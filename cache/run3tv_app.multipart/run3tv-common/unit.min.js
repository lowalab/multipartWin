/*! For license information please see unit.min.js.LICENSE.txt */
(()=>{var e={6010:(e,t,n)=>{var r,i,a=n(6933),s=n(3416),o=n(2425),l=n(5686).rpc,u=n(2592).rT,c=n(9707).cX,d={width:400,group:{},index:-1,line:-1,focus:0,tab:[]},f={},h={},g=null,p=document.getElementById("vid"),m={return:{},notify:{},eventStream:{},query:new URLSearchParams(window.location.search)};function E(e,t,n){n=3!==d.focus,"history"in d&&(n||(n=d.history.scrollTop===0-(d.history.scrollHeight-d.history.clientHeight-1)),d.history.insertAdjacentHTML("beforeend",'<div class="log" style="background-color: '+(t||"#9EE09E")+'">'+e+"</div>"),n&&(d.history.scrollTop=0-(d.history.scrollHeight-d.history.clientHeight-1))),console.log(e)}function y(e,t,n){if(!d.cli.isConnected())return E("rpc is not connected","#FF6663");void 0===n&&"function"==typeof t&&(n=t,t=void 0);var r={reqUrl:null,reqPath:d.schema+"/"+e+"-request.json",resUrl:null,resPath:d.schema+"/"+e+"-response.json",method:e,params:t,cb:n};fetch(r.reqPath).then((function(e){return r.reqUrl=e.url,e.json()})).then((function(e){return r.reqSchema=e,fetch(r.resPath)})).then((function(e){return r.resUrl=e.url,e.json()})).then((function(e){r.resSchema=e,A.call(r)})).catch(A.bind(r))}function _(e,t){if("object"!=typeof e||!e||!("msgType"in e))return E("notify > "+JSON.stringify(e),"#FDFD97");if("xlinkResolution"===e.msgType&&"xlink"in e&&"nav"===d.tab[d.focus].id&&d.index>=0&&d.line>=0){var n=f[d.group][d.line];"linear-dai"in n&&"[object Array]"===Object.prototype.toString.call(n["linear-dai"])&&function(e,t){if("string"==typeof t.xlink){var n;for(var r of e["linear-dai"])if("object"==typeof r&&r&&"xlink"in r&&r.xlink===t.xlink){n=r;break}var i=n?n.url.replace(new RegExp("<xlink>","g"),n.xlink):"xlink"in e["linear-dai"][0]?void 0:e["linear-dai"][0].url.replace(new RegExp("<xlink>","g"),t.xlink);i?fetch(i).then((function(e){return 200===e.status?e.json():e.text().then((function(t){return Promise.reject(new Error("HTTP status code "+e.status+" - "+t))}))})).then((function(e){if(!("data"in e)||"string"!=typeof e.data)return Promise.reject(new Error("'data' not found - "+JSON.stringify(e)));if(!("type"in e))return Promise.reject(new Error("'type' not found - "+JSON.stringify(e)));if("mpd"===e.type)y("org.atsc.xlinkResolution",{xlink:t.xlink,mpdURL:e.data});else if("period"===e.type)y("org.atsc.xlinkResolution",{xlink:t.xlink,period:e.data});else{if("period-url"!==e.type)return Promise.reject(new Error("'type' not match - "+JSON.stringify(e)));fetch(e.data).then((function(e){return 200===e.status?e.text():e.text().then((function(t){return Promise.reject(new Error("HTTP status code 2 - "+e.status+" - "+t))}))})).then((function(e){y("org.atsc.xlinkResolution",{xlink:t.xlink,period:e})})).catch((function(t){E("Fetch failed 2 - "+e.data+" - "+t.message,"#FF6663")}))}})).catch((function(e){E("Fetch failed - "+i+" - "+e.message,"#FF6663")})):E("xlinkResolution() - URL nout found","#FF6663")}}(n,e)}t=JSON.parse(t),console.log("notify data >>",t);var r={path:d.schema+"/"+t.method+"-"+t.params.msgType+".json",data:t,type:"notify",method:t.method};fetch(r.path).then((function(e){return r.resUrl=e.url,r.status=e.status,r.ok=e.ok,e.json()})).then((function(e){r.resSchema=e,S.call(r)})).catch(S.bind(r))}function T(e,t){if("object"!=typeof e||!e||!("schemeIdUri"in e))return E("eventStream > "+JSON.stringify(e),"#FDFD97");t=JSON.parse(t),console.log("eventStream data >>",t);var n={path:d.schema+"/"+t.method+"-notification.json",data:t,type:"eventStream",method:t.method};fetch(n.path).then((function(e){n.resUrl=e.url,n.status=e.status,n.ok=e.ok,e.text().then((function(e){var t;try{t=JSON.parse(e.trim())}catch(e){S.call(n,e)}t&&(n.resSchema=t,S.call(n))}))})).catch(S.bind(n))}function v(e){for(var t=0,n=0,r=e.length;n<r;)t=(t<<5)-t+e.charCodeAt(n++)<<0;return""+t}function S(e){try{e&&(console.error("schemaMsg() error:",e),this.resUrl?E("fetch() schema "+this.type+" > "+this.resUrl+" > "+this.status+" > "+e.message,"#FF6663"):E("fetch() > "+e.message,"#FF6663")),"resSchema"in this&&(this.resSchema.$id=this.resSchema.$schema)}catch(e){E("schemaMsg() error1: "+e.message,"#FF6663"),console.error(e)}try{var t="resSchema"in this&&b(this.method,"",this.resSchema,this.data)}catch(e){E("schemaMsg() error2: "+e.message,"#FF6663"),console.error(e)}try{var n={date:(new Date).toISOString(),data:this.data};n["schema-"+this.type+"-url"]=this.path,n["schema-"+this.type+"-pas"]=t,O(this.type,n)}catch(e){E("schemaMsg() error3: "+e.message,"#FF6663"),console.error(e)}try{"msg"in d&&(d.msg.innerHTML='<div id="schema-notify" style="background-color: '+(t?"green":"red")+'">'+this.type+'</div><pre id="not-ify"></pre>',document.getElementById("not-ify").innerText=JSON.stringify(n,null,2))}catch(e){E("schemaMsg() error4: "+e.message,"#FF6663"),console.error(e)}try{"qrmsg"in d&&u(d.qrmsg,JSON.stringify(n),{width:d.qrmsg.width})}catch(e){E("schemaMsg() error5: "+e.message,"#FF6663"),console.error(e)}}function A(e){e&&(this.resUrl?E("fetch() schema response > "+this.resUrl+" > "+e.message,"#FF6663"):this.reqUrl?E("fetch() schema request > "+this.reqUrl+" > "+e.message,"#FF6663"):E("fetch() > "+e.message,"#FF6663")),this.params&&(this.params=R(this.params)),d.cli.call(this.method,this.params,function(e,t,n){n=JSON.parse(n);var r,i=this.method+" > "+(this.params?JSON.stringify(this.params)+" > ":""),a={jsonrpc:"2.0",method:this.method,params:this.params,id:n.id},s="reqSchema"in this&&b(this.method,"request",this.reqSchema,a),o=!e&&"resSchema"in this&&b(this.method,"response",this.resSchema,n);if(d.res.innerHTML='<div id="schema-request" style="background-color: '+(s?"green":"red")+'">Request</div><div id="schema-response" style="background-color: '+(o?"green":"red")+'">Response</div><pre id="req-res"></pre>',e)return E(i+e,"#FF6663"),O("return",r={date:(new Date).toISOString(),return:!1,"schema-request-url":this.reqPath,"schema-request-pas":s,"schema-response-url":this.resPath,"schema-response-pas":o,response:n,request:a}),"res"in d&&(document.getElementById("req-res").innerText=JSON.stringify(r,null,2)),"qresp"in d&&u(d.qresp,JSON.stringify(r),{width:d.qresp.width}),void("function"==typeof this.cb&&this.cb(e));if(O("return",r={date:(new Date).toISOString(),return:!0,"schema-request-url":this.reqPath,"schema-request-pas":s,"schema-response-url":this.resPath,"schema-response-pas":o,response:n,request:a}),"res"in d&&(document.getElementById("req-res").innerText=JSON.stringify(r,null,2)),"qresp"in d){var l=JSON.stringify(r),c=JSON.parse(l);if(l.length>2e3)if(E("Data response is too big for QR code, generating hash code.","#FDFD97"),"org.atsc.query.signaling"===this.method&&"result"in c.response&&"objectList"in c.response.result&&"[object Array]"===Object.prototype.toString.call(c.response.result.objectList))for(var f=0,h=c.response.result.objectList.length;f<h;f++)"object"==typeof c.response.result.objectList[f]&&"table"in c.response.result.objectList[f]&&(c.response.result.objectList[f].table=v(c.response.result.objectList[f].table));else c.response=v(JSON.stringify(c.response));u(d.qresp,JSON.stringify(c),{width:d.qresp.width})}"function"==typeof this.cb&&this.cb(void 0,t)}.bind(this))}function R(e){for(var t of Object.keys(e))"object"==typeof e[t]&&e[t]?e[t]=R(e[t]):"string"==typeof e[t]&&(e[t]=new Function(`return \`${e[t]}\``)());return e}function b(e,t,n,r){"$schema"in n&&!("$id"in n)&&(n.$id=n.$schema);var i=new c(n);try{return"params"in r&&!r.params&&delete r.params,!!i.validate(r)}catch(n){return E("Schema "+e+" "+t+" error: "+n.message,"#FF6663"),!1}}function I(e){e.preventDefault();var t={ArrowUp:38,ArrowDown:40,ArrowRight:39,ArrowLeft:37,Select:13,Back:461};if("deviceInput"in d.device&&"object"==typeof d.device.deviceInput&&d.device.deviceInput){var n=d.device.deviceInput;"ArrowUp"in n&&"number"==typeof n.ArrowUp&&(t.ArrowUp=n.ArrowUp),"ArrowDown"in n&&"number"==typeof n.ArrowDown&&(t.ArrowDown=n.ArrowDown),"ArrowRight"in n&&"number"==typeof n.ArrowRight&&(t.ArrowRight=n.ArrowRight),"ArrowLeft"in n&&"number"==typeof n.ArrowLeft&&(t.ArrowLeft=n.ArrowLeft),"Select"in n&&"number"==typeof n.Select&&(t.Select=n.Select),"Back"in n&&"number"==typeof n.Back&&(t.Back=n.Back)}switch(e.keyCode){case t.ArrowUp:!function(){var e=d.tab[d.focus];"nav"===e.id?F("prev"):"history"!==e.id&&"res"!==e.id&&"msg"!==e.id||(e.scrollTop-=40)}();break;case t.ArrowDown:!function(){var e=d.tab[d.focus];"nav"===e.id?F("next"):"history"!==e.id&&"res"!==e.id&&"msg"!==e.id||(e.scrollTop+=40)}();break;case t.ArrowRight:!function(){var e=d.tab[d.focus];"nav"===e.id?x("next"):"res"===e.id?P("return",1):"msg"===e.id&&document.getElementById("schema-notify")&&P(document.getElementById("schema-notify").innerHTML,1)}();break;case t.ArrowLeft:!function(){var e=d.tab[d.focus];"nav"===e.id?x("prev"):"res"===e.id?P("return",-1):"msg"===e.id&&document.getElementById("schema-notify")&&P(document.getElementById("schema-notify").innerHTML,-1)}();break;case t.Select:!function(){d.qrcode&&("qresp"in d&&(d.qresp.style.visibility="visible"),"qrmsg"in d&&(d.qrmsg.style.visibility="visible"),"qrnav"in d&&(d.qrnav.style.visibility="visible"));var e=d.tab[d.focus];if("nav"===e.id){if(d.index>=0&&d.line>=0)if(e=f[d.group][d.line],"qrnav"in d&&u(d.qrnav,JSON.stringify({group:d.group,"tc-id":"description"in e&&"tc-id"in e.description?e.description["tc-id"]:d.line,status:"executed"}),{width:d.qrnav.width}),"request"in e&&"object"==typeof e.request&&e.request&&"method"in e.request&&"string"==typeof e.request.method)"clear"===e.request.method?("res"in d&&(d.res.innerHTML=""),"msg"in d&&(d.msg.innerHTML=""),"history"in d&&(d.history.innerHTML="",d.history.scrollTop=1),m={return:{},notify:{}},M={return:[],notify:[],index:{return:0,notify:0}},"qresp"in d&&d.qresp.getContext("2d").clearRect(0,0,d.qresp.width,d.qresp.height),"qrmsg"in d&&d.qrmsg.getContext("2d").clearRect(0,0,d.qrmsg.width,d.qrmsg.height)):y(e.request.method,"params"in e.request?e.request.params:void 0);else if("eval"in e&&"string"==typeof e.eval){var t=new Function(`return \`${e.eval}\``)(),n={date:(new Date).toISOString(),response:t,request:e.eval};if("res"in d&&(d.res.innerHTML='<div id="schema-request" style="background-color: green">Request</div><div id="schema-response" style="background-color: green">Response</div><pre id="req-res"></pre>',document.getElementById("req-res").innerText=JSON.stringify(n,null,2)),"qresp"in d){var l=JSON.stringify(n),c=JSON.parse(l);l.length>2e3&&(c.request=v(JSON.stringify(c.request)),c.response=v(JSON.stringify(c.response))),u(d.qresp,JSON.stringify(c),{width:d.qresp.width})}}else if("switch"in e&&"string"==typeof e.switch)e.switch=e.switch.trim().toLowerCase(),"qrcode"===e.switch?(d.qrcode=!d.qrcode,D()):"console"===e.switch?(d.logs=!d.logs,w()):"console-top"===e.switch?"history"in d&&d.logs&&(d.history.style.top="40px"===d.history.style.top?"677px":"40px",d.history.style.height="950px"===d.history.style.height?"313px":"950px"):E("Invalid switch cmd: "+e.switch,"#FF6663");else if("parseMPD"in e&&e.parseMPD&&"object"==typeof e.parseMPD&&"kid"in e.parseMPD&&"string"==typeof e.parseMPD.kid)e.parseMPD.kid=new Function(`return \`${e.parseMPD.kid}\``)(),"data"in e.parseMPD&&"string"==typeof e.parseMPD.data?(e.parseMPD.data=new Function(`return \`${e.parseMPD.data}\``)(),C.call(e.parseMPD,e.parseMPD.data)):"url"in e.parseMPD&&"string"==typeof e.parseMPD.url?(e.parseMPD.url=new Function(`return \`${e.parseMPD.url}\``)(),fetch(e.parseMPD.url,"params"in e.parseMPD&&"object"==typeof e.parseMPD.params?R(e.parseMPD.params):void 0).then((function(e){return 200===e.status?e.text():e.text().then((function(t){return Promise.reject(new Error("HTTP status code "+e.status+" - "+t))}))})).then(C.bind(e.parseMPD)).catch((function(t){L(e.parseMPD,t.message)}))):E("Invalid parseMPD cmd: "+JSON.stringify(e),"#FF6663");else if("drmData"in e&&e.drmData&&"url"in e.drmData&&"string"==typeof e.drmData.url)e.drmData.url=new Function(`return \`${e.drmData.url}\``)(),fetch(e.drmData.url,"params"in e.drmData&&"object"==typeof e.drmData.params?R(e.drmData.params):void 0).then((function(e){return 200===e.status?e.text():e.text().then((function(t){return Promise.reject(new Error("HTTP status code "+e.status+" - "+t))}))})).then((function(t){N(e.drmData,t)})).catch((function(t){L(e.drmData,t.message)}));else if("ssai"in e&&e.ssai&&"content"in e.ssai&&"string"==typeof e.ssai.content)g?(g.destroy(),g=null):(i=new a.rmp(d.cli),p.style.width="100%",p.style.top="0",p.style.left="0",(r=new s.player)._state=p.ended?2:p.paused?1:0,r.video(p),p.onended=function(){i.resume(),p.style.visibility="hidden"},p.onerror=function(){i.resume(),p.style.visibility="hidden"},p.onabort=function(){i.resume(),p.style.visibility="hidden"}),i.stop(),"qresp"in d&&(d.qresp.getContext("2d").clearRect(0,0,d.qresp.width,d.qresp.height),d.qresp.style.visibility="hidden"),"qrmsg"in d&&(d.qrmsg.getContext("2d").clearRect(0,0,d.qrmsg.width,d.qrmsg.height),d.qrmsg.style.visibility="hidden"),"qrnav"in d&&(d.qrnav.getContext("2d").clearRect(0,0,d.qrnav.width,d.qrnav.height),d.qrnav.style.visibility="hidden"),"res"in d&&(d.res.innerHTML='<div id="schema-response2">Response</div><pre id="req-res"></pre>'),"msg"in d&&(d.msg.innerHTML='<div id="schema-notify">notify</div><pre id="not-ify"></pre>'),r.type("type"in e.ssai&&"string"==typeof e.ssai.type?e.ssai.type:"auto"),r.start(e.ssai.content,(function(){r.play()}));else if("pre-dai"in e&&e["pre-dai"]&&"vast"in e["pre-dai"]&&"string"==typeof e["pre-dai"].vast)g?g.destroy():(i=new a.rmp(d.cli),p.style.width="100%",p.style.top="0",p.style.left="0",(r=new s.player)._state=p.ended?2:p.paused?1:0,r.video(p),p.onended=function(){i.resume(),p.style.visibility="hidden"},p.onerror=function(){i.resume(),p.style.visibility="hidden"},p.onabort=function(){i.resume(),p.style.visibility="hidden"}),p.style.visibility="visible",g=new o({conf:{vid:p},amp:r},(function(){}),(function(){}),e["pre-dai"].vast),i.stop(),"qresp"in d&&(d.qresp.getContext("2d").clearRect(0,0,d.qresp.width,d.qresp.height),d.qresp.style.visibility="hidden"),"qrmsg"in d&&(d.qrmsg.getContext("2d").clearRect(0,0,d.qrmsg.width,d.qrmsg.height),d.qrmsg.style.visibility="hidden"),"qrnav"in d&&(d.qrnav.getContext("2d").clearRect(0,0,d.qrnav.width,d.qrnav.height),d.qrnav.style.visibility="hidden"),"res"in d&&(d.res.innerHTML='<div id="schema-response2">Response</div><pre id="req-res"></pre>'),"msg"in d&&(d.msg.innerHTML='<div id="schema-notify">notify</div><pre id="not-ify"></pre>'),g.triggerEvent=function(t){document.getElementById("schema-notify").style.backgroundColor="AD_ERROR"===t?"red":"ALL_ADS_COMPLETED"===t?"green":"orange",document.getElementById("not-ify").innerText=JSON.stringify({event:t},null,2),"ALL_ADS_COMPLETED"!==t&&"AD_ERROR"!==t||!("content"in e["pre-dai"])||"string"!=typeof e["pre-dai"].content||(r.type("type"in e["pre-dai"]&&"string"==typeof e["pre-dai"].type?e["pre-dai"].type:"auto"),r.start(e["pre-dai"].content,(function(){r.play()}))),E("DAI event: "+t,"#9EE09E",!0)},g.triggerEvent("INIT"),document.getElementById("schema-response2").style.backgroundColor="orange",document.getElementById("req-res").innerText=JSON.stringify({request:{method:"HEAD",status:"loading",url:e["pre-dai"].vast}},null,2),E("fetch() url > "+e["pre-dai"].vast),fetch(e["pre-dai"].vast,{method:"HEAD"}).then((function(t){document.getElementById("schema-response2").style.backgroundColor=200==t.status?"green":"red",document.getElementById("req-res").innerText=JSON.stringify({response:{status:{code:t.status},url:e["pre-dai"].vast}},null,2)})).catch((function(e){document.getElementById("schema-response2").style.backgroundColor="red",document.getElementById("req-res").innerText=JSON.stringify({error:{message:e.message}},null,2),E("fethc() error > "+e.message,"#FF6663")}));else if("linear-dai"in e&&"[object Array]"===Object.prototype.toString.call(e["linear-dai"]))"auto-subscribe"in e&&e["auto-subscribe"]&&y("org.atsc.subscribe",{msgType:["xlinkResolution"]},(function(e,t){}));else if("redirect"in e&&"object"==typeof e.redirect&&e.redirect&&"url"in e.redirect&&"string"==typeof e.redirect.url){var h=new URL(new Function(`return \`${e.redirect.url}\``)());if("params"in e.redirect&&"object"==typeof e.redirect.params&&e.redirect.params){var _=new URLSearchParams(h.search);for(var T in e.redirect.params)"string"==typeof e.redirect.params[T]&&_.set(T,new Function(`return \`${e.redirect.params[T]}\``)());h.search=_.toString()}window.location.href=h.href}else E("Invalid cmd: "+JSON.stringify(e),"#FF6663")}else"history"!==e.id&&"res"!==e.id&&"msg"!==e.id||(e.innerHTML="","history"===e.id&&(e.scrollTop=1),"res"===e.id&&"qresp"in d&&d.qresp.getContext("2d").clearRect(0,0,d.qresp.width,d.qresp.height),"msg"===e.id&&"qrmsg"in d&&d.qrmsg.getContext("2d").clearRect(0,0,d.qrmsg.width,d.qrmsg.height))}();break;case t.Back:d.tab[d.focus].style.borderColor="darkslategrey",d.focus<d.tab.length-1?d.focus++:d.focus=0,d.logs||3!==d.focus||(d.focus=0),d.tab[d.focus].style.borderColor="orange"}}function D(){d.qrnav&&(d.qrnav.style.visibility=d.qrcode?"visible":"hidden"),d.qresp&&(d.qresp.style.visibility=d.qrcode?"visible":"hidden"),d.qrmsg&&(d.qrmsg.style.visibility=d.qrcode?"visible":"hidden")}function w(){"history"in d&&(d.history.style.visibility=d.logs?"visible":"hidden")}function C(e){if(!("get"in this)||"cenc:pssh"!==this.get&&"contentId-1.0"!==this.get)return L(this,"parseMPD() get value is not set");var t=(new DOMParser).parseFromString(e,"text/xml");if(!t.firstChild||!("getElementsByTagName"in t.firstChild)||"function"!=typeof t.firstChild.getElementsByTagName)return L(this,"parseMPD() firstChild error");var n=t.firstChild.getElementsByTagName("Period");if(0===n.length)return L(this,"parseMPD() Period tag not found");var r,i,a,s,o,l,u,c={},f={};for(var g of n){var p=g.getAttribute("id");f[p]=[];var m=g.getElementsByTagName("AdaptationSet");if(0!==m.length)for(var E of m){var y=E.getElementsByTagName("ContentProtection");if(!(y.length<=1)){var _;for(var T of(i="",a="",y)){if(o=T.getAttribute("cenc:default_KID")||T.getAttribute("cenc"),(r=document.createElement("div")).innerHTML=T.innerHTML.split("dashif:Laurl").join("dashif"),(s=r.getElementsByTagName("dashif"))&&s.length>0){var v;for(var S of s)(v=S.getAttribute("licenseType"))&&"contentid-1.0"===(v=v.toLowerCase())&&(a=(a=S.textContent.split("/"))[a.length-1]);var A=document.createElement("div");A.innerHTML=T.innerHTML.split("cenc:pssh").join("cenc");var R=A.getElementsByTagName("cenc");1===R.length&&(_=R[0].textContent)}o&&(i=o)}i&&a&&""!==i&&""!==a&&(i===this.kid&&(l=a,_&&(u=_)),f[p].push({default_KID:i,contentId:a,pssh:_}),a in c||(c[a]=[]),c[a].push(i))}}}console.log("this.get:",this.get),console.info("key:",l),console.info("DRM multi-period:",c),console.info("DRM return:",f),"cenc:pssh"===this.get?u?N(this,u):L(this,"parseMPD() cenc:pssh content not found"):"contentId-1.0"===this.get&&(l?N(this,l):d.cli.call("org.atsc.query.service",function(e,t){if(e)return L(this,"parseMPD() org.atsc.query.service - "+e);"service"in t&&"string"==typeof t.service&&t.service in h?N(this,h[t.service]):L(this,"parseMPD() contentId key not found")}.bind(this)))}function N(e,t){var n={date:(new Date).toISOString(),"schema-request-pas":!0,"schema-response-pas":!0,response:{},request:e};if(n.response.result=t,n.return=!0,O("return",n),document.getElementById("req-res").innerText=JSON.stringify(n,null,2),document.getElementById("schema-request").style.backgroundColor="green",document.getElementById("schema-response").style.backgroundColor="green","qresp"in d){var r=JSON.stringify(n),i=JSON.parse(r);r.length>2e3&&(i.request=v(JSON.stringify(i.request)),i.response=v(JSON.stringify(i.response))),u(d.qresp,JSON.stringify(i),{width:d.qresp.width})}}function L(e,t){var n={date:(new Date).toISOString(),"schema-request-pas":!0,"schema-response-pas":!0,response:{},request:e};if(n.response.result=t,n.return=!1,O("return",n),E("Fetch failed - "+e.url+" - "+t,"#FF6663"),document.getElementById("req-res").innerText=JSON.stringify(n,null,2),document.getElementById("schema-request").style.backgroundColor="green",document.getElementById("schema-response").style.backgroundColor="red","qresp"in d){var r=JSON.stringify(n),i=JSON.parse(r);r.length>2e3&&(i.request=v(JSON.stringify(i.request)),i.response=v(JSON.stringify(i.response))),u(d.qresp,JSON.stringify(i),{width:d.qresp.width})}}var M={return:[],notify:[],eventStream:[],index:{return:0,notify:0,eventStream:0}};function O(e,t){m[e]=t,M[e]&&M[e].length>100&&M[e].shift(),M.index[e]=M[e].push(t)-1}function P(e,t){var n=M.index[e]+t;n>=0&&n<M[e].length&&(M.index[e]=n,m[e]=M[e][n],"notify"===e||"eventStream"===e?(document.getElementById("schema-notify")&&(document.getElementById("schema-notify").style.backgroundColor=m[e]["schema-"+e+"-pas"]?"green":"red"),document.getElementById("not-ify")&&(document.getElementById("not-ify").innerText=JSON.stringify(m[e],null,2))):"return"===e&&(document.getElementById("schema-request")&&(document.getElementById("schema-request").style.backgroundColor=m[e]["schema-request-pas"]?"green":"red"),document.getElementById("schema-response")&&(document.getElementById("schema-response").style.backgroundColor=m[e]["schema-response-pas"]?"green":"red"),document.getElementById("req-res")&&(document.getElementById("req-res").innerText=JSON.stringify(m[e],null,2))))}function x(e){var t=Object.keys(f),n=d.index;if("number"==typeof e&&e>=0?e<t.length&&(d.index=e):"next"===e?d.index<t.length-1?d.index++:d.index=0:"prev"===e&&(d.index>0?d.index--:d.index=t.length-1),n!==d.index){if(d.group=t[d.index],"nav"in d)for(var r of(d.nav.innerHTML='<div id="group">GROUP: '+d.group+'</div><div id="spacer"></div>',f[d.group]))d.nav.innerHTML+='<div class="line">'+r.description["tc-id"]+" - "+r.description.name+"</div>";d.line=-1,F(0)}}function F(e){var t=f[d.group],n=d.line;if("number"==typeof e&&e>=0?e<t.length&&(d.line=e):"next"===e?d.line<t.length-1?d.line++:d.line=0:"prev"===e&&(d.line>0?d.line--:d.line=t.length-1),n!==d.line){"nav"in d&&(n<d.line?d.line>1&&(d.nav.scrollTop=20*(d.line-1)):d.nav.scrollTop=d.line>1?20*(d.line-1):0),"qrnav"in d&&u(d.qrnav,JSON.stringify({group:d.group,"tc-id":"description"in t[d.line]&&"tc-id"in t[d.line].description?t[d.line].description["tc-id"]:d.line}),{width:d.qrnav.width});var r=document.querySelectorAll(".line");n>=0&&n<r.length&&(r[n].className="line"),r&&d.line<r.length&&(r[d.line].className="line line-focus")}}e.exports={run:function(e){if("object"!=typeof e&&(e={}),"qrnav"in e&&(e.qrnav instanceof Element||e.qrnav instanceof HTMLCanvasElement)&&(d.qrnav=e.qrnav),"qresp"in e&&(e.qresp instanceof Element||e.qresp instanceof HTMLCanvasElement)&&(d.qresp=e.qresp),"qrmsg"in e&&(e.qrmsg instanceof Element||e.qrmsg instanceof HTMLCanvasElement)&&(d.qrmsg=e.qrmsg),d.qrnav.width=160,d.qresp.width=396,d.qrmsg.width=396,"nav"in e&&(e.nav instanceof Element||e.nav instanceof HTMLDocument)&&(d.nav=e.nav,d.tab.push(e.nav)),"res"in e&&(e.res instanceof Element||e.res instanceof HTMLDocument)&&(d.res=e.res,d.tab.push(e.res)),"msg"in e&&(e.msg instanceof Element||e.msg instanceof HTMLDocument)&&(d.msg=e.msg,d.tab.push(e.msg)),"history"in e&&(e.history instanceof Element||e.history instanceof HTMLDocument)&&(d.history=e.history,d.tab.push(e.history)),d.schema="schema"in e&&"string"==typeof e.schema?e.schema.trim():".",d.qrcode=!("qrcode"in e)||!!e.qrcode,D(),d.logs="logs"in e&&!!e.logs,w(),d.tab[d.focus].style.setProperty("border-color","orange"),E("@yottamedialabs/run3tv-a344-tester-app v1.0.20 ("+new Date(1666099223329).toISOString()+")","#9EC1CF"),E(navigator.userAgent,"#9EC1CF"),E(decodeURIComponent(window.location.href),"#9EC1CF"),E((new Date).toString(),"#9EC1CF"),E("App config: "+JSON.stringify(e),"#9EC1CF"),!("cmd"in e)||"string"!=typeof e.cmd)return E("Commands list is missing.","#FF6663");fetch(e.cmd).then((function(e){return e.json()})).then((function(t){if(t&&Object.keys(t).length>0){for(var n of Object.keys(t))"[object Array]"===Object.prototype.toString.call(t[n])&&(t[n].unshift({request:{method:"clear"},description:{"tc-id":"RESET",name:"Clear All"}}),f[n]=t[n]);"drm"in e&&"string"==typeof e.drm&&fetch(e.cmd).then((function(e){return e.json()})).then((function(e){h=e})).catch((function(){E("Fetch drm fail: "+e.drm,"#FF6663")})),d.cli.connect("path"in e&&"string"==typeof e.path?e.path:void 0)}else E("Invalid cmd object value.","#FF6663")})).catch((function(){E("Fetch cmd fail: "+e.cmd,"#FF6663")})),d.cli=new l(null,!1,10),d.cli.addListener("open",(function(e){E("rpc open > "+JSON.stringify(e)),y("org.atsc.request.keys",{keys:["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Select","Back"]},(function(e,t){e||y("org.atsc.query.deviceInfo",(function(e,t){e||(x(0),d.device=t,document.addEventListener("keydown",I),"history"in d&&(d.history.scrollTop=0-(d.history.scrollHeight-d.history.clientHeight-1)))}))}))})),d.cli.addListener("close",(function(e){E("rpc close > "+JSON.stringify(e),"#FDFD97")})),d.cli.addListener("notify",_),d.cli.addListener("eventStream",T),d.cli.addListener("input",(function(e){E("&rarr; "+e,"#FDFD97")})),d.cli.addListener("output",(function(e){E("&larr; "+e,"#9EC1CF")}))}(window.config),log:E,req:y,opt:d,$:m,cmd:f,drm:h,dai:g,player:r,rcv:i,vid:p}},2425:e=>{e.exports=function(e,t,n,r){this.t=e,this.gt=n,this.setFocus=t,this.ad=null,this.adProgressData=null;var i=document.createElement("script");i.src="https://imasdk.googleapis.com/js/sdkloader/ima3.js",i.id="imasdk";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(i,a),this.script=i;var s=document.createElement("div");s.onclick=function(){this.adsManager&&this.adsManager.resume(),this.setFocus()}.bind(this),s.id="ad-container",s.style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;",this.adContainer=s;var o=document.createElement("div");o.id="count-down",o.style="position: absolute;bottom: 7%;right: 8%;font-size: xxx-large;font-size: -webkit-xxx-large;color: greenyellow;text-shadow: 0px 0px 10px black, 0 0 1em black, 0 0 0.4em black;",document.body.appendChild(s),this.countDown=o,this.adComplete=!1,this.interval=null,this.request=function(e){if("string"!=typeof e)return console.error("FMW DAI request() invalid URL param:",e);this.adsRequest=new window.google.ima.AdsRequest,this.adsRequest.adTagUrl=e,this.adContainer&&(this.adContainer.style.zIndex="-1",this.adContainer.style.left=this.t.conf.vid.style.left,this.adContainer.style.top=this.t.conf.vid.style.top,this.adContainer.style.width=this.t.conf.vid.style.width,this.adContainer.style.height=this.t.conf.vid.style.width,this.adContainer.firstElementChild&&(this.adContainer.firstElementChild.style.width="100%",this.adContainer.firstElementChild.style.height="100%",document.getElementById("count-down")||this.adContainer.firstElementChild.appendChild(this.countDown)),console.log("REQUEST SCALE >>",this.adContainer.style.left,this.adContainer.style.top,this.adContainer.style.width,this.adContainer.style.height)),this.adsLoader.requestAds(this.adsRequest)},this.destroy=function(){this.adsManager&&this.adsManager.destroy(),document.getElementById("imasdk")&&document.getElementById("imasdk").remove(),document.getElementById("ad-container")&&document.getElementById("ad-container").remove(),"imasdk"in this.t&&delete this.t.imasdk},this.triggerEvent=function(e){this.t.conf.app.dynamic.iframe&&this.t.iframe.loaded&&this.t.conf.app.dynamic.iframe.contentWindow.postMessage({s:"_onIMAEvent",m:e},"*"),"_onIMAEvent"in this.t&&this.t._onIMAEvent(e)},i.onload=function(){this.adDisplayContainer=new window.google.ima.AdDisplayContainer(this.adContainer,this.t.conf.vid),this.adDisplayContainer.initialize(),this.adsLoader=new window.google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.getSettings().setFeatureFlags({disableClickAdPause:!0}),this.t.conf.vid.addEventListener("ended",function(){this.adsLoader.contentComplete()}.bind(this)),this.adsLoader.addEventListener(window.google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(e){for(var t of(this.adsManager=e.getAdsManager(this.t.conf.vid),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,function(e){this.t.amp.pause(),this.triggerEvent("CONTENT_PAUSE_REQUESTED")}.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,function(e){this.t.amp.play(),this.triggerEvent("CONTENT_RESUME_REQUESTED")}.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.LOADED,function(e){this.ad=e.getAd(),this.triggerEvent("LOADED"),this.adContainer&&this.adContainer.firstElementChild&&(this.adContainer.firstElementChild.style.width="100%",this.adContainer.firstElementChild.style.height="100%"),this.adComplete=!1,this.ad.isLinear()||this.t.amp.play()}.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.ALL_ADS_COMPLETED,function(e){this.adComplete=!0,this.triggerEvent("ALL_ADS_COMPLETED")}.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.STARTED,function(e){this.ad=e.getAd(),this.triggerEvent("STARTED"),this.adContainer&&this.adContainer.firstElementChild&&(this.adContainer.firstElementChild.style.width="100%",this.adContainer.firstElementChild.style.height="100%"),this.ad.isLinear()&&(this.interval=setInterval((function(){this&&(this.adsManager?o.innerText="DAI Remaining: "+parseInt(this.adsManager.getRemainingTime())+" sec":clearInterval(this.interval))}),300))}.bind(this)),this.adsManager.addEventListener(window.google.ima.AdEvent.Type.COMPLETE,function(e){this.triggerEvent("COMPLETE"),this.interval&&(clearInterval(this.interval),this.interval=null,o.innerText="")}.bind(this)),["CLICK","VIDEO_CLICKED","VIDEO_ICON_CLICKED","AD_PROGRESS","AD_BUFFERING","IMPRESSION","PAUSED","RESUMED","FIRST_QUARTILE","MIDPOINT","THIRD_QUARTILE","DURATION_CHANGE","USER_CLOSE","SKIPPED","LINEAR_CHANGED","SKIPPABLE_STATE_CHANGED","AD_METADATA","AD_BREAK_READY","VOLUME_CHANGED","VOLUME_MUTED","INTERACTION"]))(function(e){e in window.google.ima.AdEvent.Type&&this.adsManager.addEventListener(window.google.ima.AdEvent.Type[e],function(t){"AD_PROGRESS"===e&&(this.adProgressData=t.getAdData()),this.triggerEvent(e)}.bind(this))}).bind(this)(t);this.triggerEvent("ADS_MANAGER_LOADED");try{this.adsManager.init(this.t.conf.vid.clientWidth,this.t.conf.vid.clientHeight,window.google.ima.ViewMode.NORMAL),this.adsManager.start()}catch(e){}this.adContainer&&this.adContainer.firstElementChild&&(this.adContainer.firstElementChild.style.width="100%",this.adContainer.firstElementChild.style.height="100%")}.bind(this),!1),this.adsLoader.addEventListener(window.google.ima.AdErrorEvent.Type.AD_ERROR,function(e){this.triggerEvent("AD_ERROR"),"adsManager"in this&&this.adsManager&&(this.ad=null,this.adProgressData=null,this.adsManager.destroy())}.bind(this),!1),this.request(r)}.bind(this)}},3416:(e,t,n)=>{var r=n(4457),i=n(7631);function a(e){return(e instanceof Element||e instanceof HTMLDocument)&&"nodeName"in e&&"VIDEO"===e.nodeName}function s(e){return".m3u8"===e.substr(-5)||".M3U8"===e.substr(-5)?"hls":".mpd"===e.substr(-4)||".MPD"===e.substr(-4)?"dash":".mp4"===e.substr(-4)||".MP4"===e.substr(-4)?"mp4":void 0}function o(e){if("number"==typeof e){e=e>=0?e:0;var t=parseInt(e),n=parseInt(t/60),r=t-60*n,i=0;return n>59&&(n-=60*(i=parseInt(n/60))),{hours:i,minutes:n,seconds:r,format:(i>0?i+":"+(n<10?"0":""):"")+n+":"+(r<10?"0"+r:r)}}throw new Error("getTime() invalid input: "+e)}function l(e,t,n){if(!a(e))throw new Error("controls() invalid video element");e.nextSibling&&"amp-player"===e.nextSibling.className&&e.nextSibling.remove();var r={play:!0,back:!0,next:!0,line:!0,time:!0,full:!0};"object"==typeof t&&t&&("play"in t&&!t.play&&(r.play=!1),"next"in t&&!t.next&&(r.next=!1),"back"in t&&!t.back&&(r.back=!1),"line"in t&&!t.line&&(r.line=!1),"time"in t&&!t.time&&(r.time=!1),"full"in t&&!t.full&&(r.full=!1));var i="";r.play&&(i+='<div class="amp-player-play" style="float: left"><button style="padding: 0;font-size: x-large;background: none;border: none;outline: none" onclick="ampPlay(this.parentNode.parentNode.previousSibling)">▶️</button></div>'),r.back&&(i+='<div class="amp-player-back" style="float: left"><button style="padding: 0;font-size: x-large;background: none;border: none;outline: none" onclick="ampBack(this.parentNode.parentNode.previousSibling)">⏪</button></div>'),r.next&&(i+='<div class="amp-player-next" style="float: left"><button style="padding: 0;font-size: x-large;background: none;border: none;outline: none" onclick="ampNext(this.parentNode.parentNode.previousSibling)">⏩</button></div>'),"string"==typeof n&&(i+='<div class="amp-player-info" style="float: left;margin-top: 7px;margin-left: 7px"><span style="font-size: large">'+n+"</span></div>"),r.full&&(i+='<div class="amp-player-full" style="float: right"><button style="padding: 0;font-size: x-large;background: none;border: none;outline: none;font-weight: bold" onclick="toggleFullScreen(this.parentNode.parentNode.previousSibling)">⛶</button></div>'),r.time&&(i+='<div class="amp-player-time" style="float: right;margin-top: 7px;margin-right: 7px"><span style="font-size: larger"></span></div>'),r.line&&(i+='<div class="amp-player-line"><progress style="width: 100%;height: 1em"></progress><canvas style="width: 100%;height: 6px;display: block"></canvas></div>');var s=document.createElement("div");return s.className="amp-player",s.style.backgroundColor="rgba(255, 255, 255, 0.6)",s.style.width=e.width+"px",s.style.marginTop="-3px",s.innerHTML=i,e.parentNode.insertBefore(s,e.nextSibling),r.self=e.nextSibling,r.list={div_play:!!r.play&&e.nextSibling.querySelector(".amp-player-play"),div_back:!!r.back&&e.nextSibling.querySelector(".amp-player-back"),div_next:!!r.next&&e.nextSibling.querySelector(".amp-player-next"),div_line:!!r.line&&e.nextSibling.querySelector(".amp-player-line"),div_info:"string"==typeof n&&e.nextSibling.querySelector(".amp-player-info"),div_time:!!r.time&&e.nextSibling.querySelector(".amp-player-time"),div_full:!!r.full&&e.nextSibling.querySelector(".amp-player-full")},r.play&&(r.play=e.nextSibling.querySelector(".amp-player-play button")),r.back&&(r.back=e.nextSibling.querySelector(".amp-player-back button")),r.next&&(r.next=e.nextSibling.querySelector(".amp-player-next button")),r.line&&(r.line=e.nextSibling.querySelector(".amp-player-line progress")),"string"==typeof n&&(r.info=e.nextSibling.querySelector(".amp-player-info span")),r.time&&(r.time=e.nextSibling.querySelector(".amp-player-time span")),r.full&&(r.full=e.nextSibling.querySelector(".amp-player-full button")),r.play&&(e.onplaying=function(){this.nextSibling&&"amp-player"===this.nextSibling.className&&this.nextSibling.querySelector(".amp-player-play button")&&(this.nextSibling.querySelector(".amp-player-play button").innerHTML="⏸️")},e.onpause=function(){this.nextSibling&&"amp-player"===this.nextSibling.className&&this.nextSibling.querySelector(".amp-player-play button")&&(this.nextSibling.querySelector(".amp-player-play button").innerHTML="▶️")}),(r.line||r.time)&&(e.ontimeupdate=function(){u(this),d(this)},e.oncanplay=function(){u(this),d(this)},e.onprogress=function(){d(this)}),r}function u(e){if(e.nextSibling&&"amp-player"===e.nextSibling.className&&"duration"in e&&"number"==typeof e.duration){if(e.nextSibling.querySelector(".amp-player-line progress")&&e.duration>0){var t=e.nextSibling.querySelector(".amp-player-line progress");t.max=e.duration,t.value=e.currentTime}e.nextSibling.querySelector(".amp-player-time span")&&"duration"in e&&"number"==typeof e.duration&&(e.nextSibling.querySelector(".amp-player-time span").innerText=o(e.currentTime).format+" / "+o(e.duration).format)}}function c(e){"fullScreen"in e&&e.fullScreen?(e.style=e.fullScreen,e.fullScreen=null):(e.fullScreen=e.style,e.style.position="fixed",e.style.left="0px",e.style.width="100%",window.innerHeight>e.clientHeight?e.style.top=parseInt((window.innerHeight-e.clientHeight)/2)+"px":e.style.top="0px")}function d(e){if(a(e)&&e.nextSibling&&e.nextSibling.querySelector(".amp-player-line canvas")){var t=e.nextSibling.querySelector(".amp-player-line canvas"),n=e.buffered,r=t.width/e.duration,i=t.getContext("2d");i.clearRect(0,0,t.width,t.height),i.fillStyle="darkorange";for(var s,o,l=0;l<n.length;l++)s=n.start(l)*r,o=n.end(l)*r,i.fillRect(s,0,o-s,t.height)}}e.exports={dash:r,hls:i,player:function(){this._t="auto",this.type=function(e){if("string"==typeof e){if("hls"!==(e=e.toLowerCase())&&"dash"!==e&&"mp4"!==e)throw new Error("player.type() invalid video type: "+e);this._t=e}else this._t="auto"},this.video=function(e){if(!a(e))throw new Error("player.video() invalid video element");this._v=e},this.load=function(e,t){if("string"!=typeof e)throw new Error("player.load() invalid video source: "+e);this._t||(this._t="auto");var n="auto"===this._t?s(e):this._t;if(!n)throw new Error("player.load() invalid (can not detect) video type, please set it first using player.type()");if(!("_v"in this))throw new Error("player.load() video element not found, please set it first using player.video()");if("hls"===n){if(t&&(this._v.canPlayType("application/vnd.apple.mpegurl")||this._v.canPlayType("application/x-mpegurl")))return this._v.src=e,this._v.load(),this._l="hls",this._p=null,void(this._s=e);if("_l"in this&&"_p"in this&&"hls"===this._l&&this._p)this._p.attachMedia(this._v),a.on(i.Events.MEDIA_ATTACHED,(function(){a.loadSource(e)}));else if(i.isSupported())(a=new i).attachMedia(this._v),a.on(i.Events.MEDIA_ATTACHED,(function(){a.loadSource(e)})),this._l="hls",this._p=a,this._s=e;else{if(!this._v.canPlayType("application/vnd.apple.mpegurl")&&!this._v.canPlayType("application/x-mpegurl"))throw new Error("player.load() can not play hls");this._v.src=e,this._v.load(),this._l="hls",this._p=null,this._s=e}}else if("dash"===n){if(t&&this._v.canPlayType("application/dash+xml"))return this._v.src=e,this._v.load(),this._l="dash",this._p=null,void(this._s=e);var a;"_l"in this&&"_p"in this&&"dash"===this._l&&this._p?this._p.attachSource(e):((a=r.MediaPlayer().create()).initialize(this._v,e),this._l="dash",this._p=a,this._s=e)}else this._v.src=e,this._v.load(),this._l="mp4",this._p=null,this._s=e;this._v.nextSibling&&"amp-player"===this._v.nextSibling.className&&this._v.nextSibling.querySelector(".amp-player-info span")&&(this._v.nextSibling.querySelector(".amp-player-info span").innerText="using "+(this._p?"opensource":"built-in")+" "+this._l+" player")},this.seek=function(e){if(!("_l"in this)||!("_p"in this))throw new Error("player.seek() source not found");if("number"!=typeof e||0===e)throw new Error("player.seek() invalid value: "+e);if(!("duration"in this._v)||!("currentTime"in this._v)||"number"!=typeof this._v.duration||"number"!=typeof this._v.currentTime)throw new Error("player.seek() invalid video duration and/or currentTime properties");e>0?this._v.currentTime+e<this._v.duration?this._v.currentTime+=e:this._v.currentTime=this._v.duration:(e*=-1,this._v.currentTime-e>0?this._v.currentTime-=e:this._v.currentTime=0)},this.controls=function(e,t){if(!("_v"in this))throw new Error("player.controls() video element not found, set it first using player.video()");return l(this._v,e,t)},this.toggleFullScreen=function(){if(!("_v"in this))throw new Error("player.toggleFullScreen() video element not found, set it first using player.video()");c(this._v)},this._u=void 0,this.start=function(e,t,n){"function"==typeof t&&void 0===n&&(n=t,t=void 0);try{this.load(e),this._u=e,"number"==typeof t?this._v.loadedmetadata=function(){this._v.currentTime=t,"function"==typeof n&&n(null,{operation:"startAmp",ampurl:e,ampSyncTime:this._v.currentTime})}:"function"==typeof n&&n(null,{operation:"startAmp",ampurl:e})}catch(e){"function"==typeof n&&n(e.message)}},this.play=function(e,t){if("_v"in this)if(void 0===t&&"function"==typeof e&&(t=e),"number"==typeof e&&e>=0&&(this._v.currentTime=e),this._v.paused){var n=this._v.play();n instanceof Promise?n.then(function(){"function"==typeof t&&t(null,{operation:"playAmp",position:this._v.currentTime})}.bind(this)).catch((function(e){"function"==typeof t&&t(e.message)})):"function"==typeof t&&t(null,{operation:"playAmp",position:this._v.currentTime})}else this._v.pause(),"function"==typeof t&&t(null,{operation:"playAmp",position:this._v.currentTime});else"function"==typeof t&&t("video element not found")},this.pause=function(e){"_v"in this?(this._v.pause(),"function"==typeof e&&e(null,{operation:"pauseAmp",position:this._v.currentTime})):"function"==typeof e&&e("video element not found")},this.stop=function(e){"_v"in this?("_l"in this&&"_p"in this&&this._p?"dash"===this._l?this._p.attachSource():"hls"===this._l&&(this._p.detachMedia(),this._p=null):(this._v.pause(),this._v.src="",this._v.load()),this._u=void 0,"function"==typeof e&&e(null,{operation:"stopAmp"})):"function"==typeof e&&e("video element not found")},this.url=function(){return this._u},this.time=function(e){"_v"in this?"function"==typeof e&&e(null,{currentTime:this._v.currentTime}):"function"==typeof e&&e("video element not found")},this.state=function(e){"_v"in this?"function"==typeof e&&e(null,{playbackState:this._v.ended?2:this._v.paused?1:0}):"function"==typeof e&&e("video element not found")}},getType:s,getTime:o,controls:l,ampPlay:function(e){if(!a(e))throw new Error("ampPlay() invalid video element");e.paused?e.play():e.pause()},ampBack:function(e,t){if(a(e)){if("number"==typeof t&&t>0);else{if(!("number"==typeof e.duration&&e.duration>0))throw new Error("ampBack() invalid video duration: "+e.duration);t=(t=e.duration/20)>1?parseInt(t):1}e.currentTime-t>0?e.currentTime-=t:e.currentTime=0}},ampNext:function(e,t){if(a(e)){if("number"==typeof t&&t>0);else{if(!("number"==typeof e.duration&&e.duration>0))throw new Error("ampNext() invalid video duration: "+e.duration);t=(t=e.duration/20)>1?parseInt(t):1}e.currentTime+t<e.duration?e.currentTime+=t:e.currentTime=e.duration}},toggleFullScreen:c}},6933:e=>{e.exports={rmp:function(e){if("object"!=typeof e||!("call"in e)||"function"!=typeof e.call)throw new Error("rmp() init, invalid rpc client object");this.cli=e,this._u=void 0,this.start=function(e,t,n){if("function"==typeof t&&void 0===n&&(n=t),"string"==typeof e){this._u=e;var r={operation:"startRmp",rmpurl:e};"number"==typeof t&&(r.rmpSyncTime=t),this.cli.call("org.atsc.setRMPURL",r,n)}else"function"==typeof n&&n({message:"invalid string url value",url:e})},this.play=function(e,t){"number"==typeof e?this.cli.call("org.atsc.setRMPURL",{operation:"playRMP",position:e},t):"function"==typeof t&&t({message:"invalid position value",position:e})},this.pause=function(e){this.cli.call("org.atsc.setRMPURL",{operation:"pauseRmp"},e)},this.stop=function(e){this.cli.call("org.atsc.setRMPURL",{operation:"stopRmp"},e)},this.resume=function(e){this.cli.call("org.atsc.setRMPURL",{operation:"resumeService"},e)},this.url=function(){return this._u},this.scale=function(e,t){"object"==typeof e&&"scaleFactor"in e&&"xPos"in e&&"yPos"in e?this.cli.call("org.atsc.scale-position",e,t):"function"==typeof t&&t({message:"invalid params",params:e})},this.time=function(e){this.cli.call("org.atsc.query.rmpMediaTime",e)},this.clock=function(e){this.cli.call("org.atsc.query.rmpWallClockTime",e)},this.state=function(e){this.cli.call("org.atsc.query.rmpPlaybackState",e)},this.index=-1,this.subscribe=function(e,t){void 0===t&&"function"==typeof e&&(t=e,e=!0),-1===this.index&&(this.index=this.cli.addListener("notify",function(e){if("msgType"in e&&"string"==typeof e.msgType)switch(e.msgType){case"rmpMediaTimeChange":"_rmpMediaTimeChange"in this&&this._rmpMediaTimeChange(e);break;case"rmpPlaybackStateChange":"_rmpPlaybackStateChange"in this&&this._rmpPlaybackStateChange(e);break;case"rmpPlaybackRateChange":"_rmpPlaybackRateChange"in this&&this._rmpPlaybackRateChange(e)}}.bind(this))),e&&this.cli.call("org.atsc.subscribe",{msgType:["rmpMediaTimeChange","rmpPlaybackStateChange","rmpPlaybackRateChange"]},t)},this.unsubscribe=function(e,t){void 0===t&&"function"==typeof e&&(t=e,e=!0),this.index>=0&&(this.cli.removeListener("notify",this.index),this.index=-1),e&&this.cli.call("org.atsc.unsubscribe",{msgType:["rmpMediaTimeChange","rmpPlaybackStateChange","rmpPlaybackRateChange"]},t)},this.rmpMediaTimeChange=function(e){"function"==typeof e&&(this._rmpMediaTimeChange=e)},this.rmpPlaybackStateChange=function(e){"function"==typeof e&&(this._rmpPlaybackStateChange=e)},this.rmpPlaybackRateChange=function(e){"function"==typeof e&&(this._rmpPlaybackRateChange=e)},this.date=1666099223329,this.name="@yottamedialabs/run3tv-a344-tester-app",this.version="1.0.20"}}},5686:e=>{function t(){var e=window.location.search.substring(1),t="ws://"+window.location.host;return e.split("&").some((function(e){var n=e.split("=");if("wsURL"==n[0])return"/"===(t=decodeURIComponent(n[1])).slice(-1)&&(t=t.slice(0,-1)),!0})),t}function n(e){if(this.isConnected())this.log&&console.warn("rpc.connect() rpc is already connected",this.ws.readyState);else{var n,r=this;n="string"==typeof e?["atscCmd","atscVid","atscAud","atscCap","atscCD"].indexOf(e)>=0?t()+"/"+e:e:t()+"/atscCmd";var i=new URLSearchParams(window.location.search);if(i.has("a3fa-srv")){var a=new URL(n);a.searchParams.set("a3fa-srv",i.get("a3fa-srv")),n=a.toString()}console.log("wsConnect() url:",n),this.ws=new WebSocket(n),this.ws.onopen=function(e){r.listener.open.forEach((function(t){"function"==typeof t&&t({event:e,url:r.ws.url})}))},this.ws.onclose=function(e){r.listener.close.forEach((function(t){"function"==typeof t&&t({event:e,url:r.ws.url})}))},this.ws.onmessage=function(e){r.listener.output.forEach((function(t){"function"==typeof t&&t(e.data)}));var t=JSON.parse(e.data);if("id"in t&&t.id in r.fc)"result"in t?r.fc[t.id](void 0,t.result,e.data):r.fc[t.id](t,void 0,e.data),delete r.fc[t.id],t.id in r.tm&&(clearTimeout(r.tm[t.id]),delete r.tm[t.id]);else if(r.log&&console.log("event:",t),"result"in t)r.listener.result.forEach((function(n){"function"==typeof n&&n(t.result,e.data)}));else if("error"in t){var n={message:t.error};"code"in t&&(n.code=t.code),n.response=t,r.listener.error.forEach((function(t){"function"==typeof t&&t(n,e.data)}))}else"method"in t&&"org.atsc.notify"===t.method&&"params"in t?r.listener.notify.forEach((function(n){"function"==typeof n&&n(t.params,e.data)})):"method"in t&&"org.atsc.eventStream.event"===t.method&&"params"in t?r.listener.eventStream.forEach((function(n){"function"==typeof n&&n(t.params,e.data)})):r.listener.error.forEach((function(n){"function"==typeof n&&n({message:"Internal error",code:-32603,response:t},e.data)}))}}}e.exports={rpc:function(e,t,r){this.name="@yottamedialabs/run3tv-a344-tester-app",this.version="1.0.20",this.date=1666099223329,this.timeout="number"==typeof r&&r>0?parseInt(r):0,this.setTimeout=function(e){"number"==typeof e&&e>0?this.timeout=parseInt(e):this.log&&console.error("rpc.setTimeout() error, invalid timeout value:",e)},this.log=!!t,this.setLog=function(e){this.log=!!e},"object"==typeof e&&e&&(this.msg=e),this.setMsg=function(e){"object"==typeof e&&e&&(this.msg=e)},this.send=function(e,t){if("msg"in this){var n=arguments;this.listener.msg.forEach(function(e){"function"==typeof e&&e(this.msg.pop.apply(this.msg,n))}.bind(this))}else this.log&&console.error("rpc.send() error, msg is not configured, use setMsg() first")},this.id=1,this.fc={},this.tm={},this.reset=function(){this.id=1,this.fc={},this.tm={}},this.call=function(e,t,n){if(n="function"==typeof n?n:"function"==typeof t?t:void 0,this.isConnected()){if("string"!=typeof e){if(n)return void n("rpc.call() error, invalid call method");throw new Error("rpc.call() invalid call method")}var r={jsonrpc:"2.0",method:e};"object"==typeof t&&(r.params=t),n&&(this.timeout>0&&(this.tm[this.id]=setTimeout(function(e,t){delete this.tm[e],delete this.fc[e],n({jsonrpc:"2.0",error:{code:-32300,message:"Request timeout",seconds:t},id:e})}.bind(this),1e3*this.timeout,this.id,this.timeout)),r.id=this.id,this.fc[this.id]=n,this.id++);var i=JSON.stringify(r);this.log&&console.log("rpc.call() send: "+i),this.ws.send(i),this.listener.input.forEach((function(e){"function"==typeof e&&e(i)}))}else{if(n)return void n("rpc.call() error, connection is not open "+(this.ws?this.ws.readyState:"-1"));this.log&&console.warn("rpc.call() error: rpc connection is not open",this.ws?this.ws.readyState:"-1")}},this.listener={open:[],close:[],error:[],result:[],notify:[],eventStream:[],input:[],output:[],msg:[]},this.addListener=function(e,t){if(e in this.listener&&"function"==typeof t){var n=this.listener[e].push(t)-1;return this.log&&console.log("rpc.addListener() type",e,"index ",n),n}throw new Error("rpc.addListener() invalid params, type: "+e)},this.removeListener=function(e,t){if(!(e in this.listener&&"number"==typeof t&&t>=0))throw new Error("rpc.removeListener() invalid params, type '"+e+"' index '"+t+"'");return"function"==typeof this.listener[e][t]&&(this.log&&console.log("rpc.removeListener() type",e,"index:",t),this.listener[e][t]=null,!0)},this.ws=null,this.connect=n,this.disConnect=function(){this.isConnected()?(this.log&&console.log("rpc.disConnect() rpc is disconnecting",this.ws.readyState),this.ws.close(1e3)):this.log&&console.warn("rpc.disConnect() rpc is not connected",this.ws?this.ws.readyState:"-1")},this.isConnected=function(){return this.ws&&(0===this.ws.readyState||1===this.ws.readyState)}}}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,a=l(e),s=a[0],o=a[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,o)),c=0,d=o>0?s-4:s;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&t),1===o&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],s=16383,o=0,l=r-i;o<l;o+=s)a.push(u(e,o,o+s>l?l:o+s));return 1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),a.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=a.length;s<o;++s)n[s]=a[s],r[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,r){for(var i,a,s=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},8764:(e,t,n)=>{"use strict";const r=n(9742),i=n(645),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function o(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return u(e,t,n)}function u(e,t,n){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|p(e,t);let r=o(n);const i=r.write(e,t);return i!==n&&(r=r.slice(0,i)),r}(e,t);if(ArrayBuffer.isView(e))return function(e){if($(e,Uint8Array)){const t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if($(e,ArrayBuffer)||e&&$(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&($(e,SharedArrayBuffer)||e&&$(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);const i=function(e){if(l.isBuffer(e)){const t=0|g(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||X(e.length)?o(0):f(e):"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return c(e),o(e<0?0:0|g(e))}function f(e){const t=e.length<0?0:0|g(e.length),n=o(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,l.prototype),r}function g(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||$(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(e).length;default:if(i)return r?-1:j(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return N(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return w(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function E(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){let a,s=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let r=-1;for(a=n;a<o;a++)if(u(e,a)===u(t,-1===r?0:a-r)){if(-1===r&&(r=a),a-r+1===l)return r*s}else-1!==r&&(a-=a-r),r=-1}else for(n+l>o&&(n=o-l),a=n;a>=0;a--){let n=!0;for(let r=0;r<l;r++)if(u(e,a+r)!==u(t,r)){n=!1;break}if(n)return a}return-1}function T(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const a=t.length;let s;for(r>a/2&&(r=a/2),s=0;s<r;++s){const r=parseInt(t.substr(2*s,2),16);if(X(r))return s;e[n+s]=r}return s}function v(e,t,n,r){return W(j(t,e.length-n),e,n,r)}function S(e,t,n,r){return W(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function A(e,t,n,r){return W(z(t),e,n,r)}function R(e,t,n,r){return W(function(e,t){let n,r,i;const a=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function b(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let a=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=n){let n,r,o,l;switch(s){case 1:t<128&&(a=t);break;case 2:n=e[i+1],128==(192&n)&&(l=(31&t)<<6|63&n,l>127&&(a=l));break;case 3:n=e[i+1],r=e[i+2],128==(192&n)&&128==(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(a=l));break;case 4:n=e[i+1],r=e[i+2],o=e[i+3],128==(192&n)&&128==(192&r)&&128==(192&o)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&o,l>65535&&l<1114112&&(a=l))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return function(e){const t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=D));return n}(r)}t.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return c(e),e<=0?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)}(e,t,n)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if($(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),$(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=l.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if($(t,Uint8Array))i+t.length>r.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)E(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):m.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,t,n,r,i){if($(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let a=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0);const o=Math.min(a,s),u=this.slice(r,i),c=e.slice(t,n);for(let e=0;e<o;++e)if(u[e]!==c[e]){a=u[e],s=c[e];break}return a<s?-1:s<a?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let a=!1;for(;;)switch(r){case"hex":return T(this,e,t,n);case"utf8":case"utf-8":return v(this,e,t,n);case"ascii":case"latin1":case"binary":return S(this,e,t,n);case"base64":return A(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const D=4096;function w(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function N(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let r=t;r<n;++r)i+=Q[e[r]];return i}function L(e,t,n){const r=e.slice(t,n);let i="";for(let e=0;e<r.length-1;e+=2)i+=String.fromCharCode(r[e]+256*r[e+1]);return i}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r,i){K(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a,a>>=8,e[n++]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function x(e,t,n,r,i){K(t,r,i,e,n,7);let a=Number(t&BigInt(4294967295));e[n+7]=a,a>>=8,e[n+6]=a,a>>=8,e[n+5]=a,a>>=8,e[n+4]=a;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function F(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function k(e,t,n,r,a){return t=+t,n>>>=0,a||F(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,a){return t=+t,n>>>=0,a||F(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||M(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=J((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=J((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let r=this[e],i=1,a=0;for(;++a<t&&(i*=256);)r+=this[e+a]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||M(e,t,this.length);let r=t,i=1,a=this[e+--r];for(;r>0&&(i*=256);)a+=this[e+--r]*i;return i*=128,a>=i&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return e>>>=0,t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||M(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||M(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=J((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=J((function(e){H(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||Y(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||M(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||M(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||M(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||M(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);let i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){e=+e,t>>>=0,n>>>=0,r||O(this,e,t,n,Math.pow(2,8*n)-1,0);let i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=J((function(e,t=0){return P(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=J((function(e,t=0){return x(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);O(this,e,t,n,r-1,-r)}let i=0,a=1,s=0;for(this[t]=255&e;++i<n&&(a*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);O(this,e,t,n,r-1,-r)}let i=n-1,a=1,s=0;for(this[t+i]=255&e;--i>=0&&(a*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/a>>0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=J((function(e,t=0){return P(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=J((function(e,t=0){return x(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){return k(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return k(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{const a=l.isBuffer(e)?e:l.from(e,r),s=a.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=a[i%s]}return this};const B={};function G(e,t,n){B[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function q(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function K(e,t,n,r,i,a){if(e>n||e<t){const r="bigint"==typeof t?"n":"";let i;throw i=a>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(a+1)}${r}`:`>= -(2${r} ** ${8*(a+1)-1}${r}) and < 2 ** ${8*(a+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new B.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){H(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||Y(t,e.length-(n+1))}(r,i,a)}function H(e,t){if("number"!=typeof e)throw new B.ERR_INVALID_ARG_TYPE(t,"number",e)}function Y(e,t,n){if(Math.floor(e)!==e)throw H(e,n),new B.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new B.ERR_BUFFER_OUT_OF_BOUNDS;throw new B.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=q(String(n)):"bigint"==typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=q(i)),i+="n"),r+=` It must be ${t}. Received ${i}`,r}),RangeError);const V=/[^+/0-9A-Za-z-_]/g;function j(e,t){let n;t=t||1/0;const r=e.length;let i=null;const a=[];for(let s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function z(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(V,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function W(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function $(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!=e}const Q=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function J(e){return"undefined"==typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},715:(e,t)=>{var n={parseBuffer:function(e){return new r(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new r},createBox:function(e,t,n){var r=i.create(e);return t&&t.append(r,n),r},createFullBox:function(e,t,r){var i=n.createBox(e,t,r);return i.version=0,i.flags=0,i},Utils:{}};n.Utils.dataViewToString=function(e,t){var n=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(n).decode(e);var r=[],i=0;if("utf-8"===n)for(;i<e.byteLength;){var a=e.getUint8(i++);a<128||(a<224?(a=(31&a)<<6,a|=63&e.getUint8(i++)):a<240?(a=(15&a)<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++)):(a=(7&a)<<18,a|=(63&e.getUint8(i++))<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++))),r.push(String.fromCharCode(a))}else for(;i<e.byteLength;)r.push(String.fromCharCode(e.getUint8(i++)));return r.join("")},n.Utils.utf8ToByteArray=function(e){var t,n;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},n.Utils.appendBox=function(e,t,n){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==n)if(null!=n){var r,i=-1;if("number"==typeof n)i=n;else{if("string"==typeof n)r=n;else{if("object"!=typeof n||!n.type)return void e.boxes.push(t);r=n.type}for(var a=0;a<e.boxes.length;a++)if(r===e.boxes[a].type){i=a+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=n.parseBuffer,t.addBoxProcessor=n.addBoxProcessor,t.createFile=n.createFile,t.createBox=n.createBox,t.createFullBox=n.createFullBox,t.Utils=n.Utils,n.Cursor=function(e){this.offset=void 0===e?0:e};var r=function(e){this._cursor=new n.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};r.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},r.prototype.fetchAll=function(e,t){var n=[];return r._sweep.call(this,e,n,t),n},r.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},r._sweep=function(e,t,n){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&n)return;r._sweep.call(this.boxes[i],e,t,n)}},r.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var n=new Uint8Array(t);for(this._rawo=new DataView(n.buffer),this.bytes=n,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return n.buffer},r.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new n.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,n){this._parsing?this[e]=this._readField(t,n):this._writeField(t,n,this[e])},i.prototype._procFieldArray=function(e,t,n,r){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(n,r);else for(i=0;i<this[e].length;i++)this._writeField(n,r,this[e][i])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,n){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push({}),n.call(this,this[e][r]);else for(r=0;r<t;r++)n.call(this,this[e][r])},i.prototype._procSubEntries=function(e,t,n,r){var i;if(this._parsing)for(e[t]=[],i=0;i<n;i++)e[t].push({}),r.call(this,e[t][i]);else for(i=0;i<n;i++)r.call(this,e[t][i])},i.prototype._procEntryField=function(e,t,n,r){this._parsing?e[t]=this._readField(n,r):this._writeField(n,r,e[t])},i.prototype._procSubBoxes=function(e,t){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push(i.parse(this));else for(n=0;n<t;n++)this._rawo?this[e][n].write():this.size+=this[e][n].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,n=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(n);break;case 16:t=this._raw.getInt16(n);break;case 32:t=this._raw.getInt32(n);break;case 64:var r=this._raw.getInt32(n),i=this._raw.getInt32(n+4);t=r*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,n,r=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:r=this._raw.getUint8(i);break;case 16:r=this._raw.getUint16(i);break;case 24:r=((t=this._raw.getUint16(i))<<8)+(n=this._raw.getUint8(i+2));break;case 32:r=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),n=this._raw.getUint32(i+4),r=t*Math.pow(2,32)+n}return this._cursor.offset+=e>>3,r},i.prototype._readString=function(e){for(var t="",n=0;n<e;n++){var r=this._readUint(8);t+=String.fromCharCode(r)}return t},i.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var n=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,n}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?n.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset+8);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){n.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var n=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(n,t);break;case 16:this._rawo.setInt16(n,t);break;case 32:this._rawo.setInt32(n,t);break;case 64:var r=Math.floor(t/Math.pow(2,32)),i=t-r*Math.pow(2,32);this._rawo.setUint32(n,r),this._rawo.setUint32(n+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var n,r,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:n=(16776960&t)>>8,r=255&t,this._rawo.setUint16(i,n),this._rawo.setUint8(i+2,r);break;case 32:this._rawo.setUint32(i,t);break;case 64:r=t-(n=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,n),this._rawo.setUint32(i+4,r)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var n=0;n<e;n++)this._writeUint(8,t.charCodeAt(n))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var n=Math.floor(t),r=(t-n)*Math.pow(2,e/2);this._writeUint(e/2,n),this._writeUint(e/2,r)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,n=0;n<e.length;n++)this._rawo.setInt8(t+n,e[n]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=n.Utils.utf8ToByteArray(e);if(this._rawo)for(var r=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)r.setUint8(i,t[i]);else this.size+=t.length},i.prototype._writeField=function(e,t,n){switch(e){case"uint":this._writeUint(t,n);break;case"int":this._writeInt(t,n);break;case"template":this._writeTemplate(t,n);break;case"string":-1==t?this._writeTerminatedString(n):this._writeString(t,n);break;case"data":this._writeData(n);break;case"utf8":this._writeUTF8String(n)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)}))},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,(function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)}))},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,(function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,(function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)}))}))},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,(function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,(function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)}))}))},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,(function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))}))},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,(function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)}))},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}},4915:(e,t)=>{var n,r,i,o,l,u=function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t.push(r):r<2048?(t.push(192|r>>6),t.push(128|63&r)):r<65536?(t.push(224|r>>12),t.push(128|63&r>>6),t.push(128|63&r)):(t.push(240|r>>18),t.push(128|63&r>>12),t.push(128|63&r>>6),t.push(128|63&r))}return t},c=function(e){for(var t=[],n=0;n<e.length;){var r=e[n++];r<128||(r<224?(r=(31&r)<<6,r|=63&e[n++]):r<240?(r=(15&r)<<12,r|=(63&e[n++])<<6,r|=63&e[n++]):(r=(7&r)<<18,r|=(63&e[n++])<<12,r|=(63&e[n++])<<6,r|=63&e[n++])),t.push(String.fromCharCode(r))}return t.join("")},d={};n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=function(e){for(var t=0,r=[],i=0|e.length/3;0<i--;){var a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,r.push(n.charAt(63&a>>18)),r.push(n.charAt(63&a>>12)),r.push(n.charAt(63&a>>6)),r.push(n.charAt(63&a))}return 2==e.length-t?(a=(e[t]<<16)+(e[t+1]<<8),r.push(n.charAt(63&a>>18)),r.push(n.charAt(63&a>>12)),r.push(n.charAt(63&a>>6)),r.push("=")):1==e.length-t&&(a=e[t]<<16,r.push(n.charAt(63&a>>18)),r.push(n.charAt(63&a>>12)),r.push("==")),r.join("")},i=function(){for(var e=[],t=0;t<n.length;++t)e[n.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),o=function(e){for(var t=0,n=[],r=0|e.length/4;0<r--;){var a=(i[e.charCodeAt(t)]<<18)+(i[e.charCodeAt(t+1)]<<12)+(i[e.charCodeAt(t+2)]<<6)+i[e.charCodeAt(t+3)];n.push(255&a>>16),n.push(255&a>>8),n.push(255&a),t+=4}return n&&("="==e.charAt(t-2)?(n.pop(),n.pop()):"="==e.charAt(t-1)&&n.pop()),n},l={encode:function(e){for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},d.decodeArray=function(e){var t=o(e);return new Uint8Array(t)},d.encodeASCII=function(e){var t=l.encode(e);return r(t)},d.decodeASCII=function(e){var t=o(e);return l.decode(t)},d.encode=function(e){var t=u(e);return r(t)},d.decode=function(e){var t=o(e);return c(t)},t.decode=d.decode,t.decodeArray=d.decodeArray,t.encode=d.encode,t.encodeASCII=d.encodeASCII},9783:(e,t)=>{!function(e){"use strict";var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},n=function(e){var n=e;return t.hasOwnProperty(e)&&(n=t[e]),String.fromCharCode(n)},r=15,i=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},s={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},u=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var n=this.verboseFilter[e];this.verboseLevel>=n&&console.log(this.time+" ["+e+"] "+t)}},d=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},f=function(e,t,n,r,i){this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1};f.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var h=function(e,t,n,r,i,a){this.uchar=e||" ",this.penState=new f(t,n,r,i,a)};h.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var g=function(){this.chars=[];for(var e=0;e<i;e++)this.chars.push(new h);this.pos=0,this.currPenState=new f};g.prototype={equals:function(e){for(var t=!0,n=0;n<i;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=n(e);this.pos>=i?c.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<i;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,n=0;n<i;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var p=function(){this.rows=[];for(var e=0;e<r;e++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()};p.prototype={reset:function(){for(var e=0;e<r;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,n=0;n<r;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},copy:function(e){for(var t=0;t<r;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<r;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){c.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){c.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var n=this.rows[this.currRow];if(null!==e.indent){var r=e.indent,i=Math.max(r-1,0);n.setCursor(e.indent),e.color=n.chars[i].penState.foreground}var a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(e){c.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){c.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),c.log("INFO","Rolling up")}else c.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],n="",i=-1,a=0;a<r;a++){var s=this.rows[a].getTextString();s&&(i=a+1,e?t.push("Row "+i+': "'+s+'"'):t.push(s.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,c.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){c.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){c.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(c.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){c.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}c.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=c.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var E=function(e,t,n){this.field=e||1,this.outputs=[t,n],this.channels=[new m(1,t),new m(2,n)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};E.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var n,r,i,a=!1;this.lastTime=e,c.setTime(e);for(var s=0;s<t.length;s+=2)r=127&t[s],i=127&t[s+1],r>=16&&r<=31&&r===this.lastCmdA&&i===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+d([r,i])+") is dropped")):0!==r||0!==i?(c.log("DATA","["+d([t[s],t[s+1]])+"] -> ("+d([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),n||(a=this.parseChars(r,i))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(a):c.log("WARNING","No channel found yet. TEXT-MODE?")),n?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+d([r,i])+" orig: "+d([t[s],t[s+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var n;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;n=20===e||21===e||23===e?1:2;var r=this.channels[n-1];return 20===e||21===e||28===e||29===e?32===t?r.cc_RCL():33===t?r.cc_BS():34===t?r.cc_AOF():35===t?r.cc_AON():36===t?r.cc_DER():37===t?r.cc_RU(2):38===t?r.cc_RU(3):39===t?r.cc_RU(4):40===t?r.cc_FON():41===t?r.cc_RDC():42===t?r.cc_TR():43===t?r.cc_RTD():44===t?r.cc_EDM():45===t?r.cc_CR():46===t?r.cc_ENM():47===t&&r.cc_EOC():r.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},parseMidrow:function(e,t){var n=null;if((17===e||25===e)&&32<=t&&t<=47){if((n=17===e?1:2)!==this.currChNr)return c.log("ERROR","Mismatch channel in midrow parsing"),!1;var r=this.channels[n-1];return r.insertChars([32]),r.cc_MIDROW(t),c.log("DEBUG","MIDROW ("+d([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var n,r;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;n=e<=23?1:2,r=64<=t&&t<=95?1===n?a[e]:o[e]:1===n?s[e]:l[e];var i=this.interpretPAC(r,t);return this.channels[n-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=n,!0},interpretPAC:function(e,t){var n,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},parseChars:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var s;s=17===a?t+80:18===a?t+112:t+144,c.log("INFO","Special char '"+n(s)+"' in channel "+r),i=[s],this.lastCmdA=e,this.lastCmdB=t}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null);if(i){var o=d(i);c.log("DEBUG","Char codes =  "+o.join(","))}return i},parseBackgroundAttributes:function(e,t){var n,r,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(n={},16===e||24===e?(r=Math.floor((t-32)/2),n.background=u[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(n),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=c,e.PenState=f,e.CaptionScreen=p,e.Cea608Parser=E,e.findCea608Nalus=function(e,t,n){for(var r=0,i=t,a=[],s=function(e,t,n,r){if(4!==e||t<8)return null;var i=n.getUint8(r),a=n.getUint16(r+1),s=n.getUint32(r+3),o=n.getUint8(r+7);return 181==i&&49==a&&1195456820==s&&3==o};i<t+n;){if(r=e.getUint32(i),6==(31&e.getUint8(i+4)))for(var o=i+5,l=-1;o<i+4+r-1;){l=0;for(var u=255;255===u;)l+=u=e.getUint8(o),o++;var c=0;for(u=255;255===u;)c+=u=e.getUint8(o),o++;s(l,c,e,o)&&a.push([o,c]),o+=c}i+=r+4}return a},e.extractCea608DataFromRange=function(e,t){var n=t[0],r=[[],[]];n+=8;var i=31&e.getUint8(n);n+=2;for(var a=0;a<i;a++){var s=e.getUint8(n),o=4&s,l=3&s;n++;var u=e.getUint8(n);n++;var c=e.getUint8(n);n++,o&&(127&u)+(127&c)!=0&&(0===l?(r[0].push(u),r[0].push(c)):1===l&&(r[1].push(u),r[1].push(c)))}return r}}(t)},4457:(e,t,n)=>{"use strict";n.r(t),n.d(t,{Debug:()=>_,MediaPlayer:()=>Bi,MediaPlayerFactory:()=>Rs,MetricsReporting:()=>ba,Protection:()=>vs,default:()=>bs,supportsMediaSource:()=>Vr});var r=n(9783),i=n.n(r);const a=new class{init(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.FRAGMENTED_TEXT="fragmentedText",this.EMBEDDED_TEXT="embeddedText",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability"}constructor(){this.init()}},s=new class{init(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.INBAND_EVENT_STREAM="InbandEventStream",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.ROLE_ASARRAY="Role_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.PATCH_LOCATION="PatchLocation",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId"}constructor(){this.init()}},o=new class{init(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors"}constructor(){this.init()}},l=function(){let e,t=[];const n={},r={};function i(e,n){for(const r in t){const i=t[r];if(i.context===e&&i.name===n)return i.instance}return null}function a(e,t){return t[e]}function s(e,t,n){e in n&&(n[e]=t)}function o(t,n,r){let i;const a=t.__dashjs_factory_name,s=n[a];if(s){let a=s.instance;if(!s.override)return a.apply({context:n,factory:e},r);i=t.apply({context:n},r),a=a.apply({context:n,factory:e,parent:i},r);for(const e in a)i.hasOwnProperty(e)&&(i[e]=a[e])}else i=t.apply({context:n},r);return i.getClassName=function(){return a},i}return e={extend:function(e,t,n,r){!r[e]&&t&&(r[e]={instance:t,override:n})},getSingletonInstance:i,setSingletonInstance:function(e,n,r){for(const i in t){const a=t[i];if(a.context===e&&a.name===n)return void(t[i].instance=r)}t.push({name:n,context:e,instance:r})},deleteSingletonInstances:function(e){t=t.filter((t=>t.context!==e))},getSingletonFactory:function(e){let r=a(e.__dashjs_factory_name,n);return r||(r=function(n){let r;return void 0===n&&(n={}),{getInstance:function(){return r||(r=i(n,e.__dashjs_factory_name)),r||(r=o(e,n,arguments),t.push({name:e.__dashjs_factory_name,context:n,instance:r})),r}}},n[e.__dashjs_factory_name]=r),r},getSingletonFactoryByName:function(e){return a(e,n)},updateSingletonFactory:function(e,t){s(e,t,n)},getClassFactory:function(e){let t=a(e.__dashjs_factory_name,r);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return o(e,t,arguments)}}},r[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return a(e,r)},updateClassFactory:function(e,t){s(e,t,r)}},e}(),u=l,c=class{extend(e,t){if(!e)return;let n=!!t&&t.override,r=!!t&&t.publicOnly;for(const t in e)!e.hasOwnProperty(t)||this[t]&&!n||r&&-1===e[t].indexOf("public_")||(this[t]=e[t])}},d=new class extends c{constructor(){super(),this.AST_IN_FUTURE="astInFuture",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_LOADED="bufferLoaded",this.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",this.DYNAMIC_TO_STATIC="dynamicToStatic",this.ERROR="error",this.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",this.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",this.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",this.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",this.LOG="log",this.MANIFEST_LOADED="manifestLoaded",this.METRICS_CHANGED="metricsChanged",this.METRIC_CHANGED="metricChanged",this.METRIC_ADDED="metricAdded",this.METRIC_UPDATED="metricUpdated",this.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",this.PERIOD_SWITCH_STARTED="periodSwitchStarted",this.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",this.QUALITY_CHANGE_RENDERED="qualityChangeRendered",this.TRACK_CHANGE_RENDERED="trackChangeRendered",this.SOURCE_INITIALIZED="sourceInitialized",this.STREAM_INITIALIZING="streamInitializing",this.STREAM_UPDATED="streamUpdated",this.STREAM_INITIALIZED="streamInitialized",this.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",this.TEXT_TRACKS_ADDED="allTextTracksAdded",this.TEXT_TRACK_ADDED="textTrackAdded",this.TTML_PARSED="ttmlParsed",this.TTML_TO_PARSE="ttmlToParse",this.CAPTION_RENDERED="captionRendered",this.CAPTION_CONTAINER_RESIZE="captionContainerResize",this.CAN_PLAY="canPlay",this.PLAYBACK_ENDED="playbackEnded",this.PLAYBACK_ERROR="playbackError",this.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",this.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",this.PLAYBACK_PAUSED="playbackPaused",this.PLAYBACK_PLAYING="playbackPlaying",this.PLAYBACK_PROGRESS="playbackProgress",this.PLAYBACK_RATE_CHANGED="playbackRateChanged",this.PLAYBACK_SEEKED="playbackSeeked",this.PLAYBACK_SEEKING="playbackSeeking",this.PLAYBACK_SEEK_ASKED="playbackSeekAsked",this.PLAYBACK_STALLED="playbackStalled",this.PLAYBACK_STARTED="playbackStarted",this.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",this.PLAYBACK_WAITING="playbackWaiting",this.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",this.GAP_CAUSED_SEEK_TO_PERIOD_END="gapCausedSeekToPeriodEnd",this.GAP_CAUSED_INTERNAL_SEEK="gapCausedInternalSeek",this.EVENT_MODE_ON_START="eventModeOnStart",this.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",this.CONFORMANCE_VIOLATION="conformanceViolation"}};function f(){let e={};function t(t,n,r){let i=-1;return e[t]?(e[t].some(((e,t)=>{if(e&&e.callback===n&&(!r||r===e.scope))return i=t,!0})),i):i}return{on:function(n,r,i,a={}){if(!n)throw new Error("event type cannot be null or undefined");if(!r||"function"!=typeof r)throw new Error("listener must be a function: "+r);let s=a.priority||0;if(t(n,r,i)>=0)return;e[n]=e[n]||[];const o={callback:r,scope:i,priority:s};i&&i.getStreamId&&(o.streamId=i.getStreamId()),i&&i.getType&&(o.mediaType=i.getType()),a&&a.mode&&(o.mode=a.mode),e[n].some(((t,r)=>{if(t&&s>t.priority)return e[n].splice(r,0,o),!0}))||e[n].push(o)},off:function(n,r,i){if(!n||!r||!e[n])return;const a=t(n,r,i);a<0||(e[n][a]=null)},trigger:function(t,n={},r={}){if(t&&e[t]){if((n=n||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");n.type=t,r.streamId&&(n.streamId=r.streamId),r.mediaType&&(n.mediaType=r.mediaType),e[t].filter((e=>!(!e||r.streamId&&e.streamId&&e.streamId!==r.streamId||r.mediaType&&e.mediaType&&e.mediaType!==r.mediaType||r.mode&&e.mode&&e.mode!==r.mode||!e.mode&&r.mode&&r.mode===d.EVENT_MODE_ON_RECEIVE))).forEach((e=>e&&e.callback.call(e.scope,n)))}},reset:function(){e={}}}}f.__dashjs_factory_name="EventBus";const h=u.getSingletonFactory(f);h.EVENT_PRIORITY_LOW=0,h.EVENT_PRIORITY_HIGH=5e3,u.updateSingletonFactory(f.__dashjs_factory_name,h);const g=h,p=class extends c{constructor(){super(),this.ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",this.BUFFERING_COMPLETED="bufferingCompleted",this.BUFFER_CLEARED="bufferCleared",this.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",this.BYTES_APPENDED="bytesAppended",this.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",this.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",this.CURRENT_TRACK_CHANGED="currentTrackChanged",this.DATA_UPDATE_COMPLETED="dataUpdateCompleted",this.DATA_UPDATE_STARTED="dataUpdateStarted",this.INBAND_EVENTS="inbandEvents",this.INITIALIZATION_LOADED="initializationLoaded",this.INIT_FRAGMENT_LOADED="initFragmentLoaded",this.INIT_FRAGMENT_NEEDED="initFragmentNeeded",this.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",this.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",this.LIVE_EDGE_SEARCH_COMPLETED="liveEdgeSearchCompleted",this.LOADING_COMPLETED="loadingCompleted",this.LOADING_PROGRESS="loadingProgress",this.LOADING_DATA_PROGRESS="loadingDataProgress",this.LOADING_ABANDONED="loadingAborted",this.MANIFEST_UPDATED="manifestUpdated",this.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",this.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",this.QUOTA_EXCEEDED="quotaExceeded",this.REPRESENTATION_UPDATE_STARTED="representationUpdateStarted",this.REPRESENTATION_UPDATE_COMPLETED="representationUpdateCompleted",this.SEGMENTS_LOADED="segmentsLoaded",this.SERVICE_LOCATION_BLACKLIST_ADD="serviceLocationBlacklistAdd",this.SERVICE_LOCATION_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",this.SOURCEBUFFER_REMOVE_COMPLETED="sourceBufferRemoveCompleted",this.STREAMS_COMPOSED="streamsComposed",this.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",this.STREAM_COMPLETED="streamCompleted",this.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",this.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",this.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",this.URL_RESOLUTION_FAILED="urlResolutionFailed",this.VIDEO_CHUNK_RECEIVED="videoChunkReceived",this.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",this.XLINK_ELEMENT_LOADED="xlinkElementLoaded",this.XLINK_READY="xlinkReady",this.SEGMENTBASE_INIT_REQUEST_NEEDED="segmentBaseInitRequestNeeded",this.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED="segmentBaseSegmentsListRequestNeeded",this.SEEK_TARGET="seekTarget"}},m=new class extends p{};function E(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=e.settings,i=[];let a,s,o,l;function u(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function c(...e){E(1,this,...e)}function d(...e){E(2,this,...e)}function f(...e){E(3,this,...e)}function h(...e){E(4,this,...e)}function p(...e){E(5,this,...e)}function E(e,t,...a){let u="",c=null;s&&(c=(new Date).getTime(),u+="["+(c-l)+"]"),o&&t&&t.getClassName&&(u+="["+t.getClassName()+"]",t.getType&&(u+="["+t.getType()+"]")),u.length>0&&(u+=" "),Array.apply(null,a).forEach((function(e){u+=e+" "})),i[e]&&r.get().debug.logLevel>=e&&i[e](u),r&&r.get().debug.dispatchEvent&&n.trigger(m.LOG,{message:u,level:e})}return a={getLogger:function(e){return{fatal:c.bind(e),error:d.bind(e),warn:f.bind(e),info:h.bind(e),debug:p.bind(e)}},setLogTimestampVisible:function(e){s=e},setCalleeNameVisible:function(e){o=e}},s=!0,o=!0,l=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(i[1]=u(window.console.error),i[2]=u(window.console.error),i[3]=u(window.console.warn),i[4]=u(window.console.info),i[5]=u(window.console.debug)),a}E.__dashjs_factory_name="Debug";const y=u.getSingletonFactory(E);y.LOG_LEVEL_NONE=0,y.LOG_LEVEL_FATAL=1,y.LOG_LEVEL_ERROR=2,y.LOG_LEVEL_WARNING=3,y.LOG_LEVEL_INFO=4,y.LOG_LEVEL_DEBUG=5,u.updateSingletonFactory(E.__dashjs_factory_name,y);const _=y;function T(){const e=this.context,t=g(e).getInstance();let n,r,i,s,l,u,c,d,f,h,p,E,y,T,v,S,A,R,b,I,D,w,C,N;function L(e){if(d&&isNaN(f))return;let n=f;if(isNaN(n))if(y){n=e.liveStartTime;const t=s.getCurrentDVRInfo(),i=t?t.range:null;if(i){const e=j(!0);isNaN(e)||(r.info("Start time from URI parameters: "+e),n=Math.max(Math.min(n,e),i.start))}}else{n=E.start;const e=j(!1);!isNaN(e)&&e<n+E.duration&&(r.info("Start time from URI parameters: "+e),n=Math.max(n,e))}isNaN(n)||n===u.getTime()||(t.trigger(m.PLAYBACK_SEEKING,{seekTime:n}),U(n,!1,!0))}function M(){return parseFloat((O()-B()).toFixed(5))}function O(){return E.start+E.duration}function P(){E&&u&&u.getElement()?u.play():v=!0}function x(){return E&&u?u.isPaused():null}function F(){E&&u&&u.pause()}function k(){return E&&u?u.isSeeking():null}function U(e,n,i){E&&u&&e!==(isNaN(R)?u.getTime():R)&&(b=!0===i,b||(R=e,t.trigger(m.PLAYBACK_SEEK_ASKED)),r.info("Requesting seek to time: "+e+(b?" (internal)":"")),u.setCurrentTime(e,n))}function B(){return E&&u?u.getTime():null}function G(){let e=B();if(y&&!isNaN(A)){const t=A/1e3;e>t&&(e-=t)}return e}function q(){return E&&u?u.getPlaybackRate():null}function K(){return E&&u?u.getEnded():null}function H(){return y}function Y(){if(!y||isNaN(A))return NaN;let e=G();if(isNaN(e)||0===e)return 0;const t=(new Date).getTime()+1e3*c.getClientTimeOffset();return Math.max(((t-A-1e3*e)/1e3).toFixed(3),0)}function V(){v=!1,d=!1,f=NaN,p=0,A=0,R=NaN,u&&(t.off(m.STREAM_INITIALIZED,L,this),t.off(m.DATA_UPDATE_COMPLETED,X,this),t.off(m.BUFFER_LEVEL_STATE_CHANGED,Ee,this),t.off(m.LOADING_PROGRESS,me,this),t.off(m.PLAYBACK_PROGRESS,de,this),t.off(m.PLAYBACK_TIME_UPDATED,de,this),t.off(m.PLAYBACK_ENDED,ue,this),t.off(m.STREAM_INITIALIZING,_e,this),W(),u.removeEventListener("canplay",Q),u.removeEventListener("play",J),u.removeEventListener("waiting",Z),u.removeEventListener("playing",ee),u.removeEventListener("pause",te),u.removeEventListener("error",ce),u.removeEventListener("seeking",ne),u.removeEventListener("seeked",re),u.removeEventListener("timeupdate",ie),u.removeEventListener("progress",ae),u.removeEventListener("ratechange",se),u.removeEventListener("loadedmetadata",oe),u.removeEventListener("stalled",ye),u.removeEventListener("ended",le)),h=null,u=null,E=null,y=null}function j(e){const t=C.getURIFragmentData();if(!t||!t.t)return NaN;const n=i.getStreams()[0].getStreamInfo().start;t.t=t.t.split(",")[0];const r=-1!==t.t.indexOf("posix:")?"now"===t.t.substring(6)?Date.now()/1e3:parseInt(t.t.substring(6)):NaN;return e&&!isNaN(r)?r-A/1e3:parseInt(t.t)+n}function z(){null===h&&(h=setInterval((function(){t.trigger(m.WALLCLOCK_TIME_UPDATED,{isDynamic:y,time:new Date}),H()&&x()&&function(){const e=Date.now();(!S||e>S+500)&&(S=e,ie())}()}),N.get().streaming.wallclockTimeUpdateInterval))}function W(){clearInterval(h),h=null}function $(e){if(x()||!y||0===u.getReadyState())return;const t=G(),n=function(e,t){const n=s.getCurrentDVRInfo(t),i=n?n.range:null;let a;return i?(r.debug(`Checking DVR window for at ${e} with DVR window range ${i.start} - ${i.end}`),a=e>i.end?Math.max(i.end-p,i.start):e>0&&e+.25<i.start&&Math.abs(e-i.start)<31536e4?i.start:e,a):NaN}(t,e);!isNaN(n)&&n!==t&&!k()&&(r.debug(`UpdateCurrentTime: Seek to actual time: ${n} from currentTime: ${t}`),U(n))}function X(e){if(e.error)return;const t=l.convertDataToRepresentationInfo(e.currentRepresentation),n=t?t.mediaInfo.streamInfo:null;null!==n&&E.id===n.id&&(E=n,$())}function Q(){t.trigger(m.CAN_PLAY)}function J(){r.info("Native video element event: play"),$(),z(),t.trigger(m.PLAYBACK_STARTED,{startTime:B()})}function Z(){r.info("Native video element event: waiting"),t.trigger(m.PLAYBACK_WAITING,{playingTime:B()})}function ee(){r.info("Native video element event: playing"),t.trigger(m.PLAYBACK_PLAYING,{playingTime:B()})}function te(){r.info("Native video element event: pause"),t.trigger(m.PLAYBACK_PAUSED,{ended:K()})}function ne(){if(b)return void(b=!1);let e=B();isNaN(R)||R===e||(e=R),R=NaN,r.info("Seeking to: "+e),z(),t.trigger(m.PLAYBACK_SEEKING,{seekTime:e})}function re(){r.info("Native video element event: seeked"),t.trigger(m.PLAYBACK_SEEKED)}function ie(){E&&t.trigger(m.PLAYBACK_TIME_UPDATED,{timeToEnd:M(),time:B()})}function ae(){t.trigger(m.PLAYBACK_PROGRESS)}function se(){const e=q();r.info("Native video element event: ratechange: ",e),t.trigger(m.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function oe(){r.info("Native video element event: loadedmetadata"),t.trigger(m.PLAYBACK_METADATA_LOADED),z()}function le(){r.info("Native video element event: ended"),F(),W();const e=i?i.getActiveStreamInfo():null;e&&t.trigger(m.PLAYBACK_ENDED,{isLast:e.isLast})}function ue(e){if(h&&e.isLast){r.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");const t=e.seekTime?e.seekTime:O();u.setCurrentTime(t),F(),W()}}function ce(e){const n=e.target||e.srcElement;t.trigger(m.PLAYBACK_ERROR,{error:n.error})}function de(){y&&fe()&&N.get().streaming.liveCatchup.playbackRate>0&&!x()&&!k()&&(function(){try{if(fe()&&N.get().streaming.liveCatchup.playbackRate>0&&B()>0){const e=ge(),t=Y(),n=T.getLiveDelay(),r=T.getLiveCatchupLatencyThreshold(),i=N.get().streaming.liveCatchup.minDrift;if(e===a.LIVE_CATCHUP_MODE_LOLP){return function(e,t,n,r,i,a){try{const s=Math.abs(e-t);return(isNaN(a)||e<=a)&&(s>n||r<i)}catch(e){return!1}}(t,n,i,he(),N.get().streaming.liveCatchup.playbackBufferMin,r)}return function(e,t,n,r){try{return Math.abs(e-t)>r&&(isNaN(n)||e<=n)}catch(e){return!1}}(t,n,r,i)}}catch(e){return!1}}()?function(){if(u){let e;const t=u.getPlaybackRate(),n=N.get().streaming.liveCatchup.playbackRate,i=Y(),o=T.getLiveDelay(),l=he();ge()===a.LIVE_CATCHUP_MODE_LOLP?(N.get().streaming.liveCatchup.minDrift,e=function(e,t,n,i,a,s,o){const l=e;let u;if(s<a){const e=5*(s-a);u=1-l+2*l/(1+Math.pow(Math.E,-e)),r.debug("[LoL+ playback control_buffer-based] bufferLevel: "+s+", newRate: "+u)}else{const e=.02;if(Math.abs(t-n)<=e*n)u=1;else{const e=5*(t-n);u=1-l+2*l/(1+Math.pow(Math.E,-e))}r.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+u)}return D&&s>n/2&&(D=!1),Math.abs(o-u)<=w&&(u=null),{newRate:u}}(n,i,o,0,N.get().streaming.liveCatchup.playbackBufferMin,l,t)):e=function(e,t,n,r,i){const a=t-n,s=5*a;let o=1-e+2*e/(1+Math.pow(Math.E,-s));return D&&(r>n/2?D=!1:a>0&&(o=1)),Math.abs(i-o)<=w&&(o=null),{newRate:o}}(n,i,o,l,t);let c=e.newRate;c&&u.setPlaybackRate(c);const d=i-o;N.get().streaming.liveCatchup.maxDrift>0&&!I&&d>N.get().streaming.liveCatchup.maxDrift?(r.info("Low Latency catchup mechanism. Latency too high, doing a seek to live point"),I=!0,function(){const e=s.getCurrentDVRInfo();U((e?e.range:null).end-T.getLiveDelay(),!0,!1)}()):I=!1}}():pe())}function fe(){return N.get().streaming.liveCatchup.enabled||N.get().streaming.lowLatencyEnabled}function he(){let e=null;return i.getActiveStreamProcessors().forEach((t=>{const n=t.getBufferLevel();e=null===e?n:Math.min(e,n)})),e}function ge(){const e=N.get().streaming.liveCatchup.playbackBufferMin;return N.get().streaming.liveCatchup.mode!==a.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?a.LIVE_CATCHUP_MODE_DEFAULT:a.LIVE_CATCHUP_MODE_LOLP}function pe(){u&&u.setPlaybackRate(1)}function me(e){if(!1===e.stream&&N.get().streaming.lowLatencyEnabled&&!isNaN(e.request.duration)){const t=1.2*e.request.duration;if(t>T.getLiveDelay()){r.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",t.toFixed(2));const e={streaming:{liveDelay:t}};N.update(e)}}}function Ee(e){e.streamId===E.id&&(fe()?e.state!==o.BUFFER_EMPTY||k()||D||(D=!0,pe()):u.setStallState(e.mediaType,e.state===o.BUFFER_EMPTY))}function ye(e){t.trigger(m.PLAYBACK_STALLED,{e})}function _e(e){!function(e,t){if(e&&e.manifestInfo&&e.manifestInfo.serviceDescriptions){let n;for(let t=0;t<e.manifestInfo.serviceDescriptions.length;t++){const r=e.manifestInfo.serviceDescriptions[t];if(r.schemeIdUri===a.SERVICE_DESCRIPTION_LL_SCHEME){n=r;break}}n&&t&&t.supplementalProperties&&"true"===t.supplementalProperties[a.SUPPLEMENTAL_PROPERTY_LL_SCHEME]&&(n.latency&&n.latency.target>0&&(r.debug("Apply LL properties coming from service description. Target Latency (ms):",n.latency.target),N.update({streaming:{lowLatencyEnabled:!0,liveDelay:n.latency.target/1e3,liveCatchup:{minDrift:n.latency.max>n.latency.target?(n.latency.max-n.latency.target)/1e3:void 0}}})),n.playbackRate&&n.playbackRate.max>1&&(r.debug("Apply LL properties coming from service description. Max PlaybackRate:",n.playbackRate.max),N.update({streaming:{lowLatencyEnabled:!0,liveCatchup:{playbackRate:n.playbackRate.max-1}}})))}}(e.streamInfo,e.mediaInfo)}return n={initialize:function(e,n,r){E=e,u.addEventListener("canplay",Q),u.addEventListener("play",J),u.addEventListener("waiting",Z),u.addEventListener("playing",ee),u.addEventListener("pause",te),u.addEventListener("error",ce),u.addEventListener("seeking",ne),u.addEventListener("seeked",re),u.addEventListener("timeupdate",ie),u.addEventListener("progress",ae),u.addEventListener("ratechange",se),u.addEventListener("loadedmetadata",oe),u.addEventListener("stalled",ye),u.addEventListener("ended",le),y=E.manifestInfo.isDynamic,I=!1,D=!1,d=!0===n,f=r,b=!1;const i="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",a=/safari/.test(i)&&!/chrome/.test(i);w=a?.25:.02,t.on(m.STREAM_INITIALIZED,L,this),t.on(m.DATA_UPDATE_COMPLETED,X,this),t.on(m.LOADING_PROGRESS,me,this),t.on(m.BUFFER_LEVEL_STATE_CHANGED,Ee,this),t.on(m.PLAYBACK_PROGRESS,de,this),t.on(m.PLAYBACK_TIME_UPDATED,de,this),t.on(m.PLAYBACK_ENDED,ue,this,{priority:g.EVENT_PRIORITY_HIGH}),t.on(m.STREAM_INITIALIZING,_e,this),v&&(v=!1,P())},setConfig:function(e){e&&(e.streamController&&(i=e.streamController),e.dashMetrics&&(s=e.dashMetrics),e.mediaPlayerModel&&(T=e.mediaPlayerModel),e.adapter&&(l=e.adapter),e.videoModel&&(u=e.videoModel),e.timelineConverter&&(c=e.timelineConverter),e.uriFragmentModel&&(C=e.uriFragmentModel),e.settings&&(N=e.settings))},getStartTimeFromUriParameters:j,getTimeToStreamEnd:M,getTime:B,getNormalizedTime:G,getPlaybackRate:q,getPlayedRanges:function(){return E&&u?u.getPlayedRanges():null},getEnded:K,getIsDynamic:H,getStreamController:function(){return i},computeAndSetLiveDelay:function(e,t,n){let r,i,a;const s=!isNaN(e)&&isFinite(e)?e:NaN;let o=l.getSuggestedPresentationDelay();if(r=N.get().streaming.lowLatencyEnabled?0:T.getLiveDelay()?T.getLiveDelay():null===N.get().streaming.liveDelayFragmentCount||isNaN(N.get().streaming.liveDelayFragmentCount)||isNaN(s)?!0===N.get().streaming.useSuggestedPresentationDelay&&null!==o&&!isNaN(o)&&o>0?o:isNaN(s)?isNaN(n)?4*E.manifestInfo.minBufferTime:4*n:4*s:s*N.get().streaming.liveDelayFragmentCount,a=l.getAvailabilityStartTime(),null!==a&&(A=a),t>0){const e=Math.max(t-10,t/2);i=Math.min(r,e)}else i=r;return p=i,i},getLiveDelay:function(){return p},setLiveDelay:function(e,t=!1){t&&e<p||(p=e)},getCurrentLiveLatency:Y,play:P,isPaused:x,pause:F,isSeeking:k,getStreamEndTime:O,seek:U,updateCurrentTime:$,reset:V},r=_(e).getInstance().getLogger(n),V(),n}T.__dashjs_factory_name="PlaybackController";const v=u.getSingletonFactory(T);class S{constructor(){this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null}}class A{constructor(){this.s=null,this.d=null,this.b=[]}}S.GET="GET",S.HEAD="HEAD",S.MPD_TYPE="MPD",S.XLINK_EXPANSION_TYPE="XLinkExpansion",S.INIT_SEGMENT_TYPE="InitializationSegment",S.INDEX_SEGMENT_TYPE="IndexSegment",S.MEDIA_SEGMENT_TYPE="MediaSegment",S.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",S.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",S.LICENSE="license",S.OTHER_TYPE="other";class R{constructor(e){this.action=R.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=e||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}isInitializationRequest(){return this.type&&this.type===S.INIT_SEGMENT_TYPE}setInfo(e){this.type=e&&e.init?S.INIT_SEGMENT_TYPE:S.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}R.ACTION_DOWNLOAD="download",R.ACTION_COMPLETE="complete";const b=R,I="loading",D="executed",w="failed";function C(e){const t=(e=e||{}).eventBus,n=e.events,r=e.dashMetrics,i=e.fragmentLoader,a=e.debug,s=e.streamInfo,o=e.type;let l,u,c,d;function f(e){return!!e&&function(t){let n=!1;return t.some((t=>{if(r=e,i=t,!isNaN(r.index)&&r.startTime===i.startTime&&r.adaptationIndex===i.adaptationIndex&&r.type===i.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,t)||function(e,t){return e.action===b.ACTION_COMPLETE&&e.action===t.action}(e,t))return n=!0,n;var r,i})),n}(c)}function h(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function g(e){c=c.filter((t=>{const n=h(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-n}))}function p(e,t){t<=e+.5||(c=c.filter((n=>{const r=h(n);return isNaN(n.startTime)||n.startTime>=t-r||isNaN(n.duration)||n.startTime+n.duration<=e+r})))}function m(e,t,n){for(let r=e.length-1;r>=0;r--){const i=e[r],a=i.startTime,s=a+i.duration;if(n=isNaN(n)?h(i):n,!isNaN(a)&&!isNaN(s)&&t+n>=a&&t-n<s||isNaN(a)&&isNaN(t))return i}return null}function E(e,t){r.addSchedulingInfo(e,t),r.addRequestsQueue(e.mediaType,d,c)}function y(e){e.sender===i&&(d.splice(d.indexOf(e.request),1),e.response&&!e.error&&c.push(e.request),E(e.request,e.error?w:D),t.trigger(n.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:s.id,mediaType:o}))}function _(e){e.sender===i&&t.trigger(n.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:s.id,mediaType:o})}function T(e){e.sender===i&&t.trigger(n.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:s.id,mediaType:o})}function v(){c=[],d=[]}return l={getStreamId:function(){return s.id},getType:function(){return o},getRequests:function(e){const t=e?e.state instanceof Array?e.state:[e.state]:[];let n=[];return t.forEach((t=>{const r=function(e){let t;switch(e){case I:t=d;break;case D:t=c;break;default:t=[]}return t}(t);n=n.concat(function(e,t){return t.hasOwnProperty("time")?[m(e,t.time,t.threshold)]:e.filter((e=>{for(const n in t)if("state"!==n&&t.hasOwnProperty(n)&&e[n]!=t[n])return!1;return!0}))}(r,e))})),n},isFragmentLoaded:f,isFragmentLoadedOrPending:function(e){let t,n=!1,r=0;if(n=f(e),!n)for(r=0;r<d.length;r++)t=d[r],e.url===t.url&&e.startTime===t.startTime&&(n=!0);return n},removeExecutedRequestsBeforeTime:g,removeExecutedRequestsAfterTime:function(e){c=c.filter((t=>isNaN(t.startTime)||void 0!==e&&t.startTime<e))},syncExecutedRequestsWithBufferedRange:function(e,t){if(!e||0===e.length)return void g();let n=0;for(let t=0,r=e.length;t<r;t++)p(n,e.start(t)),n=e.end(t);t>0&&p(n,t)},abortRequests:function(){u.debug("abort requests"),i.abort(),d=[]},executeRequest:function(e){switch(e.action){case b.ACTION_COMPLETE:c.push(e),E(e,D),u.debug("STREAM_COMPLETED"),t.trigger(n.STREAM_COMPLETED,{request:e},{streamId:e.mediaInfo.streamInfo.id,mediaType:e.mediaType});break;case b.ACTION_DOWNLOAD:E(e,I),d.push(e),function(e){t.trigger(n.FRAGMENT_LOADING_STARTED,{request:e},{streamId:s.id,mediaType:o}),i.load(e)}(e);break;default:u.warn("Unknown request action.")}},reset:function(){t.off(n.LOADING_COMPLETED,y,this),t.off(n.LOADING_DATA_PROGRESS,_,this),t.off(n.LOADING_ABANDONED,T,this),i&&i.reset(),v()},addExecutedRequest:function(e){c.push(e)}},u=a.getLogger(l),v(),t.on(n.LOADING_COMPLETED,y,l),t.on(n.LOADING_DATA_PROGRESS,_,l),t.on(n.LOADING_ABANDONED,T,l),l}C.__dashjs_factory_name="FragmentModel";const N=u.getClassFactory(C);N.FRAGMENT_MODEL_LOADING=I,N.FRAGMENT_MODEL_EXECUTED=D,N.FRAGMENT_MODEL_CANCELED="canceled",N.FRAGMENT_MODEL_FAILED=w,u.updateClassFactory(C.__dashjs_factory_name,N);const L=N,M=class{constructor(e,t,n){this.code=e||null,this.message=t||null,this.data=n||null}};class O{constructor(e){if(this.offset=e._offset,this.type=e.type,this.size=e.size,this.boxes=[],e.boxes)for(let t=0;t<e.boxes.length;t++)this.boxes.push(new O(e.boxes[t]));switch(this.isComplete=!0,e.type){case"sidx":if(this.timescale=e.timescale,this.earliest_presentation_time=e.earliest_presentation_time,this.first_offset=e.first_offset,this.references=e.references,e.references){this.references=[];for(let t=0;t<e.references.length;t++){let n={reference_type:e.references[t].reference_type,referenced_size:e.references[t].referenced_size,subsegment_duration:e.references[t].subsegment_duration};this.references.push(n)}}break;case"emsg":this.id=e.id,this.version=1===e.version?1:0,this.value=e.value,this.timescale=e.timescale,this.scheme_id_uri=e.scheme_id_uri,this.presentation_time_delta=1===e.version?e.presentation_time:e.presentation_time_delta,this.event_duration=e.event_duration,this.message_data=e.message_data;break;case"mdhd":this.timescale=e.timescale;break;case"mfhd":this.sequence_number=e.sequence_number;break;case"subs":this.entry_count=e.entry_count,this.entries=e.entries;break;case"tfhd":this.base_data_offset=e.base_data_offset,this.sample_description_index=e.sample_description_index,this.default_sample_duration=e.default_sample_duration,this.default_sample_size=e.default_sample_size,this.default_sample_flags=e.default_sample_flags,this.flags=e.flags;break;case"tfdt":this.version=e.version,this.baseMediaDecodeTime=e.baseMediaDecodeTime,this.flags=e.flags;break;case"trun":if(this.sample_count=e.sample_count,this.first_sample_flags=e.first_sample_flags,this.data_offset=e.data_offset,this.flags=e.flags,this.samples=e.samples,e.samples){this.samples=[];for(let t=0,n=e.samples.length;t<n;t++){let n={sample_size:e.samples[t].sample_size,sample_duration:e.samples[t].sample_duration,sample_composition_time_offset:e.samples[t].sample_composition_time_offset};this.samples.push(n)}}}}getChildBox(e){for(let t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}getChildBoxes(e){let t=[];for(let n=0;n<this.boxes.length;n++)this.boxes[n].type===e&&t.push(this.boxes[n]);return t}}const P=O;function x(){let e,t;function n(e){let n=[];if(!e||!t||"function"!=typeof t.fetchAll)return n;let i,a=t.fetchAll(e);for(let e=0,t=a.length;e<t;e++)i=r(a[e]),i&&n.push(i);return n}function r(e){if(!e)return null;let t=new P(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return e={getBox:function(e){return e&&t&&t.boxes&&0!==t.boxes.length&&"function"==typeof t.fetch?r(t.fetch(e)):null},getBoxes:n,setData:function(e){t=e},getLastBox:function(){if(!t||!t.boxes||!t.boxes.length)return null;let e=n(t.boxes[t.boxes.length-1].type);return e.length>0?e[e.length-1]:null}},e}x.__dashjs_factory_name="IsoFile";const F=u.getClassFactory(x);var k=n(715);const U=class{constructor(e,t,n){this.lastCompletedOffset=e,this.found=t,this.size=n}};function B(){let e,t,n=this.context;function r(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);let t=k.parseBuffer(e),r=F(n).create();return r.setData(t),r}function i(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function a(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:r,findLastTopIsoBoxCompleted:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new U(0,!1);const r=t instanceof ArrayBuffer?new Uint8Array(t):t;let s,o=0;for(;n<r.byteLength;){const t=i(r,n),l=a(r,n+4);if(0===t)break;n+t<=r.byteLength&&(e.indexOf(l)>=0?s=new U(n,!0,t):o=n+t),n+=t}return s||new U(o,!1)},getMediaTimescaleFromMoov:function(e){let t=r(e),n=t?t.getBox("mdhd"):void 0;return n?n.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};let t,n,i,a,s,o,l,u,c,d,f,h,g,p,m,E,y,_=r(e),T=_.getBoxes("moof"),v=_.getBoxes("mfhd");E=_.getBoxes("moof").length,m=v[v.length-1].sequence_number,i=0,o=[];let S=-1,A=-1;for(f=0;f<T.length;f++){let e=T[f],r=e.getChildBoxes("traf");for(c=0;c<r.length;c++){let f=r[c],m=f.getChildBox("tfhd"),E=f.getChildBox("tfdt");s=E.baseMediaDecodeTime;let _=f.getChildBoxes("trun"),T=f.getChildBoxes("subs");for(d=0;d<_.length;d++){let r=_[d];for(i=r.sample_count,p=(m.base_data_offset||0)+(r.data_offset||0),u=0;u<i;u++){l=r.samples[u],t=void 0!==l.sample_duration?l.sample_duration:m.default_sample_duration,a=void 0!==l.sample_size?l.sample_size:m.default_sample_size,n=void 0!==l.sample_composition_time_offset?l.sample_composition_time_offset:0;let i={dts:s,cts:s+n,duration:t,offset:e.offset+p,size:a,subSizes:[a]};if(T)for(h=0;h<T.length;h++){let e=T[h];if(S<e.entry_count-1&&u>A&&(S++,A+=e.entries[S].sample_delta),u==A){i.subSizes=[];let t=e.entries[S];for(g=0;g<t.subsample_count;g++)i.subSizes.push(t.subsamples[g].subsample_size)}}o.push(i),p+=a,s+=t}}y=s-E.baseMediaDecodeTime}}return{sampleList:o,lastSequenceNumber:m,totalDuration:y,numSequences:E}},findInitRange:function(t){let n,i,a=null;const s=r(t);if(!s)return a;const o=s.getBox("ftyp"),l=s.getBox("moov");return e.debug("Searching for initialization."),l&&l.isComplete&&(n=o?o.offset:l.offset,i=l.offset+l.size-1,a=n+"-"+i,e.debug("Found the initialization.  Range: "+a)),a},parsePayload:function(e,t,n){if(void 0===n&&(n=0),!t||n+8>=t.byteLength)return new U(0,!1);const r=t instanceof ArrayBuffer?new Uint8Array(t):t;let s,o=0;for(;n<r.byteLength;){const t=i(r,n),l=a(r,n+4);if(0===t)break;n+t<=r.byteLength&&(e.indexOf(l)>=0?s=new U(n,!0,t,l):o=n+t),n+=t}return s||new U(o,!1)}},e=_(n).getInstance().getLogger(t),t}B.__dashjs_factory_name="BoxParser";const G=u.getSingletonFactory(B);function q(e,t){if(typeof e!==t)throw a.BAD_ARGUMENT_ERROR}function K(e){if(null===e||isNaN(e)||e%1!=0)throw a.BAD_ARGUMENT_ERROR+" : argument is not an integer"}function H(){return{customTimeRangeArray:[],length:0,add:function(e,t){let n=0;for(n=0;n<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[n].start;n++);for(this.customTimeRangeArray.splice(n,0,{start:e,end:t}),n=0;n<this.customTimeRangeArray.length-1;n++)this.mergeRanges(n,n+1)&&n--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(let n=0;n<this.customTimeRangeArray.length;n++)if(e<=this.customTimeRangeArray[n].start&&t>=this.customTimeRangeArray[n].end)this.customTimeRangeArray.splice(n,1),n--;else{if(e>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end){this.customTimeRangeArray.splice(n+1,0,{start:t,end:this.customTimeRangeArray[n].end}),this.customTimeRangeArray[n].end=e;break}e>this.customTimeRangeArray[n].start&&e<this.customTimeRangeArray[n].end?this.customTimeRangeArray[n].end=e:t>this.customTimeRangeArray[n].start&&t<this.customTimeRangeArray[n].end&&(this.customTimeRangeArray[n].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){let n=this.customTimeRangeArray[e],r=this.customTimeRangeArray[t];return n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(n.end=r.end,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(n.start=r.start,this.customTimeRangeArray.splice(t,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end?(this.customTimeRangeArray.splice(e,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return K(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return K(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}H.__dashjs_factory_name="CustomTimeRanges";const Y=u.getClassFactory(H);var V=n(315);function j(){const e=this.context,t=g(e).getInstance();let n,r,i,s,o,l,u,c,d,f,h,p,E,y,T,v,S,A;function R(e){const t=o[e].kind,n=void 0!==o[e].id?o[e].id:o[e].lang,r=o[e].lang,i=o[e].isTTML,a=o[e].isEmbedded;return s.addTextTrack(t,n,r,i,a)}function b(e,t,n,r,i,a){let s=0,o=0;e/t>n/r?(o=t,s=o/r*n):(s=e,o=s/n*r);let l=0,u=0,c=0,d=0;return s/o>i?(d=o,c=o*i):(c=s,d=s/i),l=(e-c)/2,u=(t-d)/2,a?{x:l+.1*c,y:u+.1*d,w:.8*c,h:.8*d}:{x:l,y:u,w:c,h:d}}function I(e,n){const r=s.getClientWidth(),i=s.getClientHeight(),a=s.getVideoWidth(),o=s.getVideoHeight(),l=s.getVideoRelativeOffsetTop(),u=s.getVideoRelativeOffsetLeft();if(0!==a&&0!==o){let s=a/o,g=!1;e.isFromCEA608&&(s=3.5/3,g=!0);const E=b.call(this,r,i,a,o,s,g),_=E.w,v=E.h,A=E.x,R=E.y;if(_!=f||v!=h||A!=c||R!=d||n){if(c=A+u,d=R+l,f=_,h=v,p){const e=p.style;e&&(e.left=c+"px",e.top=d+"px",e.width=f+"px",e.height=h+"px",e.zIndex=y&&document[y]||T?S:null,t.trigger(m.CAPTION_CONTAINER_RESIZE))}const n=e.activeCues;if(n){const e=n.length;for(let t=0;t<e;++t){const e=n[t];e.scaleCue(e)}}}}}function D(e){const t=f,n=h;let r,i,a,s,o;if(e.cellResolution){const l=[t/e.cellResolution[0],n/e.cellResolution[1]];if(e.linePadding)for(r in e.linePadding)if(e.linePadding.hasOwnProperty(r)){i=(e.linePadding[r]*l[0]).toString();const t=document.getElementsByClassName("spanPadding");for(let e=0;e<t.length;e++)t[e].style.cssText=t[e].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i),t[e].style.cssText=t[e].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.fontSize){for(r in e.fontSize)if(e.fontSize.hasOwnProperty(r)){"%"===e.fontSize[r][0]?a=e.fontSize[r][1]/100:"c"===e.fontSize[r][0]&&(a=e.fontSize[r][1]),i=(a*l[1]).toString(),o="defaultFontSize"!==r?document.getElementsByClassName(r):document.getElementsByClassName("paragraph");for(let e=0;e<o.length;e++)o[e].style.cssText=o[e].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}if(e.lineHeight)for(r in e.lineHeight)if(e.lineHeight.hasOwnProperty(r)){"%"===e.lineHeight[r][0]?s=e.lineHeight[r][1]/100:"c"===e.fontSize[r][0]&&(s=e.lineHeight[r][1]),i=(s*l[1]).toString(),o=document.getElementsByClassName(r);for(let e=0;e<o.length;e++)o[e].style.cssText=o[e].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+i)}}}if(e.isd){let t=document.getElementById(e.cueID);t&&p.removeChild(t),w(e)}}function w(e){if(p){const n=document.createElement("div");p.appendChild(n),v=(0,V.renderHTML)(e.isd,n,(function(t){const n=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,r=/^#(.*)$/;if(n.test(t)){const r=n.exec(t),i=parseInt(r[4],10)-1;return"data:image/png;base64,"+btoa(e.images[i])}if(r.test(t)){const n=r.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[n]}return null}),p.clientHeight,p.clientWidth,!1,(function(e){r.info("renderCaption :",e)}),v,!0),n.id=e.cueID,t.trigger(m.CAPTION_RENDERED,{captionDiv:n,currentTrackIdx:u})}}function C(e){return e>=0&&o[e]?s.getTextTrack(o[e].kind,o[e].id,o[e].lang,o[e].isTTML,o[e].isEmbedded):null}function N(e){if(e===u)return;u=e;const t=C(u);L.call(this,t),E&&(clearInterval(E),E=null),t&&"html"===t.renderingType&&(I.call(this,t,!0),window.ResizeObserver?(A=new window.ResizeObserver((()=>{I.call(this,t,!0)})),A.observe(s.getElement())):E=setInterval(I.bind(this,t),500))}function L(e){F.call(this),e&&"html"===e.renderingType?P.call(this):x.call(this)}function M(e,t,n){return(isNaN(t)||e.startTime>=t)&&(isNaN(n)||e.endTime<=n)}function O(e,t,n){if(e.cues){const r=e.cues;for(let i=r.length-1;i>=0;i--)M(r[i],t,n)&&e.removeCue(r[i])}}function P(){let e=document.getElementById("native-cue-style");if(e)return;e=document.createElement("style"),e.id="native-cue-style",document.head.appendChild(e);const t=e.sheet,n=s.getElement();try{n&&(n.id?t.insertRule("#"+n.id+"::cue {background: transparent}",0):0!==n.classList.length?t.insertRule("."+n.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){r.info(""+e.message)}}function x(){const e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function F(){if(p)for(;p.firstChild;)p.removeChild(p.firstChild)}return n={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(i=window.VTTCue||window.TextTrackCue,o=[],l=[],u=-1,c=0,d=0,f=0,h=0,p=null,E=null,T=!1,S=2147483647,v=null,void 0!==document.fullscreenElement?y="fullscreenElement":void 0!==document.webkitIsFullScreen?y="webkitIsFullScreen":document.msFullscreenElement?y="msFullscreenElement":document.mozFullScreen&&(y="mozFullScreen"))},setDisplayCConTop:function(e){q(e,"boolean"),T=e,p&&!document[y]&&(p.style.zIndex=e?S:null)},addTextTrack:function(e,n){if(o.length!==n){if(o.push(e),o.length===n){o.sort((function(e,t){return e.index-t.index})),p=s.getTTMLRenderingDiv();let e=-1;for(let n=0;n<o.length;n++){const r=R.call(this,n);l.push(r),o[n].defaultTrack&&(r.default=!0,e=n);const i=C(n);i&&(i.mode=a.TEXT_SHOWING,p&&(o[n].isTTML||o[n].isEmbedded)?i.renderingType="html":i.renderingType="default"),this.addCaptions(n,0,o[n].captionData),t.trigger(m.TEXT_TRACK_ADDED)}if(N.call(this,e),e>=0){let n=function(){const r=C(e);r&&I.call(this,r,!0),t.off(m.PLAYBACK_METADATA_LOADED,n,this)};t.on(m.PLAYBACK_METADATA_LOADED,n,this);for(let t=0;t<o.length;t++){const n=C(t);n&&(n.mode=t===e?a.TEXT_SHOWING:a.TEXT_HIDDEN)}}t.trigger(m.TEXT_TRACKS_QUEUE_INITIALIZED,{index:u,tracks:o})}}else r.error("Trying to add too many tracks.")},addCaptions:function(e,n,s){const o=C(e),l=this;if(o&&Array.isArray(s)&&0!==s.length)for(let e=0;e<s.length;e++){let g;const E=s[e];o.cellResolution=E.cellResolution,o.isFromCEA608=E.isFromCEA608,"html"===E.type&&p?(g=new i(E.start-n,E.end-n,""),g.cueHTMLElement=E.cueHTMLElement,g.isd=E.isd,g.images=E.images,g.embeddedImages=E.embeddedImages,g.cueID=E.cueID,g.scaleCue=D.bind(l),g.cellResolution=E.cellResolution,g.lineHeight=E.lineHeight,g.linePadding=E.linePadding,g.fontSize=E.fontSize,p.style.left=c+"px",p.style.top=d+"px",p.style.width=f+"px",p.style.height=h+"px",g.onenter=function(){o.mode===a.TEXT_SHOWING&&(this.isd?(w(this),r.debug("Cue enter id:"+this.cueID)):(p.appendChild(this.cueHTMLElement),D.call(l,this),t.trigger(m.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:u})))},g.onexit=function(){if(p){const e=p.childNodes;for(let t=0;t<e.length;++t)e[t].id===this.cueID&&(r.debug("Cue exit id:"+e[t].id),p.removeChild(e[t]),--t)}}):E.data&&(g=new i(E.start-n,E.end-n,E.data),E.styles&&(void 0!==E.styles.align&&"align"in g&&(g.align=E.styles.align),void 0!==E.styles.line&&"line"in g&&(g.line=E.styles.line),void 0!==E.styles.position&&"position"in g&&(g.position=E.styles.position),void 0!==E.styles.size&&"size"in g&&(g.size=E.styles.size)),g.onenter=function(){o.mode===a.TEXT_SHOWING&&t.trigger(m.CAPTION_RENDERED,{currentTrackIdx:u})});try{g?o.addCue(g):r.error("impossible to display subtitles.")}catch(e){throw O(o),o.addCue(g),e}}},getCurrentTrackIdx:function(){return u},setCurrentTrackIdx:N,getTrackIdxForId:function(e){let t=-1;for(let n=0;n<o.length;n++)if(o[n].id===e){t=n;break}return t},getCurrentTrackInfo:function(){return o[u]},setModeForTrackIdx:function(e,t){const n=C(e);n&&n.mode!==t&&(n.mode=t)},deleteCuesFromTrackIdx:function(e,t,n){const r=C(e);r&&O(r,t,n)},deleteAllTextTracks:function(){const e=l?l.length:0;for(let t=0;t<e;t++){const e=C(t);e&&(O.call(this,e),e.mode="disabled")}l=[],o=[],E&&(clearInterval(E),E=null),A&&s&&(A.unobserve(s.getElement()),A=null),u=-1,F.call(this)},deleteTextTrack:function(e){s.removeChild(l[e]),l.splice(e,1)},setConfig:function(e){e&&e.videoModel&&(s=e.videoModel)}},r=_(e).getInstance().getLogger(n),n}j.__dashjs_factory_name="TextTracks";const z=u.getSingletonFactory(j);function W(){let e,t=0;function n(e){let t="";for(let n=0;n<e.length;++n)t+=e[n].uchar;return t.length-t.replace(/^\s+/,"").length}function r(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function i(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function a(e,t){const n=e.videoHeight/15;return t?"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?i(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?i(t.background):"transparent")+";":"font-size: "+n+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function s(e){return e.replace(/^\s+/g,"")}function o(e){return e.replace(/\s+$/g,"")}return e={createHTMLCaptionsFromScreen:function(e,i,l,u){let c=null,d=null,f=!1,h=-1,g={start:i,end:l,spans:[]},p="style_cea608_white_black";const m={},E={},y=[];let _,T;for(_=0;_<15;++_){const e=u.rows[_];let t="",r=null;if(!1===e.isEmpty()){const a=n(e.chars);null===c&&(c={x:a,y1:_,y2:_+1,p:[]}),a!==h&&f&&(c.p.push(g),g={start:i,end:l,spans:[]},c.y2=_,c.name="region_"+c.x+"_"+c.y1+"_"+c.y2,!1===m.hasOwnProperty(c.name)?(y.push(c),m[c.name]=c):(d=m[c.name],d.p.contat(c.p)),c={x:a,y1:_,y2:_+1,p:[]});for(let n=0;n<e.chars.length;++n){const i=e.chars[n],a=i.penState;if(null===r||!a.equals(r)){t.trim().length>0&&(g.spans.push({name:p,line:t,row:_}),t="");let e="style_cea608_"+a.foreground+"_"+a.background;a.underline&&(e+="_underline"),a.italics&&(e+="_italics"),E.hasOwnProperty(e)||(E[e]=JSON.parse(JSON.stringify(a))),r=a,p=e}t+=i.uchar}t.trim().length>0&&g.spans.push({name:p,line:t,row:_}),f=!0,h=a}else f=!1,h=-1,c&&(c.p.push(g),g={start:i,end:l,spans:[]},c.y2=_,c.name="region_"+c.x+"_"+c.y1+"_"+c.y2,!1===m.hasOwnProperty(c.name)?(y.push(c),m[c.name]=c):(d=m[c.name],d.p.contat(c.p)),c=null)}c&&(c.p.push(g),c.y2=_+1,c.name="region_"+c.x+"_"+c.y1+"_"+c.y2,!1===m.hasOwnProperty(c.name)?(y.push(c),m[c.name]=c):(d=m[c.name],d.p.contat(c.p)),c=null);const v=[];for(_=0;_<y.length;++_){const n=y[_],u="sub_cea608_"+t++,c=document.createElement("div");c.id=u;const d=r(n);c.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+d;const f=document.createElement("div");f.className="paragraph bodyStyle",f.style.cssText=a(e);const h=document.createElement("div");h.className="cueUniWrapper",h.style.cssText="unicode-bidi: normal; direction: ltr;";for(let t=0;t<n.p.length;++t){const r=n.p[t];let i=0;for(T=0;T<r.spans.length;++T){let t=r.spans[T];if(t.line.length>0){if(0!==T&&i!=t.row){const e=document.createElement("br");e.className="lineBreak",h.appendChild(e)}let n=!1;i===t.row&&(n=!0),i=t.row;const l=E[t.name],u=document.createElement("span");u.className="spanPadding "+t.name+" customSpanColor",u.style.cssText=a(e,l),0!==T&&n?T===r.spans.length-1?u.textContent=o(t.line):u.textContent=t.line:r.spans.length>1&&T<r.spans.length-1&&t.row===r.spans[T+1].row?u.textContent=s(t.line):u.textContent=t.line.trim(),h.appendChild(u)}}}f.appendChild(h),c.appendChild(f);const g={bodyStyle:["%",90]};for(const e in E)E.hasOwnProperty(e)&&(g[e]=["%",90]);v.push({type:"html",start:i,end:l,cueHTMLElement:c,cueID:u,cellResolution:[32,15],isFromCEA608:!0,fontSize:g,lineHeight:{},linePadding:{}})}return v}},e}W.__dashjs_factory_name="EmbeddedTextHtmlRender";const $=u.getSingletonFactory(W),X=class{extend(e,t){if(!e)return;let n=!!t&&t.override,r=!!t&&t.publicOnly;for(const t in e)!e.hasOwnProperty(t)||this[t]&&!n||r&&-1===e[t].indexOf("public_")||(this[t]=e[t])}},Q=new class extends X{constructor(){super(),this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,this.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,this.SEGMENTS_UPDATE_FAILED_ERROR_CODE=13,this.SEGMENTS_UNAVAILABLE_ERROR_CODE=14,this.SEGMENT_BASE_LOADER_ERROR_CODE=15,this.TIME_SYNC_FAILED_ERROR_CODE=16,this.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,this.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,this.APPEND_ERROR_CODE=20,this.REMOVE_ERROR_CODE=21,this.DATA_UPDATE_FAILED_ERROR_CODE=22,this.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,this.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,this.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,this.DOWNLOAD_ERROR_ID_SIDX_CODE=26,this.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,this.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,this.DOWNLOAD_ERROR_ID_XLINK_CODE=29,this.MANIFEST_ERROR_ID_CODEC_CODE=30,this.MANIFEST_ERROR_ID_PARSE_CODE=31,this.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,this.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,this.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,this.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,this.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",this.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",this.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",this.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",this.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",this.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segments",this.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize time",this.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",this.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",this.APPEND_ERROR_MESSAGE="chunk is not defined",this.REMOVE_ERROR_MESSAGE="buffer is not defined",this.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",this.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",this.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",this.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",this.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : "}};function J(){const e=this.context,t=g(e).getInstance();let n,r,s,o,l,u,c,d,f,h,p,E,y,T,v,A,R,b,I,D,w,C,N,L,O,P,x=!1;function F(){y=null,v=NaN,A=[],I=null,T=!1}function U(){F(),p=[],d=null}function B(e){const t=e.chunk;t.mediaInfo.embeddedCaptions&&V(t.bytes,t)}function q(){w=[],E=z(e).getInstance(),E.setConfig({videoModel:R}),E.initialize(),s=G(e).getInstance(),D=null,C=0,L=[],N=null,x=!0,O=$(e).getInstance();const n=b.getActiveStreamProcessors();for(const e in n)if("video"===n[e].getType()){P=n[e].getRepresentationInfo().MSETimeOffset;break}t.on(m.VIDEO_CHUNK_RECEIVED,B,this),t.on(m.BUFFER_CLEARED,W,this)}function K(e){D=e}function H(e,t){const n=new class{constructor(){this.captionData=null,this.label=null,this.lang=null,this.defaultTrack=!1,this.kind=null,this.isFragmented=!1,this.isEmbedded=!1}},r={subtitle:"subtitles",caption:"captions"};n.captionData=e,n.lang=t.lang,n.labels=t.labels,n.id=t.id?t.id:t.index,n.index=t.index,n.isTTML=function(){let e=!1;return t.codec&&t.codec.search(a.STPP)>=0&&(e=!0),t.mimeType&&t.mimeType.search(a.TTML)>=0&&(e=!0),e}(),n.defaultTrack=function(e){let t=!1;return w.length>1&&e.isEmbedded?t=e.id&&e.id===a.CC1:1===w.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===w.length&&(t=e.index===p[0].index),t}(t),n.isFragmented=!l.getIsTextTrack(t.mimeType),n.isEmbedded=!!t.isEmbedded,n.kind=function(){let e=t.roles.length>0?r[t.roles[0]]:r.caption;return e=e===r.caption||e===r.subtitle?e:r.caption,e}(),n.roles=t.roles,n.accessibility=t.accessibility;const i=(p?p.length:0)+w.length;E.addTextTrack(n,i)}function V(e,t){let n,l,c,f,h,g,p;const m=t.mediaInfo,_=m.type,A=m.mimeType,b=m.codec||A;if(b){if(_===a.FRAGMENTED_TEXT)if(T||"InitializationSegment"!==t.segmentType){if(!T)return;if(g=s.getSamplesInfo(e),l=g.sampleList,null===I&&l.length>0&&(I=l[0].cts-t.start*v),b.search(a.STPP)>=0)for(d=null!==d?d:j(b),c=0;c<l.length;c++){const t=l[c],i=t.cts,s=i-I;this.buffered.add(s/v,(s+t.duration)/v);const o=new DataView(e,t.offset,t.subSizes[0]);p=k.Utils.dataViewToString(o,a.UTF8);const h=[];let g=t.offset+t.subSizes[0];for(f=1;f<t.subSizes.length;f++){const n=new Uint8Array(e,g,t.subSizes[f]),r=String.fromCharCode.apply(null,n);h.push(r),g+=t.subSizes[f]}try{const e=u.getValue().ttmlTimeIsRelative?i/v:0;n=d.parse(p,e,i/v,(i+t.duration)/v,h),E.addCaptions(D,I/v,n)}catch(e){y.removeExecutedRequestsBeforeTime(),this.remove(),r.error("TTML parser error: "+e.message)}}else{const t=[];for(c=0;c<l.length;c++){const n=l[c];n.cts-=I,this.buffered.add(n.cts/v,(n.cts+n.duration)/v);const i=e.slice(n.offset,n.offset+n.size),a=k.parseBuffer(i);for(f=0;f<a.boxes.length;f++){const e=a.boxes[f];if(r.debug("VTT box1: "+e.type),"vtte"!==e.type&&"vttc"===e.type)for(r.debug("VTT vttc boxes.length = "+e.boxes.length),h=0;h<e.boxes.length;h++){const i=e.boxes[h];if(r.debug("VTT box2: "+i.type),"payl"===i.type){const e=i.cue_text;r.debug("VTT cue_text = "+e);const a=n.cts/v,s=(n.cts+n.duration)/v;t.push({start:a,end:s,data:e,styles:{}}),r.debug("VTT "+a+"-"+s+" : "+e)}}}}t.length>0&&E.addCaptions(D,0,t)}}else T=!0,v=s.getMediaTimescaleFromMoov(e);else if(_===a.TEXT){const t=new DataView(e,0,e.byteLength);p=k.Utils.dataViewToString(t,a.UTF8);try{n=j(b).parse(p,0),E.addCaptions(E.getCurrentTrackIdx(),0,n)}catch(e){o.error(new M(Q.TIMED_TEXT_ERROR_ID_PARSE_CODE,Q.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,p))}}else if(_===a.VIDEO)if(t.segmentType===S.INIT_SEGMENT_TYPE){if(0===C)for(C=s.getMediaTimescaleFromMoov(e),c=0;c<w.length;c++)H(null,w[c])}else{if(0===C)return void r.warn("CEA-608: No timescale for embeddedTextTrack yet");const t=function(e,t){return function(e,n,r){let i=null;i=R.getTTMLRenderingDiv()?O.createHTMLCaptionsFromScreen(R.getElement(),e,n,r):[{start:e,end:n,data:r.getDisplayText(),styles:{}}],i&&E.addCaptions(t,0,i)}};g=s.getSamplesInfo(e);const n=g.lastSequenceNumber;if(!L[0]&&!L[1]){let e,n,s;for(c=0;c<w.length;c++){if(w[c].id===a.CC1?(e=0,s=E.getTrackIdxForId(a.CC1)):w[c].id===a.CC3&&(e=1,s=E.getTrackIdxForId(a.CC3)),-1===s)return void r.warn("CEA-608: data before track is ready.");n=t(this,s),L[c]=new(i().Cea608Parser)(c+1,{newCue:n},null)}}if(C){if(null!==N&&n!==N+g.numSequences)for(c=0;c<L.length;c++)L[c]&&L[c].reset();const t=function(e,t){if(0===t.length)return null;const n={splits:[],fields:[[],[]]},r=new DataView(e);for(let e=0;e<t.length;e++){const a=t[e],s=i().findCea608Nalus(r,a.offset,a.size);let o=null,l=0;for(let e=0;e<s.length;e++){const t=i().extractCea608DataFromRange(r,s[e]);for(let e=0;e<2;e++)t[e].length>0&&(a.cts!==o?l=0:l+=1,n.fields[e].push([a.cts+P*C,t[e],l]),o=a.cts)}}return n.fields.forEach((function(e){e.sort((function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]}))})),n}(e,g.sampleList);for(let e=0;e<L.length;e++){const n=t.fields[e],r=L[e];if(r)for(c=0;c<n.length;c++)r.addData(n[c][0]/C,n[c][1])}N=n}}}else r.error("No text type defined")}function j(e){let t;return e.search(a.VTT)>=0?t=f:(e.search(a.TTML)>=0||e.search(a.STPP)>=0)&&(t=h),t}function W(e){w.forEach((function(t){const n=E.getTrackIdxForId(t.id);n>=0&&E.deleteCuesFromTrackIdx(n,e.from,e.to)}))}return n={initialize:function(t,r,i,o){x||q(),E.setConfig({videoModel:R}),E.initialize(),s||(s=G(e).getInstance()),function(t,r,i,s){const o=!l.getIsTextTrack(t);if(p=p.concat(i),o){y=s,n.buffered=Y(e).create(),A=c.getTracksFor(a.FRAGMENTED_TEXT,r);const t=c.getCurrentTrackFor(a.FRAGMENTED_TEXT,r);for(let e=0;e<A.length;e++)if(A[e]===t){K(e);break}}for(let e=0;e<p.length;e++)H(null,p[e])}(t,r,i,o)},append:V,abort:function(){E.deleteAllTextTracks(),F(),s=null,p=[]},addEmbeddedTrack:function(e){if(x||q(),e)if(e.id===a.CC1||e.id===a.CC3){for(let t=0;t<w.length;t++)if(w[t].id===e.id)return;w.push(e)}else r.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){t.off(m.VIDEO_CHUNK_RECEIVED,B,this),t.off(m.BUFFER_CLEARED,W,this),E&&E.deleteAllTextTracks(),x=!1,w=[],L=[null,null],N=null},setConfig:function(e){e&&(e.errHandler&&(o=e.errHandler),e.adapter&&(l=e.adapter),e.manifestModel&&(u=e.manifestModel),e.mediaController&&(c=e.mediaController),e.videoModel&&(R=e.videoModel),e.streamController&&(b=e.streamController),e.textTracks&&(E=e.textTracks),e.vttParser&&(f=e.vttParser),e.ttmlParser&&(h=e.ttmlParser))},getConfig:function(){return{fragmentModel:y,fragmentedTracks:A,videoModel:R}},setCurrentFragmentedTrackIdx:K,remove:function(e,t){void 0===e&&e===t&&(e=this.buffered.start(0),t=this.buffered.end(this.buffered.length-1)),this.buffered.remove(e,t)},reset:function(){U(),b=null,R=null,E=null}},r=_(e).getInstance().getLogger(n),U(),n}J.__dashjs_factory_name="TextSourceBuffer";const Z=u.getSingletonFactory(J);function ee(){const e=this.context;let t,n,r,i,a,s;function o(e){const t=e.split(":"),n=t.length-1;return e=60*parseInt(t[n-1],10)+parseFloat(t[n]),2===n&&(e+=3600*parseInt(t[0],10)),e}function l(e){const t=e.split(i),n=t[1].split(s);return n.shift(),t[1]=n[0],n.shift(),{cuePoints:t,styles:u(n)}}function u(e){const t={};return e.forEach((function(e){if(e.split(/:/).length>1){let n=e.split(/:/)[1];n&&-1!=n.search(/%/)&&(n=parseInt(n.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=n),(e.match(/line/)||e.match(/L/))&&(t.line=n),(e.match(/position/)||e.match(/P/))&&(t.position=n),(e.match(/size/)||e.match(/S/))&&(t.size=n)}})),t}function c(e,t){let n,r=t,a="",s="";for(;""!==e[r]&&r<e.length;)r++;if(n=r-t,n>1)for(let r=0;r<n;r++){if(s=e[t+r],s.match(i)){a="";break}a+=s,r!==n-1&&(a+="\n")}else s=e[t],s.match(i)||(a=s);return a}return t={parse:function(e){const t=[];let s,u;if(!e)return t;s=(e=e.split(r)).length,u=-1;for(let r=0;r<s;r++){let s=e[r];if(s.length>0&&"WEBVTT"!==s&&s.match(i)){const i=l(s),d=i.cuePoints,f=i.styles,h=c(e,r+1),g=o(d[0].replace(a,"")),p=o(d[1].replace(a,""));!isNaN(g)&&!isNaN(p)&&g>=u&&p>g?""!==h?(u=g,t.push({start:g,end:p,data:h,styles:f})):n.error("Skipping cue due to empty/malformed cue text"):n.error("Skipping cue due to incorrect cue timing")}}return t}},n=_(e).getInstance().getLogger(t),r=/(?:\r\n|\r|\n)/gm,i=/-->/,a=/(^[\s]+|[\s]+$)/g,s=/\s\b/g,t}ee.__dashjs_factory_name="VTTParser";const te=u.getSingletonFactory(ee),ne={LEVELS:{SUGGESTION:"Suggestion",WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'}}};function re(){const e=this.context,t=g(e).getInstance();let n,r,i=0;function a(){const e="cue_TTML_"+i;return i++,e}return n={parse:function(e,n,i,s,o){let l="";const u=[];let c,f,h;const g={},p={};let E="",y="",_={onOpenTag:function(e,n,i){if(i[" imagetype"]&&!i[" imageType"]&&(t.trigger(d.CONFORMANCE_VIOLATION,{level:ne.LEVELS.ERROR,event:ne.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),i[" imageType"]=i[" imagetype"]),"image"===n&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!i[" imageType"]||"PNG"!==i[" imageType"].value)return void r.warn("smpte-tt imageType != PNG. Discarded");E=i["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){E&&(p[E]=y.trim()),y="",E=""},onText:function(e){E&&(y+=e)}};if(!e)throw l="no ttml data to parse",new Error(l);g.data=e,t.trigger(m.TTML_TO_PARSE,g);const T=(0,V.fromXML)(g.data,(function(e){l=e}),_);t.trigger(m.TTML_PARSED,{ttmlString:g.data,ttmlDoc:T});const v=T.getMediaTimeEvents();for(h=0;h<v.length;h++){let e=(0,V.generateISD)(T,v[h],(function(e){l=e}));e.contents.some((e=>e.contents.length))&&(c=v[h]+n<i?i:v[h]+n,f=v[h+1]+n>s?s:v[h+1]+n,c<f&&u.push({start:c,end:f,type:"html",cueID:a(),isd:e,images:o,embeddedImages:p}))}if(""!==l)throw r.error(l),new Error(l);return u}},r=_(e).getInstance().getLogger(n),n}re.__dashjs_factory_name="TTMLParser";const ie=u.getSingletonFactory(re);function ae(){let e,t,n,r,i,s,o,l,u,c,d,f,h,p,E,y,_,T,v,S,A,R=this.context;function b(){let e=!0;return _&&!T&&(e=!1),e}function I(){_=!0,v=!1,S=!1}return e={setConfig:function(e){e&&(e.errHandler&&(n=e.errHandler),e.adapter&&(r=e.adapter),e.manifestModel&&(i=e.manifestModel),e.mediaController&&(s=e.mediaController),e.videoModel&&(o=e.videoModel),e.streamController&&(l=e.streamController),e.textTracks&&(u=e.textTracks),e.vttParser&&(c=e.vttParser),e.ttmlParser&&(d=e.ttmlParser),t.setConfig({errHandler:n,adapter:r,manifestModel:i,mediaController:s,videoModel:o,streamController:l,textTracks:u,vttParser:c,ttmlParser:d}))},getTextSourceBuffer:function(){return t},getAllTracksAreDisabled:function(){return _},addEmbeddedTrack:function(e){t.addEmbeddedTrack(e)},getTextDefaultLanguage:function(){return h&&h.lang||""},setTextDefaultLanguage:function(e){q(e,"string"),h||(h={}),h.lang=e,p=!0},setTextDefaultEnabled:function(e){q(e,"boolean"),y=e,y?_=!1:this.setTextTrack(-1)},getTextDefaultEnabled:function(){return void 0!==y&&y},setInitialSettings:function(e){h=e,p=!0},enableText:function(e){q(e,"boolean"),!y&&e&&(y=!0),b()!==e&&(e&&this.setTextTrack(E),e||(E=this.getCurrentTrackIdx(),v?this.setTextTrack(-1):S=!0))},isTextEnabled:b,setTextTrack:function(e){let n,r,i=t.getConfig(),o=i.fragmentModel,c=i.fragmentedTracks,d=i.videoModel;_=-1===e;let f=u.getCurrentTrackIdx();if(f!==e){_&&s&&s.saveTextSettingsDisabled(),u.setModeForTrackIdx(f,a.TEXT_HIDDEN),u.setCurrentTrackIdx(e),u.setModeForTrackIdx(e,a.TEXT_SHOWING);let i=u.getCurrentTrackInfo();if(i&&i.isFragmented&&!i.isEmbedded)for(let e=0;e<c.length;e++){let n=c[e];if(i.lang===n.lang&&i.index===n.index&&(n.id?i.id===n.id:i.id===n.index))if(n!==s.getCurrentTrackFor(a.FRAGMENTED_TEXT,l.getActiveStreamInfo()))o.abortRequests(),o.removeExecutedRequestsBeforeTime(),t.remove(),u.deleteCuesFromTrackIdx(f),s.setTrack(n),t.setCurrentFragmentedTrackIdx(e);else if(-1===f){const e=l.getActiveStreamProcessors();for(let t=0;t<e.length;t++)if(e[t].getType()===a.FRAGMENTED_TEXT){r=e[t];break}r.setBufferingTime(d.getTime()),r.getScheduleController().start()}}else if(i&&!i.isFragmented){const e=l.getActiveStreamProcessors();for(let t=0;t<e.length;t++)if(e[t].getType()===a.TEXT){r=e[t],n=r.getMediaInfoArr();break}if(r&&n)for(let e=0;e<n.length;e++)if(n[e].index===i.index&&n[e].lang===i.lang){r.selectMediaInfo(n[e]);break}}}},getCurrentTrackIdx:function(){return u.getCurrentTrackIdx()},enableForcedTextStreaming:function(e){q(e,"boolean"),T=e},reset:function(){I(),t.resetEmbedded(),t.reset()}},h=null,E=-1,T=!1,v=!1,p=!1,S=!1,u=z(R).getInstance(),c=te(R).getInstance(),d=ie(R).getInstance(),t=Z(R).getInstance(),f=g(R).getInstance(),u.initialize(),f.on(m.TEXT_TRACKS_QUEUE_INITIALIZED,(function(e){let t=e.tracks,n=e.index;h&&t.some(((e,t)=>{if(s.matchSettings(h,e))return this.setTextTrack(t),n=t,!0})),(!1===y||void 0===y&&!h||S)&&this.setTextTrack(-1),E=n,f.trigger(m.TEXT_TRACKS_ADDED,{enabled:b(),index:n,tracks:t}),v=!0}),e),f.on(m.CURRENT_TRACK_CHANGED,(function(e){if(!p&&e&&e.newMediaInfo){let t=e.newMediaInfo;t.type===a.FRAGMENTED_TEXT&&(h={lang:t.lang,role:t.roles[0],accessibility:t.accessibility[0]})}}),e),f.on(m.PERIOD_SWITCH_STARTED,(function(e){void 0===A&&null!==e.fromStreamInfo&&(A=this.getCurrentTrackIdx())}),e),f.on(m.STREAM_COMPLETED,(function(){void 0===A&&(A=this.getCurrentTrackIdx())}),e),f.on(m.PERIOD_SWITCH_COMPLETED,(function(){void 0!==A&&(this.setTextTrack(A),A=void 0)}),e),I(),e}ae.__dashjs_factory_name="TextController";const se=u.getSingletonFactory(ae);function oe(e,t,n,r){const i=this.context,a=g(i).getInstance();let s,o,l,u,c,d,f=[],h=[],p=n;function E(){try{return u.buffered}catch(e){return l.error("getAllBufferRanges exception: "+e.message),null}}function y(t){u&&b((()=>{try{let n=e.duration,r=0;t&&!isNaN(t.start)&&!isNaN(t.duration)&&isFinite(t.duration)&&(n=t.start+t.duration),t&&!isNaN(t.start)&&(r=t.start),u.appendWindowStart=0,u.appendWindowEnd=n,u.appendWindowStart=r,l.debug(`Updated append window. Set start to ${u.appendWindowStart} and end to ${u.appendWindowEnd}`)}catch(e){l.warn("Failed to set append window")}}))}function T(){const e=this;if(h.length>0){c=!0;const t=h[0];h.splice(0,1);let n=[];const r=function(){const r=E();!function(e,t,n,r){t&&t.length>0&&t.length<n.length&&function(e,t){for(let n=0;n<e.length;n++){const r=Math.round(e.start(n)),i=Math.round(e.end(n));if(i===t.start||r===t.end||t.start>=r&&t.end<=i)return!0}return!1}(t,r)&&a.trigger(m.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:e,from:n.end(n.length-2),to:n.start(n.length-1),unintended:!0})}(e,n,r,t),h.length>0?T.call(this):(c=!1,p&&p({chunk:t}))};try{0===t.bytes.length?r.call(this):(n=E(),u.appendBuffer?u.appendBuffer(t.bytes):u.append(t.bytes,t),b(r.bind(this)))}catch(e){l.fatal('SourceBuffer append failed "'+e+'"'),h.length>0?T():c=!1,p&&p({chunk:t,error:new M(e.code,e.message)})}}}function v(){if(f.length>0){const e=f.shift();u.updating?b(e):(e(),v())}}function S(){u.updating||v()}function A(){u.updating||v()}function R(){l.error("SourceBufferSink error")}function b(e){f.push(e),u.updating||v()}return s={getType:function(){return o},getAllBufferRanges:E,getBuffer:function(){return u},append:function(e){e?(h.push(e),c||b(T.bind(this))):p({chunk:e,error:new M(Q.APPEND_ERROR_CODE,Q.APPEND_ERROR_MESSAGE)})},remove:function(t,n,r){const i=this;b((function(){try{t>=0&&n>t&&(r||"ended"!==e.readyState)&&u.remove(t,n),b((function(){a.trigger(m.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:n,unintended:!1})}))}catch(e){a.trigger(m.SOURCEBUFFER_REMOVE_COMPLETED,{buffer:i,from:t,to:n,unintended:!1,error:new M(e.code,e.message)})}}))},abort:function(){try{("open"===e.readyState||u.setTextTrack&&"ended"===e.readyState)&&u.abort()}catch(e){l.error('SourceBuffer append abort failed: "'+e+'"')}h=[]},reset:function(t){if(u){if("function"==typeof u.removeEventListener&&(u.removeEventListener("updateend",A,!1),u.removeEventListener("error",R,!1),u.removeEventListener("abort",R,!1)),clearInterval(d),f=[],!t){try{u.getClassName&&"TextSourceBuffer"===u.getClassName()||(l.debug("Removing sourcebuffer from media source"),e.removeSourceBuffer(u))}catch(e){l.error("Failed to remove source buffer from media source.")}u=null}c=!1}h=[],p=null},updateTimestampOffset:function(e){u.timestampOffset===e||isNaN(e)||b((()=>{e<0&&(e+=.001),u.timestampOffset=e}))},hasDiscontinuitiesAfter:function(e){try{const t=E();if(t&&t.length>1)for(let n=0,r=t.length;n<r;n++)if(n>0&&e<t.start(n)&&t.start(n)>t.end(n-1)+.1)return!0}catch(e){l.error("hasDiscontinuities exception: "+e.message)}return!1},waitForUpdateEnd:b,updateAppendWindow:y},function(){l=_(i).getInstance().getLogger(s),c=!1,o=t.type;const n=t.codec;try{if(n.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))throw new Error("not really supported");u=r||e.addSourceBuffer(n),u.changeType&&r&&(l.debug("Doing period transition with changeType"),u.changeType(n)),y();const t=50;if("function"==typeof u.addEventListener)try{u.addEventListener("updateend",A,!1),u.addEventListener("error",R,!1),u.addEventListener("abort",R,!1)}catch(e){d=setInterval(S,t)}else d=setInterval(S,t)}catch(e){if(!t.isText&&-1===n.indexOf('codecs="stpp')&&-1===n.indexOf('codecs="wvtt'))throw e;{const e=se(i).getInstance();u=e.getTextSourceBuffer()}}}(),s}oe.__dashjs_factory_name="SourceBufferSink";const le=u.getClassFactory(oe);function ue(e){const t=this.context;let n,r,i,a=[],s=e;function o(e,t){a=a.filter((n=>!((isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e))))}return n={getAllBufferRanges:function(){let e=[];for(let t=0;t<a.length;t++){let n=a[t];0===e.length||n.start>e[e.length-1].end?e.push({start:n.start,end:n.end}):e[e.length-1].end=n.end}const t={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(t,"length",{get:function(){return e.length}}),t},append:function(e){"InitializationSegment"!==e.segmentType?(a.push(e),a.sort((function(e,t){return e.start-t.start})),i=null):i=e,r.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),s&&s({chunk:e})},remove:o,abort:function(){},discharge:function(e,t){const n=function(e,t){return a.filter((n=>(isNaN(t)||n.start<t)&&(isNaN(e)||n.end>e)))}(e,t);return i&&(n.push(i),i=null),o(e,t),n},reset:function(){a=[],i=null,s=null},updateTimestampOffset:function(){},hasDiscontinuitiesAfter:function(){return!1},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},r=_(t).getInstance().getLogger(n),n}ue.__dashjs_factory_name="PreBufferSink";const ce=u.getClassFactory(ue),de={DEFAULT:.5,STRONG:1,WEAK:0};function fe(e,t,n){let r,i,a,s;return i=void 0===e?-1:e,a=function(e){let t=de.DEFAULT;return e!==de.DEFAULT&&e!==de.STRONG&&e!==de.WEAK||(t=e),t}(n),s=void 0===t?null:t,r={quality:i,reason:s,priority:a},r}fe.__dashjs_factory_name="SwitchRequest";const he=u.getClassFactory(fe);he.NO_CHANGE=-1,he.PRIORITY=de,u.updateClassFactory(fe.__dashjs_factory_name,he);const ge=he;function pe(e){e=e||{};const t=this.context,n=e.dashMetrics;let r,i;return r={getMaxIndex:function(e){const r=ge(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return r;!function(){if(!n||!n.hasOwnProperty("getCurrentBufferState"))throw new Error(a.MISSING_CONFIG_ERROR)}();const s=e.getMediaInfo(),l=e.getMediaType(),u=n.getCurrentBufferState(l),c=e.getScheduleController(),d=e.getAbrController(),f=e.getStreamInfo(),h=f&&f.manifestInfo?f.manifestInfo.isDynamic:null,g=d.getThroughputHistory(),p=g.getSafeAverageThroughput(l,h),m=g.getAverageLatency(l),E=e.useBufferOccupancyABR();return isNaN(p)||!u||E||d.getAbandonmentStateFor(l)!==o.ABANDON_LOAD&&(u.state===o.BUFFER_LOADED||h)&&(r.quality=d.getQualityForBitrate(s,p,m),c.setTimeToLoadDelay(0),i.debug("["+l+"] requesting switch to index: ",r.quality,"Average throughput",Math.round(p),"kbps"),r.reason={throughput:p,latency:m}),r},reset:function(){}},i=_(t).getInstance().getLogger(r),r}pe.__dashjs_factory_name="ThroughputRule";const me=u.getClassFactory(pe);function Ee(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=e.dashMetrics;let i,s,l;function u(){l={},l[a.VIDEO]={ignoreCount:2},l[a.AUDIO]={ignoreCount:2}}function c(){u()}function d(e){isNaN(e.startTime)||e.mediaType!==a.AUDIO&&e.mediaType!==a.VIDEO||l[e.mediaType].ignoreCount>0&&l[e.mediaType].ignoreCount--}return i={getMaxIndex:function(e){const n=ge(t).create();if(!e||!e.hasOwnProperty("getMediaType"))return n;!function(){if(!r||!r.hasOwnProperty("getCurrentBufferLevel")||!r.hasOwnProperty("getCurrentBufferState"))throw new Error(a.MISSING_CONFIG_ERROR)}();const i=e.getMediaType(),u=r.getCurrentBufferState(i),c=e.getRepresentationInfo().fragmentDuration;if(function(e){return l[e].ignoreCount>0}(i)||!c)return n;if(u&&u.state===o.BUFFER_EMPTY)s.debug("["+i+"] Switch to index 0; buffer is empty."),n.quality=0,n.reason="InsufficientBufferRule: Buffer is empty";else{const t=e.getMediaInfo(),a=e.getAbrController(),s=a.getThroughputHistory(),o=r.getCurrentBufferLevel(i),l=s.getAverageThroughput(i),u=s.getAverageLatency(i),d=l*(o/c)*.5;n.quality=a.getQualityForBitrate(t,d,u),n.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return n},reset:function(){u(),n.off(m.PLAYBACK_SEEKING,c,i),n.off(m.BYTES_APPENDED_END_FRAGMENT,d,i)}},s=_(t).getInstance().getLogger(i),u(),n.on(m.PLAYBACK_SEEKING,c,i),n.on(m.BYTES_APPENDED_END_FRAGMENT,d,i),i}Ee.__dashjs_factory_name="InsufficientBufferRule";const ye=u.getClassFactory(Ee);function _e(e){e=e||{};const t=this.context,n=e.mediaPlayerModel,r=e.dashMetrics,i=e.settings;let a,s,o,l,u;function c(){o={},l={},u=[]}return a={shouldAbandon:function(e){const a=ge(t).create(ge.NO_CHANGE,{name:_e.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return a;const c=e.getMediaInfo(),d=e.getMediaType(),f=e.getCurrentRequest();if(!isNaN(f.index)){h=d,g=f.index,o[h]=o[h]||{},o[h][g]=o[h][g]||{};const t=n.getStableBufferTime();if(r.getCurrentBufferLevel(d)>t)return a;const p=o[d][f.index];if(null===p||null===f.firstByteDate||l.hasOwnProperty(p.id))return a;if(void 0===p.firstByteTime&&(u[d]=[],p.firstByteTime=f.firstByteDate.getTime(),p.segmentDuration=f.duration,p.bytesTotal=f.bytesTotal,p.id=f.index),p.bytesLoaded=f.bytesLoaded,p.elapsedTime=(new Date).getTime()-p.firstByteTime,p.bytesLoaded>0&&p.elapsedTime>0&&function(e,t){u[e]=u[e]||[],u[e].push(t)}(d,Math.round(8*p.bytesLoaded/p.elapsedTime)),u[d].length>=5&&p.elapsedTime>500&&p.bytesLoaded<p.bytesTotal){const t=u[d].reduce(((e,t)=>e+t),0);if(p.measuredBandwidthInKbps=Math.round(t/u[d].length),p.estimatedTimeOfDownload=+(8*p.bytesTotal/p.measuredBandwidthInKbps/1e3).toFixed(2),p.estimatedTimeOfDownload<1.8*p.segmentDuration||0===e.getRepresentationInfo().quality)return a;if(!l.hasOwnProperty(p.id)){const t=e.getAbrController(),n=p.bytesTotal-p.bytesLoaded,r=t.getBitrateList(c),u=t.getQualityForBitrate(c,p.measuredBandwidthInKbps*i.get().streaming.abr.bandwidthSafetyFactor),f=t.getMinAllowedIndexFor(d),h=void 0!==f?Math.max(f,u):u;n>p.bytesTotal*r[h].bitrate/r[t.getQualityFor(d)].bitrate&&(a.quality=h,a.reason.throughput=p.measuredBandwidthInKbps,a.reason.fragmentID=p.id,l[p.id]=p,s.debug("["+d+"] frag id",p.id," is asking to abandon and switch to quality to ",h," measured bandwidth was",p.measuredBandwidthInKbps),delete o[d][p.id])}}else p.bytesLoaded===p.bytesTotal&&delete o[d][p.id]}var h,g;return a},reset:c},s=_(t).getInstance().getLogger(a),c(),a}_e.__dashjs_factory_name="AbandonRequestsRule";const Te=u.getClassFactory(_e);function ve(){const e=this.context;let t,n;return t={getMaxIndex:function(t){const r=ge(e).create();if(!t||!t.hasOwnProperty("getDroppedFramesHistory"))return r;const i=t.getDroppedFramesHistory();if(i){const t=i.getFrameHistory();let r=0,a=0,s=ge.NO_CHANGE;for(let e=1;e<t.length;e++)if(t[e]&&(r=t[e].droppedVideoFrames,a=t[e].totalVideoFrames,a>375&&r/a>.15)){s=e-1,n.debug("index: "+s+" Dropped Frames: "+r+" Total Frames: "+a);break}return ge(e).create(s,{droppedFrames:r})}return r}},n=_(e).getInstance().getLogger(t),t}ve.__dashjs_factory_name="DroppedFramesRule";const Se=u.getClassFactory(ve);function Ae(){const e=this.context;let t,n;return t={getMaxIndex:function(t){const r=t?t.getSwitchHistory():null,i=r?r.getSwitchRequests():[];let a=0,s=0,o=0;const l=ge(e).create();for(let e=0;e<i.length;e++)if(void 0!==i[e]&&(a+=i[e].drops,s+=i[e].noDrops,o+=i[e].dropSize,a+s>=6&&a/s>.075)){l.quality=e>0&&i[e].drops>0?e-1:e,l.reason={index:l.quality,drops:a,noDrops:s,dropSize:o},n.debug("Switch history rule index: "+l.quality+" samples: "+(a+s)+" drops: "+a);break}return l}},n=_(e).getInstance().getLogger(t),t}Ae.__dashjs_factory_name="SwitchHistoryRule";const Re=u.getClassFactory(Ae),be=10;function Ie(e){e=e||{};const t=this.context,n=e.dashMetrics,r=e.mediaPlayerModel,i=g(t).getInstance();let a,s,l;function u(e,t,n){const r=n.reduce(((e,t,r)=>t>n[e]?r:e),0);if(0===r)return null;const i=Math.max(e,be+2*t.length),a=(n[r]-1)/(i/be-1);return{gp:a,Vp:be/a}}function c(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function d(e,t){const i=r.getStableBufferTime();if(e.stableBufferTime!==i){const r=u(i,e.bitrates,e.utilities);if(r.Vp!==e.Vp||r.gp!==e.gp){const a=n.getCurrentBufferLevel(t);let s=a+e.placeholderBuffer;s-=be,s*=r.Vp/e.Vp,s+=be,e.stableBufferTime=i,e.Vp=r.Vp,e.gp=r.gp,e.placeholderBuffer=Math.max(0,s-a)}}}function f(e,t){return e.Vp*(e.utilities[t]+e.gp)}function h(e,t){const n=e.bitrates[t],r=e.utilities[t];let i=0;for(let a=t-1;a>=0;--a)if(e.utilities[a]<e.utilities[t]){const t=e.bitrates[a],s=e.utilities[a],o=e.Vp*(e.gp+(n*s-t*r)/(n-t));i=Math.max(i,o)}return i}function p(){for(const e in l)l.hasOwnProperty(e)&&2===l[e].state&&(l[e].placeholderBuffer=0)}function E(){for(const e in l)if(l.hasOwnProperty(e)){const t=l[e];0!==t.state&&(t.state=1,c(t))}}function y(e){if(e&&e.chunk&&e.chunk.mediaInfo){const t=l[e.chunk.mediaInfo.type];if(t&&0!==t.state){const n=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||n>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=n,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=n,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,v(t,e.chunk.mediaInfo.type)}}}function T(e){if(e&&e.metric===o.HTTP_REQUEST&&e.value&&e.value.type===S.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){const t=l[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),v(t,e.mediaType))}}function v(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){const r=n.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),i=f(e,e.lastQuality),a=Math.max(0,i-r);e.placeholderBuffer=Math.min(a,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function A(e){if(e){const t=l[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function R(e){if(e){const t=l[e.mediaType];if(t&&0!==t.state){const r=n.getCurrentBufferLevel(e.mediaType);let i;i=t.abrQuality>0?h(t,t.abrQuality):be;const a=Math.max(0,i-r);t.placeholderBuffer=Math.min(t.placeholderBuffer,a)}}}function b(){l={}}return a={getMaxIndex:function(e){const i=ge(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return i;const a=e.getMediaInfo(),o=e.getMediaType(),g=e.getScheduleController(),p=e.getStreamInfo(),m=e.getAbrController(),E=m.getThroughputHistory(),y=p?p.id:null,_=p&&p.manifestInfo&&p.manifestInfo.isDynamic,T=e.useBufferOccupancyABR();if(i.reason=i.reason||{},!T)return i;g.setTimeToLoadDelay(0);const v=function(e){const t=e.getMediaType();let n=l[t];return n?0!==n.state&&d(n,t):(n=function(e){const t={},n=e.getMediaInfo().bitrateList.map((e=>e.bandwidth));let i=function(e){return e.map((e=>Math.log(e)))}(n);i=i.map((e=>e-i[0]+1));const a=r.getStableBufferTime(),s=u(a,n,i);return s?(t.state=1,t.bitrates=n,t.utilities=i,t.stableBufferTime=a,t.Vp=s.Vp,t.gp=s.gp,t.lastQuality=0,c(t)):t.state=0,t}(e),l[t]=n),n}(e);if(0===v.state)return i;const S=n.getCurrentBufferLevel(o),A=E.getAverageThroughput(o,_),R=E.getSafeAverageThroughput(o,_),b=E.getAverageLatency(o);let I;if(i.reason.state=v.state,i.reason.throughput=A,i.reason.latency=b,isNaN(A))return i;switch(v.state){case 1:I=m.getQualityForBitrate(a,R,b),i.quality=I,i.reason.throughput=R,v.placeholderBuffer=Math.max(0,h(v,I)-S),v.lastQuality=I,!isNaN(v.lastSegmentDurationS)&&S>=v.lastSegmentDurationS&&(v.state=2);break;case 2:!function(e,t){const n=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){const t=.001*(n-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,t)}}else{const t=.001*(n-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,t)}e.lastCallTimeMs=n,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,d(e,t)}(v,o),I=function(e,t){const n=e.bitrates.length;let r=NaN,i=NaN;for(let a=0;a<n;++a){let n=(e.Vp*(e.utilities[a]+e.gp)-t)/e.bitrates[a];(isNaN(i)||n>=i)&&(i=n,r=a)}return r}(v,S+v.placeholderBuffer);const e=m.getQualityForBitrate(a,R,b);I>v.lastQuality&&I>e&&(I=Math.max(e,v.lastQuality));let t=Math.max(0,S+v.placeholderBuffer-f(v,I));t<=v.placeholderBuffer?(v.placeholderBuffer-=t,t=0):(t-=v.placeholderBuffer,v.placeholderBuffer=0,I<m.getTopQualityIndexFor(o,y)?g.setTimeToLoadDelay(1e3*t):t=0),i.quality=I,i.reason.throughput=A,i.reason.latency=b,i.reason.bufferLevel=S,i.reason.placeholderBuffer=v.placeholderBuffer,i.reason.delay=t,v.lastQuality=I;break;default:s.debug("BOLA ABR rule invoked in bad state."),i.quality=m.getQualityForBitrate(a,R,b),i.reason.state=v.state,i.reason.throughput=R,i.reason.latency=b,v.state=1,c(v)}return i},reset:function(){b(),i.off(m.BUFFER_EMPTY,p,a),i.off(m.PLAYBACK_SEEKING,E,a),i.off(m.MEDIA_FRAGMENT_LOADED,y,a),i.off(m.METRIC_ADDED,T,a),i.off(m.QUALITY_CHANGE_REQUESTED,A,a),i.off(m.FRAGMENT_LOADING_ABANDONED,R,a)}},s=_(t).getInstance().getLogger(a),b(),i.on(m.BUFFER_EMPTY,p,a),i.on(m.PLAYBACK_SEEKING,E,a),i.on(m.MEDIA_FRAGMENT_LOADED,y,a),i.on(m.METRIC_ADDED,T,a),i.on(m.QUALITY_CHANGE_REQUESTED,A,a),i.on(m.FRAGMENT_LOADING_ABANDONED,R,a),a}Ie.__dashjs_factory_name="BolaRule";const De=u.getClassFactory(Ie);function we(e){e=e||{};const t=this.context,n=e.dashMetrics,r=g(t).getInstance();let i,s,l,u;function c(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function d(){for(const e in s)if(s.hasOwnProperty(e)){const t=s[e];0!==t.state&&(t.state=1,c(t))}}function f(e){if(e&&e.chunk&&e.chunk.mediaInfo){const t=s[e.chunk.mediaInfo.type],n=l[e.chunk.mediaInfo.type];if(t&&0!==t.state){const r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,p(t,n)}}}function h(e){if(e&&e.metric===o.HTTP_REQUEST&&e.value&&e.value.type===S.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){const t=s[e.mediaType],n=l[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),p(t,n))}}function p(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function E(e){if(e&&e.mediaType){const t=s[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function y(e,t){if(e.length!==t.length)return-1;let n=0;for(let r=0;r<e.length;r++)n+=e[r]*t[r];return n}function T(){s={},l={}}return i={getMaxIndex:function(e){const r=ge(t).create(),i=Math.pow(4,.99),o=Math.max(Math.pow(4,1),i*Math.sqrt(4)),d=e.getMediaInfo(),f=e.getMediaType(),h=d.bitrateList.map((e=>e.bandwidth)),g=h.length,p=e.getScheduleController(),m=e.getStreamInfo(),E=e.getAbrController(),_=E.getThroughputHistory(),T=m&&m.manifestInfo&&m.manifestInfo.isDynamic,v=e.useL2AABR(),S=n.getCurrentBufferLevel(f,!0),A=_.getSafeAverageThroughput(f,T),R=_.getAverageThroughput(f,T),b=_.getAverageLatency(f);let I,D=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return r;if(r.reason=r.reason||{},!v||f===a.AUDIO)return r;p.setTimeToLoadDelay(0);const w=function(e){const t=e.getMediaType();let n=s[t];return n||(n=function(e){const t={},n=e.getMediaInfo(),r=n.bitrateList.map((e=>e.bandwidth/1e3));return t.state=1,t.bitrates=r,t.lastQuality=0,function(e){e&&e.type&&(l[e.type]={},l[e.type].w=[],l[e.type].prev_w=[],l[e.type].Q=0,l[e.type].segment_request_start_s=0,l[e.type].segment_download_finish_s=0,l[e.type].B_target=1.5)}(n),c(t),t}(e),s[t]=n),n}(e);if(0===w.state)return r;const C=l[f];if(!C)return r;if(r.reason.state=w.state,r.reason.throughput=R,r.reason.latency=b,isNaN(R))return r;switch(w.state){case 1:if(I=E.getQualityForBitrate(d,A,b),r.quality=I,r.reason.throughput=A,w.lastQuality=I,!isNaN(w.lastSegmentDurationS)&&S>=C.B_target){w.state=2,C.Q=i;for(let e=0;e<g;++e)e===w.lastQuality?C.prev_w[e]=1:C.prev_w[e]=0}break;case 2:let e=[],t=n.getCurrentHttpRequest(f).trace.reduce(((e,t)=>e+t.d),0);const a=n.getCurrentHttpRequest(f).trace.reduce(((e,t)=>e+t.b[0]),0);let s=Math.round(8*a/t);s<1&&(s=1);let l=w.lastSegmentDurationS,p=1;for(let e=0;e<g;++e)h[e]=h[e]/1e3,D*h[e]>s&&(p=-1),C.w[e]=C.prev_w[e]+p*(l/(2*o))*((C.Q+i)*(D*h[e]/s));C.w=function(e){const t=e.length;let n=!1,r=[];for(let n=0;n<t;++n)r[n]=e[n];let i=e.sort((function(e,t){return t-e})),a=0,s=0,o=[];for(let e=0;e<t-1;++e)if(a+=i[e],s=(a-1)/(e+1),s>=i[e+1]){n=!0;break}n||(s=(a+i[t-1]-1)/t);for(let e=0;e<t;++e)o[e]=Math.max(r[e]-s,0);return o}(C.w);for(let t=0;t<g;++t)e[t]=C.w[t]-C.prev_w[t],C.prev_w[t]=C.w[t];C.Q=Math.max(0,C.Q-l+l*D*((y(h,C.prev_w)+y(h,e))/s));let m=[];for(let e=0;e<g;++e)m[e]=Math.abs(h[e]-y(C.w,h));I=m.indexOf(Math.min(...m)),I>w.lastQuality&&h[w.lastQuality+1]<=s&&(I=w.lastQuality+1),h[I]>=s&&(C.Q=2*Math.max(i,C.Q)),r.quality=I,r.reason.throughput=R,r.reason.latency=b,r.reason.bufferLevel=S,w.lastQuality=r.quality;break;default:u.debug("L2A ABR rule invoked in bad state."),r.quality=E.getQualityForBitrate(d,A,b),r.reason.state=w.state,r.reason.throughput=A,r.reason.latency=b,w.state=1,c(w)}return r},reset:function(){T(),r.off(m.PLAYBACK_SEEKING,d,i),r.off(m.MEDIA_FRAGMENT_LOADED,f,i),r.off(m.METRIC_ADDED,h,i),r.off(m.QUALITY_CHANGE_REQUESTED,E,i)}},u=_(t).getInstance().getLogger(i),T(),r.on(m.PLAYBACK_SEEKING,d,i),r.on(m.MEDIA_FRAGMENT_LOADED,f,i),r.on(m.METRIC_ADDED,h,i),r.on(m.QUALITY_CHANGE_REQUESTED,E,i),i}we.__dashjs_factory_name="L2ARule";const Ce=u.getClassFactory(we);function Ne(){const e=this.context;let t,n,r,i,a,s,o,l,u,c;function d(){r=null,i=1,a=100,s=0,o=null,l=null,u=null,c="dynamic_weight_selection"}function f(){let e=0;if(r)for(let t=0;t<r.length;t++){let n=r[t];n.state.throughput>e&&(e=n.state.throughput)}return e}function h(e,t,n){let r=e.map(((e,r)=>n[r]*Math.pow(e-t[r],2))).reduce(((e,t)=>e+t));return(r<0?-1:1)*Math.sqrt(Math.abs(r))}function g(e,t){return h([e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch],[1,1,1,1])}function p(e,t,n){for(let r=0;r<t.length;r++){let i=t[r],a=.1;const s=g(i,e);m(i,n,Math.exp(-1*Math.pow(s,2)/(2*Math.pow(a,2))))}}function m(e,t,n){let r=e.state,i=[.01,.01,.01,.01];r.throughput=r.throughput+(t[0]-r.throughput)*i[0]*n,r.latency=r.latency+(t[1]-r.latency)*i[1]*n,r.rebuffer=r.rebuffer+(t[2]-r.rebuffer)*i[2]*n,r.switch=r.switch+(t[3]-r.switch)*i[3]*n}return t={getNextQuality:function(e,t,d,g,m,E,y){let _=d,T=g,v=t,S=function(e){if(!r){r=[];const t=e.bitrateList;let n=[];s=t[0].bandwidth,t.forEach((e=>{n.push(e.bandwidth),e.bandwidth<s&&(s=e.bandwidth)})),i=function(e){const t=e.map((e=>Math.pow(e,2))).reduce(((e,t)=>e+t));return Math.sqrt(t)}(n);for(let e=0;e<t.length;e++){let n={qualityIndex:e,bitrate:t[e].bandwidth,state:{throughput:t[e].bandwidth/i,latency:0,rebuffer:0,switch:0}};r.push(n),n.bitrate===s&&(o=n)}u=function(e){let t=[],n=function(e){let t=[];for(let n=0;n<e;n++){let e=[Math.random()*f(),Math.random(),Math.random(),Math.random()];t.push(e)}return t}(Math.pow(e.length,2));t.push(n[0]);let r=[1,1,1,1];for(let i=1;i<e.length;i++){let e=null,i=null;for(let a=0;a<n.length;a++){let s=n[a],o=null;for(let e=0;e<t.length;e++){let n=h(s,t[e],r);(null===o||n<o)&&(o=n)}(null===i||o>i)&&(e=s,i=o)}t.push(e)}let i=null,a=null;for(let e=0;e<t.length;e++){let n=0;for(let i=0;i<t.length;i++)e!==i&&(n+=h(t[e],t[i],r));(null===i||n>i)&&(i=n,a=e)}let s=[];for(s.push(t[a]),t.splice(a,1);t.length>0;){let e=null,n=null;for(let i=0;i<t.length;i++){let a=h(s[0],t[i],r);(null===e||a<e)&&(e=a,n=i)}s.push(t[n]),t.splice(n,1)}return s}(r)}return r}(e),A=t/i;A>1&&(A=f()),d/=a,n.debug(`getNextQuality called throughput:${A} latency:${d} bufferSize:${g} currentQualityIndex:${E} playbackRate:${m}`);let R=S[E],b=R.bitrate*y.getSegmentDuration()/v,I=Math.max(0,b-T);if(T-b<y.getMinBuffer())return n.debug(`Buffer is low for bitrate= ${R.bitrate} downloadTime=${b} currentBuffer=${T} rebuffer=${I}`),function(e,t){let n=0,i=e;if(r)for(let a=0;a<r.length;a++){let s=r[a];s.bitrate<e.bitrate&&s.bitrate>n&&t>s.bitrate&&(n=s.bitrate,i=s)}return i}(R,v).qualityIndex;switch(c){case"manual_weight_selection":l=[.4,.4,.4,.4];break;case"random_weight_selection":!function(e){l=function(e,t){let n=[],r=Math.sqrt(2/e);for(let e=0;e<4;e++)n.push(Math.random()*r);return l=n,l}(e.length)}(S);break;default:!function(e,t,n,r,i,a,s){l||(l=u[u.length-1]);let o=e.findWeightVector(t,n,r,i,a,s);null!==o&&-1!==o&&(l=o)}(y,S,_,T,I,v,m)}let D=null,w=null,C=null,N=null;for(let e=0;e<S.length;e++){let r=S[e],i=r.state,a=[i.throughput,i.latency,i.rebuffer,i.switch],o=l.slice(),u=y.getNextBufferWithBitrate(r.bitrate,T,v),c=u<y.getMinBuffer();c&&n.debug(`Buffer is low for bitrate=${r.bitrate} downloadTime=${b} currentBuffer=${T} nextBuffer=${u}`),(r.bitrate>t-1e4||c)&&r.bitrate!==s&&(o[0]=100);let d=h(a,[A,0,0,0],o);(null===D||d<D)&&(D=d,w=r.qualityIndex,C=r,N=o)}let L=Math.abs(R.bitrate-C.bitrate)/i;return p(R,S,[A,d,I,L]),p(C,S,[A,0,0,L]),w},reset:function(){d()}},n=_(e).getInstance().getLogger(t),d(),t}Ne.__dashjs_factory_name="LearningAbrController";const Le=u.getClassFactory(Ne);function Me(){let e,t,n,r,i;function a(){t=null,n=null,r=null,i=null}function s(e,t,n,r){let i=new class{constructor(){this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}};return i.type=e,i.weights.bitrateReward=t||1,i.weights.bitrateSwitchPenalty=1,i.weights.rebufferPenalty=n||1e3,i.weights.latencyPenalty=[],i.weights.latencyPenalty.push({threshold:1.1,penalty:.05*r}),i.weights.latencyPenalty.push({threshold:1e8,penalty:.1*n}),i.weights.playbackSpeedPenalty=r||200,i}function o(e,t,n,r,i){i.bitrateWSum+=i.weights.bitrateReward*e,i.lastBitrate&&(i.bitrateSwitchWSum+=i.weights.bitrateSwitchPenalty*Math.abs(e-i.lastBitrate)),i.lastBitrate=e,i.rebufferWSum+=i.weights.rebufferPenalty*t;for(let e=0;e<i.weights.latencyPenalty.length;e++){let t=i.weights.latencyPenalty[e];if(n<=t.threshold){i.latencyWSum+=t.penalty*n;break}}i.playbackSpeedWSum+=i.weights.playbackSpeedPenalty*Math.abs(1-r),i.totalQoe=i.bitrateWSum-i.bitrateSwitchWSum-i.rebufferWSum-i.latencyWSum-i.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,a,o){t=s("segment",e,a,o),n=e,r=a,i=o},logSegmentMetrics:function(e,n,r,i){t&&o(e,n,r,i,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,a,l){let u=null;return n&&r&&i&&(u=s("segment",n,r,i)),u?(o(e,t,a,l,u),u.totalQoe):0},reset:function(){a()}},a(),e}Me.__dashjs_factory_name="LoLpQoeEvaluator";const Oe=u.getClassFactory(Me);function Pe(e){let t,n,r,i,a,s=e.targetLatency,o=e.bufferMin,l=e.segmentDuration,u=e.qoeEvaluator;function c(){return l}function d(e,t){const n=c();let r;return r=t>n?e-n:e+n-t,r}return t={getMinBuffer:function(){return o},getSegmentDuration:c,getNextBufferWithBitrate:function(e,t,n){return d(t,e*l/n)},getNextBuffer:d,findWeightVector:function(e,t,n,r,c,f){let h=null,g=null,p=null,m=Math.abs(t-a);return e.forEach((e=>{i.forEach((r=>{r[0];let i,a=r[1],E=r[2],y=(r[3],e.bitrate*l/c),_=d(n,y);i=0===E?10:1/E;let T=i*Math.max(1e-5,y-_);i=0===a?10:1/a;let v=i*e.state.latency,S=u.calculateSingleUseQoe(e.bitrate,T,v,f);(null===h||S>h)&&function(e,t,n){return!(e>s+n)&&t>=o}(t,_,m)&&(h=S,g=r,p=e.bitrate)}))})),null===g&&null===p&&(g=-1),a=t,g}},n=[.2,.4,.6,.8,1],r=4,i=function(e,t){let n=e.map((function(e){return[e]})),r=function(t,n,i){if(i===n)return t;let a=t.length;for(let n=0;n<a;n++){let n=t.shift();for(let r=0;r<e.length;r++)t.push(n.concat(e[r]))}return r(t,n,i+1)};return r(n,4,1)}(n),a=0,t}Pe.__dashjs_factory_name="LoLpWeightSelector";const xe=u.getClassFactory(Pe);function Fe(e){let t,n,r,i,s=(e=e||{}).dashMetrics,l=this.context;return n={getMaxIndex:function(e){try{let n=ge(l).create(),u=e.getMediaInfo().type,c=e.getAbrController();const d=e.getStreamInfo();let f=c.getQualityFor(u,d);const h=e.getMediaInfo(),g=s.getCurrentBufferState(u),p=e.getScheduleController(),m=s.getCurrentBufferLevel(u,!0),E=d&&d.manifestInfo?d.manifestInfo.isDynamic:null,y=p.getPlaybackController();let _=y.getCurrentLiveLatency();if(!e.useLoLPABR()||u===a.AUDIO)return n;_||(_=0);const T=y.getPlaybackRate(),v=c.getThroughputHistory().getSafeAverageThroughput(u,E);if(t.debug(`Throughput ${Math.round(v)} kbps`),isNaN(v)||!g)return n;if(c.getAbandonmentStateFor(u)===o.ABANDON_LOAD)return n;let S=h.bitrateList,A=e.getRepresentationInfo().fragmentDuration,R=S[0].bandwidth/1e3,b=S[S.length-1].bandwidth/1e3;for(let e=0;e<S.length;e++){let t=S[e].bandwidth/1e3;t>b?b=t:t<R&&(R=t)}let I=S[f].bandwidth/1e3,D=s.getCurrentHttpRequest(u,!0),w=(D.tresponse.getTime()-D.trequest.getTime())/1e3,C=w>A?w-A:0;i.setupPerSegmentQoe(A,b,R),i.logSegmentMetrics(I,C,_,T);let N=xe(l).create({targetLatency:1.5,bufferMin:.3,segmentDuration:A,qoeEvaluator:i});return n.quality=r.getNextQuality(h,1e3*v,_,m,T,f,N),n.reason={throughput:v,latency:_},n.priority=ge.PRIORITY.STRONG,p.setTimeToLoadDelay(0),n.quality!==f&&console.log("[TgcLearningRule]["+u+"] requesting switch to index: ",n.quality,"Average throughput",Math.round(v),"kbps"),n}catch(e){throw e}},reset:function(){r.reset(),i.reset()}},t=_(l).getInstance().getLogger(n),r=Le(l).create(),i=Oe(l).create(),n}Fe.__dashjs_factory_name="LoLPRule";const ke=u.getClassFactory(Fe),Ue="qualitySwitchRules",Be="abandonFragmentRules";function Ge(e){e=e||{};const t=this.context,n=e.mediaPlayerModel,r=e.dashMetrics,i=e.settings;let s,o,l;function u(e){return e.filter((e=>e.quality>ge.NO_CHANGE))}function c(e){const n={};let r,i,a,s,o,l=null;if(0!==e.length){for(n[ge.PRIORITY.STRONG]={quality:ge.NO_CHANGE,reason:null},n[ge.PRIORITY.WEAK]={quality:ge.NO_CHANGE,reason:null},n[ge.PRIORITY.DEFAULT]={quality:ge.NO_CHANGE,reason:null},r=0,i=e.length;r<i;r+=1)a=e[r],a.quality!==ge.NO_CHANGE&&(n[a.priority].quality===ge.NO_CHANGE||n[a.priority].quality>a.quality)&&(n[a.priority].quality=a.quality,n[a.priority].reason=a.reason||null);return n[ge.PRIORITY.WEAK].quality!==ge.NO_CHANGE&&(l=n[ge.PRIORITY.WEAK]),n[ge.PRIORITY.DEFAULT].quality!==ge.NO_CHANGE&&(l=n[ge.PRIORITY.DEFAULT]),n[ge.PRIORITY.STRONG].quality!==ge.NO_CHANGE&&(l=n[ge.PRIORITY.STRONG]),l&&(s=l.quality,o=l.reason),ge(t).create(s,o)}}return s={initialize:function(){o=[],l=[],i.get().streaming.abr.useDefaultABRRules&&(i.get().streaming.abr.ABRStrategy===a.ABR_STRATEGY_L2A?o.push(Ce(t).create({dashMetrics:r,mediaPlayerModel:n,settings:i})):i.get().streaming.abr.ABRStrategy===a.ABR_STRATEGY_LoLP?o.push(ke(t).create({dashMetrics:r})):(o.push(De(t).create({dashMetrics:r,mediaPlayerModel:n,settings:i})),o.push(me(t).create({dashMetrics:r})),o.push(ye(t).create({dashMetrics:r})),o.push(Re(t).create()),o.push(Se(t).create()),l.push(Te(t).create({dashMetrics:r,mediaPlayerModel:n,settings:i})))),n.getABRCustomRules().forEach((function(e){e.type===Ue&&o.push(e.rule(t).create()),e.type===Be&&l.push(e.rule(t).create())}))},reset:function(){[o,l].forEach((e=>{e&&e.length&&e.forEach((e=>e.reset&&e.reset()))})),o=[],l=[]},getMaxQuality:function(e){return c(u(o.map((t=>t.getMaxIndex(e)))))||ge(t).create()},getMinSwitchRequest:c,shouldAbandonFragment:function(e){return c(u(l.map((t=>t.shouldAbandon(e)))))||ge(t).create()},getQualitySwitchRules:function(){return o}},s}Ge.__dashjs_factory_name="ABRRulesCollection";const qe=u.getClassFactory(Ge);qe.QUALITY_SWITCH_RULES=Ue,qe.ABANDON_FRAGMENT_RULES=Be,u.updateSingletonFactory(Ge.__dashjs_factory_name,qe);const Ke=qe,He=class{constructor(){this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN}};function Ye(e){let t;const n=(e=e||{}).abrController,r=e.switchHistory,i=e.droppedFramesHistory,a=e.currentRequest,s=e.useBufferOccupancyABR,o=e.useL2AABR,l=e.useLoLPABR,u=e.streamProcessor?e.streamProcessor.getScheduleController():null,c=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,d=e.videoModel?e.videoModel:null;function f(){return c?c.mediaInfo:null}return t={getMediaType:function(){const e=f();return e?e.type:null},getMediaInfo:f,getDroppedFramesHistory:function(){return i},getCurrentRequest:function(){return a},getSwitchHistory:function(){return r},getStreamInfo:function(){const e=f();return e?e.streamInfo:null},getScheduleController:function(){return u},getAbrController:function(){return n},getRepresentationInfo:function(){return c},useBufferOccupancyABR:function(){return s},useL2AABR:function(){return o},useLoLPABR:function(){return l},getVideoModel:function(){return d}},t}Ye.__dashjs_factory_name="RulesContext";const Ve=u.getClassFactory(Ye);function je(){let e=[],t=[];return{push:function(n){n.newValue===ge.NO_CHANGE&&(n.newValue=n.oldValue),e[n.oldValue]||(e[n.oldValue]={noDrops:0,drops:0,dropSize:0});let r=n.newValue-n.oldValue,i=r<0?1:0,a=i?-r:0,s=i?0:1;if(e[n.oldValue].drops+=i,e[n.oldValue].dropSize+=a,e[n.oldValue].noDrops+=s,t.push({idx:n.oldValue,noDrop:s,drop:i,dropSize:a}),t.length>8){let n=t.shift();e[n.idx].drops-=n.drop,e[n.idx].dropSize-=n.dropSize,e[n.idx].noDrops-=n.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}je.__dashjs_factory_name="SwitchRequestHistory";const ze=u.getClassFactory(je);function We(){let e=[],t=0,n=0;return{push:function(r,i){let a=i&&i.droppedVideoFrames?i.droppedVideoFrames:0,s=i&&i.totalVideoFrames?i.totalVideoFrames:0,o=a-t;t=a;let l=s-n;n=s,isNaN(r)||(e[r]?(e[r].droppedVideoFrames+=o,e[r].totalVideoFrames+=l):e[r]={droppedVideoFrames:o,totalVideoFrames:l})},getFrameHistory:function(){return e},reset:function(r){e=[],t=r.droppedVideoFrames,n=r.totalVideoFrames}}}We.__dashjs_factory_name="DroppedFramesHistory";const $e=u.getClassFactory(We);function Xe(e){const t=(e=e||{}).settings;let n,r,i,s,o;function l(e,t,n,r){const i=Math.pow(.5,n/r.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;const a=Math.pow(.5,n/r.slow);e.slowEstimate=(1-a)*t+a*e.slowEstimate,e.totalWeight+=n}function u(e,l,u){return t.get().streaming.abr.movingAverageMethod!==a.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){const n=e?o.throughputHalfLife:o.latencyHalfLife,r=e?i[t]:s[t];if(!r||r.totalWeight<=0)return NaN;const a=r.fastEstimate/(1-Math.pow(.5,r.totalWeight/n.fast)),l=r.slowEstimate/(1-Math.pow(.5,r.totalWeight/n.slow));return e?Math.min(a,l):Math.max(a,l)}(e,l):function(e,t,i){const a=function(e,t,i){let a,s;if(e?(a=n[t],s=i?3:4):(a=r[t],s=4),a){if(s>=a.length)s=a.length;else if(e)for(let e=1;e<s;++e){const t=a[a.length-e]/a[a.length-e-1];if((t>=1.3||t<=1/1.3)&&(s+=1,s===a.length))break}}else s=0;return s}(e,t,i);let s=(e?n:r)[t];return 0!==a&&s&&0!==s.length?(s=s.slice(-a),s.reduce(((e,t)=>e+t))/s.length):NaN}(e,l,u)}function c(e,t){return u(!0,e,t)}function d(e){n[e]=n[e]||[],r[e]=r[e]||[],i[e]=i[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},s[e]=s[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function f(){n={},r={},i={},s={}}const h={push:function(e,u,c){if(!u.trace||!u.trace.length)return;const f=u.tresponse.getTime()-u.trequest.getTime()||1,h=u._tfinish.getTime()-u.tresponse.getTime()||1,g=u.trace.reduce(((e,t)=>e+t.b[0]),0);let p;p=t.get().streaming.lowLatencyEnabled?u.trace.reduce(((e,t)=>e+t.d),0):c?h:f+h;const m=Math.round(8*g/p);if(d(e),function(e,n,r){return e===a.VIDEO?r<t.get().streaming.cacheLoadThresholds[a.VIDEO]:e===a.AUDIO?r<t.get().streaming.cacheLoadThresholds[a.AUDIO]:void 0}(e,0,h)){if(n[e].length>0&&!n[e].hasCachedEntries)return;n[e].hasCachedEntries=!0}else n[e]&&n[e].hasCachedEntries&&function(e){delete n[e],delete r[e],delete i[e],delete s[e],d(e)}(e);n[e].push(m),n[e].length>20&&n[e].shift(),r[e].push(f),r[e].length>20&&r[e].shift(),l(i[e],m,.001*h,o.throughputHalfLife),l(s[e],f,1,o.latencyHalfLife)},getAverageThroughput:c,getSafeAverageThroughput:function(e,n){let r=c(e,n);return isNaN(r)||(r*=t.get().streaming.abr.bandwidthSafetyFactor),r},getAverageLatency:function(e){return u(!1,e)},reset:f};return o={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},f(),h}Xe.__dashjs_factory_name="ThroughputHistory";const Qe=u.getClassFactory(Xe);function Je(){const e=this.context,t=_(e).getInstance(),n=g(e).getInstance();let r,i,s,l,u,c,d,f,h,p,E,y,T,v,A,R,b,I,D,w,C,N,M,O,P;function x(){s=Ke(e).create({dashMetrics:O,mediaPlayerModel:A,settings:P}),s.initialize()}function F(){u={},c={},f={},d={},I={},C={},N={},M={},void 0===p&&(p=!1),b=void 0,D=void 0,w=void 0,clearTimeout(h),h=null}function k(e){e.mediaType===a.VIDEO&&(void 0!==b&&D.push(b,v.getPlaybackQuality()),b=e.newQuality)}function U(e){e.metric!==o.HTTP_REQUEST||!e.value||e.value.type!==S.MEDIA_SEGMENT_TYPE||e.mediaType!==a.AUDIO&&e.mediaType!==a.VIDEO||w.push(e.mediaType,e.value,P.get().streaming.abr.useDeadTimeLatency),e.metric!==o.BUFFER_LEVEL||e.mediaType!==a.AUDIO&&e.mediaType!==a.VIDEO||function(e,t){const n=P.get().streaming.abr.ABRStrategy;n===a.ABR_STRATEGY_L2A?(C[e]=!1,M[e]=!1,N[e]=!0):n===a.ABR_STRATEGY_LoLP?(C[e]=!1,M[e]=!0,N[e]=!1):n===a.ABR_STRATEGY_BOLA?(C[e]=!0,M[e]=!1,N[e]=!1):n===a.ABR_STRATEGY_THROUGHPUT?(C[e]=!1,M[e]=!1,N[e]=!1):function(e,t){const n=A.getStableBufferTime(),r=n,a=.5*n,s=C[e],o=t>(s?a:r);C[e]=o,o!==s&&(o?i.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+t.toFixed(3)+")."):i.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+t.toFixed(3)+")."))}(e,t)}(e.mediaType,.001*e.value.level)}function B(e,t){let n;return u[t]=u[t]||{},u[t].hasOwnProperty(e)||(u[t][e]=0),n=function(e,t){let n=e;if(!d[t])return n;const r=q(t);void 0!==r&&(n=Math.max(e,r));const i=G(t);return void 0!==i&&(n=Math.min(n,i)),n}(u[t][e],e),n=function(e,t,n){const r=P.get().streaming.abr.maxRepresentationRatio[t];return isNaN(r)||r>=1||r<0?e:Math.min(e,Math.round(n*r))}(n,e,u[t][e]),n=function(e,t){if(t!==a.VIDEO||!P.get().streaming.abr.limitBitrateByPortal||!d[t])return e;p||J();const n=T.getAdaptationForType(0,t).Representation;let r=e;if(E>0&&y>0){for(;r>0&&n[r]&&E<n[r].width&&E-n[r-1].width<n[r].width-E;)r-=1;for(;r<n.length-1&&n[r].width===n[r+1].width;)r+=1}return r}(n,e),n}function G(e){const t=function(e){return P.get().streaming.abr.maxBitrate[e]}(e);return t>-1?j(d[e].getMediaInfo(),t):void 0}function q(e){const t=function(e){return P.get().streaming.abr.minBitrate[e]}(e);if(t>-1){const n=d[e].getMediaInfo(),r=z(n);let i=j(n,t);return r[i]&&i<r.length-1&&r[i].bitrate<1e3*t&&i++,i}}function H(e,t,n,r){const i=t.id,a=Q(e);K(n);const s=B(e,i);n!==a&&n>=0&&n<=s&&Y(e,a,n,s,r)}function Y(e,t,r,a,s){if(e&&d[e]){const o=d[e].getStreamInfo(),l=o?o.id:null;if(P.get().debug.logLevel===_.LOG_LEVEL_DEBUG){const n=O.getCurrentBufferLevel(e);i.info("["+e+"] switch from "+t+" to "+r+"/"+a+" (buffer: "+n+") "+(s?JSON.stringify(s):"."))}!function(e,t,n){c[t]=c[t]||{},c[t][e]=n}(e,l,r),n.trigger(m.QUALITY_CHANGE_REQUESTED,{oldQuality:t,newQuality:r,reason:s},{streamId:o.id,mediaType:e});const u=w.getAverageThroughput(e);isNaN(u)||R.setSavedBitrateSettings(e,u)}}function V(e,t){f[e].state=t}function j(e,t,n){const r=e&&e.type?d[e.type].getRepresentationInfo():null;if(P.get().streaming.abr.useDeadTimeLatency&&n&&r&&r.fragmentDuration){n/=1e3;const e=r.fragmentDuration;if(n>e)return 0;t*=1-n/e}const i=z(e);for(let e=i.length-1;e>=0;e--)if(1e3*t>=i[e].bitrate)return e;return 0}function z(e){const t=[];if(!e||!e.bitrateList)return t;const n=e.bitrateList,r=e.type;let i;for(let e=0,a=n.length;e<a;e++)i=new He,i.mediaType=r,i.qualityIndex=e,i.bitrate=n[e].bandwidth,i.width=n[e].width,i.height=n[e].height,i.scanType=n[e].scanType,t.push(i);return t}function W(e){return C[e]}function $(e){return N[e]}function X(e){return M[e]}function Q(e){if(e&&d[e]){const t=d[e].getStreamInfo(),n=t?t.id:null;let r;if(n)return c[n]=c[n]||{},c[n].hasOwnProperty(e)||(c[n][e]=0),r=c[n][e],r}return 0}function J(){if(v){const e=P.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;E=v.getClientWidth()*e,y=v.getClientHeight()*e}}function Z(t){const n=t.request.mediaType;if(P.get().streaming.abr.autoSwitchBitrate[n]){const i=d[n];if(!i)return;const a=Ve(e).create({abrController:r,streamProcessor:i,currentRequest:t.request,useBufferOccupancyABR:W(n),useL2AABR:$(n),useLoLPABR:X(n),videoModel:v}),u=s.shouldAbandonFragment(a);if(u.quality>ge.NO_CHANGE){const e=i.getFragmentModel();e.getRequests({state:L.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(e.abortRequests(),V(n,o.ABANDON_LOAD),I[n].reset(),I[n].push({oldValue:Q(n),newValue:u.quality,confidence:1,reason:u.reason}),H(n,l.getActiveStreamInfo(),u.quality,u.reason),clearTimeout(h),h=setTimeout((()=>{V(n,o.ALLOW_LOAD),h=null}),P.get().streaming.abandonLoadTimeout))}}}return r={isPlayingAtTopQuality:function(e){const t=e?e.id:null,n=Q(a.AUDIO),r=Q(a.VIDEO);return n===B(a.AUDIO,t)&&r===B(a.VIDEO,t)},updateTopQualityIndex:function(e){const t=e.type,n=e.streamInfo.id,r=e.representationCount-1;return function(e,t,n){u[t]=u[t]||{},u[t][e]=n}(t,n,r),r},getThroughputHistory:function(){return w},getBitrateList:z,getQualityForBitrate:j,getTopBitrateInfoFor:function(e){if(e&&d&&d[e]){const t=d[e].getStreamInfo();if(t&&t.id){const n=B(e,t.id),r=z(d[e].getMediaInfo());return r[n]?r[n]:null}}return null},getMaxAllowedIndexFor:G,getMinAllowedIndexFor:q,getInitialBitrateFor:function(e){if(function(){if(!R||!R.hasOwnProperty("getSavedBitrateSettings"))throw new Error(a.MISSING_CONFIG_ERROR)}(),e===a.TEXT||e===a.FRAGMENTED_TEXT)return NaN;const t=R.getSavedBitrateSettings(e);let n=P.get().streaming.abr.initialBitrate[e],r=P.get().streaming.abr.initialRepresentationRatio[e];if(-1===n)if(r>-1){const t=T.getAdaptationForType(0,e).Representation;n=Array.isArray(t)?t[Math.max(Math.round(t.length*r)-1,0)].bandwidth:0}else n=isNaN(t)?e===a.VIDEO?1e3:100:t;return n},getQualityFor:Q,getAbandonmentStateFor:function(e){return f[e]?f[e].state:null},setPlaybackQuality:H,checkPlaybackQuality:function(t){if(t&&d&&d[t]){const n=d[t].getStreamInfo(),a=n?n.id:null,l=Q(t),u=Ve(e).create({abrController:r,streamProcessor:d[t],currentValue:l,switchHistory:I[t],droppedFramesHistory:D,useBufferOccupancyABR:W(t),useL2AABR:$(t),useLoLPABR:X(t),videoModel:v});if(D){const e=v.getPlaybackQuality();e&&D.push(b,e)}if(P.get().streaming.abr.autoSwitchBitrate[t]){const e=q(t),n=B(t,a),r=s.getMaxQuality(u);let c=r.quality;if(void 0!==e&&(c>ge.NO_CHANGE?c:l)<e&&(c=e),c>n&&(c=n),I[t].push({oldValue:l,newValue:c}),c>ge.NO_CHANGE&&c!=l)(f[t].state===o.ALLOW_LOAD||c>l)&&Y(t,l,c,n,r.reason);else if(P.get().debug.logLevel===_.LOG_LEVEL_DEBUG){const e=O.getCurrentBufferLevel(t,!0);i.debug("["+t+"] stay on "+l+"/"+n+" (buffer: "+e+")")}}}},getTopQualityIndexFor:B,setElementSize:J,setWindowResizeEventCalled:function(e){p=e},createAbrRulesCollection:x,registerStreamType:function(t,i){I[t]=I[t]||ze(e).create(),d[t]=i,f[t]=f[t]||{},f[t].state=o.ALLOW_LOAD,C[t]=!1,N[t]=!1,M[t]=!1,n.on(m.LOADING_PROGRESS,Z,r),t===a.VIDEO&&(n.on(m.QUALITY_CHANGE_RENDERED,k,r),D=D||$e(e).create(),J()),n.on(m.METRIC_ADDED,U,r),n.on(m.PERIOD_SWITCH_COMPLETED,x,r),w=w||Qe(e).create({settings:P})},unRegisterStreamType:function(e){delete d[e]},setConfig:function(e){e&&(e.streamController&&(l=e.streamController),e.domStorage&&(R=e.domStorage),e.mediaPlayerModel&&(A=e.mediaPlayerModel),e.dashMetrics&&(O=e.dashMetrics),e.adapter&&(T=e.adapter),e.videoModel&&(v=e.videoModel),e.settings&&(P=e.settings))},reset:function(){F(),n.off(m.LOADING_PROGRESS,Z,r),n.off(m.QUALITY_CHANGE_RENDERED,k,r),n.off(m.METRIC_ADDED,U,r),n.off(m.PERIOD_SWITCH_COMPLETED,x,r),s&&s.reset()}},i=t.getLogger(r),F(),r}Je.__dashjs_factory_name="AbrController";const Ze=u.getSingletonFactory(Je);Ze.QUALITY_DEFAULT=0,u.updateSingletonFactory(Je.__dashjs_factory_name,Ze);const et=Ze;function tt(){let e={};return{save:function(t){const n=t.streamId,r=t.representationId;e[n]=e[n]||{},e[n][r]=t},extract:function(t,n){return e&&e[t]&&e[t][n]?e[t][n]:null},reset:function(){e={}}}}tt.__dashjs_factory_name="InitCache";const nt=u.getSingletonFactory(tt),rt=.01,it="BufferController";function at(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=e.errHandler,i=e.fragmentModel,s=e.representationController,l=e.mediaController,u=e.adapter,c=e.textController,d=e.abrController,f=e.playbackController,h=e.streamInfo,p=e.type,E=e.settings;let y,T,v,A,R,b,I,D,w,C,N,O,P,x,F,k,U,B,G,q,K,H,Y;function V(e){return u.convertDataToRepresentationInfo(s.getRepresentationForQuality(e))}function j(e,n){if(!B||!e)return null;const a=e[0];if(I)try{C=n&&n[p]?le(t).create(I,a,J.bind(this),n[p]):le(t).create(I,a,J.bind(this),null),E.get().streaming.useAppendWindow&&C.updateAppendWindow(h),"function"==typeof C.getBuffer().initialize&&C.getBuffer().initialize(p,h,e,i)}catch(e){T.fatal("Caught error on create SourceBuffer: "+e),r.error(new M(Q.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Q.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+p))}else C=ce(t).create(J.bind(this));return me(V(v)),C}function z(e){T.info("Init fragment finished loading saving to",p+"'s init cache"),B.save(e.chunk),T.debug("Append Init fragment",p," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),$(e.chunk)}function W(e){const t=e.chunk;if(H){Y=t;const e=C&&C.getAllBufferRanges();e&&e.length>0&&f.getTimeToStreamEnd()>E.get().streaming.stallThreshold&&(T.debug("Clearing buffer because track changed - "+(e.end(e.length-1)+.5)),he([{start:0,end:e.end(e.length-1)+.5,force:!0}]))}else $(t)}function $(e){C.append(e),e.mediaInfo.type===a.VIDEO&&be(m.VIDEO_CHUNK_RECEIVED,{chunk:e})}function X(e){if(e&&e.length>0)for(let t=0,n=e.length;t<n;t++)T.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",f.getTime())}function J(e){if(e.error){if(22===e.error.code&&(U=!0,b=.8*Ae(),T.warn("Quota exceeded, Critical Buffer: "+b),b>0)){const e=Math.max(.2*b,1),t=b-e,n=Math.min(E.get().streaming.bufferTimeAtTopQuality,.9*t),r=Math.min(E.get().streaming.bufferTimeAtTopQualityLongForm,.9*t),i={streaming:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(n.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(r.toFixed(5))}};E.update(i)}return void(22!==e.error.code&&Re()||(T.warn("Clearing playback buffer to overcome quota exceed situation"),be(m.QUOTA_EXCEEDED,{criticalBufferLevel:b,quotaExceededTime:e.chunk.start}),he(fe())))}U=!1,x=e.chunk,x&&!isNaN(x.index)&&(D=Math.max(x.index,D),oe());const t=C.getAllBufferRanges();if(x.segmentType===S.MEDIA_SEGMENT_TYPE)X(t),ne(),function(){if(p!==a.AUDIO&&p!==a.VIDEO)return;if(isNaN(G))return;const e=f.getTime();let t=ae(G,0);if(e===G&&t)return;const n=s.getCurrentRepresentation().segmentDuration;t=ae(G,n),t&&(Math.abs(e-G)>n?G<=t.end&&(f.seek(Math.max(G,t.start),!1,!0),G=NaN):e<t.start&&(f.seek(t.start,!1,!0),G=NaN))}();else if(H){const e=f.getTime();T.debug("AppendToBuffer seek target should be "+e),be(m.SEEK_TARGET,{time:e})}let n=!1;O&&(O.indexOf(x)>0&&(n=!0),O=null),x&&!n&&be(x.endFragment?m.BYTES_APPENDED_END_FRAGMENT:m.BYTES_APPENDED,{quality:x.quality,startTime:x.start,index:x.index,bufferedRanges:t,mediaType:p})}function Z(e){v!==e.newQuality&&(me(this.getRepresentationInfo(e.newQuality)),v=e.newQuality)}function ee(e){C&&(G=e.seekTime,A&&(q=!0,A=!1,w=Number.POSITIVE_INFINITY),p!==a.FRAGMENTED_TEXT?C&&C.waitForUpdateEnd((()=>{const e=function(){if(!C)return;const e=[],t=C.getAllBufferRanges();if(!t||0===t.length)return e;const n=f.getTime(),r=t.end(t.length-1)+.5,a=i.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,time:n,threshold:rt})[0];if(a){const n={start:0,end:a.startTime-E.get().streaming.stallThreshold},s=i.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,time:a.startTime-a.duration/2,threshold:rt})[0];s&&s.startTime!=a.startTime&&(n.end=s.startTime),n.start<n.end&&n.end>t.start(0)&&e.push(n);const o={start:a.startTime+a.duration+E.get().streaming.stallThreshold,end:r},l=i.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,time:a.startTime+a.duration+E.get().streaming.stallThreshold,threshold:rt})[0];l&&l.startTime!==a.startTime&&(o.start=l.startTime+l.duration+E.get().streaming.stallThreshold),o.start<o.end&&o.start<r&&e.push(o)}else T.debug("getAllRangesWithSafetyFactor - No request found in current time position, removing full buffer 0 -",r),e.push({start:0,end:r});return e}();e&&0!==e.length||ne(),he(e)})):ne())}function te(){G=NaN}function ne(){(!H||p===a.FRAGMENTED_TEXT&&c.isTextEnabled())&&se()}function re(){ue()}function ie(){G=NaN,ue()}function ae(e,t){const n=C.getAllBufferRanges();let r,i,a=0,s=0,o=null,l=null,u=0;const c=isNaN(t)?.15:t;if(null!=n){for(i=0,r=n.length;i<r;i++)if(a=n.start(i),s=n.end(i),null===o)u=Math.abs(a-e),(e>=a&&e<s||u<=c)&&(o=a,l=s);else{if(u=a-l,!(u<=c))break;l=s}if(null!==o)return{start:o,end:l}}return null}function se(){f&&(R=function(e,t){let n,r;return E.get().streaming.jumpGaps&&(t=E.get().streaming.smallGapLimit),n=ae(e,t),r=null===n?0:n.end-e,r}((isNaN(G)?f.getTime():G)||0),be(m.BUFFER_LEVEL_UPDATED,{bufferLevel:R}),ue())}function oe(){D>=w-1&&!A&&void 0===C.discharge&&(A=!0,T.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for "+p),be(m.BUFFERING_COMPLETED))}function ue(){p!==a.AUDIO&&p!==a.VIDEO||(q&&!A&&R>0&&f&&f.getTimeToStreamEnd()-R<.1&&(q=!1,A=!0,T.debug("checkIfSufficientBuffer trigger BUFFERING_COMPLETED for type "+p),be(m.BUFFERING_COMPLETED)),(!E.get().streaming.lowLatencyEnabled&&R<E.get().streaming.stallThreshold||0===R)&&!A?de(o.BUFFER_EMPTY):(A||R>=h.manifestInfo.minBufferTime)&&de(o.BUFFER_LOADED))}function de(e){P===e||e===o.BUFFER_EMPTY&&0===f.getTime()||p===a.FRAGMENTED_TEXT&&!c.isTextEnabled()||(P=e,be(m.BUFFER_LEVEL_STATE_CHANGED,{state:e}),be(e===o.BUFFER_LOADED?m.BUFFER_LOADED:m.BUFFER_EMPTY),T.debug(e===o.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function fe(){const e=[],t=C.getAllBufferRanges();if(!t||0===t.length)return e;const n=f.getTime();let r=Math.max(0,n-E.get().streaming.bufferToKeep);const a=i.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,time:n,threshold:rt})[0];if(a)r=Math.min(a.startTime,r);else if(0===n&&f.getIsDynamic())return[];if(t.start(0)<=r){const n={start:0,end:r};for(let e=0;e<t.length&&t.end(e)<=r;e++)n.end=t.end(e);n.start<n.end&&e.push(n)}return e}function he(e){e&&C&&0!==e.length&&(K.push.apply(K,e),k||ge())}function ge(){if(0===K.length||!C)return T.debug("Nothing to prune, halt pruning"),K=[],void(k=!1);const e=C.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return T.debug("SourceBuffer is empty (or does not exist), halt pruning"),K=[],void(k=!1);const t=K.shift();T.debug("Removing buffer from:",t.start,"to",t.end),k=!0,f.getTime()<t.end&&(A=!1,D=0),C.remove(t.start,t.end,t.force)}function pe(e){C===e.buffer&&(T.debug("onRemoved buffer from:",e.from,"to",e.to),X(C.getAllBufferRanges()),0===K.length&&(k=!1),e.unintended&&(T.warn("Detected unintended removal from:",e.from,"to",e.to,"setting index handler time to",e.from),be(m.SEEK_TARGET,{time:e.from,mediaType:p,streamId:h.id})),k?ge():(H?(H=!1,Y&&$(Y)):se(),be(m.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:Re(),quotaExceeded:U})))}function me(e){e&&void 0!==e.MSETimeOffset&&C&&C.updateTimestampOffset&&C.updateTimestampOffset(e.MSETimeOffset)}function Ee(e){e.error||A||me(e.currentRepresentation)}function ye(e){w=e.request.index,oe()}function _e(e){if(e.newMediaInfo.streamInfo.id!==h.id||e.newMediaInfo.type!==p)return;const t=C&&C.getAllBufferRanges();t&&(T.info("Track change asked"),l.getSwitchMode(p)===a.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&t&&t.length>0&&f.getTimeToStreamEnd()>E.get().streaming.stallThreshold&&(A=!1,w=Number.POSITIVE_INFINITY))}function Te(){F++,F*(E.get().streaming.wallclockTimeUpdateInterval/1e3)>=E.get().streaming.bufferPruningInterval&&(F=0,C&&p!==a.FRAGMENTED_TEXT&&(A||he(fe())))}function ve(){ue()}function Se(e,t){I=e,C&&t&&"function"==typeof C.discharge&&(N=C,j(t))}function Ae(){const e=C.getAllBufferRanges();let t,n,r=0;if(!e)return r;for(n=0,t=e.length;n<t;n++)r+=e.end(n)-e.start(n);return r}function Re(){return Ae()<b}function be(e,t){let r=t||{};n.trigger(e,r,{streamId:h.id,mediaType:p})}function Ie(e,t){b=Number.POSITIVE_INFINITY,P=void 0,v=et.QUALITY_DEFAULT,w=Number.POSITIVE_INFINITY,D=0,x=null,A=!1,k=!1,U=!1,q=!1,R=0,F=0,K=[],G=NaN,C&&(e||C.abort(),C.reset(t),C=null),H=!1}return y={initialize:function(e){Se(e),v=d.getQualityFor(p),n.on(m.DATA_UPDATE_COMPLETED,Ee,this),n.on(m.INIT_FRAGMENT_LOADED,z,this),n.on(m.MEDIA_FRAGMENT_LOADED,W,this),n.on(m.QUALITY_CHANGE_REQUESTED,Z,this),n.on(m.STREAM_COMPLETED,ye,this),n.on(m.PLAYBACK_PLAYING,ie,this),n.on(m.PLAYBACK_PROGRESS,ne,this),n.on(m.PLAYBACK_TIME_UPDATED,ne,this),n.on(m.PLAYBACK_RATE_CHANGED,ve,this),n.on(m.PLAYBACK_SEEKING,ee,this),n.on(m.PLAYBACK_SEEKED,te,this),n.on(m.PLAYBACK_STALLED,re,this),n.on(m.WALLCLOCK_TIME_UPDATED,Te,this),n.on(m.CURRENT_TRACK_CHANGED,_e,this,{priority:g.EVENT_PRIORITY_HIGH}),n.on(m.SOURCEBUFFER_REMOVE_COMPLETED,pe,this)},getStreamId:function(){return h.id},getType:function(){return p},getBufferControllerType:function(){return it},getRepresentationInfo:V,createBuffer:j,dischargePreBuffer:function(){if(C&&N&&"function"==typeof N.discharge){const e=N.getAllBufferRanges();if(e.length>0){let t="Beginning "+p+"PreBuffer discharge, adding buffer for:";for(let n=0;n<e.length;n++)t+=" start: "+e.start(n)+", end: "+e.end(n)+";";T.debug(t)}else T.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");O=[];let t=N.discharge(),n=null;for(let e=0;e<t.length;e++){const r=t[e];if("InitializationSegment"!==r.segmentType){const e=B.extract(r.streamId,r.representationId);e&&n!==e&&(O.push(e),C.append(e),n=e)}O.push(r),C.append(r)}N.reset(),N=null}},getBuffer:function(){return C},setBuffer:function(e){C=e},getBufferLevel:function(){return R},getRangeAt:ae,setMediaSource:Se,getMediaSource:function(){return I},appendInitSegment:function(e){const t=B.extract(h.id,e);return!!t&&(T.info("Append Init fragment",p," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),$(t),!0)},replaceBuffer:function(){H=!0},getIsBufferingCompleted:function(){return A},getIsPruningInProgress:function(){return k},reset:function(e,t){n.off(m.DATA_UPDATE_COMPLETED,Ee,this),n.off(m.INIT_FRAGMENT_LOADED,z,this),n.off(m.MEDIA_FRAGMENT_LOADED,W,this),n.off(m.QUALITY_CHANGE_REQUESTED,Z,this),n.off(m.STREAM_COMPLETED,ye,this),n.off(m.PLAYBACK_PLAYING,ie,this),n.off(m.PLAYBACK_PROGRESS,ne,this),n.off(m.PLAYBACK_TIME_UPDATED,ne,this),n.off(m.PLAYBACK_RATE_CHANGED,ve,this),n.off(m.PLAYBACK_SEEKING,ee,this),n.off(m.PLAYBACK_SEEKED,te,this),n.off(m.PLAYBACK_STALLED,re,this),n.off(m.WALLCLOCK_TIME_UPDATED,Te,this),n.off(m.CURRENT_TRACK_CHANGED,_e,this),n.off(m.SOURCEBUFFER_REMOVE_COMPLETED,pe,this),Ie(e,t)},updateAppendWindow:function(){C&&!A&&C.updateAppendWindow(h)}},T=_(t).getInstance().getLogger(y),B=nt(t).getInstance(),Ie(),y}at.__dashjs_factory_name=it;const st=u.getClassFactory(at),ot="NotFragmentedTextBufferController";function lt(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=se(t).getInstance(),i=e.errHandler,s=e.streamInfo,o=e.type,l=e.mimeType,u=e.fragmentModel;let c,d,f,h,p,E;function y(e){h=e}function _(e){null===E.extract(s.id,e.currentRepresentation.id)&&(d=!1,n.trigger(m.INIT_FRAGMENT_NEEDED,{representationId:e.currentRepresentation.id,sender:c},{streamId:s.id,mediaType:o}))}function T(e){e.chunk.bytes&&(E.save(e.chunk),p.append(e.chunk),d=!0,n.trigger(m.STREAM_COMPLETED,{request:e.request},{streamId:s.id,mediaType:o}))}return c={getBufferControllerType:function(){return ot},initialize:function(e){y(e),E=nt(t).getInstance()},createBuffer:function(e){const n=e[0];try{if(p=le(t).create(h,n),!f){const t=p.getBuffer();t.hasOwnProperty(a.INITIALIZE)&&t.initialize(l,s,e,u),f=!0}return p}catch(e){if(n&&(n.isText||-1!==n.codec.indexOf('codecs="stpp')||-1!==n.codec.indexOf('codecs="wvtt')))try{p=r.getTextSourceBuffer()}catch(e){i.error(new M(Q.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Q.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+o+" : "+e.message))}else i.error(new M(Q.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Q.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+o))}},getStreamId:function(){return s.id},getType:function(){return o},getBuffer:function(){return p},getBufferLevel:function(){return 0},setMediaSource:y,getMediaSource:function(){return h},getIsBufferingCompleted:function(){return d},getIsPruningInProgress:function(){return!1},dischargePreBuffer:function(){},appendInitSegment:function(e){return null!==E.extract(s.id,e)},getRangeAt:function(){return null},reset:function(e){n.off(m.DATA_UPDATE_COMPLETED,_,c),n.off(m.INIT_FRAGMENT_LOADED,T,c),!e&&p&&(p.abort(),p.reset(),p=null)},updateTimestampOffset:function(e){p.timestampOffset===e||isNaN(e)||(p.timestampOffset=e)}},f=!1,h=null,d=!1,n.on(m.DATA_UPDATE_COMPLETED,_,c),n.on(m.INIT_FRAGMENT_LOADED,T,c),c}lt.__dashjs_factory_name=ot;const ut=u.getClassFactory(lt);function ct(e){e=e||{};let t,n,r=this.context;function i(){return t.getBuffer()}return n={getBufferControllerType:function(){return t.getBufferControllerType()},initialize:function(e,n){return t.initialize(e,n)},createBuffer:function(e,n){return t.createBuffer(e,n)},getType:function(){return t.getType()},getBuffer:i,setBuffer:function(e){t.setBuffer(e)},getBufferLevel:function(){return t.getBufferLevel()},setMediaSource:function(e){t.setMediaSource(e)},getMediaSource:function(){return t.getMediaSource()},getIsBufferingCompleted:function(){return t.getIsBufferingCompleted()},getIsPruningInProgress:function(){return t.getIsPruningInProgress()},dischargePreBuffer:function(){return t.dischargePreBuffer()},appendInitSegment:function(e){t.appendInitSegment(e)},getRangeAt:function(e){return t.getRangeAt(e)},reset:function(e){t.reset(e)},updateTimestampOffset:function(e){const t=i();t.timestampOffset===e||isNaN(e)||(t.timestampOffset=e)},updateAppendWindow:function(){t.updateAppendWindow()},getRepresentationInfo:function(e){return t.getRepresentationInfo(e)}},t=e.type===a.FRAGMENTED_TEXT?st(r).create({streamInfo:e.streamInfo,type:e.type,mediaPlayerModel:e.mediaPlayerModel,manifestModel:e.manifestModel,fragmentModel:e.fragmentModel,errHandler:e.errHandler,mediaController:e.mediaController,representationController:e.representationController,adapter:e.adapter,textController:e.textController,abrController:e.abrController,playbackController:e.playbackController,settings:e.settings}):ut(r).create({streamInfo:e.streamInfo,type:e.type,mimeType:e.mimeType,fragmentModel:e.fragmentModel,errHandler:e.errHandler}),n}ct.__dashjs_factory_name="TextBufferController";const dt=u.getClassFactory(ct);function ft(e){const t=(e=e||{}).dashMetrics,n=e.mediaPlayerModel,r=e.textController,i=e.abrController,s=e.settings;function l(e,l,u){let c=NaN;if(!e||!l)return c;if(e===a.FRAGMENTED_TEXT)if(r.isTextEnabled())if(isNaN(l.fragmentDuration)){const e=t.getCurrentSchedulingInfo(o.SCHEDULING_INFO);c=e?e.duration:0}else c=l.fragmentDuration;else c=0;else if(e===a.AUDIO&&u){const e=t.getCurrentBufferLevel(a.VIDEO);c=isNaN(l.fragmentDuration)?e:Math.max(e,l.fragmentDuration)}else{const e=l.mediaInfo.streamInfo;c=i.isPlayingAtTopQuality(e)?e.manifestInfo.duration>=s.get().streaming.longFormContentDurationThreshold?s.get().streaming.bufferTimeAtTopQualityLongForm:s.get().streaming.bufferTimeAtTopQuality:n.getStableBufferTime()}return c}return{execute:function(e,n,r){return!e||!n||t.getCurrentBufferLevel(e)<l(e,n,r)},getBufferTarget:l}}ft.__dashjs_factory_name="BufferLevelRule";const ht=u.getClassFactory(ft);function gt(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=e.adapter,i=e.dashMetrics,s=e.mediaPlayerModel,l=e.fragmentModel,u=e.abrController,c=e.playbackController,d=e.textController,f=e.type,h=e.mimeType,p=e.mediaController,E=e.bufferController,y=e.settings;let T,v,S,A,R,b,I,D,w,C,N,M,O,P,x,F,k,U,B,G,q;function K(){return!1===b}function H(){v&&(K()||A&&!E.getIsBufferingCompleted()&&(S.debug("Schedule Controller starts"),b=!1,i.createPlaylistTraceMetrics(A.id,1e3*c.getTime(),c.getPlaybackRate()),R&&(R=!1),j(0)))}function Y(){b||(S.debug("Schedule Controller stops"),S.debug(f+" Schedule Controller stops"),b=!0,clearTimeout(w))}function V(){if(!v)return;if(b||I||c.isPaused()&&!y.get().streaming.scheduleWhilePaused||(f===a.FRAGMENTED_TEXT||f===a.TEXT)&&!d.isTextEnabled()||E.getIsBufferingCompleted())return void Y();!function(){if(!isNaN(C))return;if(!x)return;const e=c.getTime();let t=1.5;if(isNaN(x.fragmentDuration)){const e=i.getCurrentSchedulingInfo(A.mediaInfo.type);t=e?1.5*e.duration:1.5}const n=l.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,time:e+t,threshold:0})[0];if(n&&-1===F.indexOf(n)&&!r.getIsTextTrack(h)){const e=y.get().streaming.fastSwitchEnabled,r=E.getBufferLevel(),i=u.getAbandonmentStateFor(f),s=!p.isCurrentTrack(n.mediaInfo)&&p.getSwitchMode(n.mediaInfo.type)===a.TRACK_SWITCH_MODE_NEVER_REPLACE,l=n.quality<x.quality;e&&(s||l)&&r>=t&&i!==o.ABANDON_LOAD?(W(n),q=!0,S.debug("Reloading outdated fragment at index: ",n.index)):n.quality>x.quality&&!U&&ue(c.getTime()+r)}}();const e=F.length>0,t=x?x.quality:NaN;if(U||isNaN(t)||k||e||function(e,t){P[t]=P[t]||{};const n=u.getTopQualityIndexFor(e,t);return P[t][e]!=n&&(S.info("Top quality "+e+" index has changed from "+P[t][e]+" to "+n),P[t][e]=n,!0)}(f,v.id)||M.execute(f,A,N)){const r=function(){if(A.quality===t&&!k||U){const e=F.shift();e&&e.isInitializationRequest()?(n.trigger(m.INIT_FRAGMENT_NEEDED,{representationId:e.representationId,sender:T},{streamId:v.id,mediaType:f}),G=!1):(n.trigger(m.MEDIA_FRAGMENT_NEEDED,{seekTarget:C,replacement:e},{streamId:v.id,mediaType:f}),G=!0)}else k?(S.debug("Switch track for "+f+", representation id = "+A.id),U=p.getSwitchMode(f)===a.TRACK_SWITCH_MODE_ALWAYS_REPLACE,U&&E.replaceBuffer&&E.replaceBuffer(),k=!1):S.debug("Quality has changed, get init request for representationid = "+A.id),n.trigger(m.INIT_FRAGMENT_NEEDED,{representationId:A.id,sender:T},{streamId:v.id,mediaType:f}),G=!1};z(!0),!e&&G&&u.checkPlaybackQuality(f),r()}else j(500)}function j(e){clearTimeout(w),w=setTimeout(V,e)}function z(e){I!==e?I=e:S.debug("isFragmentProcessingInProgress is already equal to",e)}function W(e){F.push(e)}function $(e){if(c&&l){const t=l.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,time:c.getTime(),threshold:0})[0];t&&c.getTime()>=t.startTime&&((!O.mediaInfo||t.mediaInfo.type===O.mediaInfo.type&&t.mediaInfo.id!==O.mediaInfo.id)&&e&&n.trigger(m.TRACK_CHANGE_RENDERED,{mediaType:f,oldMediaInfo:O.mediaInfo,newMediaInfo:t.mediaInfo}),t.quality===O.quality&&t.adaptationIndex===O.adaptationIndex||!e||n.trigger(m.QUALITY_CHANGE_RENDERED,{mediaType:f,oldQuality:O.quality,newQuality:t.quality}),O={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function X(){Y(),z(!1),S.info(`Stream ${v.id} is complete`)}function Q(e){e.request.mediaInfo.streamInfo.id===v.id&&e.request.mediaType===f&&(S.info("OnFragmentLoadingCompleted - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),r.getIsTextTrack(h)&&z(!1),e.error&&e.request.serviceLocation&&!b&&(W(e.request),z(!1),j(0)),U&&(B=e.request))}function J(){$(!0)}function Z(e){if(U&&!isNaN(e.startTime)&&(U=!1,l.addExecutedRequest(B)),z(!1),isNaN(e.index)&&(x=E.getRepresentationInfo(e.quality),S.info("["+f+"] lastInitializedRepresentationInfo changed to "+e.quality)),q&&!isNaN(e.startTime)){const t=c.getTime(),n=e.startTime+A.fragmentDuration,r=1.5*A.fragmentDuration;j(t+r>=n?0:1e3*(n-(t+r))),q=!1}else j(0)}function ee(e){S.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),c.isSeeking()||k||(S.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),W(e.request)),z(!1),j(0)}function te(){}function ne(){Y()}function re(e){U&&y.get().streaming.flushBufferAtTrackSwitch&&c.seek(c.getTime()+.001,!1,!0),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&H()}function ie(){Y(),z(!1)}function ae(){l.abortRequests(),Y()}function se(){!b&&y.get().streaming.scheduleWhilePaused||H()}function oe(e){if(!v)return;ue(e.seekTime),ce(0),b&&H();const t=A&&A.DVRWindow&&c?A.DVRWindow.end-c.getTime():NaN;i.updateManifestUpdateInfo({latency:t}),I?l.abortRequests():j(0)}function le(e){i.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function ue(e){C=e}function ce(e){D=e}function de(){G=!0,I=!1,D=0,C=NaN,R=!0,x=void 0,O={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},P={},F=[],b=!0,k=!1,U=!1,B=null,q=!1}return T={initialize:function(e){N=e,M=ht(t).create({abrController:u,dashMetrics:i,mediaPlayerModel:s,textController:d,settings:y}),n.on(m.DATA_UPDATE_STARTED,te,this),n.on(m.FRAGMENT_LOADING_COMPLETED,Q,this),n.on(m.STREAM_COMPLETED,X,this),n.on(m.BUFFER_CLEARED,re,this),n.on(m.BYTES_APPENDED_END_FRAGMENT,Z,this),n.on(m.QUOTA_EXCEEDED,ie,this),n.on(m.PLAYBACK_SEEKING,oe,this),n.on(m.PLAYBACK_STARTED,se,this),n.on(m.PLAYBACK_RATE_CHANGED,le,this),n.on(m.PLAYBACK_TIME_UPDATED,J,this),n.on(m.URL_RESOLUTION_FAILED,ae,this),n.on(m.FRAGMENT_LOADING_ABANDONED,ee,this),n.on(m.BUFFERING_COMPLETED,ne,this)},getType:function(){return f},getStreamId:function(){return v.id},setCurrentRepresentation:function(e){A=e},setSeekTarget:ue,setTimeToLoadDelay:ce,getTimeToLoadDelay:function(){return D},switchTrackAsked:function(){k=!0},isStarted:K,start:H,stop:Y,reset:function(){n.off(m.DATA_UPDATE_STARTED,te,this),n.off(m.FRAGMENT_LOADING_COMPLETED,Q,this),n.off(m.STREAM_COMPLETED,X,this),n.off(m.BUFFER_CLEARED,re,this),n.off(m.BYTES_APPENDED_END_FRAGMENT,Z,this),n.off(m.QUOTA_EXCEEDED,ie,this),n.off(m.PLAYBACK_SEEKING,oe,this),n.off(m.PLAYBACK_STARTED,se,this),n.off(m.PLAYBACK_RATE_CHANGED,le,this),n.off(m.PLAYBACK_TIME_UPDATED,J,this),n.off(m.URL_RESOLUTION_FAILED,ae,this),n.off(m.FRAGMENT_LOADING_ABANDONED,ee,this),n.off(m.BUFFERING_COMPLETED,ne,this),Y(),$(!1),de(),v=null},getBufferTarget:function(){return M.getBufferTarget(f,A,N)},processInitRequest:function(e){e&&(z(!0),l.executeRequest(e))},processMediaRequest:function(e){e?(S.debug("Next fragment request url is "+e.url),l.executeRequest(e)):(c.getIsDynamic()&&S.debug("Next fragment seems to be at the bleeding live edge and is not available yet. Rescheduling."),z(!1),j(y.get().streaming.lowLatencyEnabled?100:500))},getPlaybackController:function(){return c}},S=_(t).getInstance().getLogger(T),de(),v=e.streamInfo,T}gt.__dashjs_factory_name="ScheduleController";const pt=u.getClassFactory(gt);function mt(e){const t=(e=e||{}).eventBus,n=e.events,r=e.errors,i=e.abrController,s=e.dashMetrics,o=e.playbackController,l=e.timelineConverter,u=e.type,c=e.streamInfo,d=e.dashConstants;let f,h,g,p,m;function E(){return u}function y(){if(!(i&&s&&o&&l))throw new Error(a.MISSING_CONFIG_ERROR)}function _(){return g}function T(){return m}function v(){h=null,g=!0,p=[]}function S(){y();const e=new Date,t=T(),n=1e3*o.getTime();t&&s.addRepresentationSwitch(t.adaptation.type,e,n,t.id)}function A(e){return null==e||e>=p.length?null:p[e]}function R(e,t){var n;(e.segmentAvailabilityRange=l.calcSegmentAvailabilityRange(e,t),e.segmentAvailabilityRange.end<e.segmentAvailabilityRange.start)?D(new M(r.SEGMENTS_UNAVAILABLE_ERROR_CODE,r.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE,{availabilityDelay:e.segmentAvailabilityRange.start-e.segmentAvailabilityRange.end})):t&&(n=e.segmentAvailabilityRange.end,l.setExpectedLiveEdge(n),s.updateManifestUpdateInfo({presentationStartTime:n}))}function b(e,r){y();for(let i=0,a=p.length;i<a;i++)R(p[i],e),r&&t.trigger(n.REPRESENTATION_UPDATE_STARTED,{representation:p[i]},{streamId:c.id,mediaType:u})}function I(){g=!0,t.trigger(n.DATA_UPDATE_STARTED,{},{streamId:c.id,mediaType:u})}function D(e){g=!1,t.trigger(n.DATA_UPDATE_COMPLETED,{data:h,currentRepresentation:m,error:e},{streamId:c.id,mediaType:u})}function w(e){if(!_())return;if(e.error)return void D(e.error);let a,l,u,f=e.representation,h=s.getCurrentManifestUpdate(),g=!1,y=0;if(f.adaptation.period.mpd.manifest.type===d.DYNAMIC&&!f.adaptation.period.mpd.manifest.ignorePostponeTimePeriod&&o.getStreamController().getStreams().length<=1&&(y=function(e){try{const t=o.getStreamController().getActiveStreamInfo();let n=e.segmentAvailabilityRange.start;t&&t.id&&t.id!==c.id&&(n=Math.min(o.getTime(),n));let r=e.segmentAvailabilityRange.end-n;return 1e3*(o.getLiveDelay()-r)}catch(e){return 0}}(f)),y>0)return function(e){let r=e;t.trigger(n.AST_IN_FUTURE,{delay:r}),setTimeout((function(){_()||(I(),p.forEach((e=>{e.segmentAvailabilityRange=null})),b(o.getIsDynamic(),!0))}),r)}(y),l=new M(r.SEGMENTS_UPDATE_FAILED_ERROR_CODE,r.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE),void D(l);if(h){for(let e=0;e<h.representationInfo.length;e++)if(a=h.representationInfo[e],a.index===f.index&&a.mediaType===E()){g=!0;break}g||s.addManifestUpdateRepresentationInfo(f,E())}var v;(function(){for(let e=0,t=p.length;e<t;e++){let t=p[e].segmentInfoType;if(null===p[e].segmentAvailabilityRange||!p[e].hasInitialization()||(t===d.SEGMENT_BASE||t===d.BASE_URL)&&!p[e].segments)return!1}return!0})()&&(i.setPlaybackQuality(E(),c,(v=m,p.indexOf(v))),s.updateManifestUpdateInfo({latency:m.segmentAvailabilityRange.end-o.getTime()}),u=s.getCurrentRepresentationSwitch(T().adaptation.type),u||S(),D())}function C(e){e.isDynamic&&b(e.isDynamic)}function N(e){m=A(e.newQuality),S()}function L(e){if(e.newDuration){const t=T();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return f={getStreamId:function(){return c.id},getType:E,getData:function(){return h},isUpdating:_,updateData:function(e,t,n,r){y(),I(),p=t,m=A(r),h=e,n===a.VIDEO||n===a.AUDIO||n===a.FRAGMENTED_TEXT?b(o.getIsDynamic(),!0):D()},updateRepresentation:R,getCurrentRepresentation:T,getRepresentationForQuality:A,reset:function(){t.off(n.QUALITY_CHANGE_REQUESTED,N,f),t.off(n.REPRESENTATION_UPDATE_COMPLETED,w,f),t.off(n.WALLCLOCK_TIME_UPDATED,C,f),t.off(n.MANIFEST_VALIDITY_CHANGED,L,f),v()}},v(),t.on(n.QUALITY_CHANGE_REQUESTED,N,f),t.on(n.REPRESENTATION_UPDATE_COMPLETED,w,f),t.on(n.WALLCLOCK_TIME_UPDATED,C,f),t.on(n.MANIFEST_VALIDITY_CHANGED,L,f),f}mt.__dashjs_factory_name="RepresentationController";const Et=u.getClassFactory(mt);function yt(e){let t,n=(e=e||{}).timelineConverter;return t={getLiveEdge:function(e){return function(){if(!n||!n.hasOwnProperty("getExpectedLiveEdge"))throw new Error(a.MISSING_CONFIG_ERROR)}(),e.DVRWindow?e.DVRWindow.end:0},reset:function(){n=null}},t}yt.__dashjs_factory_name="LiveEdgeFinder";const _t=u.getClassFactory(yt),Tt=class{constructor(){this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null}};function vt(e,t){for(;e.length<t;)e="0"+e;return e}function St(e){return e?e.split("$$").join("$"):e}function At(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;let n=t.toString();return e.split("$RepresentationID$").join(n)}function Rt(e,t,n){let r,i,a,s,o,l;const u=t.length,c="%0".length;if(!e)return e;for(;;){if(r=e.indexOf("$"+t),r<0)return e;if(i=e.indexOf("$",r+u),i<0)return e;if(a=e.indexOf("%0",r+u),a>r&&a<i)switch(s=e.charAt(i-1),o=parseInt(e.substring(a+c,i-1),10),s){case"d":case"i":case"u":l=vt(n.toString(),o);break;case"x":l=vt(n.toString(16),o);break;case"X":l=vt(n.toString(16),o).toUpperCase();break;case"o":l=vt(n.toString(8),o);break;default:return e}else l=n;e=e.substring(0,r)+l+e.substring(i+1)}}function bt(e,t,n,r,i,a,s,o,l){let u=new Tt;var c;return u.representation=e,u.duration=t,u.presentationStartTime=n,u.mediaStartTime=r,u.availabilityStartTime=i,u.availabilityEndTime=a.calcAvailabilityEndTimeFromPresentationTime(s,e.adaptation.period.mpd,o),u.wallStartTime=a.calcWallTimeForSegment(u,o),u.replacementNumber=(c=l,u.representation.startNumber+c),u.availabilityIdx=l,u}function It(e,t,n,r){const i=e.getPeriodEnd(t,r),a=e.calcPeriodRelativeTimeFromMpdRelativeTime(t,i);if(e.calcPeriodRelativeTimeFromMpdRelativeTime(t,n.presentationStartTime)>=a){if(!r)return!1;if(t.segmentAvailabilityRange&&n.presentationStartTime>=t.segmentAvailabilityRange.end)return!1}return!0}function Dt(e,t,n,r){let i,a,s;i=n.segmentDuration,isNaN(i)&&(i=n.adaptation.period.duration),a=parseFloat((n.adaptation.period.start+r*i).toFixed(5)),s=parseFloat((a+i).toFixed(5));const o=bt(n,i,a,e.calcMediaTimeFromPresentationTime(a,n),e.calcAvailabilityStartTimeFromPresentationTime(a,n.adaptation.period.mpd,t),e,s,t,r);return It(e,n,o,t)?o:null}function wt(e,t,n,r,i,a,s,o,l,u){const c=r/a,d=Math.min(i/a,n.adaptation.period.mpd.maxSegmentDuration);let f,h,g;return f=e.calcPresentationTimeFromMediaTime(c,n),h=f+d,g=bt(n,d,f,c,n.adaptation.period.mpd.manifest.loadedTime,e,h,t,l),It(e,n,g,t)?(g.replacementTime=u||r,s=Rt(s,"Number",g.replacementNumber),s=Rt(s,"Time",g.replacementTime),g.media=s,g.mediaRange=o,g):null}function Ct(e,t){const n=(e=e||{}).timelineConverter;let r;function i(){if(!n||!n.hasOwnProperty("calcMediaTimeFromPresentationTime")||!n.hasOwnProperty("calcSegmentAvailabilityRange"))throw new Error(a.MISSING_CONFIG_ERROR)}function s(e,r){const i=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,a=i.SegmentTimeline,s=i.SegmentURL_asArray;let o,l,u,c,d,f,h,g,p,m=0,E=0,y=-1;p=e.timescale,o=a.S_asArray;let _=!1;for(u=0,c=o.length;u<c&&!_;u++){if(l=o[u],f=0,l.hasOwnProperty("r")&&(f=l.r),l.hasOwnProperty("t")&&(m=l.t,E=m/p),f<0){if(g=o[u+1],g&&g.hasOwnProperty("t"))h=g.t/p;else{const r=e.segmentAvailabilityRange?e.segmentAvailabilityRange.end:n.calcSegmentAvailabilityRange(e,t).end;h=n.calcMediaTimeFromPresentationTime(r,e),e.segmentDuration=l.d/p}f=Math.ceil((h-E)/(l.d/p))-1}for(d=0;d<=f&&!_;d++)y++,_=r(m,E,i,s,l,p,y,u),_&&(e.segmentDuration=l.d/p,(d<f-1||u<c-1)&&y++),m+=l.d,E=m/p}e.availableSegmentsNumber=y}return r={getSegmentByIndex:function(e,r,a){if(i(),!e)return null;let o=null,l=!1;return s(e,(function(r,i,s,u,c,d,f,h){if(l||a<0){let i=s.media,a=c.mediaRange;return u&&(i=u[h].media||"",a=u[h].mediaRange),o=wt(n,t,e,r,c.d,d,i,a,f,c.tManifest),!0}return i>=a-.5*c.d/d&&(l=!0),!1})),o},getSegmentByTime:function(e,r){if(i(),!e)return null;void 0===r&&(r=null);let a=null;const o=n.calcMediaTimeFromPresentationTime(r,e);return s(e,(function(r,i,s,l,u,c,d,f){if(o<i+u.d/c){let i=s.media,o=u.mediaRange;return l&&(i=l[f].media||"",o=l[f].mediaRange),a=wt(n,t,e,r,u.d,c,i,o,d,u.tManifest),!0}return!1})),a}},r}Ct.__dashjs_factory_name="TimelineSegmentsGetter";const Nt=u.getClassFactory(Ct);function Lt(e,t){const n=(e=e||{}).timelineConverter;let r;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(a.MISSING_CONFIG_ERROR)}function s(e,r){if(i(),!e)return null;const a=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;r=Math.max(r,0);const s=Dt(n,t,e,r);if(s){s.replacementTime=Math.round((r-1)*e.segmentDuration*e.timescale,10);let t=a.media;t=Rt(t,"Number",s.replacementNumber),t=Rt(t,"Time",s.replacementTime),s.media=t}const o=e.segmentDuration,l=e.segmentAvailabilityRange;return isNaN(o)?e.availableSegmentsNumber=1:e.availableSegmentsNumber=Math.ceil((l.end-l.start)/o),s}return r={getSegmentByIndex:s,getSegmentByTime:function(e,t){if(i(),!e)return null;const r=e.segmentDuration;if(isNaN(r))return null;const a=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(a/r))}},r}Lt.__dashjs_factory_name="TemplateSegmentsGetter";const Mt=u.getClassFactory(Lt);function Ot(e,t){const n=(e=e||{}).timelineConverter;let r;function i(){if(!n||!n.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(a.MISSING_CONFIG_ERROR)}function s(e,r){if(i(),!e)return null;const a=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,s=a.SegmentURL_asArray.length,o=e&&!isNaN(e.startNumber)?e.startNumber:1,l=Math.max(o-1,0),u=Math.max(r-l,0);let c=null;if(u<s){const i=a.SegmentURL_asArray[u];c=Dt(n,t,e,r),c&&(c.replacementTime=(o+r-1)*e.segmentDuration,c.media=i.media?i.media:"",c.mediaRange=i.mediaRange,c.index=r,c.indexRange=i.indexRange)}return e.availableSegmentsNumber=s,c}return r={getSegmentByIndex:s,getSegmentByTime:function(e,t){if(i(),!e)return null;const r=e.segmentDuration;if(isNaN(r))return null;const a=n.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(a/r))}},r}Ot.__dashjs_factory_name="ListSegmentsGetter";const Pt=u.getClassFactory(Ot);function xt(e){const t=(e=e||{}).timelineConverter;let n;function r(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(a.MISSING_CONFIG_ERROR)}function i(e,t){if(r(),!e)return null;const n=e.segments?e.segments.length:-1;let i;if(t<n&&(i=e.segments[t],i&&i.availabilityIdx===t))return i;for(let r=0;r<n;r++)if(i=e.segments[r],i&&i.availabilityIdx===t)return i;return null}return n={getSegmentByIndex:i,getSegmentByTime:function(e,t){r();const n=function(e,t){if(!e)return-1;const n=e.segments,r=n?n.length:null;let i,a,s,o,l,u=-1;if(n&&r>0)for(l=0;l<r;l++)if(a=n[l],s=a.presentationStartTime,o=a.duration,i=o/2,t+i>=s&&t-i<s+o){u=a.availabilityIdx;break}return u}(e,t);return i(e,n)}},n}xt.__dashjs_factory_name="SegmentBaseGetter";const Ft=u.getClassFactory(xt);function kt(e){e=e||{};const t=this.context,n=e.events,r=e.eventBus,i=e.dashConstants,a=e.streamInfo,s=e.type;let o,l;function u(e){return e?e.segments?l[i.SEGMENT_BASE]:l[e.segmentInfoType]:null}return o={initialize:function(n){l[i.SEGMENT_TIMELINE]=Nt(t).create(e,n),l[i.SEGMENT_TEMPLATE]=Mt(t).create(e,n),l[i.SEGMENT_LIST]=Pt(t).create(e,n),l[i.SEGMENT_BASE]=Ft(t).create(e,n)},update:function(e,t,i,o){i||r.trigger(n.SEGMENTBASE_INIT_REQUEST_NEEDED,{streamId:a.id,mediaType:s,mimeType:t,representation:e}),o||r.trigger(n.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,{streamId:a.id,mediaType:s,mimeType:t,representation:e})},getSegmentByIndex:function(e,t,n){const r=u(e);return r?r.getSegmentByIndex(e,t,n):null},getSegmentByTime:function(e,t){const n=u(e);return n?n.getSegmentByTime(e,t):null}},l={},o}kt.__dashjs_factory_name="SegmentsController";const Ut=u.getClassFactory(kt);function Bt(e){e=e||{};const t=this.context,n=e.eventBus,r=e.events,i=e.debug,a=e.dashConstants,s=e.urlUtils,o=e.type,l=e.streamInfo,u=e.timelineConverter,c=e.dashMetrics,d=e.baseURLController;let f,h,g,p,m,E,y,_,T;function v(){return o}function A(){g=-1,p=null}function R(){A(),m=null,T=null,_=null}function I(e,t,n){const r=d.resolve(n.path);let i,a;return r&&t!==r.url&&s.isRelative(t)?(i=r.url,a=r.serviceLocation,t&&(i=s.resolve(t,i))):i=t,!s.isRelative(i)&&(e.url=i,e.serviceLocation=a,!0)}function D(e){!function(e){const t=e.hasInitialization(),i=e.hasSegments();t&&i?n.trigger(r.REPRESENTATION_UPDATE_COMPLETED,{representation:e},{streamId:l.id,mediaType:o}):T.update(e,_,t,i)}(e.representation)}function w(e,t){if(null==t)return null;const n=new b,r=t.representation,i=r.adaptation.period.mpd.manifest.Period_asArray[r.adaptation.period.index].AdaptationSet_asArray[r.adaptation.index].Representation_asArray[r.index].bandwidth;let a=t.media;return a=Rt(a,"Number",t.replacementNumber),a=Rt(a,"Time",t.replacementTime),a=Rt(a,"Bandwidth",i),a=At(a,r.id),a=St(a),n.mediaType=v(),n.type=S.MEDIA_SEGMENT_TYPE,n.range=t.mediaRange,n.startTime=t.presentationStartTime,n.mediaStartTime=t.mediaStartTime,n.duration=t.duration,n.timescale=r.timescale,n.availabilityStartTime=t.availabilityStartTime,n.availabilityEndTime=t.availabilityEndTime,n.wallStartTime=t.wallStartTime,n.quality=r.index,n.index=t.availabilityIdx,n.mediaInfo=e,n.adaptationIndex=r.adaptation.index,n.representationId=r.id,I(n,a,r)?n:void 0}function C(e){let t=!1;if(!e)return t;if(E){if(y)t=!0;else if(p){const n=parseFloat((p.presentationStartTime-e.adaptation.period.start).toFixed(5));t=(p.duration>0?n+1.5*p.duration:n)>=e.adaptation.period.duration}}else g>=e.availableSegmentsNumber&&(t=!0);return t}function N(e){const t=e.representation;t.segments&&n.trigger(r.REPRESENTATION_UPDATE_COMPLETED,{representation:t},{streamId:l.id,mediaType:o})}function L(e){if(e.error)return;const t=e.segments,i=e.representation,a=[];let s,d,f,h,g=0;for(s=0,d=t?t.length:0;s<d;s++)f=t[s],h=wt(u,E,i,f.startTime,f.duration,f.timescale,f.media,f.mediaRange,g),h&&(a.push(h),h=null,g++);var p;a.length>0&&(i.segmentAvailabilityRange={start:a[0].presentationStartTime,end:a[a.length-1].presentationStartTime},i.availableSegmentsNumber=a.length,i.segments=a,E)&&(p=a[a.length-1].presentationStartTime-8,u.setExpectedLiveEdge(p),c.updateManifestUpdateInfo({presentationStartTime:p})),i.hasInitialization()&&n.trigger(r.REPRESENTATION_UPDATE_COMPLETED,{representation:i},{streamId:l.id,mediaType:o})}function M(){h.debug("Dynamic stream complete"),y=!0}return f={initialize:function(e){E=e,y=!1,T.initialize(e)},getStreamId:function(){return l.id},getType:v,getStreamInfo:function(){return l},getInitRequest:function(e,t){if(!t)return null;const n=function(e,t,n){const r=new b,i=t.adaptation.period,a=i.start;if(r.mediaType=n,r.type=S.INIT_SEGMENT_TYPE,r.range=t.range,r.availabilityStartTime=u.calcAvailabilityStartTimeFromPresentationTime(a,i.mpd,E),r.availabilityEndTime=u.calcAvailabilityEndTimeFromPresentationTime(a+i.duration,i.mpd,E),r.quality=t.index,r.mediaInfo=e,r.representationId=t.id,I(r,t.initialization,t))return r.url=Rt(r.url,"Bandwidth",t.bandwidth),r}(e,t,v());return n},getRequestForSegment:w,getSegmentRequestForTime:function(e,t,n,r){let i=null;if(!t||!t.segmentInfoType)return i;const s=g,l=!!r&&r.keepIdx,u=!(!r||!r.ignoreIsFinished);m!==n&&(m=n,h.debug("Getting the request for time : "+n));const c=T.getSegmentByTime(t,n);return c?(g=c.availabilityIdx,p=c,h.debug("Index for time "+n+" is "+g),i=w(e,c)):!u&&C(t)&&(i=new b,i.action=b.ACTION_COMPLETE,i.index=g-1,i.mediaType=o,i.mediaInfo=e,h.debug("Signal complete in getSegmentRequestForTime")),l&&s>=0&&(g=t.segmentInfoType===a.SEGMENT_TIMELINE&&E?g:s),i},getNextSegmentRequest:function(e,t){let n=null;if(!t||!t.segmentInfoType)return null;m=null;let r=g+1;h.debug("Getting the next request at index: "+r);const i=T.getSegmentByIndex(t,r,p?p.mediaStartTime:-1);return i||!function(e){return!isFinite(e.adaptation.period.duration)}(t)||y?(i?(n=w(e,i),g=i.availabilityIdx):g=E?r-1:r,i?p=i:C(t)&&(n=new b,n.action=b.ACTION_COMPLETE,n.index=g-1,n.mediaType=v(),n.mediaInfo=e,h.debug("Signal complete")),n):(h.debug(v()+" No segment found at index: "+r+". Wait for next loop"),null)},setCurrentIndex:function(e){g=e},getCurrentIndex:function(){return g},isMediaFinished:C,reset:function(){R(),n.off(r.INITIALIZATION_LOADED,N,f),n.off(r.SEGMENTS_LOADED,L,f),n.off(r.REPRESENTATION_UPDATE_STARTED,D,f),n.off(r.DYNAMIC_TO_STATIC,M,f)},resetIndex:A,setMimeType:function(e){_=e},getNextSegmentRequestIdempotent:function(e,t){let n=null,r=g+1;const i=T.getSegmentByIndex(t,r,p?p.mediaStartTime:-1);return i?(n=w(e,i),n):null}},h=i.getLogger(f),R(),T=Ut(t).create(e),n.on(r.INITIALIZATION_LOADED,N,f),n.on(r.SEGMENTS_LOADED,L,f),n.on(r.REPRESENTATION_UPDATE_STARTED,D,f),n.on(r.DYNAMIC_TO_STATIC,M,f),f}Bt.__dashjs_factory_name="DashHandler";const Gt=u.getClassFactory(Bt);function qt(){let e;return e={modifyRequestURL:function(e){return e},modifyRequestHeader:function(e){return e}},e}qt.__dashjs_factory_name="RequestModifier";const Kt=u.getSingletonFactory(qt);function Ht(){let e;const t=/^[a-z][a-z0-9+\-_.]*:/i,n=/^https?:\/\//i,r=/^https:\/\//i,i=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,a=(e,t)=>{try{return new window.URL(e,t).toString()}catch(t){return e}},s=(e,t)=>{let n=o;if(!t)return e;if(!c(e))return e;d(e)&&(n=l),f(e)&&(n=u);const r=n(t),i="/"!==r.charAt(r.length-1)&&"/"!==e.charAt(0)?"/":"";return[r,e].join(i)};function o(e){const t=e.indexOf("/"),n=e.lastIndexOf("/");return-1!==t?n===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,n+1)):""}function l(e){const t=e.match(i);return t?t[1]:""}function u(e){const n=e.match(t);return n?n[0]:""}function c(e){return!t.test(e)}function d(e){return c(e)&&"/"===e.charAt(0)}function f(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=a}catch(e){}finally{e=e||s}}(),{parseBaseUrl:o,parseOrigin:l,parseScheme:u,isRelative:c,isPathAbsolute:d,isSchemeRelative:f,isHTTPURL:function(e){return n.test(e)},isHTTPS:function(e){return r.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,n){return e(t,n)}}}Ht.__dashjs_factory_name="DefaultURLUtils";const Yt=u.getSingletonFactory(Ht);function Vt(){let e,t,n=[];const r=this.context;function i(e,r,i){let a=function(e){let r;for(r=0;r<n.length;r++)if(n[r].regex.test(e))return n[r].utils;return t}(i||r);return a&&"function"==typeof a[e]?a[e](r,i):t[e](r,i)}return t=Yt(r).getInstance(),e={registerUrlRegex:function(e,t){n.push({regex:e,utils:t})},parseBaseUrl:function(e){return i("parseBaseUrl",e)},parseOrigin:function(e){return i("parseOrigin",e)},parseScheme:function(e){return i("parseScheme",e)},isRelative:function(e){return i("isRelative",e)},isPathAbsolute:function(e){return i("isPathAbsolute",e)},isSchemeRelative:function(e){return i("isSchemeRelative",e)},isHTTPURL:function(e){return i("isHTTPURL",e)},isHTTPS:function(e){return i("isHTTPS",e)},removeHostname:function(e){return i("removeHostname",e)},resolve:function(e,t){return i("resolve",e,t)}},e}Vt.__dashjs_factory_name="URLUtils";const jt=u.getSingletonFactory(Vt);class zt{constructor(){this.start=null,this.mstart=null,this.starttype=null,this.trace=[]}}zt.INITIAL_PLAYOUT_START_REASON="initial_playout",zt.SEEK_START_REASON="seek",zt.RESUME_FROM_PAUSE_START_REASON="resume",zt.METRICS_COLLECTION_START_REASON="metrics_collection_start";class Wt{constructor(){this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null}}function $t(e){e=e||{};let t,n,r,i,l,u,c,d,f,h,p,E,y=this.context,T=g(y).getInstance(),v=e.streamInfo,S=e.type,A=e.errHandler,R=e.mimeType,I=e.timelineConverter,D=e.adapter,w=e.manifestModel,C=e.mediaPlayerModel,N=e.fragmentModel,O=e.abrController,P=e.playbackController,x=e.mediaController,F=e.textController,k=e.dashMetrics,U=e.settings,B=e.boxParser;function q(){return S}function H(){l=[],i=null,p=0}function Y(e){e.error||c.setCurrentRepresentation(D.convertDataToRepresentationInfo(e.currentRepresentation)),e.error&&e.error.code!==Q.SEGMENTS_UPDATE_FAILED_ERROR_CODE||P.getStreamController().getActiveStreamInfo().id===v.id&&$()}function V(e){let t=ee(e.newQuality);c.setCurrentRepresentation(t),k.pushPlayListTraceMetrics(new Date,Wt.REPRESENTATION_SWITCH_STOP_REASON),k.createPlaylistTraceMetrics(t.id,1e3*P.getTime(),P.getPlaybackRate())}function j(e){k.addBufferLevel(S,new Date,1e3*e.bufferLevel);const t=P.getStreamController().getActiveStreamInfo().id;w.getValue().doNotUpdateDVRWindowOnBufferUpdated||v.id!==t||$()}function z(e){k.addBufferState(S,e.state,c.getBufferTarget()),e.state!==o.BUFFER_EMPTY||P.isSeeking()||k.pushPlayListTraceMetrics(new Date,Wt.REBUFFERING_REASON)}function W(e){N.syncExecutedRequestsWithBufferedRange(u.getBuffer().getAllBufferRanges(),v.duration),e.from>P.getTime()&&(p=e.from,E=!0)}function $(){const e=v.manifestInfo,t=e.isDynamic,n=I.calcSegmentAvailabilityRange(d.getCurrentRepresentation(),t);k.addDVRInfo(q(),P.getTime(),e,n)}function X(){return u?u.getBuffer():null}function J(){return l}function Z(){return i}function ee(e){let t;return void 0!==e?(K(e),t=d?d.getRepresentationForQuality(e):null):t=d?d.getCurrentRepresentation():null,D.convertDataToRepresentationInfo(t)}function te(e){if(e.sender&&(!D.getIsTextTrack(R)||F.isTextEnabled())&&u&&e.representationId&&!u.appendInitSegment(e.representationId)){const e=h?h.getInitRequest(Z(),d.getCurrentRepresentation()):null;c.processInitRequest(e)}}function ne(e){let t;u.getIsPruningInProgress()||(t=function(e,t){const n=ee(),r=!isNaN(e),i=P.getNormalizedTime();let s,o=r?e:p,l=!1;if(isNaN(o)||q()===a.FRAGMENTED_TEXT&&!F.isTextEnabled())return null;if(u){let e=u.getRangeAt(o);const t=u.getRangeAt(i);null===e&&null===t||r||e&&(!t||t.start==e.start||t.end==e.end)||u.getBuffer().hasDiscontinuitiesAfter(i)&&q()!==a.FRAGMENTED_TEXT&&(N.removeExecutedRequestsAfterTime(t.end),l=!0)}if(t)o=t.startTime+t.duration/2,s=ae(n,o,{timeThreshold:0,ignoreIsFinished:!0});else{const e=r||E||l;for(s=ae(n,e?o:void 0,{keepIdx:!e}),E=!1;s&&s.action!==b.ACTION_COMPLETE&&N.isFragmentLoaded(s);)s=ae(n)}return s}(e.seekTarget,e.replacement),t&&(c.setSeekTarget(NaN),e.replacement||(isNaN(t.startTime+t.duration)||(p=t.startTime+t.duration),t.delayLoadingTime=(new Date).getTime()+c.getTimeToLoadDelay(),c.setTimeToLoadDelay(0)))),c.processMediaRequest(t)}function re(e){const t=e.chunk,n=t.bytes,r=t.quality,i=ee(r),a=d&&i?d.getRepresentationForQuality(i.quality):null,s=D.getEventsFor(i.mediaInfo),o=D.getEventsFor(i,a);if(s&&s.length>0||o&&o.length>0){const e=function(e,t,n,r){try{const i={},a=[],s=n.concat(r);for(let e=0,t=s.length;e<t;e++)i[s[e].schemeIdUri+"/"+s[e].value]=s[e];const o=G(y).getInstance().parse(e),l=o.getBoxes("emsg");if(!l||0===l.length)return a;const u=o.getBox("sidx"),c=!u||isNaN(u.earliest_presentation_time)||isNaN(u.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:u.earliest_presentation_time/u.timescale,f=Math.max(c,0),h=d.getCurrentRepresentation();for(let e=0,t=l.length;e<t;e++){const t=D.getEvent(l[e],i,f,h);t&&a.push(t)}return a}catch(e){return[]}}(n,N.getRequests({state:L.FRAGMENT_MODEL_EXECUTED,quality:r,index:t.index})[0],s,o);T.trigger(m.INBAND_EVENTS,{events:e},{streamId:v.id})}}function ie(e){p=e.time,c.setSeekTarget(e.time)}function ae(e,t,n){let r=null;if(h){const i=d&&e?d.getRepresentationForQuality(e.quality):null;r=void 0!==t&&void 0!==n?h.getSegmentRequestForTime(Z(),i,t,n):h.getNextSegmentRequest(Z(),i)}return r}return t={initialize:function(n,i){h=Gt(y).create({streamInfo:v,type:S,timelineConverter:I,dashMetrics:k,mediaPlayerModel:C,baseURLController:e.baseURLController,errHandler:A,settings:U,boxParser:B,events:m,eventBus:T,errors:Q,debug:_(y).getInstance(),requestModifier:Kt(y).getInstance(),dashConstants:s,constants:a,urlUtils:jt(y).getInstance()}),r=v.manifestInfo.isDynamic,r&&(f=_t(y).create({timelineConverter:I})),h.initialize(r),O.registerStreamType(S,t),d=Et(y).create({streamInfo:v,type:S,abrController:O,dashMetrics:k,playbackController:P,timelineConverter:I,dashConstants:s,events:m,eventBus:T,errors:Q}),u=function(e){let t=null;return e?(t=e===a.VIDEO||e===a.AUDIO?st(y).create({streamInfo:v,type:e,mediaPlayerModel:C,manifestModel:w,fragmentModel:N,errHandler:A,mediaController:x,representationController:d,adapter:D,textController:F,abrController:O,playbackController:P,settings:U}):dt(y).create({streamInfo:v,type:e,mimeType:R,mediaPlayerModel:C,manifestModel:w,fragmentModel:N,errHandler:A,mediaController:x,representationController:d,adapter:D,textController:F,abrController:O,playbackController:P,settings:U}),t):(A.error(new M(Q.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,Q.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}(S),u&&u.initialize(n),c=pt(y).create({streamInfo:v,type:S,mimeType:R,adapter:D,dashMetrics:k,mediaPlayerModel:C,fragmentModel:N,abrController:O,playbackController:P,textController:F,mediaController:x,bufferController:u,settings:U}),c.initialize(i),p=0,E=!1},getStreamId:function(){return v.id},getType:q,isUpdating:function(){return!!d&&d.isUpdating()},getBufferController:function(){return u},getFragmentModel:function(){return N},getScheduleController:function(){return c},getRepresentationController:function(){return d},getRepresentationInfo:ee,getBufferLevel:function(){return u?u.getBufferLevel():0},isBufferingCompleted:function(){return!!u&&u.getIsBufferingCompleted()},createBuffer:function(e){return X()||u?u.createBuffer(l,e):null},updateStreamInfo:function(e){v=e,U.get().streaming.useAppendWindow&&u.updateAppendWindow()},getStreamInfo:function(){return v},selectMediaInfo:function(e){e===i||e&&i&&e.type!==i.type||(i=e);const t=D.getRealAdaptation(v,i),n=D.getVoRepresentations(i);if(d){const e=d.getData(),r=O.getTopQualityIndexFor(S,v.id),s=O.getMinAllowedIndexFor(S);let o,l,u=null;null!==e&&e.id==t.id||S===a.FRAGMENTED_TEXT?o=O.getQualityFor(S):(l=O.getThroughputHistory().getAverageThroughput(S),u=l||O.getInitialBitrateFor(S),o=O.getQualityForBitrate(i,u)),void 0!==s&&o<s&&(o=s),o>r&&(o=r),h.setMimeType(i?i.mimeType:null),d.updateData(t,n,S,o)}},addMediaInfo:function(e,t){-1===l.indexOf(e)&&l.push(e),t&&this.selectMediaInfo(e)},getLiveStartTime:function(){if(!r)return NaN;if(!f)return NaN;let e=NaN;const t=ee(),i=f.getLiveEdge(t);if(isNaN(i))return NaN;const a=function(e,t){try{let r=null,i=P.getLiveDelay();const a=isNaN(v.manifestInfo.DVRWindowSize)?i:v.manifestInfo.DVRWindowSize,s=.1*a;let o;if(!isFinite(a)||ae(t,e-a+s,{ignoreIsFinished:!0}))for(;!r&&i<=a;)o=e-i,r=ae(t,o,{ignoreIsFinished:!0}),r||(i+=1);return r&&P.setLiveDelay(i,!0),n.debug("live edge: "+e+", live delay: "+i+", live target: "+o),r}catch(e){return null}}(i,t);return a&&(e=U.get().streaming.lowLatencyEnabled?a.duration<C.getLiveDelay()?a.startTime:a.startTime+a.duration-C.getLiveDelay():a.startTime),e},switchTrackAsked:function(){c.switchTrackAsked()},getMediaInfoArr:J,getMediaInfo:Z,getMediaSource:function(){return u.getMediaSource()},setMediaSource:function(e){u.setMediaSource(e,J())},dischargePreBuffer:function(){u.dischargePreBuffer()},getBuffer:X,setBuffer:function(e){u.setBuffer(e)},setBufferingTime:function(e){p=e},resetIndexHandler:function(){h&&h.resetIndex()},getInitRequest:function(e){K(e);const t=d?d.getRepresentationForQuality(e):null;return h?h.getInitRequest(Z(),t):null},getFragmentRequest:ae,finalisePlayList:function(e,t){k.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){const e=ee(),t=d&&e?d.getRepresentationForQuality(e.quality):null;return h.getNextSegmentRequestIdempotent(Z(),t)},reset:function(e,n){h&&h.reset(),u&&(u.reset(e,n),u=null),c&&(c.reset(),c=null),d&&(d.reset(),d=null),f&&(f.reset(),f=null),O&&!n&&O.unRegisterStreamType(S),T.off(m.DATA_UPDATE_COMPLETED,Y,t),T.off(m.QUALITY_CHANGE_REQUESTED,V,t),T.off(m.INIT_FRAGMENT_NEEDED,te,t),T.off(m.MEDIA_FRAGMENT_NEEDED,ne,t),T.off(m.MEDIA_FRAGMENT_LOADED,re,t),T.off(m.BUFFER_LEVEL_UPDATED,j,t),T.off(m.BUFFER_LEVEL_STATE_CHANGED,z,t),T.off(m.BUFFER_CLEARED,W,t),T.off(m.SEEK_TARGET,ie,t),H(),S=null,v=null}},n=_(y).getInstance().getLogger(t),H(),T.on(m.DATA_UPDATE_COMPLETED,Y,t,{priority:g.EVENT_PRIORITY_HIGH}),T.on(m.QUALITY_CHANGE_REQUESTED,V,t),T.on(m.INIT_FRAGMENT_NEEDED,te,t),T.on(m.MEDIA_FRAGMENT_NEEDED,ne,t),T.on(m.MEDIA_FRAGMENT_LOADED,re,t),T.on(m.BUFFER_LEVEL_UPDATED,j,t),T.on(m.BUFFER_LEVEL_STATE_CHANGED,z,t),T.on(m.BUFFER_CLEARED,W,t),T.on(m.QUOTA_EXCEEDED,(function(e){p=e.quotaExceededTime,E=!0}),t),T.on(m.SEEK_TARGET,ie,t),t}Wt.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",Wt.REBUFFERING_REASON="rebuffering",Wt.USER_REQUEST_STOP_REASON="user_request",Wt.END_OF_PERIOD_STOP_REASON="end_of_period",Wt.END_OF_CONTENT_STOP_REASON="end_of_content",Wt.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",Wt.FAILURE_STOP_REASON="failure",$t.__dashjs_factory_name="StreamProcessor";const Xt=u.getClassFactory($t);function Qt(e){const t=(e=e||{}).requestModifier;let n;return n={load:function(e){const n=new Date,r=e.request;let i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),r.responseType&&(i.responseType=r.responseType),r.range&&i.setRequestHeader("Range","bytes="+r.range),r.requestStartDate||(r.requestStartDate=n),t&&(i=t.modifyRequestHeader(i)),e.headers)for(let t in e.headers){let n=e.headers[t];n&&i.setRequestHeader(t,n)}i.withCredentials=e.withCredentials,i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.onprogress=e.progress,i.onabort=e.onabort,i.ontimeout=e.ontimeout,i.timeout=e.timeout,i.send(),e.response=i},abort:function(e){const t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}},n}Qt.__dashjs_factory_name="XHRLoader";const Jt=u.getClassFactory(Qt);class Zt{static mixin(e,t,n){let r,i={};if(e)for(let a in t)t.hasOwnProperty(a)&&(r=t[a],a in e&&(e[a]===r||a in i&&i[a]===r)||("object"==typeof e[a]&&null!==e[a]?e[a]=Zt.mixin(e[a],r,n):e[a]=n(r)));return e}static clone(e){if(!e||"object"!=typeof e)return e;let t;if(e instanceof Array){t=[];for(let n=0,r=e.length;n<r;++n)n in e&&t.push(Zt.clone(e[n]))}else t={};return Zt.mixin(t,e,Zt.clone)}static addAditionalQueryParameterToUrl(e,t){try{if(!t||0===t.length)return e;let n=new URL(e);return t.forEach((e=>{e.key&&e.value&&n.searchParams.set(e.key,e.value)})),n.href}catch(t){return e}}static parseHttpHeaders(e){let t={};if(!e)return t;let n=e.trim().split("\r\n");for(let e=0,r=n.length;e<r;e++){let r=n[e],i=r.indexOf(": ");i>0&&(t[r.substring(0,i)]=r.substring(i+2))}return t}static generateUuid(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){const n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}static generateHashCode(e){let t=0;if(0===e.length)return t;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}}const en=Zt;function tn(){let e;const t={debug:{logLevel:_.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{metricsMaxListDepth:1e3,abandonLoadTimeout:1e4,liveDelayFragmentCount:NaN,liveDelay:null,scheduleWhilePaused:!0,fastSwitchEnabled:!1,flushBufferAtTrackSwitch:!1,calcSegmentAvailabilityRangeFromTimeline:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,stableBufferTime:12,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,longFormContentDurationThreshold:600,wallclockTimeUpdateInterval:50,lowLatencyEnabled:!1,keepProtectionMediaKeys:!1,useManifestDateHeaderTimeSource:!0,useSuggestedPresentationDelay:!0,useAppendWindow:!0,manifestUpdateRetryInterval:100,stallThreshold:.5,filterUnsupportedEssentialProperties:!0,eventControllerRefreshDelay:100,utcSynchronization:{backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"http://time.akamai.com/?iso&ms"}},liveCatchup:{minDrift:.02,maxDrift:0,playbackRate:.5,latencyThreshold:60,playbackBufferMin:.5,enabled:!1,mode:a.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:a.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:a.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:a.TRACK_SELECTION_MODE_HIGHEST_BITRATE,fragmentRequestTimeout:0,retryIntervals:{[S.MPD_TYPE]:500,[S.XLINK_EXPANSION_TYPE]:500,[S.MEDIA_SEGMENT_TYPE]:1e3,[S.INIT_SEGMENT_TYPE]:1e3,[S.BITSTREAM_SWITCHING_SEGMENT_TYPE]:1e3,[S.INDEX_SEGMENT_TYPE]:1e3,[S.MSS_FRAGMENT_INFO_SEGMENT_TYPE]:1e3,[S.OTHER_TYPE]:1e3,lowLatencyReductionFactor:10},retryAttempts:{[S.MPD_TYPE]:3,[S.XLINK_EXPANSION_TYPE]:1,[S.MEDIA_SEGMENT_TYPE]:3,[S.INIT_SEGMENT_TYPE]:3,[S.BITSTREAM_SWITCHING_SEGMENT_TYPE]:3,[S.INDEX_SEGMENT_TYPE]:3,[S.MSS_FRAGMENT_INFO_SEGMENT_TYPE]:3,[S.OTHER_TYPE]:3,lowLatencyMultiplyFactor:5},abr:{movingAverageMethod:a.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:a.ABR_STRATEGY_DYNAMIC,bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:a.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:a.CMCD_MODE_QUERY}}};let n=en.clone(t);function r(e,t,n){for(let i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&("object"==typeof e[i]&&null!==e[i]?r(e[i],t[i],n.slice()+i+"."):t[i]=en.clone(e[i]))}return e={get:function(){return n},update:function(e){"object"==typeof e&&r(e,n,"")},reset:function(){n=en.clone(t)}},e}tn.__dashjs_factory_name="Settings";const nn=u.getSingletonFactory(tn);function rn(e){e=e||{};const t=this.context,n=e.requestModifier,r=e.boxParser,i=nn(t).getInstance();let s;function o(e,t){e.reader.read().then(t).catch((function(t){e.onerror&&200===e.response.status&&e.onerror(t)}))}function l(e,t,n,r,i){switch(e){case a.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING:return function(e,t){try{let n,r;n=e.filter(((t,n)=>n>0&&n<e.length-1)),r=t.filter(((e,n)=>n>0&&n<t.length-1));let i=0;if(n.length>1){for(let e=0;e<n.length;e++)n[e]&&r[e]&&(i+=r[e].ts-n[e].ts);return i}return null}catch(e){return null}}(t,n);case a.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA:default:return function(e,t){try{if((e=e.filter((n=>n.bytes>t/4/e.length))).length>1){let t=0;const n=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach(((r,i)=>{const a=e[i+1];if(a){const e=a.ts-r.ts;t+=e<n?e:0}})),t}return null}catch(e){return null}}(r,i)}}return s={load:function(e){const t=new Date,s=e.request,u=new Headers;if(s.range&&u.append("Range","bytes="+s.range),e.headers)for(let t in e.headers){let n=e.headers[t];n&&u.append(t,n)}let c;s.requestStartDate||(s.requestStartDate=t),n&&n.modifyRequestHeader({setRequestHeader:function(e,t){u.append(e,t)}}),"function"==typeof window.AbortController&&(c=new AbortController,e.abortController=c,c.signal.onabort=e.onabort);const d={method:e.method,headers:u,credentials:e.withCredentials?"include":void 0,signal:c?c.signal:void 0};fetch(e.url,d).then((function(t){e.response||(e.response={}),e.response.status=t.status,e.response.statusText=t.statusText,e.response.responseURL=t.url,t.ok||e.onerror();let n="";for(const e of t.headers.keys())n+=e+": "+t.headers.get(e)+"\r\n";if(e.response.responseHeaders=n,!t.body)return t.arrayBuffer().then((function(t){e.response.response=t;const n={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(n),e.onload(),e.onend()}));const s=parseInt(t.headers.get("Content-Length"),10);let u=0,c=!1,d=new Uint8Array,f=0;e.reader=t.body.getReader();let h=[],g=[],p=[],m=!0;const E=i.get().streaming.abr.fetchThroughputCalculationMode,y=function({value:t,done:n}){if(n)return d&&(e.progress({loaded:u,total:isNaN(s)?u:s,lengthComputable:!0,time:l(E,g,p,h,u),stream:!0}),e.response.response=d.buffer),e.onload(),void e.onend();if(t&&t.length>0){d=function(e,t){if(0===e.length)return t;const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(d,t),u+=t.length,h.push({ts:Date.now(),bytes:t.length}),E===a.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&m&&r.findLastTopIsoBoxCompleted(["moof"],d,f).found&&(m=!1,g.push({ts:performance.now(),bytes:t.length}));const n=r.findLastTopIsoBoxCompleted(["moov","mdat"],d,f);if(n.found){const t=n.lastCompletedOffset+n.size;let r;E===a.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&(m=!0,p.push({ts:performance.now(),bytes:d.length})),t===d.length?(r=d,d=new Uint8Array):(r=new Uint8Array(d.subarray(0,t)),d=d.subarray(t)),e.progress({data:r.buffer,lengthComputable:!1,noTrace:!0}),f=0}else f=n.lastCompletedOffset,c||(e.progress({lengthComputable:!1,noTrace:!0}),c=!0)}o(e,y)};o(e,y)})).catch((function(t){e.onerror&&e.onerror(t)}))},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}},calculateDownloadedTime:l},s}rn.__dashjs_factory_name="FetchLoader";const an=u.getClassFactory(rn),sn=new class extends c{constructor(){super(),this.METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",this.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",this.CMCD_DATA_GENERATED="cmcdDataGenerated"}},on=class{constructor(){this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}hasInitialization(){return null!==this.initialization||null!==this.range}hasSegments(){return this.segmentInfoType!==s.BASE_URL&&this.segmentInfoType!==s.SEGMENT_BASE&&!this.indexRange}},ln=class{constructor(){this.period=null,this.index=-1,this.type=null}};class un{constructor(){this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null}}un.DEFAULT_ID="defaultId";const cn=un,dn=class{constructor(){this.schemeIdUri="",this.value=""}},fn=class{constructor(){this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN}};class hn{constructor(e,t,n,r){this.url=e||"",this.serviceLocation=t||e||"",this.dvb_priority=n||1,this.dvb_weight=r||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0}}hn.DEFAULT_DVB_PRIORITY=1,hn.DEFAULT_DVB_WEIGHT=1;const gn=hn,pn=class{constructor(){this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0}};var mn=n(1805),En=n.n(mn);function yn(){let e;return e={areEqual:function(e,t){return En()(e,t)}},e}yn.__dashjs_factory_name="ObjectUtils";const _n=u.getSingletonFactory(yn),Tn=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function vn(e){const t=this.context,n=e.adapter,r=e.baseURLController,i=e.streamInfo,o=e.timelineConverter,l=e.debug,u=e.eventBus,c=e.events,d=e.dashConstants,f=jt(t).getInstance();let h,g,p,E,y,_,T;function v(){A(),_=Jt(t).create({}),T=G(t).getInstance(),p=Gt(t).create({streamInfo:i,timelineConverter:o,baseURLController:r,debug:l,eventBus:u,events:c,dashConstants:d,urlUtils:f}),p.initialize(!!n&&n.getIsDynamic()),function(){if(!i||!n)return;if(y=n.getMediaInfoForType(i,a.IMAGE),!y)return;const e=n.getVoRepresentations(y);e&&e.length>0&&e.forEach((e=>{(e.segmentInfoType===s.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===s.SEGMENT_TIMELINE)&&S(e),e.segmentInfoType===s.SEGMENT_BASE&&S(e,!0)})),g.length>0&&(g.sort(((e,t)=>e.bitrate-t.bitrate)),E=g.length-1)}()}function S(e,t){const s=new class{constructor(){this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}};s.id=e.id,s.bitrate=e.bandwidth,s.width=e.width,s.height=e.height,s.tilesHor=1,s.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach((e=>{if(Tn.indexOf(e.schemeIdUri)>=0&&e.value){const t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(s.tilesHor=parseInt(t[0],10),s.tilesVert=parseInt(t[1],10))}})),t?u.trigger(m.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,{streamId:i.id,mediaType:a.IMAGE,mimeType:y.mimeType,representation:e,callback:function(e,t,i,a){let l=[];i=function(e,t){const r=[];let i,a,s,l,u=0;for(i=0,a=e.length;i<a;i++)s=e[i],l=wt(o,n.getIsDynamic(),t,s.startTime,s.duration,s.timescale,s.media,s.mediaRange,u),l&&(r.push(l),l=null,u++);return r}(i,a),s.segmentDuration=i[0].duration,s.readThumbnail=function(e,t){let n=null;l.some((t=>{if(t.start<=e&&t.end>e)return n=t.url,!0})),n?t(n):i.some((n=>{if(n.mediaStartTime<=e&&n.mediaStartTime+n.duration>e){const e=r.resolve(a.path);return _.load({method:"get",url:e.url,request:{range:n.mediaRange,responseType:"arraybuffer"},onload:function(e){let r=T.getSamplesInfo(e.target.response),i=new Blob([e.target.response.slice(r.sampleList[0].offset,r.sampleList[0].offset+r.sampleList[0].size)],{type:"image/jpeg"}),a=window.URL.createObjectURL(i);l.push({start:n.mediaStartTime,end:n.mediaStartTime+n.duration,url:a}),t&&t(a)}}),!0}}))}}}):(s.startNumber=e.startNumber,s.segmentDuration=e.segmentDuration,s.timescale=e.timescale,s.templateUrl=function(e){const t=f.isRelative(e.media)?f.resolve(e.media,r.resolve(e.path).url):e.media;return t?At(t,e.id):""}(e)),s.tilesHor>0&&s.tilesVert>0&&(s.widthPerTile=s.width/s.tilesHor,s.heightPerTile=s.height/s.tilesVert,g.push(s))}function A(){g=[],E=-1,y=null}return h={initialize:v,getTracks:function(){return g},reset:A,setTrackByIndex:function(e){g&&0!==g.length&&(e>=g.length&&(e=g.length-1),E=e)},getCurrentTrack:function(){return E<0?null:g[E]},getCurrentTrackIndex:function(){return E},getThumbnailRequestForTime:function(e){let t;const r=n.getVoRepresentations(y);for(let e=0;e<r.length;e++)if(g[E].id===r[e].id){t=r[e];break}return p.getSegmentRequestForTime(y,t,e)}},v(),h}vn.__dashjs_factory_name="ThumbnailTracks";const Sn=u.getClassFactory(vn);function An(){let e,t,n,r;const i=this.context,o=jt(i).getInstance(),l=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function u(e,t){let n,r,i,o,l,u,c=!1,d=!1;if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.hasOwnProperty("ContentComponent_asArray")&&(o=e.ContentComponent_asArray),l=t!==a.TEXT?new RegExp(t):new RegExp("(vtt|ttml)"),e.Representation_asArray&&e.Representation_asArray.length&&e.Representation_asArray.length>0){let n=y(e.Representation_asArray[0]);if(n&&n.length>0&&Tn.indexOf(n[0].schemeIdUri)>=0)return t===a.IMAGE;if(e.Representation_asArray[0].hasOwnProperty(s.CODECS)&&(u=e.Representation_asArray[0].codecs,0===u.search(a.STPP)||0===u.search(a.WVTT)))return t===a.FRAGMENTED_TEXT}if(o){if(o.length>1)return t===a.MUXED;o[0]&&o[0].contentType===t&&(c=!0,d=!0)}if(e.hasOwnProperty(s.MIME_TYPE)&&(c=l.test(e.mimeType),d=!0),!d)for(n=0,r=e.Representation_asArray&&e.Representation_asArray.length?e.Representation_asArray.length:0;!d&&n<r;)i=e.Representation_asArray[n],i.hasOwnProperty(s.MIME_TYPE)&&(c=l.test(i.mimeType),d=!0),n++;return c}function c(e){return u(e,a.VIDEO)}function d(e){return u(e,a.FRAGMENTED_TEXT)}function f(e){return u(e,a.IMAGE)}function h(e){return"text/vtt"===e||"application/ttml+xml"===e}function g(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort(((e,t)=>e.bandwidth-t.bandwidth)),e}function p(e,t){return e&&e.Period_asArray&&l(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function m(e){return e&&e.Period_asArray?e.Period_asArray:[]}function E(e){let t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===s.DYNAMIC),t}function y(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map((e=>({schemeIdUri:e.schemeIdUri,value:e.value}))):null}function T(e){let t=e.S_asArray[0],n=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:n.t-t.t}function v(e){const t=e.presentationTimeOffset;return e.adaptation.period.start-t}function S(e,t){if(!e)throw new Error("Period cannot be null or undefined");let n=cn.DEFAULT_ID+"_"+t;return e.hasOwnProperty(s.ID)&&e.id.length>0&&"__proto__"!==e.id&&(n=e.id),n}function A(e,t){const n=[];let r;if(!e)return n;for(r=0;r<e.length;r++){const i=new pn;if(i.timescale=1,i.representation=t,!e[r].hasOwnProperty(a.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");i.schemeIdUri=e[r].schemeIdUri,e[r].hasOwnProperty(s.TIMESCALE)&&(i.timescale=e[r].timescale),e[r].hasOwnProperty(s.VALUE)&&(i.value=e[r].value),n.push(i)}return n}function R(e){const t=[],n=e.BaseURL_asArray||[e.baseUri];let r=!1;return n.some((n=>{if(n){const i=new gn;let a=n.__text||n;return o.isRelative(a)&&(r=!0,e.baseUri&&(a=o.resolve(a,e.baseUri))),i.url=a,n.hasOwnProperty(s.SERVICE_LOCATION)&&n.serviceLocation.length?i.serviceLocation=n.serviceLocation:i.serviceLocation=a,n.hasOwnProperty(s.DVB_PRIORITY)&&(i.dvb_priority=n[s.DVB_PRIORITY]),n.hasOwnProperty(s.DVB_WEIGHT)&&(i.dvb_weight=n[s.DVB_WEIGHT]),n.hasOwnProperty(s.AVAILABILITY_TIME_OFFSET)&&(i.availabilityTimeOffset=n[s.AVAILABILITY_TIME_OFFSET]),n.hasOwnProperty(s.AVAILABILITY_TIME_COMPLETE)&&(i.availabilityTimeComplete="false"!==n[s.AVAILABILITY_TIME_COMPLETE]),t.push(i),r}})),t}return e={getIsTypeOf:u,getIsTextTrack:h,getLanguageForAdaptation:function(e){let t="";return e&&e.hasOwnProperty(s.LANG)&&(t=e.lang.replace(/[^A-Za-z0-9-]/g,"")),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(s.VIEWPOINT)?e.Viewpoint:null},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(s.ROLE_ASARRAY)?e.Role_asArray:[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(s.ACCESSIBILITY_ASARRAY)?e.Accessibility_asArray:[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(s.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(s.AUDIOCHANNELCONFIGURATION_ASARRAY)?e.AudioChannelConfiguration_asArray:[]},getAdaptationForIndex:function(e,t,n){const r=p(t,n);return r.length>0&&l(e)?r[e]:null},getIndexForAdaptation:function(e,t,n){if(!e)return-1;const r=p(t,n);for(let t=0;t<r.length;t++)if(_n(i).getInstance().areEqual(r[t],e))return t;return-1},getAdaptationForId:function(e,t,n){const r=p(t,n);let i,a;for(i=0,a=r.length;i<a;i++)if(r[i].hasOwnProperty(s.ID)&&r[i].id===e)return r[i];return null},getAdaptationsForType:function(e,t,n){const r=p(e,t);let i,a;const s=[];for(i=0,a=r.length;i<a;i++)u(r[i],n)&&s.push(g(r[i]));return s},getRealPeriods:m,getRealPeriodForIndex:function(e,t){const n=m(t);return n.length>0&&l(e)?n[e]:null},getCodec:function(e,t,n){let r=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){const i=l(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];i&&(r=i.mimeType+';codecs="'+i.codecs+'"',n&&void 0!==i.width&&(r+=';width="'+i.width+'";height="'+i.height+'"'))}return r&&(r=r.replace(/\sprofiles=[^;]*/g,"")),r},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(s.CENC_DEFAULT_KID)?e[s.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];const t=[];for(let n=0;n<e.Label_asArray.length;n++)t.push({lang:e.Label_asArray[n].lang,text:e.Label_asArray[n].__text||e.Label_asArray[n]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(s.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:E,getId:function(e){return e&&e[s.ID]||null},hasProfile:function(e,t){let n=!1;return e&&e.profiles&&e.profiles.length>0&&(n=-1!==e.profiles.indexOf(t)),n},getDuration:function(e){let t;return t=e&&e.hasOwnProperty(s.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,t},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e,t=0){let n=NaN;return e&&e.hasOwnProperty(s.MINIMUM_UPDATE_PERIOD)&&(n=e.minimumUpdatePeriod),isNaN(n)?n:Math.max(n-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(s.PUBLISH_TIME)?new Date(e[s.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){const t=g(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map((e=>({bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null})))},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&l(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){const t=[],n=function(e){if(e&&e.period&&l(e.period.index)){const t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&l(e.index))return g(t.AdaptationSet_asArray[e.index])}}(e);let r,i;if(n&&n.Representation_asArray){if(e&&e.period&&l(e.period.index)){const t=R(e.period.mpd.manifest);t&&(i=t[0])}for(let a=0,o=n.Representation_asArray.length;a<o;++a){const o=n.Representation_asArray[a],l=new on;if(l.index=a,l.adaptation=e,o.hasOwnProperty(s.ID)&&(l.id=o.id),o.hasOwnProperty(s.CODECS)&&(l.codecs=o.codecs),o.hasOwnProperty(s.CODEC_PRIVATE_DATA)&&(l.codecPrivateData=o.codecPrivateData),o.hasOwnProperty(s.BANDWITH)&&(l.bandwidth=o.bandwidth),o.hasOwnProperty(s.WIDTH)&&(l.width=o.width),o.hasOwnProperty(s.HEIGHT)&&(l.height=o.height),o.hasOwnProperty(s.SCAN_TYPE)&&(l.scanType=o.scanType),o.hasOwnProperty(s.MAX_PLAYOUT_RATE)&&(l.maxPlayoutRate=o.maxPlayoutRate),o.hasOwnProperty(s.SEGMENT_BASE)?(r=o.SegmentBase,l.segmentInfoType=s.SEGMENT_BASE):o.hasOwnProperty(s.SEGMENT_LIST)?(r=o.SegmentList,r.hasOwnProperty(s.SEGMENT_TIMELINE)?l.segmentInfoType=s.SEGMENT_TIMELINE:l.segmentInfoType=s.SEGMENT_LIST):o.hasOwnProperty(s.SEGMENT_TEMPLATE)?(r=o.SegmentTemplate,r.hasOwnProperty(s.SEGMENT_TIMELINE)?l.segmentInfoType=s.SEGMENT_TIMELINE:l.segmentInfoType=s.SEGMENT_TEMPLATE,r.hasOwnProperty(s.INITIALIZATION_MINUS)&&(l.initialization=r.initialization.split("$Bandwidth$").join(o.bandwidth).split("$RepresentationID$").join(o.id))):l.segmentInfoType=s.BASE_URL,l.essentialProperties=y(o),r){if(r.hasOwnProperty(s.INITIALIZATION)){const e=r.Initialization;e.hasOwnProperty(s.SOURCE_URL)&&(l.initialization=e.sourceURL),e.hasOwnProperty(s.RANGE)&&(l.range=e.range)}else o.hasOwnProperty(s.MIME_TYPE)&&h(o.mimeType)&&(l.range=0);r.hasOwnProperty(s.TIMESCALE)&&(l.timescale=r.timescale),r.hasOwnProperty(s.DURATION)?l.segmentDuration=r.duration/l.timescale:o.hasOwnProperty(s.SEGMENT_TEMPLATE)&&(r=o.SegmentTemplate,r.hasOwnProperty(s.SEGMENT_TIMELINE)&&(l.segmentDuration=T(r.SegmentTimeline)/l.timescale)),r.hasOwnProperty(s.MEDIA)&&(l.media=r.media),r.hasOwnProperty(s.START_NUMBER)&&(l.startNumber=r.startNumber),r.hasOwnProperty(s.INDEX_RANGE)&&(l.indexRange=r.indexRange),r.hasOwnProperty(s.PRESENTATION_TIME_OFFSET)&&(l.presentationTimeOffset=r.presentationTimeOffset/l.timescale),r.hasOwnProperty(s.AVAILABILITY_TIME_OFFSET)?l.availabilityTimeOffset=r.availabilityTimeOffset:i&&void 0!==i.availabilityTimeOffset&&(l.availabilityTimeOffset=i.availabilityTimeOffset),r.hasOwnProperty(s.AVAILABILITY_TIME_COMPLETE)?l.availabilityTimeComplete="false"!==r.availabilityTimeComplete:i&&void 0!==i.availabilityTimeComplete&&(l.availabilityTimeComplete=i.availabilityTimeComplete)}l.MSETimeOffset=v(l),l.path=[e.period.index,e.index,a],t.push(l)}}return t},getAdaptationsForPeriod:function(e){const t=e&&l(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,n=[];let r,i,o;if(t&&t.AdaptationSet_asArray)for(o=0;o<t.AdaptationSet_asArray.length;o++)i=t.AdaptationSet_asArray[o],r=new ln,i.hasOwnProperty(s.ID)&&(r.id=i.id),r.index=o,r.period=e,u(i,a.MUXED)?r.type=a.MUXED:u(i,a.AUDIO)?r.type=a.AUDIO:c(i)?r.type=a.VIDEO:d(i)?r.type=a.FRAGMENTED_TEXT:f(i)?r.type=a.IMAGE:r.type=a.TEXT,n.push(r);return n},getRegularPeriods:function(e){const r=!!e&&E(e.manifest),i=[];let o,l,u=null,c=null,d=null,f=null;for(l=0,o=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;l<o;l++)c=e.manifest.Period_asArray[l],c.hasOwnProperty(s.START)?(f=new cn,f.start=c.start):null!==u&&u.hasOwnProperty(s.DURATION)&&null!==d?(f=new cn,f.start=parseFloat((d.start+d.duration).toFixed(5))):0!==l||r||(f=new cn,f.start=0),null!==d&&isNaN(d.duration)&&(null!==f?d.duration=parseFloat((f.start-d.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==f&&(f.id=S(c,l),f.index=l,f.mpd=e,c.hasOwnProperty(s.DURATION)&&(f.duration=c.duration),i.push(f),u=c,d=f),c=null,f=null;return 0===i.length||null!==d&&isNaN(d.duration)&&(d.duration=parseFloat((function(e){!function(){if(!n||!n.hasOwnProperty("error"))throw new Error(a.MISSING_CONFIG_ERROR)}();const t=E(e.mpd.manifest);let r;return e.mpd.manifest.mediaPresentationDuration?r=e.mpd.manifest.mediaPresentationDuration:e.duration?r=e.duration:t?r=Number.POSITIVE_INFINITY:n.error(new M(Q.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),r}(d)-d.start).toFixed(5))),i},getMpd:function(e){const t=new class{constructor(){this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN}};return e&&(t.manifest=e,e.hasOwnProperty(s.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(s.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(s.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(s.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(s.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(s.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(s.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(s.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){const t=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,n=t?t.Period_asArray:null,i=n&&e&&l(e.index)?n[e.index].EventStream_asArray:null,o=[];let u,c;if(i)for(u=0;u<i.length;u++){const t=new pn;if(t.period=e,t.timescale=1,!i[u].hasOwnProperty(a.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(t.schemeIdUri=i[u][a.SCHEME_ID_URI],i[u].hasOwnProperty(s.TIMESCALE)&&(t.timescale=i[u][s.TIMESCALE]),i[u].hasOwnProperty(s.VALUE)&&(t.value=i[u][s.VALUE]),i[u].hasOwnProperty(s.PRESENTATION_TIME_OFFSET)&&(t.presentationTimeOffset=i[u][s.PRESENTATION_TIME_OFFSET]),c=0;i[u].Event_asArray&&c<i[u].Event_asArray.length;c++){const n=i[u].Event_asArray[c],a=new fn;if(a.presentationTime=0,a.eventStream=t,n.hasOwnProperty(s.PRESENTATION_TIME)){a.presentationTime=n.presentationTime;const r=t.presentationTimeOffset?t.presentationTimeOffset/t.timescale:0;a.calculatedPresentationTime=a.presentationTime/t.timescale+e.start-r}n.hasOwnProperty(s.DURATION)&&(a.duration=n.duration/t.timescale),n.hasOwnProperty(s.ID)&&(a.id=n.id),n.Signal&&n.Signal.Binary?a.messageData=r.decodeArray(n.Signal.Binary.toString()):a.messageData=n.messageData||n.__text,o.push(a)}}return o},getEssentialPropertiesForRepresentation:y,getEventStreamForAdaptationSet:function(e,t){let n,r,i;return e&&e.Period_asArray&&t&&t.period&&l(t.period.index)&&(r=e.Period_asArray[t.period.index],r&&r.AdaptationSet_asArray&&l(t.index)&&(i=r.AdaptationSet_asArray[t.index],i&&(n=i.InbandEventStream_asArray))),A(n,null)},getEventStreamForRepresentation:function(e,t){let n,r,i,a;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&l(t.adaptation.period.index)&&(r=e.Period_asArray[t.adaptation.period.index],r&&r.AdaptationSet_asArray&&l(t.adaptation.index)&&(i=r.AdaptationSet_asArray[t.adaptation.index],i&&i.Representation_asArray&&l(t.index)&&(a=i.Representation_asArray[t.index],a&&(n=a.InbandEventStream_asArray)))),A(n,t)},getUTCTimingSources:function(e){const t=E(e),n=!!e&&e.hasOwnProperty(s.AVAILABILITY_START_TIME),r=e?e.UTCTiming_asArray:null,i=[];return(t||n)&&r&&r.forEach((function(e){const t=new dn;e.hasOwnProperty(a.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(s.VALUE)&&(t.value=e.value.toString(),i.push(t)))})),i},getBaseURLsFromElement:R,getRepresentationSortFunction:function(){return(e,t)=>e.bandwidth-t.bandwidth},getLocation:function(e){if(e&&e.hasOwnProperty(a.LOCATION))return e.Location=e.Location_asArray[0],e.Location},getPatchLocation:function(e){if(e&&e.hasOwnProperty(s.PATCH_LOCATION))return e.PatchLocation=e.PatchLocation_asArray[0],e.PatchLocation},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(s.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(s.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){const t=[];if(e&&e.hasOwnProperty(s.SERVICE_DESCRIPTION))for(const n of e.ServiceDescription_asArray){let e,r,i,o;for(const t in n)n.hasOwnProperty(t)&&(t===s.ID?e=n[t]:t===s.SERVICE_DESCRIPTION_SCOPE?r=n[t].schemeIdUri:t===s.SERVICE_DESCRIPTION_LATENCY?i={target:n[t].target,max:n[t].max,min:n[t].min}:t===s.SERVICE_DESCRIPTION_PLAYBACK_RATE&&(o={max:n[t].max,min:n[t].min}));r===a.SERVICE_DESCRIPTION_LL_SCHEME&&(i||o)&&t.push({id:e,schemeIdUri:r,latency:i,playbackRate:o})}return t},getSupplementalPropperties:function(e){const t={};if(e&&e.hasOwnProperty(s.SUPPLEMENTAL_PROPERTY))for(const n of e.SupplementalProperty_asArray)n.hasOwnProperty(a.SCHEME_ID_URI)&&n.hasOwnProperty(s.VALUE)&&(t[n[a.SCHEME_ID_URI]]=n[s.VALUE]);return t},setConfig:function(e){e&&(e.errHandler&&(n=e.errHandler),e.BASE64&&(r=e.BASE64))}},t=_(i).getInstance().getLogger(e),e}An.__dashjs_factory_name="DashManifestModel";const Rn=u.getSingletonFactory(An);function bn(){let e,t,n,r,i,s,o,l,u,c,f,h=this.context,p=g(h).getInstance(),m=nn(h).getInstance();function E(){r={pr:1,nor:null,st:null,sf:null,sid:`${en.generateUuid()}`,cid:null},c={},u={},f={},T()}function y(){T()}function T(){if(!o)return;const e=o.getStreamController();if(!e)return;if("function"!=typeof e.getActiveStream)return;const t=e.getActiveStream();t&&(l=t.getProcessors())}function v(e,t){const n={};for(let r of t)e[r]&&(n[r]=e[r]);return n}function A(e){try{let n=null;return e.type===S.MPD_TYPE?function(){const e=R();return e.ot="m",e}():e.type===S.MEDIA_SEGMENT_TYPE?(t=e.mediaType,f.hasOwnProperty(t)||(f[t]=!1),u.hasOwnProperty(t)||(u[t]=!1),c.hasOwnProperty(t)||(c[t]=!1),function(e){const t=R(),n=function(e){try{const t=e.quality,n=e.mediaInfo.bitrateList;return parseInt(n[t].bandwidth/1e3)}catch(e){return null}}(e),d=function(e){try{return isNaN(e.duration)?null:Math.round(1e3*e.duration)}catch(e){return null}}(e),h=function(e){try{return 100*parseInt(i.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}(e.mediaType),g=function(e){try{const t=r.pr,n=s.getCurrentBufferLevel(e);return isNaN(t)||isNaN(n)?null:100*parseInt(n/t*10)}catch(e){return null}}(e.mediaType),p=b(e.mediaType),E=function(e){try{const t=i.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}(e.mediaType),y=r.pr,_=function(e){if(l&&0!==l.length)for(let t of l)if(t.getType()===e)return t.probeNextRequest()}(e.mediaType);let T;e.mediaType===a.VIDEO&&(T="v"),e.mediaType===a.AUDIO&&(T="a"),e.mediaType===a.FRAGMENTED_TEXT&&(T="application/mp4"===e.mediaInfo.mimeType?"tt":"c");let v=m.get().streaming.cmcd.rtp;if(v||(v=function(e){let t=o.getPlaybackRate();t||(t=1);let{quality:n,mediaType:r,mediaInfo:i,duration:a}=e,s=b(r);0===s&&(s=500);let l=i.bitrateList[n].bandwidth*a/1e3/(s/t/1e3),u=m.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(m.get().streaming.cmcd.rtpSafetyFactor)?m.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(l*u/100)+1)}(e)),t.rtp=v,_)if(e.url!==_.url){let e=new URL(_.url);t.nor=e.pathname}else _.range&&(t.nrr=_.range);return n&&(t.br=n),T&&(t.ot=T),isNaN(d)||(t.d=d),isNaN(h)||(t.mtp=h),isNaN(g)||(t.dl=g),isNaN(p)||(t.bl=p),isNaN(E)||(t.tb=E),isNaN(y)||1===y||(t.pr=y),c[e.mediaType]&&(t.bs=!0,c[e.mediaType]=!1),!u[e.mediaType]&&f[e.mediaType]||(t.su=!0,u[e.mediaType]=!1,f[e.mediaType]=!0),t}(e)):e.type===S.INIT_SEGMENT_TYPE?function(){const e=R();return e.ot="i",e.su=!0,e}():e.type===S.OTHER_TYPE||e.type===S.XLINK_EXPANSION_TYPE?function(){const e=R();return e.ot="o",e}():e.type===S.LICENSE?function(e){const t=R();return t.ot="k",t}():n}catch(e){return null}var t}function R(){const e={};let t=m.get().streaming.cmcd.cid?m.get().streaming.cmcd.cid:r.cid;return e.v=1,e.sid=m.get().streaming.cmcd.sid?m.get().streaming.cmcd.sid:r.sid,e.sid=`${e.sid}`,t&&(e.cid=`${t}`),isNaN(r.pr)||1===r.pr||null===r.pr||(e.pr=r.pr),r.st&&(e.st=r.st),r.sf&&(e.sf=r.sf),e}function b(e){try{const t=s.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function I(e){try{r.pr=e.playbackRate}catch(e){}}function D(e){try{const n=t.getIsDynamic(e.data)?"l":"v",i=e.protocol&&"MSS"===e.protocol?"s":"d";r.st=`${n}`,r.sf=`${i}`}catch(e){}}function w(e){try{e.state&&e.mediaType&&e.state===d.BUFFER_EMPTY&&(c[e.mediaType]||(c[e.mediaType]=!0),u[e.mediaType]||(u[e.mediaType]=!0))}catch(e){}}function C(){for(let e in c)c.hasOwnProperty(e)&&(c[e]=!0);for(let e in u)u.hasOwnProperty(e)&&(u[e]=!0)}function N(e){try{if(!e)return null;const t=Object.keys(e).sort(((e,t)=>e.localeCompare(t))),n=t.length;let r=t.reduce(((t,r,i)=>("v"===r&&1===e[r]||("string"!=typeof e[r]||"ot"===r&&"sf"===r&&"st"===r?t+=`${r}=${e[r]}`:t+=`${r}="${e[r].replace(/"/g,'"')}"`,i<n-1&&(t+=",")),t)),"");return r=r.replace(/=true/g,""),r}catch(e){return null}}return n={getQueryParameter:function(e){try{if(m.get().streaming.cmcd&&m.get().streaming.cmcd.enabled){const t=A(e),n=N(t);return p.trigger(sn.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:"CMCD",value:n}}return null}catch(e){return null}},getHeaderParameters:function(e){try{if(m.get().streaming.cmcd&&m.get().streaming.cmcd.enabled){const t=A(e),n=v(t,["br","d","ot","tb"]),r=v(t,["bl","dl","mtp","nor","nrr","su"]),i=v(t,["bs","rtp"]),a=v(t,["cid","pr","sf","sid","st","v"]),s={"CMCD-Object":N(n),"CMCD-Request":N(r),"CMCD-Status":N(i),"CMCD-Session":N(a)};return p.trigger(sn.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t}),s}return null}catch(e){return null}},setConfig:function(e){e&&(e.abrController&&(i=e.abrController),e.dashMetrics&&(s=e.dashMetrics),e.playbackController&&(o=e.playbackController))},reset:function(){p.off(d.PLAYBACK_RATE_CHANGED,I,this),p.off(d.MANIFEST_LOADED,D,this),p.off(d.BUFFER_LEVEL_STATE_CHANGED,w,n),p.off(d.PLAYBACK_SEEKED,C,n),E()},initialize:function(){p.on(d.PLAYBACK_RATE_CHANGED,I,n),p.on(d.MANIFEST_LOADED,D,n),p.on(d.BUFFER_LEVEL_STATE_CHANGED,w,n),p.on(d.PLAYBACK_SEEKED,C,n),p.on(d.PERIOD_SWITCH_COMPLETED,y,n)}},e=_(h).getInstance().getLogger(n),t=Rn(h).getInstance(),E(),n}bn.__dashjs_factory_name="CmcdModel";const In=u.getSingletonFactory(bn);function Dn(e){e=e||{};const t=this.context,n=e.errHandler,r=e.dashMetrics,i=e.mediaPlayerModel,s=e.requestModifier,o=e.boxParser,l=e.useFetch||!1,u=e.errors,c=e.requestTimeout||0,d=g(t).getInstance(),f=nn(t).getInstance();let h,p,E,y,T,v,A;function R(e,u){const h=e.request,g=[];let _,b=!0,I=!0,D=new Date,w=D,C=0;if(!s||!r||!n)throw new Error("config object is not correct or missing");const N=function(e){I=!1,h.requestStartDate=D,h.requestEndDate=new Date,h.firstByteDate=h.firstByteDate||D,h.checkExistenceOnly||(r.addHttpRequest(h,_.response?_.response.responseURL:null,_.response?_.response.status:null,_.response&&_.response.getAllResponseHeaders?_.response.getAllResponseHeaders():_.response?_.response.responseHeaders:[],e?g:null),h.type===S.MPD_TYPE&&r.addManifestUpdate(h))},L=function(){if(-1!==p.indexOf(_)&&(p.splice(p.indexOf(_),1),I))if(N(!1),u>0){try{f.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&h.type===S.MEDIA_SEGMENT_TYPE&&i.getRetryAttemptsForType(S.MEDIA_SEGMENT_TYPE)===u&&d.trigger(m.ATTEMPT_BACKGROUND_SYNC)}catch(e){}u--;let t={config:e};y.push(t),t.timeout=setTimeout((function(){-1!==y.indexOf(t)&&(y.splice(y.indexOf(t),1),R(e,u))}),i.getRetryIntervalsForType(h.type))}else{if(h.type===S.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;n.error(new M(T[h.type],h.url+" is not available",{request:h,response:_.response})),e.error&&e.error(h,"error",_.response.statusText),e.complete&&e.complete(h,_.response.statusText)}};let O;O=l&&window.fetch&&"arraybuffer"===h.responseType&&h.type===S.MEDIA_SEGMENT_TYPE?an(t).create({requestModifier:s,boxParser:o}):Jt(t).create({requestModifier:s});let P=null,x=s.modifyRequestURL(h.url);if(f.get().streaming.cmcd&&f.get().streaming.cmcd.enabled){const e=f.get().streaming.cmcd.mode;if(e===a.CMCD_MODE_QUERY){const e=function(e){try{const t=[],n=v.getQueryParameter(e);return n&&t.push(n),t}catch(e){return[]}}(h);x=en.addAditionalQueryParameterToUrl(x,e)}else e===a.CMCD_MODE_HEADER&&(P=v.getHeaderParameters(h))}const F=h.checkExistenceOnly?S.HEAD:S.GET,k=i.getXHRWithCredentialsForType(h.type);_={url:x,method:F,withCredentials:k,request:h,onload:function(){_.response.status>=200&&_.response.status<=299&&(N(!0),e.success&&e.success(_.response.response,_.response.statusText,_.response.responseURL),e.complete&&e.complete(h,_.response.statusText))},onend:L,onerror:L,progress:function(t){const n=new Date;b&&(b=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(h.firstByteDate=n)),t.lengthComputable&&(h.bytesLoaded=t.loaded,h.bytesTotal=t.total),t.noTrace||(g.push({s:w,d:t.time?t.time:n.getTime()-w.getTime(),b:[t.loaded?t.loaded-C:0]}),w=n,C=t.loaded),e.progress&&t&&e.progress(t)},onabort:function(){e.abort&&e.abort(h)},ontimeout:function(e){let t;if(e.lengthComputable){let n=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+n.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";A.warn(t)},loader:O,timeout:c,headers:P};let U=(new Date).getTime();if(isNaN(h.delayLoadingTime)||U>=h.delayLoadingTime)p.push(_),O.load(_);else{let e={httpRequest:_};E.push(e),e.delayTimeout=setTimeout((function(){if(-1!==E.indexOf(e)){E.splice(E.indexOf(e),1);try{D=new Date,w=D,p.push(e.httpRequest),O.load(e.httpRequest)}catch(t){e.httpRequest.onerror()}}}),h.delayLoadingTime-U)}}return h={load:function(e){e.request?R(e,i.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){y.forEach((e=>{clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)})),y=[],E.forEach((e=>clearTimeout(e.delayTimeout))),E=[],p.forEach((e=>{e.request.type!==S.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))})),p=[]}},A=_(t).getInstance().getLogger(h),p=[],E=[],y=[],v=In(t).getInstance(),T={[S.MPD_TYPE]:u.DOWNLOAD_ERROR_ID_MANIFEST_CODE,[S.XLINK_EXPANSION_TYPE]:u.DOWNLOAD_ERROR_ID_XLINK_CODE,[S.INIT_SEGMENT_TYPE]:u.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE,[S.MEDIA_SEGMENT_TYPE]:u.DOWNLOAD_ERROR_ID_CONTENT_CODE,[S.INDEX_SEGMENT_TYPE]:u.DOWNLOAD_ERROR_ID_CONTENT_CODE,[S.BITSTREAM_SWITCHING_SEGMENT_TYPE]:u.DOWNLOAD_ERROR_ID_CONTENT_CODE,[S.OTHER_TYPE]:u.DOWNLOAD_ERROR_ID_CONTENT_CODE},h}Dn.__dashjs_factory_name="HTTPLoader";const wn=u.getClassFactory(Dn);function Cn(){let e,t;function n(){t={}}function r(){n()}return r(),e={getLoader:function(e){for(var n in t)if(t.hasOwnProperty(n)&&e.startsWith(n))return t[n];return wn},registerLoader:function(e,n){t[e]=n},unregisterLoader:function(e){t[e]&&delete t[e]},unregisterAllLoader:n,reset:r},e}Cn.__dashjs_factory_name="SchemeLoaderFactory";const Nn=u.getSingletonFactory(Cn);function Ln(e){e=e||{};const t=this.context;let n,r,i;return r=Nn(t).getInstance(),n={load:function(n){let a=r.getLoader(n&&n.request?n.request.url:null);i=a(t).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.useFetch||null,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors}),i.load(n)},abort:function(){i&&i.abort()}},n}Ln.__dashjs_factory_name="URLLoader";const Mn=u.getClassFactory(Ln),On=class extends b{constructor(e){super(e),this.checkForExistenceOnly=!0}};function Pn(e){e=e||{};const t=this.context,n=e.eventBus,r=e.events,i=e.urlUtils,s=e.errors;let o,l;return o={checkForExistence:function(e){const t=function(t){n.trigger(r.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){let n=new On(e.url);l.load({request:n,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){const t=function(t,i){n.trigger(r.LOADING_COMPLETED,{request:e,response:t||null,error:i||null,sender:o})};e?l.load({request:e,progress:function(t){n.trigger(r.LOADING_PROGRESS,{request:e,stream:t.stream}),t.data&&n.trigger(r.LOADING_DATA_PROGRESS,{request:e,response:t.data||null,error:null,sender:o})},success:function(e){t(e)},error:function(e,n,r){t(void 0,new M(s.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,r,n))},abort:function(e){e&&n.trigger(r.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:o})}}):t(void 0,new M(s.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,s.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){l&&l.abort()},reset:function(){l&&(l.abort(),l=null)}},l=Mn(t).create({errHandler:e.errHandler,errors:s,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.settings.get().streaming.lowLatencyEnabled,urlUtils:i,constants:a,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),o}Pn.__dashjs_factory_name="FragmentLoader";const xn=u.getClassFactory(Pn);function Fn(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=e.errHandler,i=e.mediaPlayerModel,s=e.dashMetrics,o=_(t).getInstance(),l=e.streamInfo;let u,c,d;function f(){for(let e in d)d[e].reset();d={}}function h(e){if(!e.sender)return;const t=e.request,r=e.response,i=t.isInitializationRequest(),s=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType!==a.AUDIO&&t.mediaType!==a.VIDEO&&t.mediaType!==a.FRAGMENTED_TEXT||n.trigger(m.SERVICE_LOCATION_BLACKLIST_ADD,{entry:e.request.serviceLocation})),!r||!s)return void c.warn("No "+t.mediaType+" bytes to push or stream is inactive.");const o=function(e,t,n,r){const i=new class{constructor(){this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null}};return i.streamId=n,i.mediaInfo=t.mediaInfo,i.segmentType=t.type,i.start=t.startTime,i.duration=t.duration,i.end=i.start+i.duration,i.bytes=e,i.index=t.index,i.quality=t.quality,i.representationId=t.representationId,i.endFragment=r,i}(r,t,l.id,e.type!==m.FRAGMENT_LOADING_PROGRESS);n.trigger(i?m.INIT_FRAGMENT_LOADED:m.MEDIA_FRAGMENT_LOADED,{chunk:o,request:t},{streamId:s.id,mediaType:t.mediaType})}return u={getStreamId:function(){return l.id},getModel:function(a){let u=d[a];return u||(u=L(t).create({streamInfo:l,type:a,dashMetrics:s,fragmentLoader:xn(t).create({dashMetrics:s,mediaPlayerModel:i,errHandler:r,requestModifier:Kt(t).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:n,events:m,errors:Q,dashConstants:e.dashConstants,urlUtils:e.urlUtils}),debug:o,eventBus:n,events:m}),d[a]=u),u},reset:function(){n.off(m.FRAGMENT_LOADING_COMPLETED,h,this),n.off(m.FRAGMENT_LOADING_PROGRESS,h,this),f()}},c=o.getLogger(u),f(),n.on(m.FRAGMENT_LOADING_COMPLETED,h,u),n.on(m.FRAGMENT_LOADING_PROGRESS,h,u),u}Fn.__dashjs_factory_name="FragmentController";const kn=u.getClassFactory(Fn);function Un(e){const t=this.context,n=e.streamInfo;let r,i;function s(){i&&i.reset()}return r={getStreamId:function(){return n.id},provide:function(e,t){if("function"!=typeof t)return;const n=i.getCurrentTrack();let r,a;if(!n||n.segmentDuration<=0||null==e)return void t(null);isNaN(n.segmentDuration)&&(a=i.getThumbnailRequestForTime(e),a&&(n.segmentDuration=a.duration)),r=e%n.segmentDuration;const s=Math.floor(r*n.tilesHor*n.tilesVert/n.segmentDuration),o=new class{constructor(){this.url=null,this.width=null,this.height=null,this.x=null,this.y=null}};if(o.width=Math.floor(n.widthPerTile),o.height=Math.floor(n.heightPerTile),o.x=Math.floor(s%n.tilesHor)*n.widthPerTile,o.y=Math.floor(s/n.tilesHor)*n.heightPerTile,"readThumbnail"in n)return n.readThumbnail(e,(e=>{o.url=e,t(o)}));if(a)o.url=a.url,n.segmentDuration=NaN;else{const t=Math.floor(e/n.segmentDuration);o.url=function(e,t){const n=t+e.startNumber;let r=Rt(e.templateUrl,"Number",n);return r=Rt(r,"Time",(n-1)*e.segmentDuration*e.timescale),r=Rt(r,"Bandwidth",e.bandwidth),St(r)}(n,t)}t(o)},setTrackByIndex:function(e){i.setTrackByIndex(e)},getCurrentTrackIndex:function(){return i.getCurrentTrackIndex()},getBitrateList:function(){const e=i.getTracks();let t=0;return e.map((e=>{const n=new He;return n.mediaType=a.IMAGE,n.qualityIndex=t++,n.bitrate=e.bitrate,n.width=e.width,n.height=e.height,n}))},reset:s},s(),i=Sn(t).create({streamInfo:n,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants}),r}Un.__dashjs_factory_name="ThumbnailController";const Bn=u.getClassFactory(Un);function Gn(e){e=e||{};const t=this.context,n=g(t).getInstance(),r=jt(t).getInstance(),i=e.manifestModel,o=e.mediaPlayerModel,l=e.manifestUpdater,u=e.adapter,c=e.capabilities,d=e.capabilitiesFilter,f=e.errHandler,h=e.timelineConverter,p=e.dashMetrics,E=e.abrController,y=e.playbackController,T=e.eventController,v=e.mediaController,S=e.textController,A=e.protectionController,R=e.videoModel,b=e.settings;let I,D,w,C,N,L,O,P,x,F,k,U,B,q,K,H,Y,V,j=e.streamInfo;function z(e){let t=w?w.length:0;for(let n=0;n<t;n++)w[n].getFragmentModel().removeExecutedRequestsBeforeTime(J()+X()),w[n].reset(!1,e);w=[],N=!1,L=!1,ye(!1),n.off(m.CURRENT_TRACK_CHANGED,ae,I)}function W(){z(),C=!1,O=!1,P=!1,x={},F=!1,K=!1,Y=!1}function $(){y&&y.pause(),k&&(k.reset(),k=null),j=null,W(),n.off(m.DATA_UPDATE_COMPLETED,de,I),n.off(m.BUFFERING_COMPLETED,ce,I),n.off(m.INBAND_EVENTS,fe,I),A&&(n.off(m.KEY_ERROR,re,I),n.off(m.SERVER_CERTIFICATE_UPDATED,re,I),n.off(m.LICENSE_REQUEST_COMPLETE,re,I),n.off(m.KEY_SYSTEM_SELECTED,re,I),n.off(m.KEY_SESSION_CREATED,re,I),n.off(m.KEY_STATUSES_CHANGED,re,I)),ye(!1)}function X(){return j?j.duration:NaN}function J(){return j?j.start:NaN}function Z(){if(!j.manifestInfo.isDynamic)return NaN;for(let e=0;e<w.length;e++)if(w[e].getType()===a.AUDIO||w[e].getType()===a.VIDEO)return w[e].getLiveStartTime();return NaN}function ee(){return j?j.id:null}function te(){return j}function ne(){if(!(R&&E&&E.hasOwnProperty("getBitrateList")&&u&&u.hasOwnProperty("getAllMediaInfoForType")&&u.hasOwnProperty("getEventsFor")))throw new Error(a.MISSING_CONFIG_ERROR)}function re(e){e.error&&(f.error(e.error),D.fatal(e.error.message),$())}function ie(e){const t=e?e.type:null;let n,r;if(t===a.MUXED)return r="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",D.fatal(r),f.error(new M(Q.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,r,i.getValue())),!1;if(t===a.TEXT||t===a.FRAGMENTED_TEXT||t===a.EMBEDDED_TEXT||t===a.IMAGE)return!0;if(n=e.codec,D.debug(t+" codec: "+n),e.contentProtection&&!c.supportsEncryptedMedia())f.error(new M(Q.CAPABILITY_MEDIAKEYS_ERROR_CODE,Q.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE));else if(!c.supportsCodec(n))return r=t+"Codec ("+n+") is not supported.",D.error(r),!1;return!0}function ae(e){if(!j||e.newMediaInfo.streamInfo.id!==j.id)return;let t=e.newMediaInfo,n=i.getValue();u.setCurrentMediaInfo(j.id,t.type,t);let r=he(t);if(!r)return;let s=y.getTime();D.info("Stream -  Process track changed at current time "+s),D.debug("Stream -  Update stream controller"),n.refreshManifestOnSwitchTrack?(D.debug("Stream -  Refreshing manifest for switch track"),V=e,l.refreshManifest()):(r.selectMediaInfo(t),t.type!==a.FRAGMENTED_TEXT?(E.updateTopQualityIndex(t),r.switchTrackAsked(),r.getFragmentModel().abortRequests()):(r.getScheduleController().setSeekTarget(s),r.setBufferingTime(s),r.resetIndexHandler()))}function se(r,l){const c=u.getAllMediaInfoForType(j,r);let d,g=null;if(c&&0!==c.length){r===a.VIDEO&&(O=!0),r===a.AUDIO&&(P=!0);for(let e=0,t=c.length;e<t;e++)if(g=c[e],r===a.EMBEDDED_TEXT)S.addEmbeddedTrack(g);else{if(!ie(g))continue;v.addTrack(g)}r!==a.EMBEDDED_TEXT&&0!==v.getTracksFor(r,j).length&&(r!==a.IMAGE?(v.checkInitialMediaSettingsForType(r,j),d=v.getCurrentTrackFor(r,j),n.trigger(m.STREAM_INITIALIZING,{streamInfo:j,mediaInfo:g}),function(n,r,s,l){let c=k.getModel(n?n.type:null),d=Xt(t).create({streamInfo:j,type:n?n.type:null,mimeType:n?n.mimeType:null,timelineConverter:h,adapter:u,manifestModel:i,mediaPlayerModel:o,fragmentModel:c,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,abrController:E,playbackController:y,mediaController:v,textController:S,errHandler:f,settings:b,boxParser:q});if(d.initialize(s,O),E.updateTopQualityIndex(n),w.push(d),!n||n.type!==a.TEXT&&n.type!==a.FRAGMENTED_TEXT)d.addMediaInfo(n,!0);else{let e;for(let t=0;t<r.length;t++)r[t].index===n.index&&(e=t),d.addMediaInfo(r[t]);d.selectMediaInfo(r[e])}}(d,c,l)):U=Bn(t).create({streamInfo:j,adapter:u,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:H,eventBus:n,events:m,dashConstants:s}))}else D.info("No "+r+" data.")}function oe(){if(T){const e=u.getEventsFor(j);T.addInlineEvents(e)}}function le(){const e=w.length;let t=x.audio||x.video?new M(Q.DATA_UPDATE_FAILED_ERROR_CODE,Q.DATA_UPDATE_FAILED_ERROR_MESSAGE):null;for(let t=0;t<e;t++)if(w[t].isUpdating()||F)return;if(L){if(A){A.clearMediaInfoArrayByStreamId(ee());for(let t=0;t<e&&w[t];t++){const e=w[t].getType();if(e===a.AUDIO||e===a.VIDEO||e===a.FRAGMENTED_TEXT){let e=w[t].getMediaInfo();e&&A.initializeForMedia(e)}}}t?f.error(t):C||(C=!0,n.trigger(m.STREAM_INITIALIZED,{streamInfo:j,liveStartTime:B?NaN:Z()}));for(let t=0;t<e&&w[t];t++)w[t].getScheduleController().start()}}function ue(e){const t={};for(let n=0,r=w.length;n<r;n++){const r=w[n].createBuffer(e);r&&(t[w[n].getType()]=r.getBuffer())}return t}function ce(){let e=ge();const t=e.length;if(0!==t){for(let n=0;n<t;n++)if(!e[n].isBufferingCompleted()&&(e[n].getType()===a.AUDIO||e[n].getType()===a.VIDEO))return void D.warn("onBufferingCompleted - One streamProcessor has finished but",e[n].getType(),"one is not buffering completed");D.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),n.trigger(m.STREAM_BUFFERING_COMPLETED,{streamInfo:j})}else D.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function de(e){x[e.mediaType]=e.error,le()}function fe(e){var t;t=e.events,T&&T.addInbandEvents(t)}function he(e){return e?ge().filter((function(t){return t.getType()===e.type}))[0]:null}function ge(){let e,t,n=[];for(let r=0;r<w.length;r++)t=w[r],e=t.getType(),e!==a.AUDIO&&e!==a.VIDEO&&e!==a.FRAGMENTED_TEXT&&e!==a.TEXT||n.push(t);return n}function pe(e,t,n=null){if(!e)return!1;const r=e.getStreamInfo(),i=n?n.getStreamInfo():te();if(!r||!i)return!1;const a=u.getAdaptationForType(r.index,t,r),s=u.getAdaptationForType(i.index,t,i);return a&&s?!(!me(s)&&me(a)):!a&&!s}function me(e){return!!e&&!!(e.ContentProtection||e.Representation&&e.Representation.length>0&&e.Representation[0].ContentProtection)}function Ee(e,t,n=null){if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;const r=e.getStreamInfo(),i=n?n.getStreamInfo():te();if(!r||!i)return!1;const a=u.getAdaptationForType(r.index,t,r),s=u.getAdaptationForType(i.index,t,i);if(!a||!s)return!a&&!s;const o=a&&s&&a.mimeType===s.mimeType,l=s.Representation_asArray.map((e=>e.codecs)),d=a.Representation_asArray.map((e=>e.codecs)),f=d.some((e=>l.indexOf(e)>-1)),h=d.some((e=>l.some((t=>c.codecRootCompatibleWithCodec(t,e)))));return f||h&&o}function ye(e){B=e}function _e(){return B}return I={initialize:function(){n.on(m.BUFFERING_COMPLETED,ce,I),n.on(m.DATA_UPDATE_COMPLETED,de,I),n.on(m.INBAND_EVENTS,fe,I),A&&(n.on(m.KEY_ERROR,re,I),n.on(m.SERVER_CERTIFICATE_UPDATED,re,I),n.on(m.LICENSE_REQUEST_COMPLETE,re,I),n.on(m.KEY_SYSTEM_SELECTED,re,I),n.on(m.KEY_SESSION_CREATED,re,I),n.on(m.KEY_STATUSES_CHANGED,re,I)),n.trigger(m.STREAM_UPDATED,{streamInfo:j})},getStreamId:function(){return j?j.id:null},activate:function(e,t){if(!N){let r;return n.on(m.CURRENT_TRACK_CHANGED,ae,I),_e()?(function(){if(F=!0,ne(),d.filterUnsupportedFeaturesOfPeriod(j),L=!0,F=!1,0===w.length){const e="No streams to play.";f.error(new M(Q.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e,i.getValue())),D.debug(e)}else le()}(),r=t):r=function(e,t){ne();let n=R.getElement();oe(),F=!0,d.filterUnsupportedFeaturesOfPeriod(j),(!n||n&&/^VIDEO$/i.test(n.nodeName))&&se(a.VIDEO,e),se(a.AUDIO,e),se(a.TEXT,e),se(a.FRAGMENTED_TEXT,e),se(a.EMBEDDED_TEXT,e),se(a.MUXED,e),se(a.IMAGE,e);const r=ue(t);if(L=!0,F=!1,0===w.length){const e="No streams to play.";f.error(new M(Q.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e,i.getValue())),D.fatal(e)}else le();return r}(e,t),N=!0,r}return t},deactivate:z,isActive:function(){return N},getDuration:X,getStartTime:J,getId:ee,getStreamInfo:te,getHasAudioTrack:function(){return P},getHasVideoTrack:function(){return O},preload:function(e,t){if(!_e()){oe(),se(a.VIDEO,e),se(a.AUDIO,e),se(a.TEXT,e),se(a.FRAGMENTED_TEXT,e),se(a.EMBEDDED_TEXT,e),se(a.MUXED,e),se(a.IMAGE,e),ue(t),n.on(m.CURRENT_TRACK_CHANGED,ae,I);for(let e=0;e<w.length&&w[e];e++)w[e].getScheduleController().start();ye(!0)}},getThumbnailController:function(){return U},getBitrateListFor:function(e){if(ne(),e===a.IMAGE)return U?U.getBitrateList():[];const t=function(e){let t=null;for(let n=0;n<w.length;n++)if(t=w[n],t.getType()===e)return t.getMediaInfo();return null}(e);return E.getBitrateList(t)},updateData:function(e){D.info("Manifest updated... updating data system wide."),N=!1,F=!0,j=e,n.trigger(m.STREAM_UPDATED,{streamInfo:j}),T&&oe(),d.filterUnsupportedFeaturesOfPeriod(j);for(let e=0,t=w.length;e<t;e++){let t=w[e];t.updateStreamInfo(j);let n=u.getMediaInfoForType(j,t.getType());n&&(E.updateTopQualityIndex(n),t.addMediaInfo(n,!0))}if(V&&V.newMediaInfo.type!==a.FRAGMENTED_TEXT){let e=he(V.oldMediaInfo);if(!e)return;e.switchTrackAsked(),V=void 0}F=!1,le()},reset:$,getProcessors:ge,setMediaSource:function(e){for(let t=0;t<w.length;)ie(w[t].getMediaInfo())?(w[t].setMediaSource(e),t++):(w[t].reset(),w.splice(t,1));for(let e=0;e<w.length;e++)w[e].dischargePreBuffer();if(0===w.length){const e="No streams to play.";f.error(new M(Q.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e+"nostreams",i.getValue())),D.fatal(e)}},isMediaCodecCompatible:function(e,t=null){return Ee(e,a.VIDEO,t)&&Ee(e,a.AUDIO,t)},isProtectionCompatible:function(e,t=null){return pe(e,a.VIDEO,t)&&pe(e,a.AUDIO,t)},getPreloaded:_e,getPreloadingScheduled:function(){return K},setPreloadingScheduled:function(e){K=e},getIsEndedEventSignaled:function(){return Y},setIsEndedEventSignaled:function(e){Y=e}},H=_(t).getInstance(),D=H.getLogger(I),W(),q=G(t).getInstance(),k=kn(t).create({streamInfo:j,mediaPlayerModel:o,dashMetrics:p,errHandler:f,settings:b,boxParser:q,dashConstants:s,urlUtils:r}),I}Gn.__dashjs_factory_name="Stream";const qn=u.getClassFactory(Gn);function Kn(){const e=this.context,t=g(e).getInstance(),n=jt(e).getInstance();let r,i,a,o,l,u,c,d,f,h,p,E;function y(){a=NaN,c=!1,l=!0,u=!1,T()}function T(){null!==o&&(clearTimeout(o),o=null)}function v(e){T(),u||(isNaN(e)&&!isNaN(a)&&(e=1e3*a),isNaN(e)||(i.debug("Refresh manifest in "+e+" milliseconds."),o=setTimeout(R,e)))}function S(e=!1){c=!0;const t=f.getValue();let r=t.url;const i=h.getPatchLocation(t),a=h.getLocation(t);i&&!e?r=i:a&&(r=a),n.isRelative(r)&&(r=n.resolve(r,t.url)),d.load(r)}function A(e){if(e){if(h.getIsPatch(e)){let t=e;e=f.getValue();let n=h.isPatchValid(e,t),r=n;if(n){let n=h.getPublishTime(e);r=h.applyPatchToManifest(e,t);let i=h.getPublishTime(e);r=n.getTime()!=i.getTime()}if(!r)return i.debug("Patch provided is invalid, performing full manifest refresh"),void S(!0);e.loadedTime=new Date}}else(e=f.getValue()).loadedTime=new Date;if(f.getValue()&&f.getValue().type===s.DYNAMIC&&e.type===s.STATIC)return t.trigger(m.DYNAMIC_TO_STATIC),c=!1,void(u=!0);f.setValue(e);const n=new Date,r=(n.getTime()-e.loadedTime.getTime())/1e3;a=h.getManifestUpdatePeriod(e,r),1e3*a>2147483647&&(a=2147483.647),t.trigger(m.MANIFEST_UPDATED,{manifest:e}),i.info("Manifest has been refreshed at "+n+"["+n.getTime()/1e3+"] "),l||v()}function R(){l||(c?v(E.get().streaming.manifestUpdateRetryInterval):S())}function b(e){e.error?e.error.code===Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&p.error(e.error):A(e.manifest)}function I(){l=!1,v()}function D(){l=!E.get().streaming.scheduleWhilePaused,l&&T()}function w(){c=!1}return r={initialize:function(){y(),t.on(m.STREAMS_COMPOSED,w,this),t.on(m.PLAYBACK_STARTED,I,this),t.on(m.PLAYBACK_PAUSED,D,this),t.on(m.INTERNAL_MANIFEST_LOADED,b,this)},setManifest:function(e){A(e)},refreshManifest:S,setConfig:function(e){e&&(e.manifestModel&&(f=e.manifestModel),e.adapter&&(h=e.adapter),e.manifestLoader&&(d=e.manifestLoader),e.errHandler&&(p=e.errHandler),e.settings&&(E=e.settings))},reset:function(){t.off(m.PLAYBACK_STARTED,I,this),t.off(m.PLAYBACK_PAUSED,D,this),t.off(m.STREAMS_COMPOSED,w,this),t.off(m.INTERNAL_MANIFEST_LOADED,b,this),y()}},i=_(e).getInstance().getLogger(r),r}Kn.__dashjs_factory_name="ManifestUpdater";const Hn=u.getClassFactory(Kn);function Yn(){const e=this.context,t=g(e).getInstance(),n=jt(e).getInstance();let r,i,a,s,o,l,u,c,d,f,h,p,E,y,T;function v(){c=[],d=[],f=null,h=null,E=null,p=NaN,a=!1,s=!1,y=o.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function A(){a||s||!E||!E.value||!E.schemeIdUri||isNaN(p)||isNaN(o.get().streaming.utcSynchronization.backgroundAttempts)||h&&(Date.now()-h)/1e3<30||(c=[],s=!0,R(isNaN(o.get().streaming.utcSynchronization.backgroundAttempts)?2:o.get().streaming.utcSynchronization.backgroundAttempts))}function R(e){try{if(e<=0)return void k();const t=Date.now();l[E.schemeIdUri](E.value,(function(n){const r=Date.now(),i=I(t,r,n);c.push(i),R(e-1)}),(function(){k()}))}catch(e){k()}}function b(e=null){let t=e||0;if(!d||0===d.length||t>=d.length)return void D();let n=d[t];if(n)if(l.hasOwnProperty(n.schemeIdUri)){const e=(new Date).getTime();l[n.schemeIdUri](n.value,(function(t){const r=(new Date).getTime(),i=I(e,r,t);E=n,D(i)}),(function(){b(t+1)}))}else b(t+1);else D()}function I(e,t,n){return n-(t-(t-e)/2)}function D(e=NaN){let t=isNaN(e);t&&o.get().streaming.useManifestDateHeaderTimeSource?function(){let e=u.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?F(!0):F(!1,t-Date.now())}():F(t,e)}function w(e){let t=Date.parse(e);return isNaN(t)&&(t=function(e){let t,n,r=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&(parseInt(r[6],10)||0),r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]&&(n=60*parseInt(r[9],10)+parseInt(r[10],10),t+=("+"===r[8]?-1:1)*n*60*1e3),new Date(t).getTime()}(e)),t}function C(e){return Date.parse(e)}function N(e){return Date.parse(e)}function L(e,t,n){n()}function O(e,t,n){let r=w(e);isNaN(r)?n():t(r)}function P(e,t,r,i,a){let s,o,l=!1,u=new XMLHttpRequest,c=a?S.HEAD:S.GET,d=t.match(/\S+/g);if(t=d.shift(),s=function(){l||(l=!0,d.length?P(e,d.join(" "),r,i,a):i())},o=function(){let t,n;200===u.status&&(t=a?u.getResponseHeader("Date"):u.response,n=e(t),isNaN(n)||(r(n),l=!0))},n.isRelative(t)){const e=T.resolve();e&&(t=n.resolve(t,e.url))}u.open(c,t),u.timeout=5e3,u.onload=o,u.onloadend=s,u.send()}function x(e,t,n){P(N,e,t,n,!0)}function F(e,n){if(isNaN(p)||isNaN(n)||e||function(e){try{const t=U(e),n=isNaN(y)?30:y,r=isNaN(o.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:o.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,a=isNaN(o.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:o.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,s=isNaN(o.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:o.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;let l;t?(l=Math.min(n*r,a),i.debug(`Increasing timeBetweenSyncAttempts to ${l}`)):(l=Math.max(n/r,s),i.debug(`Decreasing timeBetweenSyncAttempts to ${l}`)),y=l}catch(e){}}(n),!e&&!isNaN(n)){f=Date.now(),a=!1;const e=isNaN(p);p=n,e&&A(),i.debug(`Completed UTC sync. Setting client - server offset to ${n}`)}e&&(E=null),t.trigger(m.UPDATE_TIME_SYNC_OFFSET,{offset:n,error:e?new M(Q.TIME_SYNC_FAILED_ERROR_CODE,Q.TIME_SYNC_FAILED_ERROR_MESSAGE):null}),t.trigger(m.TIME_SYNCHRONIZATION_COMPLETED)}function k(){if(!c||0===c.length)return;const e=c.reduce(((e,t)=>e+t),0)/c.length;U(e)?i.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(i.debug(`Completed background UTC sync. Setting client - server offset to ${e}`),p=e,t.trigger(m.UPDATE_TIME_SYNC_OFFSET,{offset:p})),s=!1,h=Date.now()}function U(e){try{if(isNaN(p))return!0;const t=o.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(o.get().streaming.utcSynchronization.maximumAllowedDrift)?o.get().streaming.utcSynchronization.maximumAllowedDrift:100,n=p+t;return e>=p-t&&e<=n}catch(e){return!0}}return r={initialize:function(){v(),l={"urn:mpeg:dash:utc:http-head:2014":x,"urn:mpeg:dash:utc:http-xsdate:2014":P.bind(null,w),"urn:mpeg:dash:utc:http-iso:2014":P.bind(null,C),"urn:mpeg:dash:utc:direct:2014":O,"urn:mpeg:dash:utc:http-head:2012":x,"urn:mpeg:dash:utc:http-xsdate:2012":P.bind(null,w),"urn:mpeg:dash:utc:http-iso:2012":P.bind(null,C),"urn:mpeg:dash:utc:direct:2012":O,"urn:mpeg:dash:utc:http-ntp:2014":L,"urn:mpeg:dash:utc:ntp:2014":L,"urn:mpeg:dash:utc:sntp:2014":L}},attemptSync:function(e){d=e,a||(function(){try{const e=isNaN(y)?30:y;return!(f&&e&&!isNaN(e))||(Date.now()-f)/1e3>=e}catch(e){return!0}}()?(a=!0,b()):t.trigger(m.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(e){e&&(e.dashMetrics&&(u=e.dashMetrics),e.baseURLController&&(T=e.baseURLController),e.settings&&(o=e.settings))},reset:function(){v(),t.off(m.ATTEMPT_BACKGROUND_SYNC,A,r)}},i=_(e).getInstance().getLogger(r),t.on(m.ATTEMPT_BACKGROUND_SYNC,A,r),r}Yn.__dashjs_factory_name="TimeSyncController";const Vn=u.getSingletonFactory(Yn);Vn.HTTP_TIMEOUT_MS=5e3,u.updateSingletonFactory(Yn.__dashjs_factory_name,Vn);const jn=Vn;function zn(){let e,t;const n=this.context;return e={createMediaSource:function(){let e="WebKitMediaSource"in window;return"MediaSource"in window?new MediaSource:e?new WebKitMediaSource:null},attachMediaSource:function(e,t){let n=window.URL.createObjectURL(e);return t.setSource(n),n},detachMediaSource:function(e){e.setSource(null)},setDuration:function e(n,r){n&&"open"===n.readyState&&(null===r&&isNaN(r)||n.duration!==r&&(function(e){let t=e.sourceBuffers;for(let e=0;e<t.length;e++)if(t[e].updating)return!0;return!1}(n)?setTimeout(e.bind(null,n,r),50):(t.info("Set MediaSource duration:"+r),n.duration=r)))},setSeekable:function(e,t,n){e&&"function"==typeof e.setLiveSeekableRange&&"function"==typeof e.clearLiveSeekableRange&&"open"===e.readyState&&t>=0&&t<n&&(e.clearLiveSeekableRange(),e.setLiveSeekableRange(t,n))},signalEndOfStream:function(e){if(!e||"open"!==e.readyState)return;let n=e.sourceBuffers;for(let e=0;e<n.length;e++){if(n[e].updating)return;if(0===n[e].buffered.length)return}t.info("call to mediaSource endOfStream"),e.endOfStream()}},t=_(n).getInstance().getLogger(e),e}zn.__dashjs_factory_name="MediaSourceController";const Wn=u.getSingletonFactory(zn);function $n(){const e="urn:mpeg:dash:event:2012",t="updated",n="added",r=this.context,i=g(r).getInstance();let a,s,o,l,u,c,f,h,p,m,E;function y(){if(!f||!h)throw new Error("setConfig function has to be called previously")}function T(){E=!1,o={},l={},u=null,m=!1,c=Date.now()/1e3}function v(e,r,i=!1){const a=e.eventStream.schemeIdUri,s=e.eventStream.value,o=e.id;let l="discarded";r[a]||(r[a]=[]);const u=r[a].findIndex((e=>(!s||e.eventStream.value&&e.eventStream.value===s)&&e.id===o));return-1===u?(r[a].push(e),l=n):i&&(r[a][u]=e,l=t),l}function S(e){try{if(1==e.eventStream.value){const t=e.calculatedPresentationTime;let n;n=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,i.trigger(d.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:t,newDuration:n,newManifestValidAfter:NaN},{mode:d.EVENT_MODE_ON_START})}}catch(e){}}function A(){try{if(!m){m=!0;const e=h.getTime();let t=e-c;t=c>0?Math.max(0,t):0,R(l,t,e),R(o,t,e),c=e,m=!1}}catch(e){m=!1}}function R(e,t,n){try{const r=function(r){if(void 0!==r){const i=isNaN(r.duration)?0:r.duration;r.calculatedPresentationTime<=n&&r.calculatedPresentationTime+t+i>=n?D(r,e,d.EVENT_MODE_ON_START):(function(e,t,n){try{return e-t>n}catch(e){return!1}}(n,i+t,r.calculatedPresentationTime)||function(e){try{const t=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>t}catch(e){return!1}}(r))&&(s.debug(`Deleting event ${r.id} as it is expired or invalid`),w(e,r))}};I(e,r)}catch(e){}}function b(e){try{const t=h.getTime();I(e,function(n){const r=n.eventStream&&n.eventStream.period&&!isNaN(n.eventStream.period.duration)?n.eventStream.period.duration:NaN,i=n.eventStream&&n.eventStream.period&&!isNaN(n.eventStream.period.start)?n.eventStream.period.start:NaN;if(isNaN(r)||isNaN(i))return;const a=n.calculatedPresentationTime;Math.abs(a-t)<300&&D(n,e,d.EVENT_MODE_ON_START)}())}catch(e){}}function I(e,t){try{if(e){const n=Object.keys(e);for(let r=0;r<n.length;r++)e[n[r]].forEach((e=>{void 0!==e&&t(e)}))}}catch(e){}}function D(t,n,a){try{const o=h.getTime(),l=t.id;if(a===d.EVENT_MODE_ON_RECEIVE)return s.debug(`Received event ${l}`),void i.trigger(t.eventStream.schemeIdUri,{event:t},{mode:a});t.eventStream.schemeIdUri===e&&1===t.eventStream.value?0===t.duration&&0===t.presentationTimeDelta||(s.debug(`Starting manifest refresh event ${l} at ${o}`),w(n,t),function(){try{y(),f.refreshManifest()}catch(e){}}()):"urn:mpeg:dash:event:callback:2015"===t.eventStream.schemeIdUri&&1===t.eventStream.value?(s.debug(`Starting callback event ${l} at ${o}`),w(n,t),function(e){try{Jt(r).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){throw e}}(t.messageData)):(s.debug(`Starting event ${l} at ${o}`),w(n,t),i.trigger(t.eventStream.schemeIdUri,{event:t},{mode:a}))}catch(e){}}function w(e,t){const n=t.eventStream.schemeIdUri,r=t.eventStream.value,i=t.id;e[n]=e[n].filter((e=>r&&e.eventStream.value&&e.eventStream.value!==r||e.id!==i)),0===e[n].length&&delete e[n]}return a={addInlineEvents:function(e){try{if(y(),e)for(let r=0;r<e.length;r++){let i=e[r],a=v(i,o,!0);a===n?(s.debug(`Added inline event with id ${i.id}`),D(i,e,d.EVENT_MODE_ON_RECEIVE)):a===t&&s.debug(`Updated inline event with id ${i.id}`)}s.debug(`Added ${e.length} inline events`)}catch(e){throw e}},addInbandEvents:function(t){try{y();for(let r=0;r<t.length;r++){let i=t[r];v(i,l,!1)===n?(i.eventStream.schemeIdUri===e&&void 0===l[i.id]&&S(i),s.debug("Added inband event with id "+i.id),D(i,t,d.EVENT_MODE_ON_RECEIVE)):s.debug(`Inband event with scheme_id_uri ${i.eventStream.schemeIdUri}, value ${i.eventStream.value} and id ${i.id} was ignored because it has been added before.`)}A()}catch(e){throw e}},getInbandEvents:function(){return l},getInlineEvents:function(){return o},start:function(){try{y(),s.debug("Start Event Controller");const e=p.get().streaming.eventControllerRefreshDelay;E||isNaN(e)||(E=!0,u=setInterval(A,e))}catch(e){throw e}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(f=e.manifestUpdater),e.playbackController&&(h=e.playbackController),e.settings&&(p=e.settings)}catch(e){throw e}},reset:function(){(function(){try{null!==u&&E&&(clearInterval(u),u=null,E=!1,function(){try{b(l),b(o)}catch(e){}}())}catch(e){throw e}})(),T()}},s=_(r).getInstance().getLogger(a),T(),a}$n.__dashjs_factory_name="EventController";const Xn=u.getSingletonFactory($n);function Qn(){const e=this.context,t=g(e).getInstance();let n,r,i,s,l,u,c,f,h,p,E,y,T,v,S,A,R,b,I,D,w,C,N,L,O,P,x,F,k,U,B,G,q,K,H,Y,V,j,z,W,$,X;function J(){if(ve()){const e=U.getPlaybackQuality();e&&h.addDroppedFrames(e)}}function Z(e){const t=ue(e.seekTime);t===C&&z&&z.length>0&&z.forEach((e=>{e.deactivate(!0)})),t&&t!==C?(Ae(Wt.END_OF_PERIOD_STOP_REASON),he(t,C,e.seekTime)):Ae(Wt.USER_REQUEST_STOP_REASON),Re(zt.SEEK_START_REASON)}function ee(e){const t=fe();Ae(Wt.END_OF_PERIOD_STOP_REASON),he(t,C,e.seekTime),Re(zt.SEEK_START_REASON)}function te(){r.debug("[onPlaybackStarted]"),K?(K=!1,Re(zt.INITIAL_PLAYOUT_START_REASON)):q&&(q=!1,Re(zt.RESUME_FROM_PAUSE_START_REASON))}function re(e){r.debug("[onPlaybackPaused]"),e.ended||(q=!0,Ae(Wt.USER_REQUEST_STOP_REASON))}function ie(){Y&&(clearInterval(Y),Y=null)}function ae(e){try{if(!e)return!1;const t=e.getProcessors().filter((e=>e.getType()===a.AUDIO||e.getType()===a.VIDEO));if(!t||0===t.length)return!1;const n=t.filter((e=>!e.isBufferingCompleted()));return n&&0===n.length}catch(e){return!1}}function se(){const e=Ie().isLast;k&&e&&(r.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),p.signalEndOfStream(k))}function oe(e,t){try{return $.get().streaming.reuseExistingSourceBuffers&&t.isProtectionCompatible(e,t)&&(W||t.isMediaCodecCompatible(e,t))&&!function(e){try{const t=e.getStreamInfo(),n=f.getAdaptationForType(t.index,a.FRAGMENTED_TEXT,t);return!!n&&(-1!==n.codecs.indexOf("stpp")||-1!==n.codecs.indexOf("wvtt"))}catch(e){return!1}}(e)}catch(e){return!1}}function le(e,t=null){k&&!e.getPreloaded()&&oe(e,t)&&(e.setPreloadingScheduled(!0),r.info(`[onStreamCanLoadNext] Preloading next stream with id ${e.getId()}`),H=!0,e.preload(k,j),z.push(e),e.getProcessors().forEach((t=>{t.setBufferingTime(e.getStartTime())})))}function ue(e){if(isNaN(e))return null;let t=0,n=null;const r=w.length;r>0&&(t+=w[0].getStartTime());for(let i=0;i<r;i++)if(n=w[i],t=parseFloat((t+n.getDuration()).toFixed(5)),e<t)return n;return null}function ce(){return C?C.getProcessors():[]}function de(e){if(!C.getIsEndedEventSignaled()){C.setIsEndedEventSignaled(!0);const e=fe();e?(r.debug(`StreamController onEnded, found next stream with id ${e.getStreamInfo().id}`),he(e,C,NaN)):(r.debug("StreamController no next stream found"),C.setIsEndedEventSignaled(!1)),Ae(e?Wt.END_OF_PERIOD_STOP_REASON:Wt.END_OF_CONTENT_STOP_REASON),H=!1}e&&e.isLast&&ie()}function fe(e=null){const t=e||C||null;if(t){const e=t.getStreamInfo().start,n=t.getStreamInfo().duration,r=parseFloat((e+n).toFixed(5));let i=0,a=-1,s=NaN;for(;i<w.length;){const e=w[i].getStreamInfo().start-r;e>=0&&(isNaN(s)||e<s)&&(s=e,a=i),i+=1}return a>=0?w[a]:null}return null}function he(e,n,i){if(P||!e||n===e&&e.isActive())return;P=!0,t.trigger(m.PERIOD_SWITCH_STARTED,{fromStreamInfo:n?n.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});let a=!1;n&&(a=oe(e,n),n.deactivate(a)),i=isNaN(i)?!a&&n?e.getStreamInfo().start:NaN:i,r.info(`Switch to stream ${e.getId()}. Seektime is ${i}, current playback time is ${B.getTime()}`),r.info(`Seamless period switch is set to ${a}`),C=e,z=z.filter((e=>e.getId()!==C.getId())),B.initialize(Ie(),!!n,i),U.getElement()?ge(i,null===n,!1,a):pe(i,a),H=!1}function ge(e,n,i,a){let s;function o(){k&&"open"===k.readyState&&(r.debug("MediaSource is open!"),window.URL.revokeObjectURL(s),k.removeEventListener("sourceopen",o),k.removeEventListener("webkitsourceopen",o),me(),n||t.trigger(m.SOURCE_INITIALIZED),i?C.setMediaSource(k):pe(e,a))}k?a?(pe(e,a),n||t.trigger(m.SOURCE_INITIALIZED)):(p.detachMediaSource(U),k.addEventListener("sourceopen",o,!1),k.addEventListener("webkitsourceopen",o,!1),s=p.attachMediaSource(k,U),r.debug("MediaSource attached to element.  Waiting on open...")):(k=p.createMediaSource(),k.addEventListener("sourceopen",o,!1),k.addEventListener("webkitsourceopen",o,!1),s=p.attachMediaSource(k,U),r.debug("MediaSource attached to element.  Waiting on open..."))}function pe(e,n){if(j=C.activate(k,n?j:void 0),j){const e=Object.keys(j);e.length>0&&j[e[0]].changeType&&(W=!0)}K||isNaN(e)||(e===B.getTime()?t.trigger(m.SEEK_TARGET,{time:e},{streamId:C.getId()}):B.seek(e)),!O&&K||B.play(),P=!1,t.trigger(m.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Ie()})}function me(e){const t=e||Ie().manifestInfo.duration;p.setDuration(k,t)}function Ee(e){for(let t=0,n=w.length;t<n;t++)if(w[t].getId()===e.id)return w[t];return null}function ye(){try{const n=f.getStreamsInfo();if(0===n.length)throw new Error("There are no streams");h.updateManifestUpdateInfo({currentTime:B.getTime(),buffered:U.getBufferRange(),presentationStartTime:n[0].start,clientTimeOffset:D.getClientTimeOffset()}),w.length>0&&(w=w.filter((e=>{const t=n.filter((t=>t.id===e.getId())).length>0||e.getId()===C.getId();return t||r.debug(`Removing stream ${e.getId()}`),t})));for(let t=0,r=n.length;t<r;t++){const r=n[t];let a=Ee(r);a?a.updateData(r):(a=qn(e).create({manifestModel:c,mediaPlayerModel:G,dashMetrics:h,manifestUpdater:l,adapter:f,timelineConverter:D,capabilities:i,capabilitiesFilter:s,errHandler:I,baseURLController:y,abrController:T,playbackController:B,eventController:S,mediaController:v,textController:A,protectionController:N,videoModel:U,streamInfo:r,settings:$}),w.push(a),a.initialize()),h.addManifestUpdateStreamInfo(r)}if(!C){if(f.getIsDynamic()&&w.length){const e=n[0].manifestInfo,t=function(e,t){try{let n=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){const t=e[0],r=[a.VIDEO,a.AUDIO,a.FRAGMENTED_TEXT].reduce(((e,n)=>{const r=f.getMediaInfoForType(t,n);return r&&e.push(r),e}),[]).reduce(((e,t)=>{const n=f.getVoRepresentations(t);return n&&n.length>0&&n.forEach((t=>{t&&e.push(t)})),e}),[]).reduce(((e,t)=>{const n=f.convertDataToRepresentationInfo(t);return n&&n.fragmentDuration&&!isNaN(n.fragmentDuration)&&e.push(n.fragmentDuration),e}),[]);n=Math.max(...r)}return isFinite(n)?n:NaN}catch(e){return NaN}}(n,e);B.computeAndSetLiveDelay(t,e.DVRWindowSize,e.minBufferTime)}let e=null;e=ue(B.getStartTimeFromUriParameters(f.getIsDynamic())),!e&&f.getIsDynamic()&&w.length&&(r.debug("Dynamic stream: Trying to find the correct starting period"),e=function(){try{const e=D.calcPresentationTimeFromWallTime(new Date,f.getRegularPeriods()[0]);return ue(e-B.getLiveDelay())}catch(e){return null}}()),he(null!==e?e:w[0],null,NaN),Y||(Y=setInterval((function(){!P&&B.getTimeToStreamEnd()<=0&&t.trigger(m.PLAYBACK_ENDED,{isLast:Ie().isLast})}),200)),V||(V=setInterval((function(){!function(){if(!C||!ae(C))return;const e=function(e){try{const t=e||C||null;if(t){const e=t.getStreamInfo().start;return w.filter((function(t){return t.getStreamInfo().start>e}))}}catch(e){return[]}}(C);let t=0;for(;t<e.length;){const n=e[t],r=0===t?C:e[t-1];if(!n.getPreloadingScheduled()&&ae(r)&&k){const e=[a.VIDEO,a.AUDIO];let t=!0;e.forEach((e=>{const r=f.getMediaInfoForType(n.getStreamInfo(),e);f.getVoRepresentations(r).forEach((e=>{const n=f.getIsDynamic(),r=D.calcSegmentAvailabilityRange(e,n);r.end<r.start&&(t=!1)}))})),t&&le(n,r)}t+=1}}()}),500))}t.trigger(m.STREAMS_COMPOSED)}catch(e){I.error(new M(Q.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+"nostreamscomposed",c.getValue())),F=!0,Ne()}}function _e(){const e=c.getValue();N&&(t.trigger(m.PROTECTION_CREATED,{controller:N,manifest:e}),N.setMediaElement(U.getElement()),L&&N.setProtectionData(L)),ye()}function Te(e){if(e.error)F=!0,Ne();else{const n=e.manifest;f.updatePeriods(n);let i=f.getUTCTimingSources();!f.getIsDynamic()||i&&0!==i.length||t.trigger(d.CONFORMANCE_VIOLATION,{level:ne.LEVELS.WARNING,event:ne.EVENTS.NO_UTC_TIMING_ELEMENT});let a=f.getIsDynamic()?i.concat(G.getUTCTimingSources()):i;const s=b.isHTTPS(e.manifest.url);a.forEach((function(e){e.value.replace(/.*?:\/\//g,"")===G.getDefaultUtcTimingSource().value.replace(/.*?:\/\//g,"")&&(e.value=e.value.replace(s?new RegExp(/^(http:)?\/\//i):new RegExp(/^(https:)?\/\//i),s?"https://":"http://"),r.debug("Matching default timing source protocol to manifest protocol: ",e.value))})),y.initialize(n),E.attemptSync(a)}}function ve(){return!!C&&C.getHasVideoTrack()}function Se(){return!!C&&C.getHasAudioTrack()}function Ae(e,t){t=t||new Date,ce().forEach((n=>{n.finalisePlayList(t,e)})),h.addPlayList()}function Re(e){h.createPlaylistMetrics(1e3*B.getTime(),e)}function be(e){if(!e.error)return;let t="";switch(e.error.code){case 1:t="MEDIA_ERR_ABORTED";break;case 2:t="MEDIA_ERR_NETWORK";break;case 3:t="MEDIA_ERR_DECODE";break;case 4:t="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:t="MEDIA_ERR_ENCRYPTED";break;default:t="UNKNOWN"}x=!0,e.error.message&&(t+=" ("+e.error.message+")"),e.error.msExtendedCode&&(t+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),r.fatal("Video Element Error: "+t),e.error&&r.fatal(e.error),I.error(new M(e.error.code,t)),Ne()}function Ie(){return C?C.getStreamInfo():null}function De(){if(!(u&&u.hasOwnProperty("load")&&D&&D.hasOwnProperty("initialize")&&D.hasOwnProperty("reset")&&D.hasOwnProperty("getClientTimeOffset")&&c&&I&&h&&B))throw new Error(a.MISSING_CONFIG_ERROR)}function we(e){isNaN(e.newDuration)||me(e.newDuration)}function Ce(){w=[],N=null,P=!1,C=null,x=!1,F=!1,K=!0,q=!1,O=!0,Y=null,H=!1,V=null,X=!1,z=[]}function Ne(){De(),E.reset(),Ae(x||F?Wt.FAILURE_STOP_REASON:Wt.USER_REQUEST_STOP_REASON);for(let e=0,t=w?w.length:0;e<t;e++)w[e].reset(x);t.off(m.PLAYBACK_TIME_UPDATED,J,n),t.off(m.PLAYBACK_SEEKING,Z,n),t.off(m.GAP_CAUSED_SEEK_TO_PERIOD_END,ee,n),t.off(m.PLAYBACK_ERROR,be,n),t.off(m.PLAYBACK_STARTED,te,n),t.off(m.PLAYBACK_PAUSED,re,n),t.off(m.PLAYBACK_ENDED,de,n),t.off(m.MANIFEST_UPDATED,Te,n),t.off(m.STREAM_BUFFERING_COMPLETED,se,n),t.off(m.MANIFEST_VALIDITY_CHANGED,we,n),t.off(m.TIME_SYNCHRONIZATION_COMPLETED,_e,n),t.off(d.METRIC_ADDED,Le,n),y.reset(),l.reset(),S.reset(),h.clearAllCurrentMetrics(),c.setValue(null),u.reset(),D.reset(),R.reset(),k&&(p.detachMediaSource(U),k=null),U=null,N&&(N.setMediaElement(null),N=null,L=null,c.getValue()&&t.trigger(m.PROTECTION_DESTROYED,{data:c.getValue().url})),ie(),clearInterval(V),V=null,t.trigger(m.STREAM_TEARDOWN_COMPLETE),Ce()}function Le(e){if(e.metric===o.DVR_INFO){const t=Se()?a.AUDIO:a.VIDEO;e.mediaType===t&&p.setSeekable(k,e.value.range.start,e.value.range.end)}}return n={initialize:function(r,i){De(),O=r,L=i,D.initialize(),l=Hn(e).create(),l.setConfig({manifestModel:c,adapter:f,manifestLoader:u,errHandler:I,settings:$}),l.initialize(),S=Xn(e).getInstance(),S.setConfig({manifestUpdater:l,playbackController:B,settings:$}),S.start(),E.setConfig({dashMetrics:h,baseURLController:y,settings:$}),E.initialize(),t.on(m.PLAYBACK_TIME_UPDATED,J,n),t.on(m.PLAYBACK_SEEKING,Z,n),t.on(m.GAP_CAUSED_SEEK_TO_PERIOD_END,ee,n),t.on(m.PLAYBACK_ERROR,be,n),t.on(m.PLAYBACK_STARTED,te,n),t.on(m.PLAYBACK_PAUSED,re,n),t.on(m.PLAYBACK_ENDED,de,n,{priority:g.EVENT_PRIORITY_HIGH}),t.on(m.MANIFEST_UPDATED,Te,n),t.on(m.STREAM_BUFFERING_COMPLETED,se,n),t.on(m.MANIFEST_VALIDITY_CHANGED,we,n),t.on(m.TIME_SYNCHRONIZATION_COMPLETED,_e,n),t.on(d.METRIC_ADDED,Le,n)},getActiveStreamInfo:Ie,hasVideoTrack:ve,hasAudioTrack:Se,switchToVideoElement:function(e){C&&(B.initialize(Ie()),ge(e,!1,!0,!1))},getStreamById:function(e){return w.filter((function(t){return t.getId()===e}))[0]},getStreamForTime:ue,getTimeRelativeToStreamId:function(e,t){let n=null,r=0,i=0,a=null;for(let s=0;s<w.length;s++){if(n=w[s],i=n.getStartTime(),a=n.getDuration(),Number.isFinite(i)&&(r=i),n.getId()===t)return e-r;Number.isFinite(a)&&(r+=a)}return null},load:function(e){De(),u.load(e)},loadWithManifest:function(e){!function(){if(!l||!l.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}(),l.setManifest(e)},getActiveStreamProcessors:ce,setConfig:function(e){e&&(e.capabilities&&(i=e.capabilities),e.capabilitiesFilter&&(s=e.capabilitiesFilter),e.manifestLoader&&(u=e.manifestLoader),e.manifestModel&&(c=e.manifestModel),e.mediaPlayerModel&&(G=e.mediaPlayerModel),e.protectionController&&(N=e.protectionController),e.adapter&&(f=e.adapter),e.dashMetrics&&(h=e.dashMetrics),e.errHandler&&(I=e.errHandler),e.timelineConverter&&(D=e.timelineConverter),e.videoModel&&(U=e.videoModel),e.playbackController&&(B=e.playbackController),e.abrController&&(T=e.abrController),e.mediaController&&(v=e.mediaController),e.textController&&(A=e.textController),e.settings&&($=e.settings),e.baseURLController&&(y=e.baseURLController))},setProtectionData:function(e){L=e},getIsStreamSwitchInProgress:function(){return P},getHasMediaOrIntialisationError:function(){return x||F},hasStreamFinishedBuffering:ae,getStreams:function(){return w},getActiveStream:function(){return C},reset:Ne},r=_(e).getInstance().getLogger(n),E=jn(e).getInstance(),p=Wn(e).getInstance(),R=nt(e).getInstance(),b=jt(e).getInstance(),Ce(),n}Qn.__dashjs_factory_name="StreamController";const Jn=u.getSingletonFactory(Qn);function Zn(){const e=this.context,t=g(e).getInstance();let n,r,i,a,s,o,l,u,c,d,f,h,p;function E(){p.debug("Stopping the gap controller"),s&&(clearInterval(s),s=null),function(){t.off(m.WALLCLOCK_TIME_UPDATED,v,this),t.off(m.PLAYBACK_SEEKING,T,this),t.off(m.BYTES_APPENDED_END_FRAGMENT,y,n)}(),s=null,o=NaN,a=0,h=null}function y(){s||function(){try{s||(p.debug("Starting the gap controller"),s=setInterval((()=>{S()&&A(l.getTime())}),100))}catch(e){}}()}function T(){h&&(clearTimeout(h),h=null)}function v(){if(S()&&(a++,a>=30)){const e=l.getTime();r===e?A(e,!0):(r=e,o=NaN),a=0}}function S(){return i.get().streaming.jumpGaps&&u.getActiveStreamProcessors().length>0&&(!l.isSeeking()||u.hasStreamFinishedBuffering(u.getActiveStream()))&&!l.isPaused()&&!u.getIsStreamSwitchInProgress()&&!u.getHasMediaOrIntialisationError()}function A(e,n=!1){const r=i.get().streaming.smallGapLimit,a=i.get().streaming.jumpLargeGaps,s=c.getBufferRange();let u,d=NaN,f=!1;if(u=function(e,t){try{if(!e||e.length<=1&&t>0)return NaN;let n=NaN,r=0;for(;isNaN(n)&&r<e.length;){const i=r>0?e.end(r-1):0;t<e.start(r)&&i-t<.1&&(n=r),r+=1}return n}catch(e){return null}}(s,e),!isNaN(u)){const t=s.start(u),n=t-e;n>0&&(n<=r||a)&&(d=t)}const g=l.getTimeToStreamEnd();if(isNaN(d)&&n&&isFinite(g)&&!isNaN(g)&&g<r&&(d=parseFloat(l.getStreamEndTime().toFixed(5)),f=!0),d>0&&o!==d&&d>e&&!h){const n=d-e;if(f)p.warn(`Jumping to end of stream because of gap from ${e} to ${d}. Gap duration: ${n}`),t.trigger(m.GAP_CAUSED_SEEK_TO_PERIOD_END,{seekTime:d,duration:n});else{const r=l.getIsDynamic(),i=u>0?s.end(u-1):e,a=r?1e3*n:0;h=window.setTimeout((()=>{l.seek(d,!0,!0),p.warn(`Jumping gap starting at ${i} and ending at ${d}. Jumping by: ${n}`),t.trigger(m.GAP_CAUSED_INTERNAL_SEEK,{seekTime:d,duration:n}),h=null}),a)}o=d}}return n={reset:E,setConfig:function(e){e&&(e.settings&&(i=e.settings),e.playbackController&&(l=e.playbackController),e.streamController&&(u=e.streamController),e.videoModel&&(c=e.videoModel),e.timelineConverter&&(d=e.timelineConverter),e.adapter&&(f=e.adapter))},initialize:function(){!function(){t.on(m.WALLCLOCK_TIME_UPDATED,v,this),t.on(m.PLAYBACK_SEEKING,T,this),t.on(m.BYTES_APPENDED_END_FRAGMENT,y,n)}()}},p=_(e).getInstance().getLogger(n),E(),n}Zn.__dashjs_factory_name="GapController";const er=u.getSingletonFactory(Zn);function tr(){const e=this.context,t=g(e).getInstance();let n,r,i,s,o,l;const u=[a.TRACK_SWITCH_MODE_ALWAYS_REPLACE,a.TRACK_SWITCH_MODE_NEVER_REPLACE],c=[a.TRACK_SELECTION_MODE_HIGHEST_BITRATE,a.TRACK_SELECTION_MODE_FIRST_TRACK,a.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY,a.TRACK_SELECTION_MODE_WIDEST_RANGE];function d(e,t){if(!e||!t)return[];const n=t.id;return i[n]&&i[n][e]?i[n][e].list:[]}function f(e,t){return!e||!t||t&&!i[t.id]?null:i[t.id][e].current}function h(e,n){if(!e||!e.streamInfo)return;const r=e.type,s=e.streamInfo,o=s.id,u=f(r,s);if(i[o]&&i[o][r]&&!S(e,u)&&(i[o][r].current=e,!i[o][r].current||n&&r===a.FRAGMENTED_TEXT||t.trigger(m.CURRENT_TRACK_CHANGED,{oldMediaInfo:u,newMediaInfo:e,switchMode:y(r)}),!n)){let t=function(e){const t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}(e);if(!t||!i[o][r].storeLastSettings)return;t.roles&&(t.role=t.roles[0],delete t.roles),t.accessibility&&(t.accessibility=t.accessibility[0]),t.audioChannelConfiguration&&(t.audioChannelConfiguration=t.audioChannelConfiguration[0]),l.setSavedMediaSettings(r,t)}}function p(e,t){e&&t&&(o[e]=t)}function E(e){return e?o[e]:null}function y(e){return s.get().streaming.trackSwitchMode[e]}function T(){return s.get().streaming.selectionModeForInitialTrack}function v(e){return e===a.AUDIO||e===a.VIDEO||e===a.TEXT||e===a.FRAGMENTED_TEXT||e===a.IMAGE}function S(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const n=e.id===t.id,r=e.viewpoint===t.viewpoint,i=e.lang===t.lang,a=e.roles.toString()===t.roles.toString(),s=e.accessibility.toString()===t.accessibility.toString(),o=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&i&&a&&s&&o}function A(){i={},o={audio:null,video:null,fragmentedText:null}}function R(e,t){const n=!e.lang||t.lang.match(e.lang),r=void 0===e.index||null===e.index||t.index===e.index,i=!e.viewpoint||e.viewpoint===t.viewpoint,a=!e.role||!!t.roles.filter((function(t){return t===e.role}))[0];let s=!e.accessibility||!!t.accessibility.filter((function(t){return t===e.accessibility}))[0],o=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter((function(t){return t===e.audioChannelConfiguration}))[0];return n&&r&&i&&a&&s&&o}function b(e){let t,n=0,r=[];return e.forEach((function(e){t=Math.max.apply(Math,e.bitrateList.map((function(e){return e.bandwidth}))),t>n?(n=t,r=[e]):t===n&&r.push(e)})),r}function I(e){let t,n=1/0,r=[];return e.forEach((function(e){const i=e.bitrateList.reduce((function(e,t){const n=Math.max(1,t.width*t.height);return e+t.bandwidth/n}),0);t=i/e.bitrateList.length,t<n?(n=t,r=[e]):t===n&&r.push(e)})),r}function D(e){let t,n=0,r=[];return e.forEach((function(e){t=e.representationCount,t>n?(n=t,r=[e]):t===n&&r.push(e)})),r}return n={checkInitialMediaSettingsForType:function(e,t){let n=E(e);const r=d(e,t),i=[];n||(n=l.getSavedMediaSettings(e),p(e,n)),r&&0!==r.length&&(n&&r.forEach((function(e){R(n,e)&&i.push(e)})),0===i.length?h(this.selectInitialTrack(e,r),!0):i.length>1?h(this.selectInitialTrack(e,i)):h(i[0]))},addTrack:function(e){if(!e)return;const t=e.type;if(!v(t))return;let n=e.streamInfo.id;i[n]||(i[n]={audio:{list:[],storeLastSettings:!0,current:null},video:{list:[],storeLastSettings:!0,current:null},text:{list:[],storeLastSettings:!0,current:null},fragmentedText:{list:[],storeLastSettings:!0,current:null},image:{list:[],storeLastSettings:!0,current:null}});const r=i[n][t].list;for(let t=0,n=r.length;t<n;++t)if(S(r[t],e))return;r.push(e);let a=E(t);a&&R(a,e)&&!f(t,e.streamInfo)&&h(e)},getTracksFor:d,getCurrentTrackFor:f,isCurrentTrack:function(e){if(!e)return!1;const t=e.type,n=e.streamInfo.id;return i[n]&&i[n][t]&&S(i[n][t].current,e)},setTrack:h,setInitialSettings:p,getInitialSettings:E,setSwitchMode:function(e,t){if(r.warn("deprecated: Please use updateSettings({streaming: { trackSwitchMode: mode } }) instead"),-1===u.indexOf(t))return void r.warn("Track switch mode is not supported: "+t);let n={};n[e]=t,s.update({streaming:{trackSwitchMode:n}})},getSwitchMode:y,selectInitialTrack:function(e,t){if(e===a.FRAGMENTED_TEXT)return t[0];let n=T(),i=[];switch(n){case a.TRACK_SELECTION_MODE_HIGHEST_BITRATE:i=b(t),i.length>1&&(i=D(i));break;case a.TRACK_SELECTION_MODE_FIRST_TRACK:i.push(t[0]);break;case a.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:i=I(t),i.length>1&&(i=b(i));break;case a.TRACK_SELECTION_MODE_WIDEST_RANGE:i=D(t),i.length>1&&(i=b(t));break;default:r.warn("Track selection mode is not supported: "+n)}return i[0]},getTracksWithHighestBitrate:b,getTracksWithHighestEfficiency:I,getTracksWithWidestRange:D,setSelectionModeForInitialTrack:function(e){r.warn("deprecated: Please use updateSettings({streaming: { selectionModeForInitialTrack: mode } }) instead"),-1!==c.indexOf(e)?s.update({streaming:{selectionModeForInitialTrack:e}}):r.warn("Track selection mode is not supported: "+e)},getSelectionModeForInitialTrack:T,isMultiTrackSupportedByType:v,isTracksEqual:S,matchSettings:R,saveTextSettingsDisabled:function(){l.setSavedMediaSettings(a.FRAGMENTED_TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(l=e.domStorage),e.settings&&(s=e.settings))},reset:A},r=_(e).getInstance().getLogger(n),A(),n}tr.__dashjs_factory_name="MediaController";const nr=u.getSingletonFactory(tr);u.updateSingletonFactory(tr.__dashjs_factory_name,nr);const rr=nr,ir=NaN;class ar{constructor(e,t){this.data={baseUrls:e||null,selectedIdx:t||ir},this.children=[]}}function sr(){let e,t,n;const r=this.context,i=_n(r).getInstance();function a(e,t,r){const a=n.getBaseURLsFromElement(r);e[t]?i.areEqual(a,e[t].data.baseUrls)||(e[t].data.baseUrls=a,e[t].data.selectedIdx=ir):e[t]=new ar(a)}function s(e,n){const r=n||t;e(r.data),r.children&&r.children.forEach((t=>s(e,t)))}function o(){t=new ar}return e={reset:o,update:function(e){!function(e){!function(){if(!n||!n.hasOwnProperty("getBaseURLsFromElement")||!n.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();const r=n.getBaseURLsFromElement(e);i.areEqual(r,t.data.baseUrls)||(t.data.baseUrls=r,t.data.selectedIdx=ir),e&&e.Period_asArray&&e.Period_asArray.forEach(((e,r)=>{a(t.children,r,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach(((e,i)=>{a(t.children[r].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(n.getRepresentationSortFunction()).forEach(((e,n)=>{a(t.children[r].children[i].children,n,e)}))}))}))}(e)},getForPath:function(e){let n=t;const r=[n.data];return e&&e.forEach((e=>{n=n.children[e],n&&r.push(n.data)})),r.filter((e=>e.baseUrls.length))},invalidateSelectedIndexes:function(e){s((t=>{isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=ir)}))},setConfig:function(e){e.adapter&&(n=e.adapter)}},o(),e}sr.__dashjs_factory_name="BaseURLTreeModel";const or=u.getClassFactory(sr);function lr(e){let t;e=e||{};let n=[];const r=g(this.context).getInstance(),i=e.updateEventName,a=e.addBlacklistEventName;function s(e){-1===n.indexOf(e)&&(n.push(e),r.trigger(i,{entry:e}))}return t={add:s,contains:function(e){return!!(n.length&&e&&e.length)&&-1!==n.indexOf(e)},reset:function(){n=[]}},a&&r.on(a,(function(e){s(e.entry)}),t),t}lr.__dashjs_factory_name="BlackListController";const ur=u.getClassFactory(lr);function cr(e){let t;const n=(e=e||{}).blacklistController;return t={select:function(e){return e&&function(e){let t,n,r=0,i=[],a=0;if(n=e.sort((function(e,t){let n=e.dvb_priority-t.dvb_priority;return isNaN(n)?0:n})).filter((function(e,t,n){return!t||n[0].dvb_priority&&e.dvb_priority&&n[0].dvb_priority===e.dvb_priority})),n.length)return n.length>1&&(n.forEach((e=>{r+=e.dvb_weight,i.push(r)})),t=Math.floor(Math.random()*(r-1)),i.every(((e,n)=>(a=n,!(t<e))))),n[a]}(function(e){let t=[];return e.filter((function(e){return!n.contains(e.serviceLocation)||(e.dvb_priority&&t.push(e.dvb_priority),!1)})).filter((function(e){return!t.length||!e.dvb_priority||-1===t.indexOf(e.dvb_priority)}))}(e))}},t}cr.__dashjs_factory_name="DVBSelector";const dr=u.getClassFactory(cr);function fr(e){let t;const n=(e=e||{}).blacklistController;return t={select:function(e){let t,r=0;return e&&e.some(((e,t)=>(r=t,!n.contains(e.serviceLocation))))&&(t=e[r]),t}},t}fr.__dashjs_factory_name="BasicSelector";const hr=u.getClassFactory(fr);function gr(){const e=this.context,t=g(e).getInstance();let n,r,i,a,s;function o(){r.reset()}return n={chooseSelector:function(e){q(e,"boolean"),s=e?a:i},select:function(e){if(!e)return;const n=e.baseUrls,r=e.selectedIdx;if(!isNaN(r))return n[r];let a=s.select(n);return a?(e.selectedIdx=n.indexOf(a),a):(t.trigger(m.URL_RESOLUTION_FAILED,{error:new M(Q.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,Q.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(s===i&&o()))},reset:o,setConfig:function(e){e.selector&&(s=e.selector)}},r=ur(e).create({updateEventName:m.SERVICE_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:m.SERVICE_LOCATION_BLACKLIST_ADD}),i=hr(e).create({blacklistController:r}),a=dr(e).create({blacklistController:r}),s=i,n}gr.__dashjs_factory_name="BaseURLSelector";const pr=u.getClassFactory(gr);function mr(){let e,t;const n=this.context,r=g(n).getInstance(),i=jt(n).getInstance();let a,s;return e={reset:function(){a.reset(),s.reset()},initialize:function(e){var n;a.setConfig({adapter:t}),n=e,a.update(n),s.chooseSelector(t.getIsDVB(n))},resolve:function(e){const t=a.getForPath(e).reduce(((e,t)=>{const n=s.select(t);return n?(i.isRelative(n.url)?e.url=i.resolve(n.url,e.url):(e.url=n.url,e.serviceLocation=n.serviceLocation),e.availabilityTimeOffset=n.availabilityTimeOffset,e.availabilityTimeComplete=n.availabilityTimeComplete,e):new gn}),new gn);if(!i.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(a=e.baseURLTreeModel),e.baseURLSelector&&(s=e.baseURLSelector),e.adapter&&(t=e.adapter)}},a=or(n).create(),s=pr(n).create(),r.on(m.SERVICE_LOCATION_BLACKLIST_CHANGED,(function(e){a.invalidateSelectedIndexes(e.entry)}),e),e}mr.__dashjs_factory_name="BaseURLController";const Er=u.getClassFactory(mr),yr=class extends b{constructor(e,t){super(),this.url=e||null,this.type=t||null,this.mediaType=a.STREAM,this.responseType=""}};function _r(e){e=e||{};const t=this.context,n=g(t).getInstance();let r,i=Mn(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.settings?e.settings.get().streaming.lowLatencyEnabled:null,errors:Q});return r={load:function(e,t,r){const a=function(i,a){t.resolved=!0,t.resolvedContent=i||null,n.trigger(m.XLINK_ELEMENT_LOADED,{element:t,resolveObject:r,error:i||a?null:new M(Q.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,Q.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{const t=new yr(e,S.XLINK_EXPANSION_TYPE);i.load({request:t,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){i&&(i.abort(),i=null)}},r}_r.__dashjs_factory_name="XlinkLoader";const Tr=u.getClassFactory(_r),vr=function(e){void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1);function t(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function n(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function r(e,t,n,r){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(t,n,r))break}return i!=e.length}function i(t,n,i){"property"===e.arrayAccessForm&&(t[n]instanceof Array?t[n+"_asArray"]=t[n]:t[n+"_asArray"]=[t[n]]),!(t[n]instanceof Array)&&e.arrayAccessFormPaths.length>0&&r(e.arrayAccessFormPaths,t,n,i)&&(t[n]=[t[n]])}function a(e){var t=e.split(/[-T:+Z]/g),n=new Date(t[0],t[1]-1,t[2]),r=t[5].split(".");if(n.setHours(t[3],t[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function s(t,n,i,a){return!(1==n&&e.xmlElementsFilter.length>0)||r(e.xmlElementsFilter,t,i,a)}function o(n,l){if(9==n.nodeType){for(var u=new Object,c=n.childNodes,d=0;d<c.length;d++)1==(h=c[d]).nodeType&&(e.ignoreRoot?u=o(h):(u={})[g=t(h)]=o(h));return u}if(1==n.nodeType){(u=new Object).__cnt=0;var f=[];for(c=n.childNodes,d=0;d<c.length;d++){var h,g=t(h=c[d]);if(8!=h.nodeType){var p=l+"."+g;if(s(u,h.nodeType,g,p))if(u.__cnt++,null==u[g]){var m=o(h,p);("#text"!=g||/[^\s]/.test(m))&&((E={})[g]=m,f.push(E)),u[g]=m,i(u,g,p)}else{var E;null!=u[g]&&(u[g]instanceof Array||(u[g]=[u[g]],i(u,g,p))),m=o(h,p),("#text"!=g||/[^\s]/.test(m))&&((E={})[g]=m,f.push(E)),u[g][u[g].length]=m}}}u.__children=f;for(var y=t(n),_=0;_<n.attributes.length;_++){var T=n.attributes[_];u.__cnt++;for(var v=T.value,S=0,A=e.matchers.length;S<A;S++){var R=e.matchers[S];R.test(T,y)&&(v=R.converter(T.value))}u[e.attributePrefix+T.name]=v}var b=function(e){return e.prefix}(n);return null!=b&&""!=b&&(u.__cnt++,u.__prefix=b),null!=u["#text"]&&(u.__text=u["#text"],u.__text instanceof Array&&(u.__text=u.__text.join("\n")),e.stripWhitespaces&&(u.__text=u.__text.trim()),delete u["#text"],"property"==e.arrayAccessForm&&delete u["#text_asArray"],u.__text=function(t,n,i){if(e.datetimeAccessFormPaths.length>0){var s=i.split(".#")[0];return r(e.datetimeAccessFormPaths,t,n,s)?a(t):t}return t}(u.__text,g,l+"."+g)),null!=u["#cdata-section"]&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],"property"==e.arrayAccessForm&&delete u["#cdata-section_asArray"]),0==u.__cnt&&"text"==e.emptyNodeForm?u="":1==u.__cnt&&null!=u.__text?u=u.__text:1!=u.__cnt||null==u.__cdata||e.keepCData?u.__cnt>1&&null!=u.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==u.__text||""==u.__text.trim())&&delete u.__text:u=u.__cdata,delete u.__cnt,!e.enableToStringFunc||null==u.__text&&null==u.__cdata||(u.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),u}if(3==n.nodeType||4==n.nodeType)return n.nodeValue}function l(t,r,i,a){var s="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+r;if(null!=i)for(var o=0;o<i.length;o++){var l=i[o],u=t[l];e.escapeMode&&(u=n(u)),s+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?s+='"'+u+'"':s+="'"+u+"'"}return s+(a?"/>":">")}function u(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function c(t,n){return"property"==e.arrayAccessForm&&(i="_asArray",-1!==(r=n.toString()).indexOf(i,r.length-i.length))||0==n.toString().indexOf(e.attributePrefix)||0==n.toString().indexOf("__")||t[n]instanceof Function;var r,i}function d(e){var t=0;if(e instanceof Object)for(var n in e)c(e,n)||t++;return t}function f(t,n,i){return 0==e.jsonPropertiesFilter.length||""==i||r(e.jsonPropertiesFilter,t,n,i)}function h(t){var n=[];if(t instanceof Object)for(var r in t)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(e.attributePrefix)&&n.push(r);return n}function g(t){var r="";return t instanceof Object?r+=function(t){var r="";return null!=t.__cdata&&(r+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?r+=n(t.__text):r+=t.__text),r}(t):null!=t&&(e.escapeMode?r+=n(t):r+=t),r}function p(e,t){return""===e?t:e+"."+t}function m(e,t,n,r){var i="";if(0==e.length)i+=l(e,t,n,!0);else for(var a=0;a<e.length;a++)i+=l(e[a],t,h(e[a]),!1),i+=E(e[a],p(r,t)),i+=u(e[a],t);return i}function E(e,t){var n="";if(d(e)>0)for(var r in e)if(!c(e,r)&&(""==t||f(e,r,p(t,r)))){var i=e[r],a=h(i);null==i||null==i?n+=l(i,r,a,!0):i instanceof Object?i instanceof Array?n+=m(i,r,a,t):i instanceof Date?(n+=l(i,r,a,!1),n+=i.toISOString(),n+=u(i,r)):d(i)>0||null!=i.__text||null!=i.__cdata?(n+=l(i,r,a,!1),n+=E(i,p(t,r)),n+=u(i,r)):n+=l(i,r,a,!0):(n+=l(i,r,a,!1),n+=g(i),n+=u(i,r))}return n+g(e)}this.parseXmlString=function(e){var t;if(window.ActiveXObject||window,void 0===e)return null;if(window.DOMParser){var n=new window.DOMParser;try{(t=n.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?a(e):e},this.xml2json=function(e){return o(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return E(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},Sr="onLoad";function Ar(e){e=e||{};let t=this.context,n=g(t).getInstance();const r=jt(t).getInstance();let i,a,o,l,u,c;function d(e,t,n){let i,a,s={};s.elements=e,s.type=t,s.resolveType=n,0===s.elements.length&&h(s);for(let e=0;e<s.elements.length;e++)i=s.elements[e],a=r.isHTTPURL(i.url)?i.url:i.originalContent.BaseURL+i.url,c.load(a,i,s)}function f(e){let t,n,r="";if(t=e.element,n=e.resolveObject,t.resolvedContent){let e=0;0===t.resolvedContent.indexOf("<?xml")&&(e=t.resolvedContent.indexOf("?>")+2),r=t.resolvedContent.substr(0,e)+"<response>"+t.resolvedContent.substr(e)+"</response>",t.resolvedContent=u.xml_str2json(r)}(function(e){let t,n;for(t=0;t<e.elements.length;t++)if(n=e.elements[t],!1===n.resolved)return!1;return!0})(n)&&h(n)}function h(e){let t,r,i=[];if(function(e){let t,n,r,i,a,s,u=[];for(i=e.elements.length-1;i>=0;i--){if(t=e.elements[i],n=t.type+"_asArray",t.resolvedContent){if(t.resolvedContent)for(a=0;a<t.resolvedContent[n].length;a++)r=t.resolvedContent[n][a],u.push(r)}else delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],u.push(t.originalContent);for(t.parentElement[n].splice(t.index,1),s=0;s<u.length;s++)t.parentElement[n].splice(t.index+s,0,u[s]);u=[]}e.elements.length>0&&o.run(l)}(e),"onActuate"===e.resolveType&&n.trigger(m.XLINK_READY,{manifest:l}),e.resolveType===Sr)switch(e.type){case s.PERIOD:for(t=0;t<l[s.PERIOD+"_asArray"].length;t++)r=l[s.PERIOD+"_asArray"][t],r.hasOwnProperty(s.ADAPTATION_SET+"_asArray")&&(i=i.concat(p(r[s.ADAPTATION_SET+"_asArray"],r,s.ADAPTATION_SET,Sr))),r.hasOwnProperty(s.EVENT_STREAM+"_asArray")&&(i=i.concat(p(r[s.EVENT_STREAM+"_asArray"],r,s.EVENT_STREAM,Sr)));d(i,s.ADAPTATION_SET,Sr);break;case s.ADAPTATION_SET:n.trigger(m.XLINK_READY,{manifest:l})}}function p(e,t,n,r){let i,a,s,o=[];for(a=e.length-1;a>=0;a--)i=e[a],i.hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===i["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)i=e[a],i.hasOwnProperty("xlink:href")&&i.hasOwnProperty("xlink:actuate")&&i["xlink:actuate"]===r&&(s=E(i["xlink:href"],t,n,a,r,i),o.push(s));return o}function E(e,t,n,r,i,a){return{url:e,parentElement:t,type:n,index:r,resolveType:i,originalContent:a,resolvedContent:null,resolved:!1}}return i={resolveManifestOnLoad:function(e){let t;u=new vr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:a}),l=e,l.Period_asArray?(t=p(l.Period_asArray,l,s.PERIOD,Sr),d(t,s.PERIOD,Sr)):n.trigger(m.XLINK_READY,{manifest:l})},setMatchers:function(e){e&&(a=e)},setIron:function(e){e&&(o=e)},reset:function(){n.off(m.XLINK_ELEMENT_LOADED,f,i),c&&(c.reset(),c=null)}},n.on(m.XLINK_ELEMENT_LOADED,f,i),c=Tr(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),i}Ar.__dashjs_factory_name="XlinkController";const Rr=u.getClassFactory(Ar);function br(e){function t(e,t){for(let n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function n(e,n,r){for(let i=0,a=e.length;i<a;++i){const a=e[i];if(n[a.name])if(r[a.name]){if(a.merge){const e=n[a.name],i=r[a.name];"object"==typeof e&&"object"==typeof i?t(e,i):r[a.name]=e+i}}else r[a.name]=n[a.name]}}function r(e,t){for(let i=0,a=e.children.length;i<a;++i){const a=e.children[i],s=t[a.name+"_asArray"];if(s)for(let i=0,o=s.length;i<o;++i){const o=s[i];n(e.properties,t,o),r(a,o)}}}return{run:function(t){if(null===t||"object"!=typeof t)return t;if(t.Period_asArray&&"period"in e){const n=e.period,i=t.Period_asArray;for(let t=0,a=i.length;t<a;++t){const a=i[t];if(r(n,a),"adaptationset"in e){const t=a.AdaptationSet_asArray;if(t){const n=e.adaptationset;for(let e=0,i=t.length;e<i;++e)r(n,t[e])}}}}return t}}}br.__dashjs_factory_name="ObjectIron";const Ir=u.getClassFactory(br),Dr=class{constructor(e,t){this._test=e,this._converter=t}get test(){return this._test}get converter(){return this._converter}},wr=class extends Dr{constructor(){super(((e,t)=>{const n={[s.MPD]:[s.ID,s.PROFILES],[s.PERIOD]:[s.ID],[s.BASE_URL]:[s.SERVICE_LOCATION,s.BYTE_RANGE],[s.SEGMENT_BASE]:[s.INDEX_RANGE],[s.INITIALIZATION]:[s.RANGE],[s.REPRESENTATION_INDEX]:[s.RANGE],[s.SEGMENT_LIST]:[s.INDEX_RANGE],[s.BITSTREAM_SWITCHING]:[s.RANGE],[s.SEGMENT_URL]:[s.MEDIA_RANGE,s.INDEX_RANGE],[s.SEGMENT_TEMPLATE]:[s.INDEX_RANGE,s.MEDIA,s.INDEX,s.INITIALIZATION_MINUS,s.BITSTREAM_SWITCHING_MINUS],[s.ASSET_IDENTIFIER]:[s.VALUE,s.ID],[s.EVENT_STREAM]:[s.VALUE],[s.ADAPTATION_SET]:[s.PROFILES,s.MIME_TYPE,s.SEGMENT_PROFILES,s.CODECS,s.CONTENT_TYPE],[s.FRAME_PACKING]:[s.VALUE,s.ID],[s.AUDIO_CHANNEL_CONFIGURATION]:[s.VALUE,s.ID],[s.CONTENT_PROTECTION]:[s.VALUE,s.ID],[s.ESSENTIAL_PROPERTY]:[s.VALUE,s.ID],[s.SUPPLEMENTAL_PROPERTY]:[s.VALUE,s.ID],[s.INBAND_EVENT_STREAM]:[s.VALUE,s.ID],[s.ACCESSIBILITY]:[s.VALUE,s.ID],[s.ROLE]:[s.VALUE,s.ID],[s.RATING]:[s.VALUE,s.ID],[s.VIEWPOINT]:[s.VALUE,s.ID],[s.CONTENT_COMPONENT]:[s.CONTENT_TYPE],[s.REPRESENTATION]:[s.ID,s.DEPENDENCY_ID,s.MEDIA_STREAM_STRUCTURE_ID],[s.SUBSET]:[s.ID],[s.METRICS]:[s.METRICS_MINUS],[s.REPORTING]:[s.VALUE,s.ID]};if(n.hasOwnProperty(t)){let r=n[t];return void 0!==r&&r.indexOf(e.name)>=0}return!1}),(e=>String(e)))}},Cr=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,Nr=class extends Dr{constructor(){super((e=>{const t=[s.MIN_BUFFER_TIME,s.MEDIA_PRESENTATION_DURATION,s.MINIMUM_UPDATE_PERIOD,s.TIMESHIFT_BUFFER_DEPTH,s.MAX_SEGMENT_DURATION,s.MAX_SUBSEGMENT_DURATION,s.SUGGESTED_PRESENTATION_DELAY,s.START,a.START_TIME,s.DURATION],n=t.length;for(let r=0;r<n;r++)if(e.nodeName===t[r])return Cr.test(e.value);return!1}),(e=>{const t=Cr.exec(e);let n=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(n=-n),n}))}},Lr=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,Mr=class extends Dr{constructor(){super((e=>Lr.test(e.value)),(e=>{const t=Lr.exec(e);let n;if(n=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&parseInt(t[6],10)||0,t[7]&&1e3*parseFloat(t[7])||0),t[9]&&t[10]){const e=60*parseInt(t[9],10)+parseInt(t[10],10);n+=("+"===t[8]?-1:1)*e*60*1e3}return new Date(n)}))}},Or=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,Pr=class extends Dr{constructor(){super((e=>Or.test(e.value)),(e=>parseFloat(e)))}},xr=class{constructor(e,t,n){this._name=e||"",this._properties=[],this._children=n||[],Array.isArray(t)&&t.forEach((e=>{this._properties.push(new class{constructor(e){var t;this._name=e,this._merge=(t=e)&&t.length&&t.charAt(0)===t.charAt(0).toUpperCase()}get name(){return this._name}get merge(){return this._merge}}(e))}))}get name(){return this._name}get children(){return this._children}get properties(){return this._properties}},Fr=class extends xr{constructor(){const e=[s.PROFILES,s.WIDTH,s.HEIGHT,s.SAR,s.FRAMERATE,s.AUDIO_SAMPLING_RATE,s.MIME_TYPE,s.SEGMENT_PROFILES,s.CODECS,s.MAXIMUM_SAP_PERIOD,s.START_WITH_SAP,s.MAX_PLAYOUT_RATE,s.CODING_DEPENDENCY,s.SCAN_TYPE,s.FRAME_PACKING,s.AUDIO_CHANNEL_CONFIGURATION,s.CONTENT_PROTECTION,s.ESSENTIAL_PROPERTY,s.SUPPLEMENTAL_PROPERTY,s.INBAND_EVENT_STREAM];super(s.ADAPTATION_SET,e,[new xr(s.REPRESENTATION,e,[new xr(s.SUB_REPRESENTATION,e)])])}},kr=class extends xr{constructor(){const e=[s.SEGMENT_BASE,s.SEGMENT_TEMPLATE,s.SEGMENT_LIST];super(s.PERIOD,e,[new xr(s.ADAPTATION_SET,e,[new xr(s.REPRESENTATION,e)])])}};function Ur(e){e=e||{};const t=this.context,n=e.debug;let r,i,a,s,o;return r={parse:function(e){let t;const n=window.performance.now();if(t=s.xml_str2json(e),!t)throw new Error("parsing the manifest failed");const r=window.performance.now();t.Patch?(t=t.Patch,t.add_asArray&&t.add_asArray.forEach((e=>o.run(e))),t.replace_asArray&&t.replace_asArray.forEach((e=>o.run(e)))):(t=t.MPD,o.run(t));const a=window.performance.now();return i.info("Parsing complete: ( xml2json: "+(r-n).toPrecision(3)+"ms, objectiron: "+(a-r).toPrecision(3)+"ms, total: "+((a-n)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return a},getIron:function(){return o}},i=n.getLogger(r),a=[new Nr,new Mr,new Pr,new wr],s=new vr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:a}),o=Ir(t).create({adaptationset:new Fr,period:new kr}),r}Ur.__dashjs_factory_name="DashParser";const Br=u.getClassFactory(Ur);function Gr(e){e=e||{};const t=this.context,n=e.debug,r=g(t).getInstance(),i=jt(t).getInstance();let o,l,u,c,d,f=e.mssHandler,h=e.errHandler;function p(e){r.trigger(m.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}return o={load:function(e){const s=new yr(e,S.MPD_TYPE);u.load({request:s,success:function(s,o,u){if(!c)return;let h,g,p;if(u&&u!==e?(g=i.parseBaseUrl(u),h=u):(i.isRelative(e)&&(e=i.resolve(e,window.location.href)),g=i.parseBaseUrl(e)),"No Content"!=o)if(null===d&&(d=function(e){let r=null;return e.indexOf("SmoothStreamingMedia")>-1?(f&&(r=f.createMssParser(),f.registerEvents()),r):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?Br(t).create({debug:n}):r}(s)),null!==d){c.setMatchers(d.getMatchers()),c.setIron(d.getIron());try{p=d.parse(s)}catch(t){return void r.trigger(m.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new M(Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+`${e}`)})}p?(p.url=h||e,p.originalUrl||(p.originalUrl=p.url),p.hasOwnProperty(a.LOCATION)&&(g=i.parseBaseUrl(p.Location_asArray[0]),l.debug("BaseURI set by Location to: "+g)),p.baseUri=g,p.loadedTime=new Date,c.resolveManifestOnLoad(p),r.trigger(m.ORIGINAL_MANIFEST_LOADED,{originalManifest:s})):r.trigger(m.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new M(Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+`${e}`)})}else r.trigger(m.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new M(Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,Q.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+`${e}`)});else r.trigger(m.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,n,i){r.trigger(m.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new M(Q.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,Q.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+`${e}, ${i}`)})}})},reset:function(){r.off(m.XLINK_READY,p,o),f&&f.reset(),c&&(c.reset(),c=null),u&&(u.abort(),u=null)}},l=n.getLogger(o),r.on(m.XLINK_READY,p,o),u=Mn(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,useFetch:e.settings.get().streaming.lowLatencyEnabled,urlUtils:i,constants:a,dashConstants:s,errors:Q}),c=Rr(t).create({errHandler:h,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),d=null,o}Gr.__dashjs_factory_name="ManifestLoader";const qr=u.getClassFactory(Gr);function Kr(){let e;const t=this.context,n=g(t).getInstance();return e={error:function(e){n.trigger(m.ERROR,{error:e})}},e}Kr.__dashjs_factory_name="ErrorHandler";const Hr=u.getSingletonFactory(Kr),Yr=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function Vr(){let e="WebKitMediaSource"in window,t="MediaSource"in window;return e||t}function jr(){let e,t;return e={supportsMediaSource:Vr,supportsEncryptedMedia:function(){return t},supportsCodec:function(e){return!(!("MediaSource"in window)||!MediaSource.isTypeSupported(e))||!(!("WebKitMediaSource"in window)||!WebKitMediaSource.isTypeSupported(e))},setEncryptedMediaSupported:function(e){t=e},supportsEssentialProperty:function(e){try{return-1!==Tn.indexOf(e.schemeIdUri)}catch(e){return!0}},codecRootCompatibleWithCodec:function(e,t){const n=e.split(".")[0],r=0===t.indexOf(n);let i;for(let e=0;e<Yr.length;e++)if(Yr[e].codec===n){i=Yr[e];break}return i?r||i.compatibleCodecs.some((e=>0===t.indexOf(e))):r}},t=!1,e}jr.__dashjs_factory_name="Capabilities";const zr=u.getSingletonFactory(jr);function Wr(){const e=this.context;let t,n,r,i,s,o;function l(e,t){const i=n.getRealPeriodByIndex(t?t.index:null);i&&i.AdaptationSet_asArray&&0!==i.AdaptationSet_asArray.length&&(i.AdaptationSet_asArray=i.AdaptationSet_asArray.filter((t=>!t.Representation_asArray||0===t.Representation_asArray.length||!n.getIsTypeOf(t,e)||(t.Representation_asArray=t.Representation_asArray.filter(((e,i)=>{const a=n.getCodec(t,i,!0);return!!r.supportsCodec(a)||(s.error("[Stream] codec not supported: "+a),!1)})),t.Representation_asArray&&t.Representation_asArray.length>0))))}return t={setConfig:function(e){e&&(e.adapter&&(n=e.adapter),e.capabilities&&(r=e.capabilities),e.settings&&(i=e.settings))},filterUnsupportedFeaturesOfPeriod:function(e){l(a.VIDEO,e),l(a.AUDIO,e),i.get().streaming.filterUnsupportedEssentialProperties&&function(e){const t=n.getRealPeriodByIndex(e?e.index:null);t&&t.AdaptationSet_asArray&&0!==t.AdaptationSet_asArray.length&&(t.AdaptationSet_asArray=t.AdaptationSet_asArray.filter((e=>!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((e=>{const t=n.getEssentialPropertiesForRepresentation(e);if(t&&t.length>0){let e=0;for(;e<t.length;){if(!r.supportsEssentialProperty(t[e]))return s.debug("[Stream] EssentialProperty not supported: "+t[e].schemeIdUri),!1;e+=1}}return!0})),e.Representation_asArray&&e.Representation_asArray.length>0))))}(e),function(e){if(!o||0===o.length)return;const t=n.getRealPeriodByIndex(e?e.index:null);t&&t.AdaptationSet_asArray&&0!==t.AdaptationSet_asArray.length&&(t.AdaptationSet_asArray=t.AdaptationSet_asArray.filter((e=>!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter((e=>!o.some((t=>!t(e))))),e.Representation_asArray&&e.Representation_asArray.length>0))))}(e)},setCustomCapabilitiesFilters:function(e){o=e}},s=_(e).getInstance().getLogger(t),t}Wr.__dashjs_factory_name="CapabilitiesFilter";const $r=u.getSingletonFactory(Wr);function Xr(){let e,t;return e={initialize:function(e){if(t=new class{constructor(){this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null}},!e)return null;const n=e.indexOf("#");if(-1!==n){const r=e.substr(n+1).split("&");for(let e=0,n=r.length;e<n;++e){const n=r[e],i=n.indexOf("=");if(-1!==i){const e=n.substring(0,i);t.hasOwnProperty(e)&&(t[e]=n.substr(i+1))}}}},getURIFragmentData:function(){return t}},e}Xr.__dashjs_factory_name="URIFragmentModel";const Qr=u.getSingletonFactory(Xr);function Jr(){let e,t,n=this.context,r=g(n).getInstance();return e={getValue:function(){return t},setValue:function(e){t=e,e&&r.trigger(m.MANIFEST_LOADED,{data:e})}},e}Jr.__dashjs_factory_name="ManifestModel";const Zr=u.getSingletonFactory(Jr);function ei(){let e,t,n,r;const i=this.context,s=nn(i).getInstance();function o(e){let t;for(t=0;t<r.length;t++)if(r[t].rulename===e)return t;return-1}function l(){return s.get().streaming.lowLatencyEnabled?s.get().streaming.liveDelay||3:s.get().streaming.liveDelay}function u(e,n){c(e,n);let r=new dn;r.schemeIdUri=e,r.value=n,t.push(r)}function c(e,n){q(e,"string"),q(n,"string"),t.forEach((function(r,i){r.schemeIdUri===e&&r.value===n&&t.splice(i,1)}))}return e={getABRCustomRules:function(){return r},addABRCustomRule:function(e,t,n){if("string"!=typeof e||e!==Ke.ABANDON_FRAGMENT_RULES&&e!==Ke.QUALITY_SWITCH_RULES||"string"!=typeof t)throw a.BAD_ARGUMENT_ERROR;let i=o(t);-1===i?r.push({type:e,rulename:t,rule:n}):(r[i].type=e,r[i].rule=n)},removeABRCustomRule:function(e){if(e){let t=o(e);-1!==t&&r.splice(t,1)}else r=[]},getStableBufferTime:function(){if(s.get().streaming.lowLatencyEnabled)return.6*l();const e=s.get().streaming.stableBufferTime;return e>-1?e:s.get().streaming.fastSwitchEnabled?20:12},getRetryAttemptsForType:function(e){const t=isNaN(s.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:s.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return s.get().streaming.lowLatencyEnabled?s.get().streaming.retryAttempts[e]*t:s.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){const t=isNaN(s.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:s.get().streaming.retryIntervals.lowLatencyReductionFactor;return s.get().streaming.lowLatencyEnabled?s.get().streaming.retryIntervals[e]/t:s.get().streaming.retryIntervals[e]},getLiveDelay:l,getLiveCatchupLatencyThreshold:function(){try{const e=s.get().streaming.liveCatchup.latencyThreshold,t=l();if(null!==e&&!isNaN(e))return Math.max(e,t);const n=s.get().streaming.liveCatchup.minDrift,r=!isNaN(t)&&t?isNaN(n)?l():s.get().streaming.liveCatchup.minDrift+l():NaN;return r&&!isNaN(r)?Math.max(4*r,5):NaN}catch(e){return NaN}},addUTCTimingSource:u,removeUTCTimingSource:c,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){let e=s.get().streaming.utcSynchronization.defaultTimingSource;u(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,r){t?n[t]=!!r:Object.keys(n).forEach((t=>{e(t,r)}))},getXHRWithCredentialsForType:function(e){const t=n[e];return void 0===t?n.default:t},getDefaultUtcTimingSource:function(){return s.get().streaming.utcSynchronization.defaultTimingSource},reset:function(){}},t=[],n={default:!1},r=[],e}ei.__dashjs_factory_name="MediaPlayerModel";const ti=u.getSingletonFactory(ei);function ni(){let e,t,n,r,i;const a=this.context,s=g(a).getInstance(),o=[];function l(){n&&(n.playbackRate=i||1,n.removeEventListener("canplay",l))}function u(e){n&&(n.readyState<=2&&e>0?n.addEventListener("canplay",l):n.playbackRate=e)}function c(){return o.length>0}function d(e){let t,r=o.indexOf(e);null!==e&&(-1!==r&&o.splice(r,1),n&&!1===c()&&0===n.playbackRate&&(u(i||1),n.paused||(t=document.createEvent("Event"),t.initEvent("playing",!0,!1),n.dispatchEvent(t))))}function f(){if(n&&c()&&0===n.playbackRate){const e=document.createEvent("Event");e.initEvent("waiting",!0,!1),n.dispatchEvent(e)}}function h(){return n?n.buffered:null}function p(e,t,r,i,a){if(n)for(let s=0;s<n.textTracks.length;s++)if(n.textTracks[s].kind===e&&(!t||n.textTracks[s].label==t)&&n.textTracks[s].language===r&&n.textTracks[s].isTTML===i&&n.textTracks[s].isEmbedded===a)return n.textTracks[s];return null}return e={initialize:function(){s.on(m.PLAYBACK_PLAYING,f,this)},setCurrentTime:function(e,t){if(n){if(n.currentTime==e)return;try{e=t?function(e){const t=h();let n=e,r=9999999999;if(t)for(let i=0;i<t.length;i++){const a=t.start(i),s=t.end(i),o=Math.abs(a-e),l=Math.abs(s-e);if(e>=a&&e<=s)return e;o<r&&(r=o,n=a),l<r&&(r=l,n=s)}return n}(e):e,n.currentTime=e}catch(t){0===n.readyState&&t.code===t.INVALID_STATE_ERR&&setTimeout((function(){n.currentTime=e}),400)}}},play:function(){if(n){n.autoplay=!0;const e=n.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch((e=>{"NotAllowedError"===e.name&&s.trigger(m.PLAYBACK_NOT_ALLOWED),t.warn(`Caught pending play exception - continuing (${e})`)}))}},isPaused:function(){return n?n.paused:null},pause:function(){n&&(n.pause(),n.autoplay=!1)},isStalled:c,isSeeking:function(){return n?n.seeking:null},getTime:function(){return n?n.currentTime:null},getPlaybackRate:function(){return n?n.playbackRate:null},setPlaybackRate:u,getPlayedRanges:function(){return n?n.played:null},getEnded:function(){return n?n.ended:null},setStallState:function(e,t){!function(e,t){t?function(e){let t;null!==e&&n&&!n.seeking&&-1===o.indexOf(e)&&(o.push(e),n&&1===o.length&&(t=document.createEvent("Event"),t.initEvent("waiting",!0,!1),i=n.playbackRate,u(0),n.dispatchEvent(t)))}(e):d(e)}(e,t)},getElement:function(){return n},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";n=e,n&&(n.preload="auto")},setSource:function(e){n&&(e?n.src=e:(n.removeAttribute("src"),n.load()))},getSource:function(){return n?n.src:null},getTTMLRenderingDiv:function(){return r},setTTMLRenderingDiv:function(e){r=e,r.style.position="absolute",r.style.display="flex",r.style.overflow="hidden",r.style.pointerEvents="none",r.style.top=0,r.style.left=0},getPlaybackQuality:function(){if(!n)return null;let e="webkitDroppedFrameCount"in n&&"webkitDecodedFrameCount"in n,t=null;return"getVideoPlaybackQuality"in n?t=n.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:n.webkitDroppedFrameCount,totalVideoFrames:n.webkitDroppedFrameCount+n.webkitDecodedFrameCount,creationTime:new Date}),t},addEventListener:function(e,t){n&&n.addEventListener(e,t)},removeEventListener:function(e,t){n&&n.removeEventListener(e,t)},getReadyState:function(){return n?n.readyState:NaN},getBufferRange:h,getClientWidth:function(){return n?n.clientWidth:NaN},getClientHeight:function(){return n?n.clientHeight:NaN},getTextTracks:function(){return n?n.textTracks:[]},getTextTrack:p,addTextTrack:function(e,t,r,i,a){if(!n)return null;let s=p(e,t,r,i,a);return s||(s=n.addTextTrack(e,t,r),s.isEmbedded=a,s.isTTML=i),s},appendChild:function(e){n&&(n.appendChild(e),void 0!==e.isTTML&&(n.textTracks[n.textTracks.length-1].isTTML=e.isTTML,n.textTracks[n.textTracks.length-1].isEmbedded=e.isEmbedded))},removeChild:function(e){n&&n.removeChild(e)},getVideoWidth:function(){return n?n.videoWidth:NaN},getVideoHeight:function(){return n?n.videoHeight:NaN},getVideoRelativeOffsetTop:function(){const e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN},getVideoRelativeOffsetLeft:function(){const e=n.parentNode.host||n.parentNode;return e?n.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN},reset:function(){s.off(m.PLAYBACK_PLAYING,f,this)}},t=_(a).getInstance().getLogger(e),e}ni.__dashjs_factory_name="VideoModel";const ri=u.getSingletonFactory(ni),ii=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],ai="dashjs_?_bitrate",si="dashjs_?_settings",oi="localStorage",li="lastBitrate",ui="lastMediaSettings";function ci(e){e=e||{};const t=this.context,n=e.settings;let r,i,s;function o(e){if(void 0!==s)return s;let t;s=!1;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return i.warn("DOMStorage access denied: "+e.message),s}if(!t||e!==oi&&"sessionStorage"!==e)return s;try{t.setItem("1","1"),t.removeItem("1"),s=!0}catch(e){i.warn("DOMStorage is supported, but cannot be used: "+e.message)}return s}function l(){const e=6e5;return Math.round((new Date).getTime()/e)*e}function u(e,t){return o(e)&&n.get().streaming[t+"CachingInfo"].enabled}function c(){if(!n)throw new Error(a.MISSING_CONFIG_ERROR)}return r={getSavedBitrateSettings:function(e){let t=NaN;if(c(),u(oi,li)){const r=ai.replace(/\?/,e);try{const a=JSON.parse(localStorage.getItem(r))||{},s=(new Date).getTime()-parseInt(a.timestamp,10)>=n.get().streaming.lastBitrateCachingInfo.ttl||!1,o=parseFloat(a.bitrate);isNaN(o)||s?s&&localStorage.removeItem(r):(t=o,i.debug("Last saved bitrate for "+e+" was "+o))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(oi,li)&&t){const n=ai.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({bitrate:t.toFixed(3),timestamp:l()}))}catch(e){i.error(e.message)}}},getSavedMediaSettings:function(e){let t=null;if(c(),u(oi,ui)){const r=si.replace(/\?/,e);try{const e=JSON.parse(localStorage.getItem(r))||{},i=(new Date).getTime()-parseInt(e.timestamp,10)>=n.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=e.settings,i&&(localStorage.removeItem(r),t=null)}catch(e){return null}}return t},setSavedMediaSettings:function(e,t){if(u(oi,ui)){const n=si.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({settings:t,timestamp:l()}))}catch(e){i.error(e.message)}}}},i=_(t).getInstance().getLogger(r),o(oi)&&ii.forEach((e=>{const t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){i.error(e.message)}}})),r}ci.__dashjs_factory_name="DOMStorage";const di=u.getSingletonFactory(ci);function fi(){const e=this.context;let t,n,r,i,a,s,o,l,u,c,d,f,h,g,p,m;function E(){if(!m||!m.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function y(e){if(!e.url)return;const t=new b;return t.setInfo(e),t}function _(e,t,n,r){d.trigger(c.SEGMENTS_LOADED,{segments:n,representation:r,error:n?void 0:new M(f.SEGMENT_BASE_LOADER_ERROR_CODE,f.SEGMENT_BASE_LOADER_ERROR_MESSAGE)},{streamId:e,mediaType:t})}return t={setConfig:function(e){e.baseURLController&&(m=e.baseURLController),e.dashMetrics&&(s=e.dashMetrics),e.mediaPlayerModel&&(l=e.mediaPlayerModel),e.errHandler&&(r=e.errHandler),e.settings&&(o=e.settings),e.boxParser&&(i=e.boxParser),e.events&&(c=e.events),e.eventBus&&(d=e.eventBus),e.debug&&(n=e.debug.getLogger(t)),e.requestModifier&&(a=e.requestModifier),e.errors&&(f=e.errors),e.urlUtils&&(p=e.urlUtils),e.constants&&(h=e.constants),e.dashConstants&&(g=e.dashConstants)},initialize:function(){u=Mn(e).create({errHandler:r,dashMetrics:s,mediaPlayerModel:l,requestModifier:a,useFetch:o?o.get().streaming.lowLatencyEnabled:null,boxParser:i,errors:f,urlUtils:p,constants:h,dashConstants:g})},loadInitialization:function e(t,r,a,s){E();let o=null;const l=a?m.resolve(a.path):null,f=s||{init:!0,url:l?l.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:r};n.debug("Start searching for initialization.");const h=y(f);u.load({request:h,success:function(n){f.bytesLoaded=f.range.end,o=i.findInitRange(n),o?(a.range=o,d.trigger(c.INITIALIZATION_LOADED,{representation:a},{streamId:t,mediaType:r})):(f.range.end=f.bytesLoaded+f.bytesToLoad,e(t,r,a,f))},error:function(){d.trigger(c.INITIALIZATION_LOADED,{representation:a},{streamId:t,mediaType:r})}}),n.debug("Perform init search: "+f.url)},loadSegments:function e(t,r,a,s,o,l){if(E(),s&&(void 0===s.start||void 0===s.end)){const e=s?s.toString().split("-"):null;s=e?{start:parseFloat(e[0]),end:parseFloat(e[1])}:null}o=o||_;let c=null,d=null;const f=!!s,h=a?m.resolve(a.path):null,g={init:!1,url:h?h.url:void 0,range:f?s:{start:0,end:1500},searching:!f,bytesLoaded:l?l.bytesLoaded:0,bytesToLoad:1500,mediaType:r},p=y(g);u.load({request:p,success:function(s){const l=g.bytesToLoad,u=s.byteLength;if(g.bytesLoaded=g.range.end-g.range.start,c=i.parse(s),d=c.getBox("sidx"),d&&d.isComplete){const i=d.references;let s,l;if(null!=i&&i.length>0&&(s=1===i[0].reference_type),s){let s,l,u,c,f;n.debug("Initiate multiple SIDX load."),g.range.end=g.range.start+d.size;let h=[],p=0,m=(d.offset||g.range.start)+d.size;const E=function(e,t,n){n?(h=h.concat(n),p++,p>=l&&(h.sort((function(e,t){return e.startTime-t.startTime<0?-1:0})),o(e,t,h,a))):o(e,t,null,a)};for(s=0,l=i.length;s<l;s++)u=m,c=m+i[s].referenced_size-1,m+=i[s].referenced_size,f={start:u,end:c},e(t,r,a,f,E,g)}else n.debug("Parsing segments from SIDX. representation "+r+" - id: "+a.id+" for range : "+g.range.start+" - "+g.range.end),l=function(e,t){const n=e.references,r=n.length,i=e.timescale;let a=e.earliest_presentation_time,s=t.range.start+e.offset+e.first_offset+e.size;const o=[];let l,u,c,d;for(let e=0;e<r;e++)c=n[e].subsegment_duration,d=n[e].referenced_size,l=new Tt,l.duration=c,l.startTime=a,l.timescale=i,u=s+d-1,l.mediaRange=s+"-"+u,o.push(l),a+=c,s+=d;return o}(d,g),o(t,r,l,a)}else{if(d)g.range.start=d.offset||g.range.start,g.range.end=g.range.start+(d.size||l);else{if(u<g.bytesLoaded)return void o(t,r,null,a);{const e=c.getLastBox();e&&e.size?(g.range.start=e.offset+e.size,g.range.end=g.range.start+l):g.range.end+=l}}e(t,r,a,g.range,o,g)}},error:function(){o(t,r,null,a)}}),n.debug("Perform SIDX load: "+g.url+" with range : "+g.range.start+" - "+g.range.end)},reset:function(){u.abort(),u=null,r=null,i=null,a=null}},t}fi.__dashjs_factory_name="SegmentBaseLoader";const hi=u.getSingletonFactory(fi);function gi(e){let t;e=e||{};let n=new DataView(e.data),r=0;function i(e,t){let i,a,s=!0,o=0;if(void 0===t&&(t=!1),e.tag>16777215?(n.getUint32(r)!==e.tag&&(s=!1),o=4):e.tag>65535?(i=n.getUint16(r),a=n.getUint8(r+2),256*i+a!==e.tag&&(s=!1),o=3):e.tag>255?(n.getUint16(r)!==e.tag&&(s=!1),o=2):(n.getUint8(r)!==e.tag&&(s=!1),o=1),!s&&e.required&&!t)throw new Error("required tag not found");return s&&(r+=o),s}function a(e){let t=1,i=128,a=-1,s=0,o=n.getUint8(r),l=0;for(l=0;l<8;l+=1){if((o&i)===i){s=void 0===e?o&~i:o,a=l;break}i>>=1}for(l=0;l<a;l+=1,t+=1)s=s<<8|255&n.getUint8(r+t);return r+=t,s}return t={getPos:function(){return r},setPos:function(e){r=e},consumeTag:i,consumeTagAndSize:function(e,t){let n=i(e,t);return n&&a(),n},parseTag:function(e){let n;return i(e),n=a(),t[e.parse](n)},skipOverElement:function(e,t){let n,s=i(e,t);return s&&(n=a(),r+=n),s},getMatroskaCodedNum:a,getMatroskaFloat:function(e){let t;switch(e){case 4:t=n.getFloat32(r),r+=4;break;case 8:t=n.getFloat64(r),r+=8}return t},getMatroskaUint:function(e){let t=0;for(let i=0;i<e;i+=1)t<<=8,t|=255&n.getUint8(r+i);return r+=e,t},moreData:function(){return r<n.byteLength}},t}gi.__dashjs_factory_name="EBMLParser";const pi=u.getClassFactory(gi);function mi(){const e=this.context;let t,n,r,i,s,o,l,u,c,d,f,h,g;function p(){if(!g||!g.hasOwnProperty("resolve"))throw new Error("setConfig function has to be called previously")}function m(e,t,n,r){d.trigger(f.SEGMENTS_LOADED,{segments:n,representation:r,error:n?void 0:new M(h.SEGMENT_BASE_LOADER_ERROR_CODE,h.SEGMENT_BASE_LOADER_ERROR_MESSAGE)},{streamId:e,mediaType:t})}function E(e){const t=new b;return t.setInfo(e),t}return t={setConfig:function(e){if(!(e.baseURLController&&e.dashMetrics&&e.mediaPlayerModel&&e.errHandler))throw new Error(a.MISSING_CONFIG_ERROR);g=e.baseURLController,o=e.dashMetrics,l=e.mediaPlayerModel,i=e.errHandler,c=e.settings,f=e.events,d=e.eventBus,h=e.errors,n=e.debug.getLogger(t),s=e.requestModifier},initialize:function(){u=Mn(e).create({errHandler:i,dashMetrics:o,mediaPlayerModel:l,requestModifier:s,useFetch:c?c.get().streaming.lowLatencyEnabled:null,errors:h})},loadInitialization:function(e,t,r,i){p();let a=null,s=r?g.resolve(r.path):null,o=r?r.range.split("-"):null,l=i||{range:{start:o?parseFloat(o[0]):null,end:o?parseFloat(o[1]):null},request:a,url:s?s.url:void 0,init:!0,mediaType:t};n.info("Start loading initialization."),a=E(l),u.load({request:a,success:function(){d.trigger(f.INITIALIZATION_LOADED,{representation:r},{streamId:e,mediaType:t})},error:function(){d.trigger(f.INITIALIZATION_LOADED,{representation:r},{streamId:e,mediaType:t})}}),n.debug("Perform init load: "+l.url)},loadSegments:function(t,i,a,s,o){p();let l=null,c=a?g.resolve(a.path):null,d=c?c.url:void 0;o=o||m,l=E({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:l,url:d,init:!1,mediaType:i}),n.debug("Parsing ebml header"),u.load({request:l,success:function(l){!function(t,i,a,s){if(!t||0===t.byteLength)return void s(null);let o,l,c,d,f=pi(e).create({data:t}),h=a?a.split("-"):null,g=null,p={url:i,range:{start:h?parseFloat(h[0]):null,end:h?parseFloat(h[1]):null},request:g};for(n.debug("Parse EBML header: "+p.url),f.skipOverElement(r.EBML),f.consumeTag(r.Segment),c=f.getMatroskaCodedNum(),c+=f.getPos(),d=f.getPos();f.moreData()&&!f.consumeTagAndSize(r.Segment.Info,!0);)if(!(f.skipOverElement(r.Segment.SeekHead,!0)||f.skipOverElement(r.Segment.Tracks,!0)||f.skipOverElement(r.Segment.Cues,!0)||f.skipOverElement(r.Void,!0)))throw new Error("no valid top level element found");for(;void 0===o;){let e=f.getMatroskaCodedNum(!0),t=f.getMatroskaCodedNum();e===r.Segment.Info.Duration.tag?o=f[r.Segment.Info.Duration.parse](t):f.setPos(f.getPos()+t)}g=E(p),u.load({request:g,success:function(t){l=function(t,i,a,s){let o,l,u,c,d,f,h,g;for(l=function(t){let n,i,a=[],s=pi(e).create({data:t});for(s.consumeTagAndSize(r.Segment.Cues);s.moreData()&&s.consumeTagAndSize(r.Segment.Cues.CuePoint,!0);){for(n={},n.CueTime=s.parseTag(r.Segment.Cues.CuePoint.CueTime),n.CueTracks=[];s.moreData()&&s.consumeTag(r.Segment.Cues.CuePoint.CueTrackPositions,!0);){const e=s.getMatroskaCodedNum(),t=s.getPos();if(i={},i.Track=s.parseTag(r.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===i.Track)throw new Error("Cue track cannot be 0");i.ClusterPosition=s.parseTag(r.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),n.CueTracks.push(i),s.setPos(t+e)}if(0===n.CueTracks.length)throw new Error("Mandatory cuetrack not found");a.push(n)}if(0===a.length)throw new Error("mandatory cuepoint not found");return a}(t),u=[],d=0,f=l.length;d<f;d+=1)c=new Tt,o=0,o=d<l.length-1?l[d+1].CueTime-l[d].CueTime:s-l[d].CueTime,c.duration=o,c.startTime=l[d].CueTime,c.timescale=1e3,h=l[d].CueTracks[0].ClusterPosition+i,g=d<l.length-1?l[d+1].CueTracks[0].ClusterPosition+i-1:a-1,c.mediaRange=h+"-"+g,u.push(c);return n.debug("Parsed cues: "+u.length+" cues."),u}(t,d,c,o),s(l)},error:function(){n.error("Download Error: Cues "+p.url),s(null)}}),n.debug("Perform cues load: "+p.url+" bytes="+p.range.start+"-"+p.range.end)}(l,d,s,(function(e){o(t,i,e,a)}))},error:function(){o(t,i,null,a)}})},reset:function(){i=null,s=null}},r={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},t}mi.__dashjs_factory_name="WebmSegmentBaseLoader";const Ei=u.getSingletonFactory(mi);function yi(e){e=e||{};const t=this.context,n=e.eventBus,r=e.events,i=e.dashMetrics,a=e.mediaPlayerModel,s=e.errHandler,o=e.baseURLController,l=e.debug,u=e.boxParser,c=e.requestModifier,d=e.errors;let f,h,g;function p(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}function m(e){p(e.mimeType)?g.loadInitialization(e.streamId,e.mediaType,e.representation):h.loadInitialization(e.streamId,e.mediaType,e.representation)}function E(e){p(e.mimeType)?g.loadSegments(e.streamId,e.mediaType,e.representation,e.representation?e.representation.indexRange:null,e.callback):h.loadSegments(e.streamId,e.mediaType,e.representation,e.representation?e.representation.indexRange:null,e.callback)}return f={initialize:function(){n.on(r.SEGMENTBASE_INIT_REQUEST_NEEDED,m,f),n.on(r.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,E,f),h.initialize(),g.initialize()},reset:function(){n.off(r.SEGMENTBASE_INIT_REQUEST_NEEDED,m,f),n.off(r.SEGMENTBASE_SEGMENTSLIST_REQUEST_NEEDED,E,f)}},h=hi(t).getInstance(),g=Ei(t).getInstance(),h.setConfig({baseURLController:o,dashMetrics:i,mediaPlayerModel:a,errHandler:s,eventBus:n,events:r,errors:d,debug:l,boxParser:u,requestModifier:c}),g.setConfig({baseURLController:o,dashMetrics:i,mediaPlayerModel:a,errHandler:s,eventBus:n,events:r,errors:d,debug:l,requestModifier:c}),f}yi.__dashjs_factory_name="SegmentBaseController";const _i=u.getSingletonFactory(yi),Ti=class{constructor(){this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null}},vi=class{constructor(){this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.lang=null,this.viewpoint=null,this.accessibility=null,this.audioChannelConfiguration=null,this.roles=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null}},Si=class{constructor(){this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0}};function Ai(){let e,t;const n=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(s.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(s.PUBLISH_TIME)?new Date(e[s.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(s.ORIGINAL_PUBLISH_TIME)?new Date(e[s.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[s.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map((e=>{let n=Object.keys(e)[0];if("add"!==n&&"remove"!==n&&"replace"!==n)return t.warn(`Ignoring node of invalid action: ${n}`),null;let r=e[n],i=r.sel;if("add"===n&&r.type){if(!r.type.startsWith("@"))return t.warn(`Ignoring add action for prefixed namespace declaration: ${r.type}=${r.__text}`),null;i=`${i}/${r.type}`}let a=new class{constructor(e){this.valid="/"==e[0],this.path=e.split("/").filter((e=>0!==e.length)).map((e=>{let t={name:e},n=e.indexOf("[");if(-1!=n){t.name=e.substring(0,n);let r=e.substring(n+1,e.length-1);this.valid=this.valid&&-1==r.indexOf("[");let i=r.indexOf("=");-1!=i?(t.attribute={name:r.substring(1,i),value:r.substring(i+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(r,10)-1}return t}))}isValid(){return this.valid}findsElement(){return!this.findsAttribute()}findsAttribute(){return this.path[this.path.length-1].name.startsWith("@")}getMpdTarget(e,t){let n=null,r=e,i=1,a="MPD";for(;i<this.path.length&&null!==r;){n=r;let e=this.path[i];if(a=e.name,i!==this.path.length-1||!a.startsWith("@")){let t=n[a+"_asArray"]||[];if(0===t.length&&n[a]&&t.push(n[a]),e.position)r=t[e.position]||null;else if(e.attribute){let n=e.attribute;r=t.filter((e=>e[n.name]==n.value))[0]||null}else r=t[0]||null}i++}return null===r?null:a.startsWith("@")?{name:a.substring(1),leaf:r,target:r}:{name:a,leaf:r,target:t?n:r}}}(i);if(!a.isValid())return t.warn(`Ignoring action with invalid selector: ${n} - ${i}`),null;let s=null;a.findsAttribute()?s=r.__text||"":"remove"!==n&&(s=r.__children.reduce(((e,t)=>{let n=Object.keys(t)[0];return"#text"!==n&&(e[n]=e[n]||[],e[n].push(t[n])),e}),{}));let o=new class{constructor(e,t,n){this.action=e,this.xpath=t,this.value=n,this.position=null}getMpdTarget(e){let t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}(n,a,s);return"add"===n&&(o.position=r.pos),o})).filter((e=>!!e)):[]}},t=_(n).getInstance().getLogger(e),e}Ai.__dashjs_factory_name="PatchManifestModel";const Ri=u.getSingletonFactory(Ai);function bi(){let e,t,n,r,i,a,o,l;const u=this.context;function c(e,n,i){const o=t.getAdaptationsForType(r[0].mpd.manifest,e,n);if(!o||0===o.length)return null;if(o.length>1&&i){const e=f(i,n);if(a[i.id]&&a[i.id][n])for(let t=0,r=o.length;t<r;t++)if(d(a[i.id][n],e[t]))return o[t];for(let e=0,n=o.length;e<n;e++)if(l=o[e],t.getRolesForAdaptation(l).filter((function(e){return e.value===s.MAIN}))[0])return o[e]}var l;return o[0]}function d(e,t){if(!e||!t)return!1;const n=e.id===t.id,r=e.viewpoint===t.viewpoint,i=e.lang===t.lang,a=e.roles.toString()===t.roles.toString(),s=e.accessibility.toString()===t.accessibility.toString(),o=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString();return n&&r&&i&&a&&s&&o}function f(e,n,a){let s,l,u,c,d,f,g,p=r,m=a,E=[];if(m)S(),p=h(m);else{if(!(r.length>0))return E;m=r[0].mpd.manifest}const v=y(e,p);v&&(g=v.id);const A=t.getAdaptationsForType(m,e?e.index:null,n!==o.EMBEDDED_TEXT?n:o.VIDEO);if(!A||0===A.length)return E;for(i[g]=i[g]||t.getAdaptationsForPeriod(v),c=0,f=A.length;c<f;c++)if(s=A[c],u=t.getIndexForAdaptation(s,m,e.index),l=_(i[g][u]),n===o.EMBEDDED_TEXT){let e=l.accessibility.length;for(d=0;d<e;d++){if(!l)continue;let e=l.accessibility[d];if(0===e.indexOf("cea-608:")){let t=e.substring(8).split(";");if("CC"===t[0].substring(0,2))for(d=0;d<t.length;d++)l||(l=_.call(this,i[g][u])),T(l,t[d].substring(0,3),t[d].substring(4)),E.push(l),l=null;else for(d=0;d<t.length;d++)l||(l=_.call(this,i[g][u])),T(l,"CC"+(d+1),t[d]),E.push(l),l=null}else 0===e.indexOf("cea-608")&&(T(l,o.CC1,"eng"),E.push(l),l=null)}}else n===o.IMAGE?(l.type=o.IMAGE,E.push(l),l=null):l&&E.push(l);return E}function h(e){const n=g(e);return t.getRegularPeriods(n)}function g(e){const n=m(e);return t.getMpd(n)}function p(){r=[],i={},a={}}function m(e){return e||(r.length>0?r[0].mpd.manifest:null)}function E(e){return e&&e.streamInfo&&void 0!==e.streamInfo.id&&i[e.streamInfo.id]?i[e.streamInfo.id][e.index]:null}function y(e,t){const n=t.length;for(let r=0;r<n;r++){let n=t[r];if(e&&e.id===n.id)return n}return null}function _(e){if(!e)return null;let n=new vi;const r=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];let i;return n.id=e.id,n.index=e.index,n.type=e.type,n.streamInfo=v(e.period),n.representationCount=t.getRepresentationCount(r),n.labels=t.getLabelsForAdaptation(r),n.lang=t.getLanguageForAdaptation(r),i=t.getViewpointForAdaptation(r),n.viewpoint=i?i.value:void 0,n.accessibility=t.getAccessibilityForAdaptation(r).map((function(e){let t=e.value,r=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==l&&(r=t?"cea-608:"+t:"cea-608",n.embeddedCaptions=!0),r})),n.audioChannelConfiguration=t.getAudioChannelConfigurationForAdaptation(r).map((function(e){return e.value})),0===n.audioChannelConfiguration.length&&Array.isArray(r.Representation_asArray)&&r.Representation_asArray.length>0&&(n.audioChannelConfiguration=t.getAudioChannelConfigurationForRepresentation(r.Representation_asArray[0]).map((function(e){return e.value}))),n.roles=t.getRolesForAdaptation(r).map((function(e){return e.value})),n.codec=t.getCodec(r),n.mimeType=t.getMimeType(r),n.contentProtection=t.getContentProtectionData(r),n.bitrateList=t.getBitrateListForAdaptation(r),n.contentProtection&&n.contentProtection.forEach((function(e){e.KID=t.getKID(e)})),n.isText=t.getIsTextTrack(n.mimeType),n.supplementalProperties=t.getSupplementalPropperties(r),n}function T(e,t,n){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=o.EMBEDDED_TEXT,e.codec="cea-608-in-SEI",e.isText=!0,e.isEmbedded=!0,e.lang=n,e.roles=["caption"]}function v(e){let n=new Si;return n.id=e.id,n.index=e.index,n.start=e.start,n.duration=e.duration,n.manifestInfo=function(e){let n=new class{constructor(){this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null}};return n.DVRWindowSize=e.timeShiftBufferDepth,n.loadedTime=e.manifest.loadedTime,n.availableFrom=e.availabilityStartTime,n.minBufferTime=e.manifest.minBufferTime,n.maxFragmentDuration=e.maxSegmentDuration,n.duration=t.getDuration(e.manifest),n.isDynamic=t.getIsDynamic(e.manifest),n.serviceDescriptions=t.getServiceDescriptions(e.manifest),n.protocol=e.manifest.protocol,n}(e.mpd),n.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(n.start+n.duration-n.manifestInfo.duration)<1,n}function S(){if(!o)throw new Error("setConfig function has to be called previously")}function A(e){return r.length>0?r[0].mpd.manifest.Period_asArray[e]:null}function R(e,t,n){let r,i,a,s,o,l;if(e)for(i=e.AdaptationSet_asArray,o=0;o<i.length;o+=1)for(r=i[o],s=r.Representation_asArray,l=0;l<s.length;l+=1)if(a=s[l],t===a.id)return n?l:a;return null}return e={getBandwidthForRepresentation:function(e,t){let n;return n=R(A(t),e),n?n.bandwidth:null},getIndexForRepresentation:function(e,t){return function(e,t){const n=R(e,t,!0);return null!==n?n:-1}(A(t),e)},getMaxIndexForBufferType:function(e,n){return function(e,n){let r,i,a,s;if(!e||!n)return-1;for(i=e.AdaptationSet_asArray,s=0;s<i.length;s+=1)if(r=i[s],a=r.Representation_asArray,t.getIsTypeOf(r,n))return a.length;return-1}(A(n),e)},convertDataToRepresentationInfo:function(e){if(e){let n=new Ti;const r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],i=t.getRepresentationFor(e.index,r);return n.id=e.id,n.quality=e.index,n.bandwidth=t.getBandwidth(i),n.DVRWindow=e.segmentAvailabilityRange,n.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),n.MSETimeOffset=e.MSETimeOffset,n.mediaInfo=_(e.adaptation),n}return null},getDataForMedia:E,getStreamsInfo:function(e,t){const n=[];let i=r;if(e&&(S(),i=h(e)),i.length>0){(!t||t>i.length)&&(t=i.length);for(let e=0;e<t;e++)n.push(v(i[e]))}return n},getMediaInfoForType:function(e,n){if(0===r.length||!e)return null;let a=y(e,r);if(!a)return null;let s=a.id;i[s]=i[s]||t.getAdaptationsForPeriod(a);let o=c(e.index,n,e);if(!o)return null;let l=t.getIndexForAdaptation(o,r[0].mpd.manifest,e.index);return _(i[s][l])},getAllMediaInfoForType:f,getAdaptationForType:c,getRealAdaptation:function(e,n){let i,a;const s=y(e,r);return i=n?n.id:null,r.length>0&&s&&(a=i?t.getAdaptationForId(i,r[0].mpd.manifest,s.index):t.getAdaptationForIndex(n?n.index:null,r[0].mpd.manifest,s.index)),a},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,r[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}},getVoRepresentations:function(e){let n;const r=E(e);return n=t.getRepresentationsForAdaptation(r),n},getEventsFor:function(e,n){let i=[];if(r.length>0){const a=r[0].mpd.manifest;e instanceof Si?i=t.getEventsForPeriod(y(e,r)):e instanceof vi?i=t.getEventStreamForAdaptationSet(a,E(e)):e instanceof Ti&&(i=t.getEventStreamForRepresentation(a,n))}return i},getEvent:function(e,t,n,r){try{if(!e||!t||isNaN(n)||!r)return null;const i=e.scheme_id_uri,a=e.value;if(!t[i+"/"+a])return null;const s=new fn,o=e.timescale||1,l=r.adaptation.period.start,u=t[i+"/"+a],c=isNaN(r.presentationTimeOffset)?isNaN(u.presentationTimeOffset)?0:u.presentationTimeOffset:r.presentationTimeOffset;let d,f=e.presentation_time_delta/o;d=0===e.version?l+n-c+f:l-c+f;const h=e.event_duration,g=e.id,p=e.message_data;return s.eventStream=u,s.eventStream.value=a,s.eventStream.timescale=o,s.duration=h,s.id=g,s.calculatedPresentationTime=d,s.messageData=p,s.presentationTimeDelta=f,s}catch(e){return null}},getMpd:g,setConfig:function(e){e&&(e.constants&&(o=e.constants),e.cea608parser&&(l=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;S(),r=h(e),i={}},getIsTextTrack:function(e){return t.getIsTextTrack(e)},getUTCTimingSources:function(){const e=m();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){const e=r.length>0?r[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){const n=g(e);return t.getAvailabilityStartTime(n)},getIsTypeOf:function(e,n){return t.getIsTypeOf(e,n)},getIsDynamic:function(e){const n=m(e);return t.getIsDynamic(n)},getDuration:function(e){const n=m(e);return t.getDuration(n)},getRegularPeriods:h,getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){const n=t.getPatchLocation(e),r=t.getPublishTime(e);if(!n||!r)return null;if(n.hasOwnProperty("ttl")&&r){const e=1e3*parseFloat(n.ttl);if(r.getTime()+e<=(new Date).getTime())return null}return n.__text},getManifestUpdatePeriod:function(e,n=0){return t.getManifestUpdatePeriod(e,n)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return n.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,n,r){return t.getCodec(e,n,r)},getVoAdaptations:function(){return i},getVoPeriods:function(){return r},getPeriodById:function(e){if(!e||0===r.length)return null;const t=r.filter((t=>t.id===e));return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,n){a[e]=a[e]||{},a[e][t]=a[e][t]||{},a[e][t]=n},isPatchValid:function(e,r){let i=t.getId(e),a=n.getMpdId(r),s=t.getPublishTime(e),o=n.getPublishTime(r),l=n.getOriginalPublishTime(r);return!!(i&&a&&i==a&&s&&l&&s.getTime()==l.getTime()&&o&&s.getTime()<o.getTime())},applyPatchToManifest:function(e,t){n.getPatchOperations(t).forEach((t=>{let n=t.getMpdTarget(e);if(null===n)return;let{name:r,target:i,leaf:a}=n;if(t.xpath.findsAttribute()){switch(t.action){case"add":case"replace":i[r]=t.value;break;case"remove":delete i[r]}return}let s=(i[r+"_asArray"]||[]).indexOf(a),o="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete i[r],-1!=s)){let e=i[r+"_asArray"];e.splice(s,1),e.length>1?i[r]=e:1==e.length?i[r]=e[0]:delete i[r+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach((e=>{let n=t.value[e],a=i[e+"_asArray"]||[];if(0===a.length&&i[e]&&a.push(i[e]),0===a.length)a=n;else{let i=a.length;i=e==r&&-1!=s?s+(o?0:1)+("replace"==t.action?-1:0):o?0:a.length,a.splice.apply(a,[i,0].concat(n))}i[e+"_asArray"]=a,i[e]=1==a.length?a[0]:a}))}))},reset:p},t=Rn(u).getInstance(),n=Ri(u).getInstance(),p(),e}bi.__dashjs_factory_name="DashAdapter";const Ii=u.getSingletonFactory(bi);class Di{constructor(){this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]}}class wi{constructor(){this.id=null,this.index=null,this.start=null,this.duration=null}}class Ci{constructor(){this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null}}function Ni(e){const t=(e=e||{}).settings;let n,r,i=this.context,s=g(i).getInstance();function l(){s.trigger(m.METRICS_CHANGED)}function u(e){s.trigger(m.METRIC_CHANGED,{mediaType:e}),l()}function c(e,t,n){s.trigger(m.METRIC_UPDATED,{mediaType:e,metric:t,value:n}),u(e)}function d(e,t,n){s.trigger(m.METRIC_ADDED,{mediaType:e,metric:t,value:n}),u(e)}function f(e,t){let n=null;return e?(r.hasOwnProperty(e)?n=r[e]:t||(n=new class{constructor(){this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]}},r[e]=n),n):n}function h(e,n,r){let i=f(e);null!==i&&(i[n].push(r),i[n].length>t.get().streaming.metricsMaxListDepth&&i[n].shift())}function p(e,t,n){h(e,t,n),d(e,t,n)}return n={clearCurrentMetricsForType:function(e){delete r[e],u(e)},clearAllCurrentMetrics:function(){r={},l()},getMetricsFor:f,addHttpRequest:function e(t,n,r,i,a,s,l,u,c,d,f,h,g,m,E){let y=new S;s&&s!==i&&(e(t,null,r,i,a,null,null,u,c,null,null,null,g,null,null),y.actualurl=s),y.tcpid=n,y.type=r,y.url=i,y.range=u,y.trequest=c,y.tresponse=d,y.responsecode=h,y._tfinish=f,y._stream=t,y._mediaduration=g,y._quality=a,y._responseHeaders=m,y._serviceLocation=l,E?E.forEach((e=>{!function(e,t,n,r){let i=new A;i.s=t,i.d=n,i.b=r,e.trace.push(i),e.interval||(e.interval=0),e.interval+=n}(y,e.s,e.d,e.b)})):(delete y.interval,delete y.trace),p(t,o.HTTP_REQUEST,y)},addRepresentationSwitch:function(e,t,n,r,i){let a=new class{constructor(){this.t=null,this.mt=null,this.to=null,this.lto=null}};a.t=t,a.mt=n,a.to=r,i?a.lto=i:delete a.lto,p(e,o.TRACK_SWITCH,a)},addBufferLevel:function(e,t,n){let r=new class{constructor(){this.t=null,this.level=null}};r.t=t,r.level=n,p(e,o.BUFFER_LEVEL,r)},addBufferState:function(e,t,n){let r=new class{constructor(){this.target=null,this.state=o.BUFFER_EMPTY}};r.target=n,r.state=t,p(e,o.BUFFER_STATE,r)},addDVRInfo:function(e,t,n,r){let i=new class{constructor(){this.time=null,this.range=null,this.manifestInfo=null}};i.time=t,i.range=r,i.manifestInfo=n,p(e,o.DVR_INFO,i)},addDroppedFrames:function(e,t){let n=new class{constructor(){this.time=null,this.droppedFrames=null}},r=f(e).DroppedFrames;t&&(n.time=t.creationTime,n.droppedFrames=t.droppedVideoFrames,r.length>0&&r[r.length-1]==n||p(e,o.DROPPED_FRAMES,n))},addSchedulingInfo:function(e,t,n,r,i,a,s,l,u){let c=new class{constructor(){this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null}};c.mediaType=e,c.t=t,c.type=n,c.startTime=r,c.availabilityStartTime=i,c.duration=a,c.quality=s,c.range=l,c.state=u,p(e,o.SCHEDULING_INFO,c)},addRequestsQueue:function(e,t,n){let r=new class{constructor(){this.loadingRequests=[],this.executedRequests=[]}};r.loadingRequests=t,r.executedRequests=n,f(e).RequestsQueue=r,d(e,o.REQUESTS_QUEUE,r)},addManifestUpdate:function(e,t,n,r,i,s,l,u,c,f){let g=new Di;g.mediaType=e,g.type=t,g.requestTime=n,g.fetchTime=r,g.availabilityStartTime=i,g.presentationStartTime=s,g.clientTimeOffset=l,g.currentTime=u,g.buffered=c,g.latency=f,h(a.STREAM,o.MANIFEST_UPDATE,g),d(e,o.MANIFEST_UPDATE,g)},updateManifestUpdateInfo:function(e,t){if(e){for(let n in t)e[n]=t[n];c(e.mediaType,o.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,n,r,i){if(e){let a=new wi;a.id=t,a.index=n,a.start=r,a.duration=i,e.streamInfo.push(a),c(e.mediaType,o.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,n,r,i,a,s,l){if(e&&e.representationInfo){const u=new Ci;u.id=t,u.index=n,u.streamIndex=r,u.mediaType=i,u.startNumber=s,u.fragmentInfoType=l,u.presentationTimeOffset=a,e.representationInfo.push(u),c(e.mediaType,o.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach((e=>{e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel})):delete e.trace,p(a.STREAM,o.PLAY_LIST,e)},addDVBErrors:function(e){p(a.STREAM,o.DVB_ERRORS,e)}},r={},n}Ni.__dashjs_factory_name="MetricsModel";const Li=u.getSingletonFactory(Ni);function Mi(e){e=e||{};const t=this.context;let n,r,i,s,l=e.metricsModel;function u(e){const t=l.getMetricsFor(e,!0);if(!t)return null;const n=t.HttpList;let r,i=null;if(!n||n.length<=0)return null;for(r=n.length-1;r>=0;){if(n[r].responsecode){i=n[r];break}r--}return i}function c(e){const t=l.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function d(e,t){if(!e)return null;const n=e[t];return n&&0!==n.length?n[n.length-1]:null}return n={getCurrentRepresentationSwitch:function(e){return d(l.getMetricsFor(e,!0),o.TRACK_SWITCH)},getCurrentBufferState:function(e){return d(l.getMetricsFor(e,!0),o.BUFFER_STATE)},getCurrentBufferLevel:function(e){const t=d(l.getMetricsFor(e,!0),o.BUFFER_LEVEL);return t?class{static round10(e,t){return function(e,t,n){return void 0===n||0==+n?Math.round(t):(n=+n,null===(t=+t)||isNaN(t)||"number"!=typeof n||n%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-n:-n)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+n:n))))}(0,e,t)}}.round10(t.level/1e3,-3):0},getCurrentHttpRequest:u,getHttpRequests:c,getCurrentDroppedFrames:function(){return d(l.getMetricsFor(a.VIDEO,!0),o.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return d(l.getMetricsFor(e,!0),o.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return d(e?l.getMetricsFor(e,!0):l.getMetricsFor(a.VIDEO,!0)||l.getMetricsFor(a.AUDIO,!0),o.DVR_INFO)},getCurrentManifestUpdate:function(){return d(l.getMetricsFor(a.STREAM),o.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){let n={},r=u(e);return r&&(n=en.parseHttpHeaders(r._responseHeaders)),void 0===n[t]?null:n[t]},getLatestMPDRequestHeaderValueByID:function(e){let t,n,r,i={};for(t=c(a.STREAM),r=t.length-1;r>=0;r--)if(n=t[r],n.type===S.MPD_TYPE){i=en.parseHttpHeaders(n._responseHeaders);break}return void 0===i[e]?null:i[e]},addRepresentationSwitch:function(e,t,n,r,i){l.addRepresentationSwitch(e,t,n,r,i)},addDVRInfo:function(e,t,n,r){l.addDVRInfo(e,t,n,r)},updateManifestUpdateInfo:function(e){const t=this.getCurrentManifestUpdate();l.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){const t=this.getCurrentManifestUpdate();l.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){const n=this.getCurrentManifestUpdate();l.addManifestUpdateRepresentationInfo(n,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){l.addManifestUpdate(a.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,n,r,i){l.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,n,e.duration,r,i)},addSchedulingInfo:function(e,t){l.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,n){l.addRequestsQueue(e,t,n)},addBufferLevel:function(e,t,n){l.addBufferLevel(e,t,n)},addBufferState:function(e,t,n){l.addBufferState(e,t,n)},addDroppedFrames:function(e){l.addDroppedFrames(a.VIDEO,e)},addPlayList:function(){s&&(l.addPlayList(s),s=null)},addDVBErrors:function(e){l.addDVBErrors(e)},createPlaylistMetrics:function(e,t){s=new zt,s.start=new Date,s.mstart=e,s.starttype=t},createPlaylistTraceMetrics:function(e,t,n){!0===r&&(r=!1,i=new Wt,i.representationid=e,i.start=new Date,i.mstart=t,i.playbackspeed=null!==n?n.toString():null)},updatePlayListTraceMetrics:function(e){if(i)for(let t in i)i[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===r&&s&&i&&i.start){const n=i.start,a=e.getTime()-n.getTime();i.duration=a,i.stopreason=t,s.trace.push(i),r=!0}},clearAllCurrentMetrics:function(){l.clearAllCurrentMetrics()}},l=l||Li(t).getInstance({settings:e.settings}),r=!0,i=null,s=null,n}Mi.__dashjs_factory_name="DashMetrics";const Oi=u.getSingletonFactory(Mi);function Pi(){const e=this.context,t=g(e).getInstance(),n=nn(e).getInstance();let r,i,a,o,l;function u(e){a=e}function c(e,t,n,r){let i=NaN;return i=r?n&&t.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(t.availabilityStartTime.getTime()+1e3*(e+t.timeShiftBufferDepth)):t.availabilityEndTime:n?new Date(t.availabilityStartTime.getTime()+1e3*(e-a)):t.availabilityStartTime,i}function d(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*a)/1e3}function f(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function h(e){void 0!==e.offset&&(u(e.offset/1e3),o=!0)}function p(){a=0,o=!1,l=NaN}function E(){t.off(m.UPDATE_TIME_SYNC_OFFSET,h,this),p()}return r={initialize:function(){p(),t.on(m.UPDATE_TIME_SYNC_OFFSET,h,this)},getClientTimeOffset:function(){return a},setClientTimeOffset:u,getExpectedLiveEdge:function(){return l},setExpectedLiveEdge:function(e){l=e},calcAvailabilityStartTimeFromPresentationTime:function(e,t,n){return c.call(this,e,t,n)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,n){return c.call(this,e,t,n,!0)},calcPresentationTimeFromWallTime:d,calcPresentationTimeFromMediaTime:f,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcSegmentAvailabilityRange:function(e,t){const r=e.adaptation.period,a={start:r.start,end:r.start+r.duration};if(!t)return a;if(!o&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;const l=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0);if(e.segmentInfoType===s.SEGMENT_TIMELINE&&n.get().streaming.calcSegmentAvailabilityRangeFromTimeline)return function(e){const t=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],n=i.getRepresentationFor(e.index,t),r=n.SegmentTemplate.SegmentTimeline,a=n.SegmentTemplate.timescale,s=r.S_asArray,o={start:0,end:0};let l,u,c,d,h=0;for(o.start=f(s[0].t/a,e),c=0,d=s.length;c<d;c++)l=s[c],u=0,l.hasOwnProperty("r")&&(u=l.r),h+=l.d/a*(1+u);return o.end=o.start+h,o}(e);const u=d(new Date,r),c=r.start+r.duration;a.start=Math.max(u-r.mpd.timeShiftBufferDepth,r.start);const h=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<l?l-e.availabilityTimeOffset:l;return a.end=u>=c&&u-h<c?c:u-h,a},getPeriodEnd:function(e,t){const n=e.adaptation.period;if(!t)return n.start+n.duration;if(!o&&e.segmentAvailabilityRange)return e.segmentAvailabilityRange;const r=e.segmentDuration||(e.segments&&e.segments.length?e.segments[e.segments.length-1].duration:0),i=d(new Date,n),a=n.start+n.duration,s=void 0!==e.availabilityTimeOffset&&e.availabilityTimeOffset<r?r-e.availabilityTimeOffset:r;return Math.min(i-s,a)},calcWallTimeForSegment:function(e,t){let n,r,i;return t&&(n=e.representation.adaptation.period.mpd.suggestedPresentationDelay,r=e.presentationStartTime+n,i=new Date(e.availabilityStartTime.getTime()+1e3*r)),i},reset:E},i=Rn(e).getInstance(),E(),r}Pi.__dashjs_factory_name="TimelineConverter";const xi=u.getSingletonFactory(Pi);var Fi=n(4915);function ki(){const e="You must first call initialize() and set a source before calling this method",t="You must first call initialize() and set a valid source and view before calling this method",n="You must first call attachView() to set the video element before calling this method",r="You must first call attachSource() with a valid source before calling this method",l="MediaPlayer not initialized!",c=this.context,f=g(c).getInstance();let h=nn(c).getInstance();const p=_(c).getInstance({settings:h});let E,y,T,A,R,b,I,D,w,C,N,L,O,P,x,F,U,B,K,H,Y,V,j,W,$,X,J,Z,ee,te,ne,re,ie,ae,oe,le;function ue(){Ae(null),Te(null),A=null,O&&(O.reset(),O=null),P&&(P.reset(),P=null),ie.reset(),h.reset(),F&&(F.reset(),F=null)}function ce(){return!!T&&!!ee.getElement()}function de(){return"3.2.2"}function fe(){if(!I)throw t;return $.isPaused()}function he(e){let t=X.getCurrentDVRInfo();if(!t)return 0;let n=$.getLiveDelay(),r=t.range.start+e;return r>t.range.end-n&&(r=t.range.end-n),r}function ge(e){if(!I)throw t;let n=_e().currentTime;if(void 0!==e)n=j.getTimeRelativeToStreamId(n,e);else if($.getIsDynamic()){let e=X.getCurrentDVRInfo();n=null===e||0===n?0:Math.max(0,n-e.range.start)}return n}function pe(){if(!I)throw t;let e=_e().duration;if($.getIsDynamic()){let t=X.getCurrentDVRInfo();e=t?t.range.end-t.range.start:0}return e}function me(e){q(e,"boolean"),D=e}function Ee(){B.restoreDefaultUTCTimingSources()}function ye(){return X}function _e(){if(!ee.getElement())throw n;return ee.getElement()}function Te(e){if(!R)throw l;ee.setElement(e),e&&(De(),function(){if(P)return;let e=dashjs.MetricsReporting;if("function"==typeof e){let t=e(c).create();P=t.createMetricsReporting({debug:p,eventBus:f,mediaElement:_e(),adapter:U,dashMetrics:X,events:m,constants:a,metricsConstants:o})}}(),function(){if(x)return;let e=dashjs.MssHandler;"function"==typeof e&&(Q.extend(e.errors),x=e(c).create({eventBus:f,mediaPlayerModel:B,dashMetrics:X,manifestModel:J,playbackController:$,streamController:j,protectionController:O,baseURLController:H,errHandler:K,events:m,constants:a,debug:p,initSegmentType:S.INIT_SEGMENT_TYPE,BASE64:Fi,ISOBoxer:k,settings:h}))}(),j&&j.switchToVideoElement()),I&&be(),Ne()}function ve(t){if(!b)throw e;let n=j.getActiveStreamInfo();return L.getTracksFor(t,n)}function Se(e,t){let n=-1;e.some(((e,r)=>{if(e===t)return n=r,!0})),n<0||e.splice(n,1)}function Ae(e){if(!R)throw l;"string"==typeof e&&ne.initialize(e),T=e,(b||I)&&be(),ce()&&Ne()}function Re(){if(!b)throw e;let t=j.getActiveStreamInfo();return t?j.getStreamById(t.id):null}function be(){I=!1,b=!1,U.reset(),j.reset(),W.reset(),$.reset(),w.reset(),L.reset(),te.reset(),O&&(h.get().streaming.keepProtectionMediaKeys?O.stop():(O.reset(),O=null,De())),Z.reset()}function Ie(){return qr(c).create({debug:p,errHandler:K,dashMetrics:X,mediaPlayerModel:B,requestModifier:Kt(c).getInstance(),mssHandler:x,settings:h})}function De(){if(O)return O;let e=dashjs.Protection;if("function"==typeof e){let t=e(c).create();return m.extend(e.events),d.extend(e.events,{publicOnly:!0}),Q.extend(e.errors),Y||(Y=zr(c).getInstance()),O=t.createProtectionSystem({debug:p,errHandler:K,videoModel:ee,capabilities:Y,eventBus:f,events:m,BASE64:Fi,constants:a,cmcdModel:Z,settings:h}),O&&(O.setLicenseRequestFilters(ae),O.setLicenseResponseFilters(oe)),O}return null}function we(){if(!R)throw l;if(F)return F;let e=dashjs.OfflineController;if("function"==typeof e){m.extend(e.events),d.extend(e.events,{publicOnly:!0}),Q.extend(e.errors);const t=Ie(),n=Hn(c).create();return n.setConfig({manifestModel:J,adapter:U,manifestLoader:t,errHandler:K}),F=e(c).create({debug:p,manifestUpdater:n,baseURLController:H,manifestLoader:t,manifestModel:J,mediaPlayerModel:B,abrController:w,playbackController:$,adapter:U,errHandler:K,dashMetrics:X,timelineConverter:N,schemeLoaderFactory:C,eventBus:f,events:m,errors:Q,constants:a,settings:h,dashConstants:s,urlUtils:jt(c).getInstance()}),F}return null}function Ce(e){let t,n,r=X.getCurrentDVRInfo();return r?(t=r.manifestInfo.availableFrom.getTime()/1e3,n=e+(t+r.range.start),n):0}function Ne(){F&&F.resetRecords(),!b&&T&&(b=!0,y.info("Streaming Initialized"),function(){const e=Ie();j||(j=Jn(c).getInstance()),V.setConfig({capabilities:Y,adapter:U,settings:h}),V.setCustomCapabilitiesFilters(le),j.setConfig({capabilities:Y,capabilitiesFilter:V,manifestLoader:e,manifestModel:J,mediaPlayerModel:B,protectionController:O,adapter:U,dashMetrics:X,errHandler:K,timelineConverter:N,videoModel:ee,playbackController:$,abrController:w,mediaController:L,textController:te,settings:h,baseURLController:H}),W.setConfig({settings:h,playbackController:$,streamController:j,videoModel:ee,timelineConverter:N,adapter:U}),$.setConfig({streamController:j,dashMetrics:X,mediaPlayerModel:B,adapter:U,videoModel:ee,timelineConverter:N,uriFragmentModel:ne,settings:h}),w.setConfig({streamController:j,domStorage:re,mediaPlayerModel:B,dashMetrics:X,adapter:U,videoModel:ee,settings:h}),te.setConfig({errHandler:K,manifestModel:J,adapter:U,mediaController:L,streamController:j,videoModel:ee}),Z.setConfig({abrController:w,dashMetrics:X,playbackController:$}),j.initialize(D,A),W.initialize(),Z.initialize()}(),"string"==typeof T?j.load(T):j.loadWithManifest(T)),!I&&ce()&&(I=!0,y.info("Playback Initialized"))}return E={initialize:function(e,t,n){Y||(Y=zr(c).getInstance()),K=Hr(c).getInstance(),Y.supportsMediaSource()?R||(R=!0,N=xi(c).getInstance(),w||(w=et(c).getInstance(),w.setConfig({settings:h})),C||(C=Nn(c).getInstance()),$||($=v(c).getInstance()),L||(L=rr(c).getInstance()),j||(j=Jn(c).getInstance()),W||(W=er(c).getInstance()),V||(V=$r(c).getInstance()),U=Ii(c).getInstance(),J=Zr(c).getInstance(),Z=In(c).getInstance(),X=Oi(c).getInstance({settings:h}),te=se(c).getInstance(),re=di(c).getInstance({settings:h}),U.setConfig({constants:a,cea608parser:i(),errHandler:K,BASE64:Fi}),H||(H=Er(c).create()),H.setConfig({adapter:U}),ie=_i(c).getInstance({dashMetrics:X,mediaPlayerModel:B,errHandler:K,baseURLController:H,events:m,eventBus:f,debug:p,boxParser:G(c).getInstance(),requestModifier:Kt(c).getInstance(),errors:Q}),ie.initialize(),L.setConfig({domStorage:re,settings:h}),Ee(),me(void 0===n||n),we(),e&&Te(e),t&&Ae(t),y.info("[dash.js 3.2.2] MediaPlayer has been initialized")):K.error(new M(Q.CAPABILITY_MEDIASOURCE_ERROR_CODE,Q.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(Y=e.capabilities),e.capabilitiesFilter&&(V=e.capabilitiesFilter),e.streamController&&(j=e.streamController),e.gapController&&(W=e.gapController),e.playbackController&&($=e.playbackController),e.mediaPlayerModel&&(B=e.mediaPlayerModel),e.abrController&&(w=e.abrController),e.schemeLoaderFactory&&(C=e.schemeLoaderFactory),e.mediaController&&(L=e.mediaController),e.settings&&(h=e.settings))},on:function(e,t,n,r){f.on(e,t,n,r)},off:function(e,t,n){f.off(e,t,n)},extend:function(e,t,n){u.extend(e,t,n,c)},attachView:Te,attachSource:Ae,isReady:ce,preload:function(){if(ee.getElement()||b)return!1;if(!T)throw r;Ne()},play:function(){if(!I)throw t;(!D||fe()&&I)&&$.play()},isPaused:fe,pause:function(){if(!I)throw t;$.pause()},isSeeking:function(){if(!I)throw t;return $.isSeeking()},isDynamic:function(){if(!I)throw t;return $.getIsDynamic()},seek:function(e){if(!I)throw t;if(q(e,"number"),isNaN(e))throw a.BAD_ARGUMENT_ERROR;let n=$.getIsDynamic()?he(e):e;$.seek(n)},setPlaybackRate:function(e){_e().playbackRate=e},getPlaybackRate:function(){return _e().playbackRate},setMute:function(e){q(e,"boolean"),_e().muted=e},isMuted:function(){return _e().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw a.BAD_ARGUMENT_ERROR;_e().volume=e},getVolume:function(){return _e().volume},time:ge,duration:pe,timeAsUTC:function(){if(!I)throw t;return ge()<0?NaN:Ce(ge())},durationAsUTC:function(){if(!I)throw t;return Ce(pe())},getActiveStream:Re,getDVRWindowSize:function(){let e=X.getCurrentDVRInfo();return e?e.manifestInfo.DVRWindowSize:0},getDVRSeekOffset:he,convertToTimeCode:function(e){e=Math.max(e,0);let t=Math.floor(e/3600),n=Math.floor(e%3600/60),r=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(n<10?"0"+n.toString():n.toString())+":"+(r<10?"0"+r.toString():r.toString())},formatUTC:function(e,t,n,r=!1){const i=new Date(1e3*e),a=i.toLocaleDateString(t),s=i.toLocaleTimeString(t,{hour12:n});return r?s+" "+a:s},getVersion:de,getDebug:function(){return p},getBufferLength:function(e){const t=[a.VIDEO,a.AUDIO,a.FRAGMENTED_TEXT];if(e){if(-1!==t.indexOf(e)){return ye().getCurrentBufferLevel(e)||NaN}return y.warn("getBufferLength requested for invalid type"),NaN}{const e=t.map((e=>ve(e).length>0?ye().getCurrentBufferLevel(e):Number.MAX_VALUE)).reduce(((e,t)=>Math.min(e,t)));return e===Number.MAX_VALUE?NaN:e}},getTTMLRenderingDiv:function(){return ee?ee.getTTMLRenderingDiv():null},getVideoElement:_e,getSource:function(){if(!T)throw r;return T},getCurrentLiveLatency:function(){if(!R)throw l;return I?$.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(t){if(!b)throw e;return w.getTopBitrateInfoFor(t)},setAutoPlay:me,getAutoPlay:function(){return D},getDashMetrics:ye,getQualityFor:function(t){if(!b)throw e;if(t===a.IMAGE){const e=Re();if(!e)return-1;const t=e.getThumbnailController();return t?t.getCurrentTrackIndex():-1}return w.getQualityFor(t)},setQualityFor:function(t,n){if(!b)throw e;if(t===a.IMAGE){const e=Re();if(!e)return;const t=e.getThumbnailController();t&&t.setTrackByIndex(n)}w.setPlaybackQuality(t,j.getActiveStreamInfo(),n)},updatePortalSize:function(){w.setElementSize(),w.setWindowResizeEventCalled(!0)},setTextDefaultLanguage:function(e){y.warn('setTextDefaultLanguage is deprecated and will be removed in version 3.2.0. Please use setInitialMediaSettingsFor("fragmentedText", { lang: lang }) instead'),void 0===te&&(te=se(c).getInstance()),te.setTextDefaultLanguage(e)},getTextDefaultLanguage:function(){return y.warn('getTextDefaultLanguage is deprecated and will be removed in version 3.2.0. Please use getInitialMediaSettingsFor("fragmentedText").lang instead'),void 0===te&&(te=se(c).getInstance()),te.getTextDefaultLanguage()},setTextDefaultEnabled:function(e){void 0===te&&(te=se(c).getInstance()),te.setTextDefaultEnabled(e)},getTextDefaultEnabled:function(){return void 0===te&&(te=se(c).getInstance()),te.getTextDefaultEnabled()},enableText:function(e){void 0===te&&(te=se(c).getInstance()),te.enableText(e)},enableForcedTextStreaming:function(e){void 0===te&&(te=se(c).getInstance()),te.enableForcedTextStreaming(e)},isTextEnabled:function(){return void 0===te&&(te=se(c).getInstance()),te.isTextEnabled()},setTextTrack:function(e){if(!I)throw t;void 0===te&&(te=se(c).getInstance()),te.setTextTrack(e)},getBitrateInfoListFor:function(t){if(!b)throw e;let n=Re();return n?n.getBitrateListFor(t):[]},getStreamsFromManifest:function(t){if(!b)throw e;return U.getStreamsInfo(t)},getTracksFor:ve,getTracksForTypeFromManifest:function(t,n,r){if(!b)throw e;return(r=r||U.getStreamsInfo(n,1)[0])?U.getAllMediaInfoForType(r,t,n):[]},getCurrentTrackFor:function(t){if(!b)throw e;let n=j.getActiveStreamInfo();return L.getCurrentTrackFor(t,n)},setInitialMediaSettingsFor:function(e,t){if(!R)throw l;L.setInitialSettings(e,t),e===a.FRAGMENTED_TEXT&&te.setInitialSettings(t)},getInitialMediaSettingsFor:function(e){if(!R)throw l;return L.getInitialSettings(e)},setCurrentTrack:function(t){if(!b)throw e;L.setTrack(t)},getTrackSwitchModeFor:function(e){if(!R)throw l;return L.getSwitchMode(e)},setTrackSwitchModeFor:function(e,t){if(!R)throw l;L.setSwitchMode(e,t)},setSelectionModeForInitialTrack:function(e){if(!R)throw l;L.setSelectionModeForInitialTrack(e)},getSelectionModeForInitialTrack:function(){if(!R)throw l;return L.getSelectionModeForInitialTrack()},addABRCustomRule:function(e,t,n){B.addABRCustomRule(e,t,n)},removeABRCustomRule:function(e){B.removeABRCustomRule(e)},removeAllABRCustomRule:function(){B.removeABRCustomRule()},getAverageThroughput:function(e){const t=w.getThroughputHistory();return t?t.getAverageThroughput(e):0},retrieveManifest:function(e,t){let n=Ie(),r=this;const i=function(e){e.error?t(null,e.error):t(e.manifest),f.off(m.INTERNAL_MANIFEST_LOADED,i,r),n.reset()};f.on(m.INTERNAL_MANIFEST_LOADED,i,r),ne.initialize(e),n.load(e)},addUTCTimingSource:function(e,t){B.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){B.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){B.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:Ee,setXHRWithCredentialsForType:function(e,t){B.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return B.getXHRWithCredentialsForType(e)},getProtectionController:function(){return De()},attachProtectionController:function(e){O=e},setProtectionData:function(e){A=e,j&&j.setProtectionData(A)},registerLicenseRequestFilter:function(e){ae.push(e),O&&O.setLicenseRequestFilters(ae)},registerLicenseResponseFilter:function(e){oe.push(e),O&&O.setLicenseResponseFilters(oe)},unregisterLicenseRequestFilter:function(e){Se(ae,e),O&&O.setLicenseRequestFilters(ae)},unregisterLicenseResponseFilter:function(e){Se(oe,e),O&&O.setLicenseResponseFilters(oe)},registerCustomCapabilitiesFilter:function(e){le.push(e),V&&V.setCustomCapabilitiesFilters(le)},unregisterCustomCapabilitiesFilter:function(e){Se(le,e),V&&V.setCustomCapabilitiesFilters(le)},displayCaptionsOnTop:function(e){let t=z(c).getInstance();t.setConfig({videoModel:ee}),t.initialize(),t.setDisplayCConTop(e)},attachTTMLRenderingDiv:function(e){if(!ee.getElement())throw n;ee.setTTMLRenderingDiv(e)},getCurrentTextTrackIndex:function(){let e=NaN;return te&&(e=te.getCurrentTrackIdx()),e},provideThumbnail:function(e,t){if("function"!=typeof t)return;if(e<0)return void t(null);const n=$.getIsDynamic()?he(e):e,r=j.getStreamForTime(n);if(null===r)return void t(null);const i=r.getThumbnailController();if(!i)return void t(null);const a=j.getTimeRelativeToStreamId(n,r.getId());return i.provide(a,t)},getDashAdapter:function(){return U},getOfflineController:function(){return we()},getSettings:function(){return h.get()},updateSettings:function(e){h.update(e)},resetSettings:function(){h.reset()},reset:ue,destroy:function(){ue(),ae=[],oe=[],le=[],u.deleteSingletonInstances(c)}},y=p.getLogger(E),R=!1,I=!1,b=!1,D=!0,O=null,F=null,A=null,U=null,ie=null,m.extend(d),B=ti(c).getInstance(),ee=ri(c).getInstance(),ne=Qr(c).getInstance(),ae=[],oe=[],le=[],E}ki.__dashjs_factory_name="MediaPlayer";const Ui=u.getClassFactory(ki);Ui.events=d,Ui.errors=Q,u.updateClassFactory(ki.__dashjs_factory_name,Ui);const Bi=Ui;var Gi="undefined"!=typeof window&&window||n.g,qi=Gi.dashjs;qi||(qi=Gi.dashjs={}),qi.MediaPlayer=Bi,qi.FactoryMaker=u,qi.Debug=_,qi.Version="3.2.2";class Ki{constructor(){this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null}}Ki.SSL_CONNECTION_FAILED_PREFIX="SSL",Ki.DNS_RESOLUTION_FAILED="C00",Ki.HOST_UNREACHABLE="C01",Ki.CONNECTION_REFUSED="C02",Ki.CONNECTION_ERROR="C03",Ki.CORRUPT_MEDIA_ISOBMFF="M00",Ki.CORRUPT_MEDIA_OTHER="M01",Ki.BASE_URL_CHANGED="F00",Ki.BECAME_REPORTER="S00";const Hi=Ki;function Yi(e){let t,n;const r=(e=e||{}).eventBus,i=e.dashMetrics,a=e.metricsConstants,s=e.events;function o(e){let t=new Hi;if(n){for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.mpdurl||(t.mpdurl=n.originalUrl||n.url),t.terror||(t.terror=new Date),i.addDVBErrors(t)}}function l(e){e.error||(n=e.manifest)}function u(e){o({errorcode:Hi.BASE_URL_CHANGED,servicelocation:e.entry})}function c(){o({errorcode:Hi.BECAME_REPORTER})}function d(e){var t;e.metric===a.HTTP_REQUEST&&(0===(t=e.value).responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&o({errorcode:t.responsecode||Hi.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}function f(e){let t;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=Hi.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=Hi.CORRUPT_MEDIA_OTHER;break;default:return}o({errorcode:t})}function h(){r.on(s.MANIFEST_UPDATED,l,t),r.on(s.SERVICE_LOCATION_BLACKLIST_CHANGED,u,t),r.on(s.METRIC_ADDED,d,t),r.on(s.METRIC_UPDATED,d,t),r.on(s.PLAYBACK_ERROR,f,t),r.on(sn.BECAME_REPORTING_PLAYER,c,t)}return t={initialise:h,reset:function(){r.off(s.MANIFEST_UPDATED,l,t),r.off(s.SERVICE_LOCATION_BLACKLIST_CHANGED,u,t),r.off(s.METRIC_ADDED,d,t),r.off(s.METRIC_UPDATED,d,t),r.off(s.PLAYBACK_ERROR,f,t),r.off(sn.BECAME_REPORTING_PLAYER,c,t)}},h(),t}Yi.__dashjs_factory_name="DVBErrorsTranslator";const Vi=dashjs.FactoryMaker.getSingletonFactory(Yi);function ji(e){e=e||{};let t,n,r=!1,i=this.context,a=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach((e=>{let t=e.starttime,r=t+e.duration;n.add(t,r)})),r=!!e[0]._useWallClockTime)},reset:function(){n.clear()},isEnabled:function(){let e,t=n.length;if(!t)return!0;e=r?(new Date).getTime()/1e3:a.currentTime;for(let r=0;r<t;r+=1){let t=n.start(r),i=n.end(r);if(t<=e&&e<i)return!0}return!1}},n=Y(i).create(),t}ji.__dashjs_factory_name="RangeController";const zi=dashjs.FactoryMaker.getClassFactory(ji);function Wi(){return{serialise:function e(t){let n,r,i=[],a=[];for(n in t)if(t.hasOwnProperty(n)&&0!==n.indexOf("_")){if(r=t[n],null==r&&(r=""),Array.isArray(r)){if(!r.length)continue;a=[],r.forEach((function(t){let n="Object"!==Object.prototype.toString.call(t).slice(8,-1);a.push(n?t:e(t))})),r=a.map(encodeURIComponent).join(",")}else"string"==typeof r?r=encodeURIComponent(r):r instanceof Date?r=r.toISOString():"number"==typeof r&&(r=Math.round(r));i.push(n+"="+r)}return i.join("&")}}}Wi.__dashjs_factory_name="MetricSerialiser";const $i=dashjs.FactoryMaker.getSingletonFactory(Wi);function Xi(){let e,t,n,r=window.crypto||window.msCrypto,i=Uint32Array,a=Math.pow(2,8*i.BYTES_PER_ELEMENT)-1;function s(){r&&(e||(e=new i(10)),r.getRandomValues(e),t=0)}return n={random:function(n,i){let o;return n||(n=0),i||(i=1),r?(t===e.length&&s(),o=e[t]/a,t+=1):o=Math.random(),o*(i-n)+n}},s(),n}Xi.__dashjs_factory_name="RNG";const Qi=dashjs.FactoryMaker.getSingletonFactory(Xi);function Ji(e){let t;e=e||{};let n,r,i,a,s,o,l=this.context,u=[];const c=e.metricsConstants;function d(){i=!1,a=!1,s=null,o=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),a&&o.isEnabled()&&t.forEach((function(t){let r=n.serialise(t);e!==c.DVB_ERRORS&&(r=`metricname=${e}&${r}`),r=`${s}?${r}`,function(e,t,n){let r=new XMLHttpRequest;const i=function(){let e=u.indexOf(r);-1!==e&&(u.splice(e,1),!(r.status>=200&&r.status<300)&&(n&&n()))};u.push(r);try{r.open("GET",e),r.onloadend=i,r.onerror=i,r.send()}catch(e){r.onerror()}}(r,0,(function(){a=!1}))}))},initialize:function(e,t){let n;if(o=t,s=e.dvb_reportingUrl,!s)throw new Error("required parameter missing (dvb:reportingUrl)");i||(n=e.dvb_probability,n&&(1e3===n||n/1e3>=r.random())&&(a=!0),i=!0)},reset:function(){d()}},n=$i(l).getInstance(),r=Qi(l).getInstance(),d(),t}Ji.__dashjs_factory_name="DVBReporting";const Zi=dashjs.FactoryMaker.getClassFactory(Ji);function ea(e){e=e||{};const t={"urn:dvb:dash:reporting:2014":Zi},n=this.context;let r;const i=e.debug?e.debug.getLogger(r):{},a=e.metricsConstants;return r={create:function(e,r){let s;try{s=t[e.schemeIdUri](n).create({metricsConstants:a}),s.initialize(e,r)}catch(t){s=null,i.error(`ReportingFactory: could not create Reporting with schemeIdUri ${e.schemeIdUri} (${t.message})`)}return s},register:function(e,n){t[e]=n},unregister:function(e){delete t[e]}},r}ea.__dashjs_factory_name="ReportingFactory";const ta=dashjs.FactoryMaker.getSingletonFactory(ea);function na(e){let t,n=[];const r=ta(this.context).getInstance(e);return t={initialize:function(e,t){e.some((e=>{let i=r.create(e,t);if(i)return n.push(i),!0}))},reset:function(){n.forEach((e=>e.reset())),n=[]},report:function(e,t){n.forEach((n=>n.report(e,t)))}},t}na.__dashjs_factory_name="ReportingController";const ra=dashjs.FactoryMaker.getClassFactory(na);function ia(){return{reconstructFullMetricName:function(e,t,n){let r=e;return t&&(r+="("+t,n&&n.length&&(r+=","+n),r+=")"),r},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}ia.__dashjs_factory_name="HandlerHelpers";const aa=dashjs.FactoryMaker.getSingletonFactory(ia);function sa(e){let t,n,r,i,a,s;e=e||{};let o=this.context,l=aa(o).getInstance(),u=[];const c=e.metricsConstants;function d(){let e=function(){try{return Object.keys(u).map((e=>u[e])).reduce(((e,t)=>e.level<t.level?e:t))}catch(e){return}}();e&&s!==e.t&&(s=e.t,n.report(i,e))}return t={initialize:function(e,t,s){t&&(r=l.validateN(s),n=t,i=l.reconstructFullMetricName(e,s),a=setInterval(d,r))},reset:function(){clearInterval(a),a=null,r=0,n=null,s=null},handleNewMetric:function(e,t,n){e===c.BUFFER_LEVEL&&(u[n]=t)}},t}sa.__dashjs_factory_name="BufferLevelHandler";const oa=dashjs.FactoryMaker.getClassFactory(sa),la=dashjs.FactoryMaker.getClassFactory((function(e){let t,n,r=(e=e||{}).eventBus;const i=e.metricsConstants;function a(){r.off(sn.METRICS_INITIALISATION_COMPLETE,a,this),r.trigger(sn.BECAME_REPORTING_PLAYER)}return t={initialize:function(e,t){t&&(n=t,r.on(sn.METRICS_INITIALISATION_COMPLETE,a,this))},reset:function(){n=null},handleNewMetric:function(e,t){e===i.DVB_ERRORS&&n&&n.report(e,t)}},t}));function ua(e){let t,n,r,i,a,s;e=e||{};let o=[],l=aa(this.context).getInstance();const u=e.metricsConstants;function c(){var e=o;e.length&&n&&n.report(a,e),o=[]}return t={initialize:function(e,t,o,u){t&&(r=l.validateN(o),n=t,u&&u.length&&(i=u),a=l.reconstructFullMetricName(e,o,u),s=setInterval(c,r))},reset:function(){clearInterval(s),s=null,r=null,i=null,o=[],n=null},handleNewMetric:function(e,t){e===u.HTTP_REQUEST&&(i&&i!==t.type||o.push(t))}},t}ua.__dashjs_factory_name="HttpListHandler";const ca=dashjs.FactoryMaker.getClassFactory(ua);function da(){let e,t,n;return e={initialize:function(e,r){t=e,n=r},reset:function(){n=null,t=void 0},handleNewMetric:function(e,r){e===t&&n&&n.report(t,r)}},e}da.__dashjs_factory_name="GenericMetricHandler";const fa=dashjs.FactoryMaker.getClassFactory(da);function ha(e){let t;const n=(e=e||{}).debug?e.debug.getLogger(t):{};let r=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/;const i=this.context;let a={BufferLevel:oa,DVBErrors:la,HttpList:ca,PlayList:fa,RepSwitchList:fa,TcpList:fa};return t={create:function(t,s){var o,l=t.match(r);if(l){try{(o=a[l[1]](i).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(l[1],s,l[3],l[5])}catch(e){o=null,n.error(`MetricsHandlerFactory: Could not create handler for type ${l[1]} with args ${l[3]}, ${l[5]} (${e.message})`)}return o}},register:function(e,t){a[e]=t},unregister:function(e){delete a[e]}},t}ha.__dashjs_factory_name="MetricsHandlerFactory";const ga=dashjs.FactoryMaker.getSingletonFactory(ha);function pa(e){e=e||{};let t,n=[];const r=this.context,i=e.eventBus,a=e.events;let s=ga(r).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function o(e){n.forEach((t=>{t.handleNewMetric(e.metric,e.value,e.mediaType)}))}return t={initialize:function(e,r){e.split(",").forEach(((e,t,i)=>{let a;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){let n=i[t+1];n&&-1===n.indexOf("(")&&-1!==n.indexOf(")")&&(e+=","+n,delete i[t+1])}a=s.create(e,r),a&&n.push(a)})),i.on(a.METRIC_ADDED,o,t),i.on(a.METRIC_UPDATED,o,t)},reset:function(){i.off(a.METRIC_ADDED,o,t),i.off(a.METRIC_UPDATED,o,t),n.forEach((e=>e.reset())),n=[]}},t}pa.__dashjs_factory_name="MetricsHandlersController";const ma=dashjs.FactoryMaker.getClassFactory(pa);function Ea(e){let t,n,r,i;e=e||{};let a=this.context;function s(){t&&t.reset(),n&&n.reset(),r&&r.reset()}return i={initialize:function(i){try{r=zi(a).create({mediaElement:e.mediaElement}),r.initialize(i.Range),n=ra(a).create({debug:e.debug,metricsConstants:e.metricsConstants}),n.initialize(i.Reporting,r),t=ma(a).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events}),t.initialize(i.metrics,n)}catch(e){throw s(),e}},reset:s},i}Ea.__dashjs_factory_name="MetricsController";const ya=dashjs.FactoryMaker.getClassFactory(Ea);function _a(e){let t,n=(e=e||{}).adapter;const r=e.constants;return t={getMetrics:function(e){let t=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach((i=>{var a=new class{constructor(){this.metrics="",this.Range=[],this.Reporting=[]}},s=n.getIsDynamic(e);i.hasOwnProperty("metrics")&&(a.metrics=i.metrics,i.Range_asArray&&i.Range_asArray.forEach((t=>{var i=new class{constructor(){this.starttime=0,this.duration=1/0,this._useWallClockTime=!1}};i.starttime=function(e,t,i){let a,s,o=0;return t?o=n.getAvailabilityStartTime(e)/1e3:(a=n.getRegularPeriods(e),a.length&&(o=a[0].start)),s=o,i&&i.hasOwnProperty(r.START_TIME)&&(s+=i.starttime),s}(e,s,t),t.hasOwnProperty("duration")?i.duration=t.duration:i.duration=n.getDuration(e),i._useWallClockTime=s,a.Range.push(i)})),i.Reporting_asArray&&(i.Reporting_asArray.forEach((e=>{var t=new class{constructor(){this.schemeIdUri="",this.value="",this.dvb_reportingUrl="",this.dvb_probability=1e3}};e.hasOwnProperty(r.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(r.DVB_REPORTING_URL)&&(t.dvb_reportingUrl=e[r.DVB_REPORTING_URL]),e.hasOwnProperty(r.DVB_PROBABILITY)&&(t.dvb_probability=e[r.DVB_PROBABILITY]),a.Reporting.push(t))})),t.push(a)))})),t}},t}_a.__dashjs_factory_name="ManifestParsing";const Ta=dashjs.FactoryMaker.getSingletonFactory(_a);function va(e){let t;e=e||{};let n={},r=this.context,i=e.eventBus;const a=e.events;function s(t){if(t.error)return;let a=Object.keys(n);Ta(r).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach((t=>{const i=JSON.stringify(t);if(n.hasOwnProperty(i))a.splice(i,1);else try{let a=ya(r).create(e);a.initialize(t),n[i]=a}catch(e){}})),a.forEach((e=>{n[e].reset(),delete n[e]})),i.trigger(sn.METRICS_INITIALISATION_COMPLETE)}function o(){Object.keys(n).forEach((e=>{n[e].reset()})),n={}}return t={reset:function(){i.off(a.MANIFEST_UPDATED,s,t),i.off(a.STREAM_TEARDOWN_COMPLETE,o,t)}},i.on(a.MANIFEST_UPDATED,s,t),i.on(a.STREAM_TEARDOWN_COMPLETE,o,t),t}va.__dashjs_factory_name="MetricsCollectionController";const Sa=dashjs.FactoryMaker.getClassFactory(va);function Aa(){let e,t,n=this.context;return e={createMetricsReporting:function(e){return t=Vi(n).getInstance({eventBus:e.eventBus,dashMetrics:e.dashMetrics,metricsConstants:e.metricsConstants,events:e.events}),Sa(n).create(e)},getReportingFactory:function(){return ta(n).getInstance()},getMetricsHandlerFactory:function(){return ga(n).getInstance()}},e}Aa.__dashjs_factory_name="MetricsReporting";const Ra=dashjs.FactoryMaker.getClassFactory(Aa);Ra.events=sn,dashjs.FactoryMaker.updateClassFactory(Aa.__dashjs_factory_name,Ra);const ba=Ra;class Ia{static findCencContentProtection(e){let t=null;for(let n=0;n<e.length;++n){let r=e[n];"urn:mpeg:dash:mp4protection:2011"!==r.schemeIdUri.toLowerCase()||"cenc"!==r.value.toLowerCase()&&"cbcs"!==r.value.toLowerCase()||(t=r)}return t}static getPSSHData(e){let t=8,n=new DataView(e),r=n.getUint8(t);return t+=20,r>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}static getPSSHForKeySystem(e,t){let n=Ia.parsePSSHList(t);return e&&n.hasOwnProperty(e.uuid.toLowerCase())?n[e.uuid.toLowerCase()]:null}static parseInitDataFromContentProtection(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}static parsePSSHList(e){if(null==e)return[];let t=new DataView(e.buffer||e),n={},r=0;for(;;){let e,i,a,s,o,l,u,c=r;if(r>=t.buffer.byteLength)break;if(e=t.getUint32(r),i=r+e,r+=4,1886614376===t.getUint32(r))if(r+=4,a=t.getUint8(r),0===a||1===a){for(r++,r+=3,s="",l=0;l<4;l++)u=t.getUint8(r+l).toString(16),s+=1===u.length?"0"+u:u;for(r+=4,s+="-",l=0;l<2;l++)u=t.getUint8(r+l).toString(16),s+=1===u.length?"0"+u:u;for(r+=2,s+="-",l=0;l<2;l++)u=t.getUint8(r+l).toString(16),s+=1===u.length?"0"+u:u;for(r+=2,s+="-",l=0;l<2;l++)u=t.getUint8(r+l).toString(16),s+=1===u.length?"0"+u:u;for(r+=2,s+="-",l=0;l<6;l++)u=t.getUint8(r+l).toString(16),s+=1===u.length?"0"+u:u;r+=6,s=s.toLowerCase(),o=t.getUint32(r),r+=4,n[s]=t.buffer.slice(c,i),r=i}else r=i;else r=i}return n}}const Da=Ia,wa=class{constructor(e,t){this.contentType=e,this.robustness=t}},Ca=class{constructor(e,t,n,r,i){this.initDataTypes=["cenc"],e&&e.length&&(this.audioCapabilities=e),t&&t.length&&(this.videoCapabilities=t),this.distinctiveIdentifier=n,this.persistentState=r,this.sessionTypes=i}},Na=new class extends X{constructor(){super(),this.MEDIA_KEYERR_CODE=100,this.MEDIA_KEYERR_UNKNOWN_CODE=101,this.MEDIA_KEYERR_CLIENT_CODE=102,this.MEDIA_KEYERR_SERVICE_CODE=103,this.MEDIA_KEYERR_OUTPUT_CODE=104,this.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,this.MEDIA_KEYERR_DOMAIN_CODE=106,this.MEDIA_KEY_MESSAGE_ERROR_CODE=107,this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,this.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,this.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,this.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,this.KEY_SESSION_CREATED_ERROR_CODE=113,this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,this.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",this.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",this.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",this.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",this.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",this.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",this.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",this.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",this.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",this.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",this.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",this.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",this.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",this.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --"}};function La(e){const t=(e=e||{}).protectionKeyController;let n=e.protectionModel;const r=e.eventBus,i=e.events,s=e.debug,o=e.BASE64,l=e.constants;let u=[];const c=e.cmcdModel,d=e.settings;let f,h,g,p,m,E,y,_,T,v;function A(){if(!(r&&r.hasOwnProperty("on")&&t&&t.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function R(e,t){const a=Da.getPSSHForKeySystem(_,e),s=w(_);if(a){if(b(a))return;try{n.createKeySession(a,s,N(_),t)}catch(e){r.trigger(i.KEY_SESSION_CREATED,{data:null,error:new M(Na.KEY_SESSION_CREATED_ERROR_CODE,Na.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e?n.createKeySession(e,s,N(_),t):r.trigger(i.KEY_SESSION_CREATED,{data:null,error:new M(Na.KEY_SESSION_CREATED_ERROR_CODE,Na.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(_?_.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function b(e){if(!e)return!1;try{const r=n.getAllInitData();for(let n=0;n<r.length;n++)if(t.initDataEquals(e,r[n]))return h.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function I(e,t){A(),n.loadKeySession(e,t,N(_))}function D(e){A(),e?(n.setMediaElement(e),r.on(i.NEED_KEY,k,this)):null===e&&(n.setMediaElement(e),r.off(i.NEED_KEY,k,this))}function w(e){let t=null;if(e){const n=e.systemString;m&&(t=n in m?m[n]:null)}return t}function C(e){const t=w(e),n=[],r=[],i=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:y,a=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:y,s=N(e),o=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",u=t&&t.persistentState?t.persistentState:"temporary"===s?"optional":"required";return p.forEach((e=>{e.type===l.AUDIO?n.push(new wa(e.codec,i)):e.type===l.VIDEO&&r.push(new wa(e.codec,a))})),new Ca(n,r,o,u,[s])}function N(e){const t=w(e);return t&&t.sessionType?t.sessionType:E}function L(e,a){e=e.sort(((t,n)=>(m&&m[t.ks.systemString]&&m[t.ks.systemString].priority>=0?m[t.ks.systemString].priority:e.length)-(m&&m[n.ks.systemString]&&m[n.ks.systemString].priority>=0?m[n.ks.systemString].priority:e.length))),void 0===_?function(e,a){const s=this,l=[];let u,c;_=null,g.push(e);for(let t=0;t<e.length;t++)l.push({ks:e[t].ks,configs:[C(e[t].ks)]});const d=function(e){r.off(i.KEY_SYSTEM_ACCESS_COMPLETE,d,s),e.error?(_=void 0,r.off(i.INTERNAL_KEY_SYSTEM_SELECTED,f,s),a||r.trigger(i.KEY_SYSTEM_SELECTED,{data:null,error:new M(Na.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,Na.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+e.error)})):(c=e.data,h.info("DRM: KeySystem Access Granted ("+c.keySystem.systemString+")!  Selecting key system..."),n.selectKeySystem(c))};var f=function(e){if(r.off(i.INTERNAL_KEY_SYSTEM_SELECTED,f,s),r.off(i.KEY_SYSTEM_ACCESS_COMPLETE,d,s),e.error)_=void 0,a||r.trigger(i.KEY_SYSTEM_SELECTED,{data:null,error:new M(Na.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,Na.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)});else{if(!n)return;_=n.getKeySystem(),r.trigger(i.KEY_SYSTEM_SELECTED,{data:c});const e=w(_);e&&e.serverCertificate&&e.serverCertificate.length>0&&n.setServerCertificate(o.decodeArray(e.serverCertificate).buffer);for(let n=0;n<g.length;n++)for(u=0;u<g[n].length;u++)if(_===g[n][u].ks){if(t.isClearKey(_)&&e&&e.hasOwnProperty("clearkeys")){const t={kids:Object.keys(e.clearkeys)};g[n][u].initData=(new TextEncoder).encode(JSON.stringify(t))}g[n][u].sessionId?I(g[n][u].sessionId,g[n][u].initData):null!==g[n][u].initData&&R(g[n][u].initData,g[n][u].cdmData);break}}};r.on(i.INTERNAL_KEY_SYSTEM_SELECTED,f,s),r.on(i.KEY_SYSTEM_ACCESS_COMPLETE,d,s),n.requestKeySystemAccess(l)}(e,a):_?function(e,a){const s=this,o=[],l=e.findIndex((e=>e.ks===_));if(-1===l||!e[l].initData)return;if(b(Da.getPSSHForKeySystem(_,e[l].initData)))return;o.push({ks:e[l].ks,configs:[C(_)]});const u=function(n){if(r.off(i.KEY_SYSTEM_ACCESS_COMPLETE,u,s),n.error)a||r.trigger(i.KEY_SYSTEM_SELECTED,{error:new M(Na.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,Na.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+n.error)});else{h.info("DRM: KeySystem Access Granted"),r.trigger(i.KEY_SYSTEM_SELECTED,{data:n.data});const a=w(_);if(t.isClearKey(_)&&a&&a.hasOwnProperty("clearkeys")){const t={kids:Object.keys(a.clearkeys)};e[l].initData=(new TextEncoder).encode(JSON.stringify(t))}e[l].sessionId?I(e[l].sessionId,e[l].initData):e[l].initData&&R(e[l].initData,e[l].cdmData)}};r.on(i.KEY_SYSTEM_ACCESS_COMPLETE,u,s),n.requestKeySystemAccess(o)}(e,a):g.push(e)}function O(e,t){r.trigger(i.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function P(e){e.error?r.trigger(i.KEY_STATUSES_CHANGED,{data:null,error:e.error}):h.debug("DRM: key status = "+e.status)}function x(e){h.debug("DRM: onKeyMessage");const a=e.data;r.trigger(i.KEY_MESSAGE,{data:a});const s=a.messageType?a.messageType:"license-request",o=a.message,l=a.sessionToken,u=w(_),c=_?_.systemString:null,d=t.getLicenseServer(_,u,s),f={sessionToken:l,messageType:s};if(!o||0===o.byteLength)return void O(f,new M(Na.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,Na.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE));if(!d)return h.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+l.getSessionID()),void O(f);if(t.isClearKey(_)){const e=t.processClearKeyLicenseRequest(_,u,o);if(e)return h.debug("DRM: ClearKey license request handled by application!"),O(f),void n.updateKeySession(l,e)}let g=null;if(u&&u.serverURL){const e=u.serverURL;"string"==typeof e&&""!==e?g=e:"object"==typeof e&&e.hasOwnProperty(s)&&(g=e[s])}else if(u&&u.laURL&&""!==u.laURL)g=u.laURL;else if(t.isClearKey(_))g=_.getLicenseServerUrlFromMediaInfo(p);else{const t=Da.getPSSHData(l.initData);g=_.getLicenseServerURLFromInitData(t),g||(g=e.data.laURL)}if(g=d.getServerURLFromMessage(g,o,s),!g)return void O(f,new M(Na.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,Na.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE));const m={};let E=!1;const y=function(e){if(e)for(const t in e)"authorization"===t.toLowerCase()&&(E=!0),m[t]=e[t]};u&&y(u.httpRequestHeaders),y(_.getRequestHeadersFromMessage(o)),u&&"boolean"==typeof u.withCredentials&&(E=u.withCredentials);const S=function(e,t,n,r){const i=e.response?d.getErrorResponse(e.response,n,r):"NONE";O(t,new M(Na.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,Na.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i))},A=function(e){if(n)if(200===e.status){let t=new class{constructor(e,t,n){this.url=e,this.headers=t,this.data=n}}(e.responseURL,en.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),e.response);U(v,t).then((()=>{const r=d.getLicenseMessage(t.data,c,s);null!==r?(O(f),n.updateKeySession(l,r)):S(e,f,c,s)}))}else S(e,f,c,s)},R=function(e){O(f,new M(Na.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,Na.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+c+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},b=function(e){O(f,new M(Na.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,Na.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+c+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},I=_.getLicenseRequestFromMessage(o),D=d.getHTTPMethod(s),C=d.getResponseType(c,s),N=u&&!isNaN(u.httpTimeout)?u.httpTimeout:8e3,L=l.getSessionID()||null;let P=new class{constructor(e,t,n,r,i,a,s,o){this.url=e,this.method=t,this.responseType=n,this.headers=r,this.withCredentials=i,this.messageType=a,this.sessionId=s,this.data=o}}(g,D,C,m,E,s,L,I);U(T,P).then((()=>{F(P,3,N,A,R,b)}))}function F(e,t,n,s,o,l){const u=new XMLHttpRequest;if(d.get().streaming.cmcd&&d.get().streaming.cmcd.enabled&&d.get().streaming.cmcd.mode===a.CMCD_MODE_QUERY){const t=c.getQueryParameter({url:e.url,type:S.LICENSE});t&&(e.url=en.addAditionalQueryParameterToUrl(e.url,[t]))}u.open(e.method,e.url,!0),u.responseType=e.responseType,u.withCredentials=e.withCredentials,n>0&&(u.timeout=n);for(const t in e.headers)u.setRequestHeader(t,e.headers[t]);if(d.get().streaming.cmcd&&d.get().streaming.cmcd.enabled&&d.get().streaming.cmcd.mode===a.CMCD_MODE_HEADER){const t=c.getHeaderParameters({url:e.url,type:S.LICENSE});if(t)for(const e in t){let n=t[e];n&&u.setRequestHeader(e,n)}}const f=function(){t--,setTimeout((function(){F(e,t,n,s,o,l)}),1e3)};u.onload=function(){200===this.status||t<=0?s(this):(h.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),f())},u.ontimeout=u.onerror=function(){t<=0?l(this):(h.warn("License request network request failed . Retrying it... Pending retries: "+t),f())},u.onabort=function(){o(this)},r.trigger(i.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),u.send(e.data)}function k(e,n){if(h.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void h.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===p.length&&(h.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(n=void 0===n?1:n+1)<5))return void u.push(setTimeout((()=>{k(e,n)}),500));let r=e.key.initData;if(ArrayBuffer.isView(r)&&(r=r.buffer),_){const e=Da.getPSSHForKeySystem(_,r);if(e&&b(e))return}h.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(r)));const i=t.getSupportedKeySystems(r,m);0!==i.length?L(i,!1):h.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}function U(e,t){return e?e.reduce(((e,n)=>e.then((()=>n(t)))),Promise.resolve()):Promise.resolve()}return f={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");A(),r.on(i.INTERNAL_KEY_MESSAGE,x,this),r.on(i.INTERNAL_KEY_STATUS_CHANGED,P,this),p.push(e);const n=t.getSupportedKeySystemsFromContentProtection(e.contentProtection);n&&n.length>0&&L(n,!0)},clearMediaInfoArrayByStreamId:function(e){p=p.filter((t=>t.streamInfo.id!==e))},createKeySession:R,loadKeySession:I,removeKeySession:function(e){A(),n.removeKeySession(e)},closeKeySession:function(e){A(),n.closeKeySession(e)},setServerCertificate:function(e){A(),n.setServerCertificate(e)},setMediaElement:D,setSessionType:function(e){E=e},setRobustnessLevel:function(e){y=e},setProtectionData:function(e){m=e,t.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return A(),t.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return t?t.getKeySystems():[]},setKeySystems:function(e){t&&t.setKeySystems(e)},setLicenseRequestFilters:function(e){T=e},setLicenseResponseFilters:function(e){v=e},stop:function(){n&&n.stop()},reset:function(){A(),T=[],v=[],r.off(i.INTERNAL_KEY_MESSAGE,x,this),r.off(i.INTERNAL_KEY_STATUS_CHANGED,P,this),D(null),_=void 0,n&&(n.reset(),n=null),u.forEach((e=>clearTimeout(e))),u=[],p=[]}},h=s.getLogger(f),g=[],p=[],E="temporary",y="",T=[],v=[],f}La.__dashjs_factory_name="ProtectionController";const Ma=dashjs.FactoryMaker.getClassFactory(La),Oa=class{constructor(e,t){this.keyID=e,this.key=t}},Pa=class{constructor(e,t){if(t&&"persistent"!==t&&"temporary"!==t)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=e,this.type=t}toJWK(){let e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){let t={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(t)}this.type&&(n.type=this.type);let r=JSON.stringify(n);const i=r.length;let a=new ArrayBuffer(i),s=new Uint8Array(a);for(e=0;e<i;e++)s[e]=r.charCodeAt(e);return a}},xa=new class{init(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"}constructor(){this.init()}},Fa="e2719d58-a985-b3c9-781a-b030af78d30e",ka=xa.CLEARKEY_KEYSTEM_STRING,Ua="urn:uuid:"+Fa;function Ba(e){let t;const n=(e=e||{}).BASE64,r={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]};return t={uuid:Fa,schemeIdURI:Ua,systemString:ka,getInitData:function(e,t){try{let r=Da.parseInitDataFromContentProtection(e,n);if(!r&&t){const e={kids:[function(e){try{let t=e.replace(/-/g,"");return t=btoa(t.match(/\w{2}/g).map((e=>String.fromCharCode(parseInt(e,16)))).join("")),t.replace(/=/g,"")}catch(e){return null}}(t["cenc:default_KID"])]};r=(new TextEncoder).encode(JSON.stringify(e))}return r}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getLicenseServerUrlFromMediaInfo:function(e){try{if(!e||0===e.length)return null;let t=0,n=null;for(;t<e.length&&!n;){const i=e[t];if(i&&i.contentProtection&&i.contentProtection.length>0){const e=i.contentProtection.filter((e=>e.schemeIdUri&&e.schemeIdUri===Ua));if(e&&e.length>0){let t=0;for(;t<e.length&&!n;){const i=e[t];let a=0;for(;a<r.attributes.length&&!n;){let e=0;const t=r.attributes[a];for(;e<r.prefixes.length&&!n;){const a=r.prefixes[e];i[t]&&i[t].__prefix&&i[t].__prefix===a&&i[t].__text&&(n=i[t].__text),e+=1}a+=1}t+=1}}}t+=1}return n}catch(e){return null}},getClearKeysFromProtectionData:function(e,t){let n=null;if(e){const r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[];for(let t=0;t<r.kids.length;t++){const n=r.kids[t],a=e.clearkeys&&e.clearkeys.hasOwnProperty(n)?e.clearkeys[n]:null;if(!a)throw new Error("DRM: ClearKey keyID ("+n+") is not known!");i.push(new Oa(n,a))}n=new Pa(i)}return n}},t}Ba.__dashjs_factory_name="KeySystemClearKey";const Ga=dashjs.FactoryMaker.getSingletonFactory(Ba),qa=xa.CLEARKEY_KEYSTEM_STRING;function Ka(e){let t;const n=e.BASE64,r=e.debug.getLogger(t);return t={uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:qa,getInitData:function(e){return Da.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){let n=null;if(e){const i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),a=[];for(let t=0;t<i.kids.length;t++){const n=i.kids[t],r=e.clearkeys&&e.clearkeys.hasOwnProperty(n)?e.clearkeys[n]:null;if(!r)throw new Error("DRM: ClearKey keyID ("+n+") is not known!");a.push(new Oa(n,r))}n=new Pa(a),r.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}},t}Ka.__dashjs_factory_name="KeySystemW3CClearKey";const Ha=dashjs.FactoryMaker.getSingletonFactory(Ka),Ya=xa.WIDEVINE_KEYSTEM_STRING;function Va(e){let t,n=null;const r=(e=e||{}).BASE64;return t={uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:Ya,init:function(e){e&&(n=e)},getInitData:function(e){return Da.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(e){return n&&n.sessionId?n.sessionId:e&&e.sessionId?e.sessionId:null}},t}Va.__dashjs_factory_name="KeySystemWidevine";const ja=dashjs.FactoryMaker.getSingletonFactory(Va),za=xa.PLAYREADY_KEYSTEM_STRING;let Wa;function $a(e){let t,n="utf-16";const r=(e=e||{}).BASE64;function i(){if(!r||!r.hasOwnProperty("decodeArray")||!r.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return t={uuid:"9a04f079-9840-4286-ab92-e65be0885f95",schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:za,getInitData:function(e){const t=new Uint8Array([112,115,115,104,0,0,0,0]),n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);let a,s,o,l,u,c=0,d=null;if(i(),!e)return null;if("pssh"in e)return Da.parseInitDataFromContentProtection(e,r);if("pro"in e)d=r.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;d=r.decodeArray(e.prheader.__text)}return a=d.length,s=4+t.length+n.length+4+a,o=new ArrayBuffer(s),l=new Uint8Array(o),u=new DataView(o),u.setUint32(c,s),c+=4,l.set(t,c),c+=t.length,l.set(n,c),c+=n.length,u.setUint32(c,a),c+=4,l.set(d,c),c+=a,l.buffer},getRequestHeadersFromMessage:function(e){let t,r;const i={},a=new DOMParser,s="utf-16"===n?new Uint16Array(e):new Uint8Array(e);t=String.fromCharCode.apply(null,s),r=a.parseFromString(t,"application/xml");const o=r.getElementsByTagName("name"),l=r.getElementsByTagName("value");for(let e=0;e<o.length;e++)i[o[e].childNodes[0].nodeValue]=l[e].childNodes[0].nodeValue;return i.hasOwnProperty("Content")&&(i["Content-Type"]=i.Content,delete i.Content),i.hasOwnProperty("Content-Type")||(i["Content-Type"]="text/xml; charset=utf-8"),i},getLicenseRequestFromMessage:function(e){let t=null;const a=new DOMParser,s="utf-16"===n?new Uint16Array(e):new Uint8Array(e);i();const o=String.fromCharCode.apply(null,s),l=a.parseFromString(o,"application/xml");if(!l.getElementsByTagName("PlayReadyKeyMessage")[0])return e;{const e=l.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;e&&(t=r.decode(e))}return t},getLicenseServerURLFromInitData:function(e){if(e){const t=new DataView(e),n=t.getUint16(4,!0);let r=6;const i=new DOMParser;for(let a=0;a<n;a++){const n=t.getUint16(r,!0);r+=2;const a=t.getUint16(r,!0);if(r+=2,1!==n){r+=a;continue}const s=e.slice(r,r+a),o=String.fromCharCode.apply(null,new Uint16Array(s)),l=i.parseFromString(o,"application/xml");if(l.getElementsByTagName("LA_URL")[0]){const e=l.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(e)return e}if(l.getElementsByTagName("LUI_URL")[0]){const e=l.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(e)return e}}}return null},getCDMData:function(){let e,t,n,a;if(i(),Wa&&Wa.cdmData){for(e=[],a=0;a<Wa.cdmData.length;++a)e.push(Wa.cdmData.charCodeAt(a)),e.push(0);for(e=String.fromCharCode.apply(null,e),e=r.encode(e),t='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",e),n=[],a=0;a<t.length;++a)n.push(t.charCodeAt(a)),n.push(0);return new Uint8Array(n).buffer}return null},getSessionId:function(e){return Wa&&Wa.sessionId?Wa.sessionId:e&&e.sessionId?e.sessionId:null},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');n=e},init:function(e){e&&(Wa=e)}},t}$a.__dashjs_factory_name="KeySystemPlayReady";const Xa=dashjs.FactoryMaker.getSingletonFactory($a);function Qa(e){const t=(e=e||{}).BASE64,n={};let r;return n[xa.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[xa.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},r={getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,r){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[r].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}},r}Qa.__dashjs_factory_name="DRMToday";const Ja=dashjs.FactoryMaker.getSingletonFactory(Qa);function Za(){let e;const t="http://schemas.xmlsoap.org/soap/envelope/";function n(e){const t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function r(e){if(window.DOMParser){const r=n(e),i=(new window.DOMParser).parseFromString(r,"text/xml"),a=i?i.getElementsByTagNameNS(t,"Envelope")[0]:null,s=a?a.getElementsByTagNameNS(t,"Body")[0]:null;if(s&&s.getElementsByTagNameNS(t,"Fault")[0])return null}return e}function i(e){let r="",i="",a="",s=-1,o=-1;if(window.DOMParser){const l=n(e),u=(new window.DOMParser).parseFromString(l,"text/xml"),c=u?u.getElementsByTagNameNS(t,"Envelope")[0]:null,d=c?c.getElementsByTagNameNS(t,"Body")[0]:null,f=d?d.getElementsByTagNameNS(t,"Fault")[0]:null,h=f?f.getElementsByTagName("detail")[0]:null,g=h?h.getElementsByTagName("Exception")[0]:null;let p=null;if(null===f)return l;p=f.getElementsByTagName("faultstring")[0].firstChild,r=p?p.nodeValue:null,null!==g&&(p=g.getElementsByTagName("StatusCode")[0],i=p?p.firstChild.nodeValue:null,p=g.getElementsByTagName("Message")[0],a=p?p.firstChild.nodeValue:null,s=a?a.lastIndexOf("[")+1:-1,o=a?a.indexOf("]"):-1,a=a?a.substring(s,o):"")}let l=`code: ${i}, name: ${r}`;return a&&(l+=`, message: ${a}`),l}return e={getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return r.call(this,e)},getErrorResponse:function(e){return i.call(this,e)}},e}Za.__dashjs_factory_name="PlayReady";const es=dashjs.FactoryMaker.getSingletonFactory(Za);function ts(){let e;return e={getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},e}ts.__dashjs_factory_name="Widevine";const ns=dashjs.FactoryMaker.getSingletonFactory(ts);function rs(){let e;return e={getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;let t=[];for(let n=0;n<e.keys.length;n++){let r=e.keys[n],i=r.kid.replace(/=/g,""),a=r.k.replace(/=/g,"");t.push(new Oa(i,a))}return new Pa(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},e}rs.__dashjs_factory_name="ClearKey";const is=dashjs.FactoryMaker.getSingletonFactory(rs);function as(){let e,t,n,r,i,a,s,o=this.context;return e={initialize:function(){let e;r=[],e=Xa(o).getInstance({BASE64:i}),r.push(e),e=ja(o).getInstance({BASE64:i}),r.push(e),e=Ga(o).getInstance({BASE64:i}),r.push(e),a=e,e=Ha(o).getInstance({BASE64:i,debug:t}),r.push(e),s=e},setProtectionData:function(e){for(var t=function(t){var n=null;return e&&(n=t in e?e[t]:null),n},n=0;n<r.length;n++){var i=r[n];i.hasOwnProperty("init")&&i.init(t(i.systemString))}},isClearKey:function(e){return e===a||e===s},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){let n=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<n.length;e++)if(n[e]!==r[e])return!1;return!0}return!1},getKeySystems:function(){return r},setKeySystems:function(e){r=e},getKeySystemBySystemString:function(e){for(let t=0;t<r.length;t++)if(r[t].systemString===e)return r[t];return null},getSupportedKeySystemsFromContentProtection:function(e){let t,n,i,a,s=[];if(e){const o=Da.findCencContentProtection(e);for(i=0;i<r.length;++i)for(n=r[i],a=0;a<e.length;++a)if(t=e[a],t.schemeIdUri.toLowerCase()===n.schemeIdURI){let e=n.getInitData(t,o);s.push({ks:r[i],initData:e,cdmData:n.getCDMData(),sessionId:n.getSessionId(t)})}}return s},getSupportedKeySystems:function(e,t){let n,i,a,s=[],o=Da.parsePSSHList(e);for(let e=0;e<r.length;++e)n=r[e],i=n.systemString,a=!t||i in t,n.uuid in o&&a&&s.push({ks:n,initData:o[n.uuid],cdmData:n.getCDMData(),sessionId:n.getSessionId()});return s},getLicenseServer:function(e,t,n){if("license-release"===n||"individualization-request"===n)return null;let r=null;return t&&t.hasOwnProperty("drmtoday")?r=Ja(o).getInstance({BASE64:i}):e.systemString===xa.WIDEVINE_KEYSTEM_STRING?r=ns(o).getInstance():e.systemString===xa.PLAYREADY_KEYSTEM_STRING?r=es(o).getInstance():e.systemString===xa.CLEARKEY_KEYSTEM_STRING&&(r=is(o).getInstance()),r},processClearKeyLicenseRequest:function(e,t,r){try{return e.getClearKeysFromProtectionData(t,r)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(r){r&&(r.debug&&(t=r.debug,n=t.getLogger(e)),r.BASE64&&(i=r.BASE64))}},e}as.__dashjs_factory_name="ProtectionKeyController";const ss=dashjs.FactoryMaker.getSingletonFactory(as),os=new class extends c{constructor(){super(),this.INTERNAL_KEY_MESSAGE="internalKeyMessage",this.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",this.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",this.KEY_ADDED="public_keyAdded",this.KEY_ERROR="public_keyError",this.KEY_MESSAGE="public_keyMessage",this.KEY_SESSION_CLOSED="public_keySessionClosed",this.KEY_SESSION_CREATED="public_keySessionCreated",this.KEY_SESSION_REMOVED="public_keySessionRemoved",this.KEY_STATUSES_CHANGED="public_keyStatusesChanged",this.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",this.KEY_SYSTEM_SELECTED="public_keySystemSelected",this.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",this.LICENSE_REQUEST_SENDING="public_licenseRequestSending",this.NEED_KEY="needkey",this.PROTECTION_CREATED="public_protectioncreated",this.PROTECTION_DESTROYED="public_protectiondestroyed",this.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",this.TEARDOWN_COMPLETE="protectionTeardownComplete",this.VIDEO_ELEMENT_SELECTED="videoElementSelected"}},ls=class{constructor(e,t){this.initData=e,this.initDataType=t}},us=class{constructor(e,t,n,r){this.sessionToken=e,this.message=t,this.defaultURL=n,this.messageType=r||"license-request"}},cs=class{constructor(e,t){this.keySystem=e,this.ksConfiguration=t}};function ds(e){e=e||{};const t=this.context,n=e.eventBus,r=e.events,i=e.debug;let a,s,o,l,u,c,d,f;function h(e,t){void 0!==navigator.requestMediaKeySystemAccess&&"function"==typeof navigator.requestMediaKeySystemAccess?function(t){const i=e[t].ks,a=e[t].configs;let s=i.systemString;s===xa.PLAYREADY_KEYSTEM_STRING&&"required"===a[0].persistentState&&(s+=".recommendation"),navigator.requestMediaKeySystemAccess(s,a).then((function(e){const t="function"==typeof e.getConfiguration?e.getConfiguration():null,a=new cs(i,t);a.mksa=e,n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{data:a})})).catch((function(i){++t<e.length?h(e,t):n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+i.message})}))}(t):n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"})}function g(e){const t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function p(e){for(let t=0;t<c.length;t++)if(c[t]===e){c.splice(t,1);break}}function m(e){let t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function E(e,t,i,a){const o={session:e,initData:t,sessionId:a,handleEvent:function(e){switch(e.type){case"keystatuseschange":n.trigger(r.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){let e=m(arguments);"expired"===e.status?n.trigger(r.INTERNAL_KEY_STATUS_CHANGED,{error:new M(Na.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,Na.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)}):n.trigger(r.INTERNAL_KEY_STATUS_CHANGED,e)}));break;case"message":let t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.trigger(r.INTERNAL_KEY_MESSAGE,{data:new us(this,t,void 0,e.messageType)})}},getSessionID:function(){return e.sessionId},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){let t=!1;return e.keyStatuses.forEach((function(){let e=m(arguments);"usable"===e.status&&(t=!0)})),t},getSessionType:function(){return i}};return e.addEventListener("keystatuseschange",o),e.addEventListener("message",o),e.closed.then((function(){p(o),s.debug("DRM: Session closed.  SessionID = "+o.getSessionID()),n.trigger(r.KEY_SESSION_CLOSED,{data:o.getSessionID()})})),c.push(o),o}return a={getAllInitData:function(){const e=[];for(let t=0;t<c.length;t++)c[t].initData&&e.push(c[t].initData);return e},requestKeySystemAccess:function(e){h(e,0)},getKeySystem:function(){return o},selectKeySystem:function(e){e.mksa.createMediaKeys().then((function(t){o=e.keySystem,u=t,l?l.setMediaKeys(u).then((function(){n.trigger(r.INTERNAL_KEY_SYSTEM_SELECTED)})):n.trigger(r.INTERNAL_KEY_SYSTEM_SELECTED)})).catch((function(){n.trigger(r.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))},setMediaElement:function(e){l!==e&&(l&&(l.removeEventListener("encrypted",d),l.setMediaKeys&&l.setMediaKeys(null)),l=e,l&&(l.addEventListener("encrypted",d),l.setMediaKeys&&u&&l.setMediaKeys(u)))},setServerCertificate:function(e){if(!o||!u)throw new Error("Can not set server certificate until you have selected a key system");u.setServerCertificate(e).then((function(){s.info("DRM: License server certificate successfully updated."),n.trigger(r.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){n.trigger(r.SERVER_CERTIFICATE_UPDATED,{error:new M(Na.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,Na.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e,t,i){if(!o||!u)throw new Error("Can not create sessions until you have selected a key system");const a=u.createSession(i),l=E(a,e,i),c=this.getKeySystem().systemString===xa.CLEARKEY_KEYSTEM_STRING&&(e||t&&t.clearkeys)?"keyids":"cenc";a.generateRequest(c,e).then((function(){s.debug("DRM: Session created.  SessionID = "+l.getSessionID()),n.trigger(r.KEY_SESSION_CREATED,{data:l})})).catch((function(e){p(l),n.trigger(r.KEY_SESSION_CREATED,{data:null,error:new M(Na.KEY_SESSION_CREATED_ERROR_CODE,Na.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){const i=e.session;f.isClearKey(o)&&(t=t.toJWK()),i.update(t).catch((function(t){n.trigger(r.KEY_ERROR,{data:new M(Na.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e,t,i){if(!o||!u)throw new Error("Can not load sessions until you have selected a key system");for(let t=0;t<c.length;t++)if(e===c[t].sessionId)return void s.warn("DRM: Ignoring session ID because we have already seen it!");const a=u.createSession(i),l=E(a,t,i,e);a.load(e).then((function(t){t?(s.debug("DRM: Session loaded.  SessionID = "+l.getSessionID()),n.trigger(r.KEY_SESSION_CREATED,{data:l})):(p(l),n.trigger(r.KEY_SESSION_CREATED,{data:null,error:new M(Na.KEY_SESSION_CREATED_ERROR_CODE,Na.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+e+")")}))})).catch((function(t){p(l),n.trigger(r.KEY_SESSION_CREATED,{data:null,error:new M(Na.KEY_SESSION_CREATED_ERROR_CODE,Na.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+e+")! "+t.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){s.debug("DRM: Session removed.  SessionID = "+e.getSessionID()),n.trigger(r.KEY_SESSION_REMOVED,{data:e.getSessionID()})}),(function(t){n.trigger(r.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionID()+"). "+t.name})}))},closeKeySession:function(e){g(e).catch((function(t){p(e),n.trigger(r.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionID()+") "+t.name})}))},stop:function(){let e;for(let t=0;t<c.length;t++)e=c[t],e.getUsable()||g(e).catch((function(){p(e)}))},reset:function(){const e=c.length;let t;if(0!==e){const i=function(e){p(e),0===c.length&&(l?(l.removeEventListener("encrypted",d),l.setMediaKeys(null).then((function(){n.trigger(r.TEARDOWN_COMPLETE)}))):n.trigger(r.TEARDOWN_COMPLETE))};for(let n=0;n<e;n++)t=c[n],function(e){t.session.closed.then((function(){i(e)})),g(t).catch((function(){i(e)}))}(t)}else n.trigger(r.TEARDOWN_COMPLETE)}},s=i.getLogger(a),o=null,l=null,u=null,c=[],f=ss(t).getInstance(),d={handleEvent:function(e){if("encrypted"===e.type&&e.initData){let t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(r.NEED_KEY,{key:new ls(t,e.initDataType)})}}},a}ds.__dashjs_factory_name="ProtectionModel_21Jan2015";const fs=dashjs.FactoryMaker.getClassFactory(ds);function hs(e){e=e||{};const t=this.context,n=e.eventBus,r=e.events,i=e.debug,a=e.api;let s,o,l,u,c,d,f,h,g;function p(){try{for(let e=0;e<f.length;e++)m(f[e]);l&&l.removeEventListener(a.needkey,h),n.trigger(r.TEARDOWN_COMPLETE)}catch(e){n.trigger(r.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function m(e){const t=e.session;t.removeEventListener(a.error,e),t.removeEventListener(a.message,e),t.removeEventListener(a.ready,e),t.removeEventListener(a.close,e);for(let t=0;t<f.length;t++)if(f[t]===e){f.splice(t,1);break}t[a.release]()}function E(){let e=null;const t=function(){l.removeEventListener("loadedmetadata",e),l[a.setMediaKeys](c),n.trigger(r.VIDEO_ELEMENT_SELECTED)};l.readyState>=1?t():(e=t.bind(this),l.addEventListener("loadedmetadata",e))}return s={getAllInitData:function(){const e=[];for(let t=0;t<f.length;t++)e.push(f[t].initData);return e},requestKeySystemAccess:function(e){let t=!1;for(let i=0;i<e.length;i++){const s=e[i].ks.systemString,o=e[i].configs;let l=null,u=null;for(let e=0;e<o.length;e++){const i=o[e].audioCapabilities,c=o[e].videoCapabilities;if(i&&0!==i.length){l=[];for(let e=0;e<i.length;e++)window[a.MediaKeys].isTypeSupported(s,i[e].contentType)&&l.push(i[e])}if(c&&0!==c.length){u=[];for(let e=0;e<c.length;e++)window[a.MediaKeys].isTypeSupported(s,c[e].contentType)&&u.push(c[e])}if(!l&&!u||l&&0===l.length||u&&0===u.length)continue;t=!0;const d=new Ca(l,u),f=g.getKeySystemBySystemString(s);n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{data:new cs(f,d)});break}}t||n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return u},selectKeySystem:function(e){try{c=e.mediaKeys=new window[a.MediaKeys](e.keySystem.systemString),u=e.keySystem,d=e,l&&E(),n.trigger(r.INTERNAL_KEY_SYSTEM_SELECTED)}catch(e){n.trigger(r.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+u.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function(e){l!==e&&(l&&l.removeEventListener(a.needkey,h),l=e,l&&(l.addEventListener(a.needkey,h),c&&E()))},createKeySession:function(e,t,i,s){if(!u||!c||!d)throw new Error("Can not create sessions until you have selected a key system");let l=null;if(d.ksConfiguration.videoCapabilities&&d.ksConfiguration.videoCapabilities.length>0&&(l=d.ksConfiguration.videoCapabilities[0]),null===l&&d.ksConfiguration.audioCapabilities&&d.ksConfiguration.audioCapabilities.length>0&&(l=d.ksConfiguration.audioCapabilities[0]),null===l)throw new Error("Can not create sessions for unknown content types.");const h=l.contentType,g=c.createSession(h,new Uint8Array(e),s?new Uint8Array(s):null),p=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case a.error:let t="KeyError";n.trigger(r.KEY_ERROR,{data:new M(Na.MEDIA_KEYERR_CODE,t,this)});break;case a.message:let i=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;n.trigger(r.INTERNAL_KEY_MESSAGE,{data:new us(this,i,e.destinationURL)});break;case a.ready:o.debug("DRM: Key added."),n.trigger(r.KEY_ADDED);break;case a.close:o.debug("DRM: Session closed.  SessionID = "+this.getSessionID()),n.trigger(r.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(g,e);g.addEventListener(a.error,p),g.addEventListener(a.message,p),g.addEventListener(a.ready,p),g.addEventListener(a.close,p),f.push(p),o.debug("DRM: Session created.  SessionID = "+p.getSessionID()),n.trigger(r.KEY_SESSION_CREATED,{data:p})},updateKeySession:function(e,t){const n=e.session;g.isClearKey(u)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t))},closeKeySession:m,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:p,reset:p},o=i.getLogger(s),l=null,u=null,c=null,d=null,f=[],g=ss(t).getInstance(),h={handleEvent:function(e){if(e.type===a.needkey&&e.initData){const t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(r.NEED_KEY,{key:new ls(t,"cenc")})}}},s}hs.__dashjs_factory_name="ProtectionModel_3Feb2014";const gs=dashjs.FactoryMaker.getClassFactory(hs);function ps(e){e=e||{};const t=this.context,n=e.eventBus,r=e.events,i=e.debug,a=e.api,s=e.errHandler;let o,l,u,c,d,f,h,g,p;function m(){u&&_();for(let e=0;e<h.length;e++)E(h[e]);n.trigger(r.TEARDOWN_COMPLETE)}function E(e){try{u[a.cancelKeyRequest](c.systemString,e.sessionID)}catch(t){n.trigger(r.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionID+") "+t.message})}}function y(e,t){if(t&&e){const n=e.length;for(let r=0;r<n;r++)if(e[r].sessionID==t)return e[r];return null}return null}function _(){u.removeEventListener(a.keyerror,p),u.removeEventListener(a.needkey,p),u.removeEventListener(a.keymessage,p),u.removeEventListener(a.keyadded,p)}return o={getAllInitData:function(){const e=[];for(let t=0;t<f.length;t++)e.push(f[t].initData);for(let t=0;t<h.length;t++)e.push(h[t].initData);return e},requestKeySystemAccess:function(e){let t=u;t||(t=document.createElement("video"));let i=!1;for(let a=0;a<e.length;a++){const s=e[a].ks.systemString,o=e[a].configs;let l=null,u=null;for(let e=0;e<o.length;e++){const a=o[e].videoCapabilities;if(a&&0!==a.length){u=[];for(let e=0;e<a.length;e++)""!==t.canPlayType(a[e].contentType,s)&&u.push(a[e])}if(!l&&!u||l&&0===l.length||u&&0===u.length)continue;i=!0;const c=new Ca(l,u),f=d.getKeySystemBySystemString(s);n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{data:new cs(f,c)});break}}i||n.trigger(r.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return c},selectKeySystem:function(e){c=e.keySystem,n.trigger(r.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){if(u!==e){if(u){_();for(var t=0;t<h.length;t++)E(h[t]);h=[]}u=e,u&&(u.addEventListener(a.keyerror,p),u.addEventListener(a.needkey,p),u.addEventListener(a.keymessage,p),u.addEventListener(a.keyadded,p),n.trigger(r.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!c)throw new Error("Can not create sessions until you have selected a key system");if(g||0===h.length){const t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return f.push(t),u[a.generateKeyRequest](c.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){const n=e.sessionID;if(d.isClearKey(c))for(let e=0;e<t.keyPairs.length;e++)u[a.addKey](c.systemString,t.keyPairs[e].key,t.keyPairs[e].keyID,n);else u[a.addKey](c.systemString,new Uint8Array(t),new Uint8Array(e.initData),n)},closeKeySession:E,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:m,reset:m},l=i.getLogger(o),u=null,c=null,f=[],h=[],d=ss(t).getInstance(),p={handleEvent:function(e){let t=null;switch(e.type){case a.needkey:let i=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;n.trigger(r.NEED_KEY,{key:new ls(i,"cenc")});break;case a.keyerror:if(t=y(h,e.sessionId),t||(t=y(f,e.sessionId)),t){let i=Na.MEDIA_KEYERR_CODE,a="";switch(e.errorCode.code){case 1:i=Na.MEDIA_KEYERR_UNKNOWN_CODE,a+="MEDIA_KEYERR_UNKNOWN - "+Na.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:i=Na.MEDIA_KEYERR_CLIENT_CODE,a+="MEDIA_KEYERR_CLIENT - "+Na.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:i=Na.MEDIA_KEYERR_SERVICE_CODE,a+="MEDIA_KEYERR_SERVICE - "+Na.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:i=Na.MEDIA_KEYERR_OUTPUT_CODE,a+="MEDIA_KEYERR_OUTPUT - "+Na.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:i=Na.MEDIA_KEYERR_HARDWARECHANGE_CODE,a+="MEDIA_KEYERR_HARDWARECHANGE - "+Na.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:i=Na.MEDIA_KEYERR_DOMAIN_CODE,a+="MEDIA_KEYERR_DOMAIN - "+Na.MEDIA_KEYERR_DOMAIN_MESSAGE}a+="  System Code = "+e.systemCode,n.trigger(r.KEY_ERROR,{data:new M(i,a,t)})}else l.error("No session token found for key error");break;case a.keyadded:t=y(h,e.sessionId),t||(t=y(f,e.sessionId)),t?(l.debug("DRM: Key added."),n.trigger(r.KEY_ADDED,{data:t})):l.debug("No session token found for key added");break;case a.keymessage:if(g=null!==e.sessionId&&void 0!==e.sessionId,g?(t=y(h,e.sessionId),!t&&f.length>0&&(t=f.shift(),h.push(t),t.sessionID=e.sessionId,n.trigger(r.KEY_SESSION_CREATED,{data:t}))):f.length>0&&(t=f.shift(),h.push(t),0!==f.length&&s.error(new M(Na.MEDIA_KEY_MESSAGE_ERROR_CODE,Na.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){let i=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=i,n.trigger(r.INTERNAL_KEY_MESSAGE,{data:new us(t,i,e.defaultURL)})}else l.warn("No session token found for key message")}}},o}ps.__dashjs_factory_name="ProtectionModel_01b";const ms=dashjs.FactoryMaker.getClassFactory(ps),Es=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],ys=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function _s(){let e;const t=this.context;function n(e,t){for(let n=0;n<t.length;n++){const r=t[n];if("function"==typeof e[r[Object.keys(r)[0]]])return r}return null}return e={createProtectionSystem:function(r){let i=null;const a=ss(t).getInstance();a.setConfig({debug:r.debug,BASE64:r.BASE64}),a.initialize();let s=function(r){const i=r.debug,a=i.getLogger(e),s=r.eventBus,o=r.errHandler,l=r.videoModel?r.videoModel.getElement():null;return l&&void 0===l.onencrypted||l&&void 0===l.mediaKeys?n(l,ys)?(a.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),gs(t).create({debug:i,eventBus:s,events:r.events,api:n(l,ys)})):n(l,Es)?(a.info("EME detected on this user agent! (ProtectionModel_01b)"),ms(t).create({debug:i,eventBus:s,errHandler:o,events:r.events,api:n(l,Es)})):(a.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(a.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),fs(t).create({debug:i,eventBus:s,events:r.events}))}(r);return!i&&s&&(i=Ma(t).create({protectionModel:s,protectionKeyController:a,eventBus:r.eventBus,debug:r.debug,events:r.events,BASE64:r.BASE64,constants:r.constants,cmcdModel:r.cmcdModel,settings:r.settings}),r.capabilities.setEncryptedMediaSupported(!0)),i}},e}_s.__dashjs_factory_name="Protection";const Ts=dashjs.FactoryMaker.getClassFactory(_s);Ts.events=os,Ts.errors=Na,dashjs.FactoryMaker.updateClassFactory(_s.__dashjs_factory_name,Ts);const vs=Ts;let Ss,As=function(){let e;function t(t,n,r){if(!t||!/^VIDEO$/i.test(t.nodeName))return null;if(t._dashjs_player)return t._dashjs_player;let i,a=t.id||t.name||"video element";if(!(n=n||[].slice.call(t.querySelectorAll("source")).filter((function(e){return"application/dash+xml"==e.type}))[0])&&t.src)(n=document.createElement("source")).src=t.src;else if(!n&&!t.src)return null;return i=Bi(r=r||{}).create(),i.initialize(t,n.src,t.autoplay),e||(e=i.getDebug().getLogger()),e.debug("Converted "+a+" to dash.js player and added content: "+n.src),t._dashjs_player=i,i}function n(e){return/^VIDEO$/i.test(e.nodeName)?e:n(e.parentNode)}return{create:t,createAll:function(e,r){let i=[];e=e||"[data-dashjs-player]";let a=(r=r||document).querySelectorAll(e);for(let e=0;e<a.length;e++){let n=t(a[e],null);i.push(n)}let s=r.querySelectorAll('source[type="application/dash+xml"]');for(let e=0;e<s.length;e++){let r=t(n(s[e]),null);i.push(r)}return i}}}();!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?As.createAll():Ss=window.setInterval((function(){window.dashjs&&(window.clearInterval(Ss),As.createAll())}),500):window.addEventListener("load",(function e(){window.removeEventListener("load",e),As.createAll()})));const Rs=As;dashjs.Protection=vs,dashjs.MetricsReporting=ba,dashjs.MediaPlayerFactory=Rs,dashjs.Debug=_,dashjs.supportsMediaSource=Vr;const bs=dashjs},1805:e=>{"use strict";var t=Array.isArray,n=Object.keys,r=Object.prototype.hasOwnProperty;e.exports=function e(i,a){if(i===a)return!0;if(i&&a&&"object"==typeof i&&"object"==typeof a){var s,o,l,u=t(i),c=t(a);if(u&&c){if((o=i.length)!=a.length)return!1;for(s=o;0!=s--;)if(!e(i[s],a[s]))return!1;return!0}if(u!=c)return!1;var d=i instanceof Date,f=a instanceof Date;if(d!=f)return!1;if(d&&f)return i.getTime()==a.getTime();var h=i instanceof RegExp,g=a instanceof RegExp;if(h!=g)return!1;if(h&&g)return i.toString()==a.toString();var p=n(i);if((o=p.length)!==n(a).length)return!1;for(s=o;0!=s--;)if(!r.call(a,p[s]))return!1;for(s=o;0!=s--;)if(!e(i[l=p[s]],a[l]))return!1;return!0}return i!=i&&a!=a}},5987:e=>{"use strict";var t={single_source_shortest_paths:function(e,n,r){var i={},a={};a[n]=0;var s,o,l,u,c,d,f,h=t.PriorityQueue.make();for(h.push(n,0);!h.empty();)for(l in o=(s=h.pop()).value,u=s.cost,c=e[o]||{})c.hasOwnProperty(l)&&(d=u+c[l],f=a[l],(void 0===a[l]||f>d)&&(a[l]=d,h.push(l,d),i[l]=o));if(void 0!==r&&void 0===a[r]){var g=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(g)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(e,n,r){var i=t.single_source_shortest_paths(e,n,r);return t.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(e){var n,r=t.PriorityQueue,i={};for(n in e=e||{},r)r.hasOwnProperty(n)&&(i[n]=r[n]);return i.queue=[],i.sorter=e.sorter||r.default_sorter,i},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};e.exports=t},624:e=>{function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},t.prototype.once=function(e,t){var n=this;function r(){n.off(e,r),t.apply(this,arguments)}return this._callbacks=this._callbacks||{},r.fn=t,this.on(e,r),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks[e];if(!r)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var i=0;i<r.length;i++)if((n=r[i])===t||n.fn===t){r.splice(i,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n)for(var r=0,i=(n=n.slice(0)).length;r<i;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}},2378:e=>{"use strict";e.exports=function(e){for(var t=[],n=e.length,r=0;r<n;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319&&n>r+1){var a=e.charCodeAt(r+1);a>=56320&&a<=57343&&(i=1024*(i-55296)+a-56320+65536,r+=1)}i<128?t.push(i):i<2048?(t.push(i>>6|192),t.push(63&i|128)):i<55296||i>=57344&&i<65536?(t.push(i>>12|224),t.push(i>>6&63|128),t.push(63&i|128)):i>=65536&&i<=1114111?(t.push(i>>18|240),t.push(i>>12&63|128),t.push(i>>6&63|128),t.push(63&i|128)):t.push(239,191,189)}return new Uint8Array(t).buffer}},7631:function(e){var t;"undefined"!=typeof window&&(t=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function a(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,n,r,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new s(n,r||e,a),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,a=n.length,s=new Array(a);r<a;r++)s[r]=n[r].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,r,a,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,a),!0;case 6:return c.fn.call(c.context,t,n,r,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,r);break;default:if(!l)for(f=1,l=new Array(d-1);f<d;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||r&&!s[o].once||n&&s[o].context!==n)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,e.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":function(e,t,n){var r,i,a,s,o;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=o.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=o.normalizePath(r.path),o.buildURLFromParts(r)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return n.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var l=i.exec(s.path);s.netLoc=l[1],s.path=l[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var c=s.path,d=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=o.normalizePath(d)}else u.path=s.path,a.params||(u.params=s.params,a.query||(u.query=s.query));return null===u.path&&(u.path=n.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(u)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},"./node_modules/webworkify-webpack/index.js":function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function a(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(e,t,r){var s={};s[r]=[];var o=t.toString(),l=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return s;for(var u,c=l[1],d=new RegExp("(\\\\n|\\W)"+a(c)+i,"g");u=d.exec(o);)"dll-reference"!==u[3]&&s[r].push(u[3]);for(d=new RegExp("\\("+a(c)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+i,"g");u=d.exec(o);)e[u[2]]||(s[r].push(u[1]),e[u[2]]=n(u[1]).m),s[u[2]]=s[u[2]]||[],s[u[2]].push(u[4]);for(var f,h=Object.keys(s),g=0;g<h.length;g++)for(var p=0;p<s[h[g]].length;p++)f=s[h[g]][p],isNaN(1*f)||(s[h[g]][p]=1*s[h[g]][p]);return s}function o(e){return Object.keys(e).reduce((function(t,n){return t||e[n].length>0}),!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},a=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};o(n);)for(var a=Object.keys(n),l=0;l<a.length;l++){var u=a[l],c=n[u].pop();if(i[u]=i[u]||{},!i[u][c]&&e[u][c]){i[u][c]=!0,r[u]=r[u]||[],r[u].push(c);for(var d=s(e,e[u][c],u),f=Object.keys(d),h=0;h<f.length;h++)n[f[h]]=n[f[h]]||[],n[f[h]]=n[f[h]].concat(d[f[h]])}}return r}(i,e),l="";Object.keys(a).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;a[e][t];)t++;a[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+a[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),l=l+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+a.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);";var u=new window.Blob([l],{type:"text/javascript"});if(t.bare)return u;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),d=new window.Worker(c);return d.objectURL=c,d}},"./src/crypt/decrypter.js":function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),a=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],a=n[2],s=n[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],f=new Uint32Array(256),h=0,g=0,p=0;for(p=0;p<256;p++)f[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var m=g^g<<1^g<<2^g<<3^g<<4;m=m>>>8^255&m^99,e[h]=m,t[m]=h;var E=f[h],y=f[E],_=f[y],T=257*f[m]^16843008*m;r[h]=T<<24|T>>>8,i[h]=T<<16|T>>>16,a[h]=T<<8|T>>>24,s[h]=T,T=16843009*_^65537*y^257*E^16843008*h,l[m]=T<<24|T>>>8,u[m]=T<<16|T>>>16,c[m]=T<<8|T>>>24,d[m]=T,h?(h=E^f[f[f[_^E]]],g^=f[f[g]]):h=g=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var a,s,o,l,u=this.ksRows=4*(i+6+1),c=this.keySchedule=new Uint32Array(u),d=this.invKeySchedule=new Uint32Array(u),f=this.sBox,h=this.rcon,g=this.invSubMix,p=g[0],m=g[1],E=g[2],y=g[3];for(a=0;a<u;a++)a<i?o=c[a]=t[a]:(l=o,a%i==0?(l=f[(l=l<<8|l>>>24)>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l],l^=h[a/i|0]<<24):i>6&&a%i==4&&(l=f[l>>>24]<<24|f[l>>>16&255]<<16|f[l>>>8&255]<<8|f[255&l]),c[a]=o=(c[a-i]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?c[a]:c[a-4],d[s]=s<4||a<=4?l:p[f[l>>>24]]^m[f[l>>>16&255]]^E[f[l>>>8&255]]^y[f[255&l]],d[s]=d[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n,r){for(var i,a,s,o,l,u,c,d,f,h,g,p,m,E,y,_,T,v=this.keySize+6,S=this.invKeySchedule,A=this.invSBox,R=this.invSubMix,b=R[0],I=R[1],D=R[2],w=R[3],C=this.uint8ArrayToUint32Array_(n),N=C[0],L=C[1],M=C[2],O=C[3],P=new Int32Array(e),x=new Int32Array(P.length),F=this.networkToHostOrderSwap;t<P.length;){for(f=F(P[t]),h=F(P[t+1]),g=F(P[t+2]),p=F(P[t+3]),l=f^S[0],u=p^S[1],c=g^S[2],d=h^S[3],m=4,E=1;E<v;E++)i=b[l>>>24]^I[u>>16&255]^D[c>>8&255]^w[255&d]^S[m],a=b[u>>>24]^I[c>>16&255]^D[d>>8&255]^w[255&l]^S[m+1],s=b[c>>>24]^I[d>>16&255]^D[l>>8&255]^w[255&u]^S[m+2],o=b[d>>>24]^I[l>>16&255]^D[u>>8&255]^w[255&c]^S[m+3],l=i,u=a,c=s,d=o,m+=4;i=A[l>>>24]<<24^A[u>>16&255]<<16^A[c>>8&255]<<8^A[255&d]^S[m],a=A[u>>>24]<<24^A[c>>16&255]<<16^A[d>>8&255]<<8^A[255&l]^S[m+1],s=A[c>>>24]<<24^A[d>>16&255]<<16^A[l>>8&255]<<8^A[255&u]^S[m+2],o=A[d>>>24]<<24^A[l>>16&255]<<16^A[u>>8&255]<<8^A[255&c]^S[m+3],m+=3,x[t]=F(i^N),x[t+1]=F(o^L),x[t+2]=F(s^M),x[t+3]=F(a^O),N=f,L=h,M=g,O=p,t+=4}return r?(T=(_=(y=x.buffer).byteLength)&&new DataView(y).getUint8(_-1))?y.slice(0,_-T):y:x.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),s=a,o=n("./src/errors.ts"),l=n("./src/utils/logger.js"),u=n("./src/events.js"),c=n("./src/utils/get-self-scope.js"),d=Object(c.getSelfScope)(),f=function(){function e(e,t,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var a=d.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,n,a){var o=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(l.logger.log("JS AES decrypt"),this.logEnabled=!1);var u=this.decryptor;u||(this.decryptor=u=new s),u.expandKey(t),a(u.decrypt(e,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(l.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var c=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new i(c,t)),this.fastAesKey.expandKey().then((function(i){new r(c,n).decrypt(e,i).catch((function(r){o.onWebCryptoError(r,e,t,n,a)})).then((function(e){a(e)}))})).catch((function(r){o.onWebCryptoError(r,e,t,n,a)}))}},t.onWebCryptoError=function(e,t,n,r,i){this.config.enableSoftwareAES?(l.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(l.logger.error("decrypting error : "+e.message),this.observer.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=f},"./src/demux/demuxer-inline.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/events.js"),i=n("./src/errors.ts"),a=n("./src/crypt/decrypter.js"),s=n("./src/polyfills/number.js"),o=n("./src/utils/logger.js"),l=n("./src/utils/get-self-scope.js");function u(e,t){return 255===e[t]&&240==(246&e[t+1])}function c(e,t){return 1&e[t+1]?7:9}function d(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function f(e,t){return!!(t+1<e.length&&u(e,t))}function h(e,t){if(f(e,t)){var n=c(e,t);if(t+n>=e.length)return!1;var r=d(e,t);if(r<=n)return!1;var i=t+r;if(i===e.length||i+1<e.length&&u(e,i))return!0}return!1}function g(e,t,n,a,s){if(!e.samplerate){var l=function(e,t,n,a){var s,l,u,c,d,f=navigator.userAgent.toLowerCase(),h=a,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(s=1+((192&t[n+2])>>>6),!((l=(60&t[n+2])>>>2)>g.length-1))return c=(1&t[n+2])<<2,c|=(192&t[n+3])>>>6,o.logger.log("manifest codec:"+a+",ADTS data:type:"+s+",sampleingIndex:"+l+"["+g[l]+"Hz],channelConfig:"+c),/firefox/i.test(f)?l>=6?(s=5,d=new Array(4),u=l-3):(s=2,d=new Array(2),u=l):-1!==f.indexOf("android")?(s=2,d=new Array(2),u=l):(s=5,d=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&l>=6?u=l-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(l>=6&&1===c||/vivaldi/i.test(f))||!a&&1===c)&&(s=2,d=new Array(2)),u=l)),d[0]=s<<3,d[0]|=(14&l)>>1,d[1]|=(1&l)<<7,d[1]|=c<<3,5===s&&(d[1]|=(14&u)>>1,d[2]=(1&u)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:g[l],channelCount:c,codec:"mp4a.40."+s,manifestCodec:h};e.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l})}(t,n,a,s);e.config=l.config,e.samplerate=l.samplerate,e.channelCount=l.channelCount,e.codec=l.codec,e.manifestCodec=l.manifestCodec,o.logger.log("parsed codec:"+e.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)}}function p(e){return 9216e4/e}function m(e,t,n,r,i){var a=function(e,t,n,r,i){var a,s,o=e.length;if(a=c(e,t),s=d(e,t),(s-=a)>0&&t+a+s<=o)return{headerLength:a,frameLength:s,stamp:n+r*i}}(t,n,r,i,p(e.samplerate));if(a){var s=a.stamp,o=a.headerLength,l=a.frameLength,u={unit:t.subarray(n+o,n+o+l),pts:s,dts:s};return e.samples.push(u),{sample:u,length:l+o}}}var E=n("./src/demux/id3.js"),y=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(E.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(h(e,t))return o.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=this._audioTrack,a=E.default.getID3Data(e,0)||[],l=E.default.getTimeStamp(a),u=Object(s.isFiniteNumber)(l)?90*l:9e4*t,c=0,d=u,h=e.length,p=a.length,y=[{pts:d,dts:d,data:a}];p<h-1;)if(f(e,p)&&p+5<h){g(i,this.observer,e,p,i.manifestCodec);var _=m(i,e,p,u,c);if(!_){o.logger.log("Unable to parse AAC frame");break}p+=_.length,d=_.sample.pts,c++}else E.default.isHeader(e,p)?(a=E.default.getID3Data(e,p),y.push({pts:d,dts:d,data:a}),p+=a.length):p++;this.remuxer.remux(i,{samples:[]},{samples:y,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),_=n("./src/demux/mp4demuxer.js"),T={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var a=this.parseHeader(t,n);if(a&&n+a.frameLength<=t.length){var s=r+i*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(n,n+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength}}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==a){var o=3===n?3-r:3===r?3:4,l=1e3*T.BitratesMap[14*o+i-1],u=3===n?0:2===n?1:2,c=T.SamplingRateMap[3*u+a],d=e[t+3]>>6==3?1:2,f=T.SamplesCoefficients[n][r],h=T.BytesInSlot[r],g=8*f*h;return{sampleRate:c,channelCount:d,frameLength:parseInt(f*l/c+s,10)*h,samplesPerFrame:g}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;n&&n.frameLength&&(r=n.frameLength);var i=t+r;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}},v=T,S=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&o.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,n=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(n+this.readEG()+256)%256),n=0===r?n:r},t.readSPS=function(){var e,t,n,r,i,a,s,o=0,l=0,u=0,c=0,d=this.readUByte.bind(this),f=this.readBits.bind(this),h=this.readUEG.bind(this),g=this.readBoolean.bind(this),p=this.skipBits.bind(this),m=this.skipEG.bind(this),E=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);if(d(),e=d(),f(5),p(3),d(),E(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var _=h();if(3===_&&p(1),E(),E(),p(1),g())for(a=3!==_?8:12,s=0;s<a;s++)g()&&y(s<6?16:64)}E();var T=h();if(0===T)h();else if(1===T)for(p(1),m(),m(),t=h(),s=0;s<t;s++)m();E(),p(1),n=h(),r=h(),0===(i=f(1))&&p(1),p(1),g()&&(o=h(),l=h(),u=h(),c=h());var v=[1,1];if(g()&&g())switch(d()){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:v=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(n+1)-2*o-2*l),height:(2-i)*(r+1)*16-(i?2:4)*(u+c),pixelRatio:v}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),A=S,R=function(){function e(e,t,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new a.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,a=i.subarray(16,i.length-i.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this.decryptBuffer(s,(function(a){a=new Uint8Array(a),i.set(a,16),r||o.decryptAacSamples(e,t+1,n)}))},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,n,r,i,a){var s=this.discardEPB(i.data),o=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(o.buffer,(function(o){i.data=l.getAvcDecryptedUnit(s,o),a||l.decryptAvcSamples(e,t,n+1,r)}))},t.decryptAvcSamples=function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var a=i[n];if(!(a.data.length<=48||1!==a.type&&5!==a.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,a,s),!s)return}}}},e}(),b={video:1,audio:2,id3:3,text:4},I=function(){function e(e,t,n,r){this.observer=e,this.config=n,this.typeSupported=r,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new R(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var n=e._syncOffset(t);return!(n<0||(n&&o.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),0))},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:b[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,n,a,s){var l,u,c,d,f,h=t.length,g=!1;this.pmtUnknownTypes={},this.contiguous=a;var p=this.pmtParsed,m=this._avcTrack,E=this._audioTrack,y=this._id3Track,_=m.pid,T=E.pid,v=y.pid,S=this._pmtId,A=m.pesData,R=E.pesData,b=y.pesData,I=this._parsePAT,D=this._parsePMT.bind(this),w=this._parsePES,C=this._parseAVCPES.bind(this),N=this._parseAACPES.bind(this),L=this._parseMPEGPES.bind(this),M=this._parseID3PES.bind(this),O=e._syncOffset(t);for(h-=(h+O)%188,l=O;l<h;l+=188)if(71===t[l]){if(u=!!(64&t[l+1]),c=((31&t[l+1])<<8)+t[l+2],(48&t[l+3])>>4>1){if((d=l+5+t[l+4])===l+188)continue}else d=l+4;switch(c){case _:u&&(A&&(f=w(A))&&C(f,!1),A={data:[],size:0}),A&&(A.data.push(t.subarray(d,l+188)),A.size+=l+188-d);break;case T:u&&(R&&(f=w(R))&&(E.isAAC?N(f):L(f)),R={data:[],size:0}),R&&(R.data.push(t.subarray(d,l+188)),R.size+=l+188-d);break;case v:u&&(b&&(f=w(b))&&M(f),b={data:[],size:0}),b&&(b.data.push(t.subarray(d,l+188)),b.size+=l+188-d);break;case 0:u&&(d+=t[d]+1),S=this._pmtId=I(t,d);break;case S:u&&(d+=t[d]+1);var P=D(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(_=P.avc)>0&&(m.pid=_),(T=P.audio)>0&&(E.pid=T,E.isAAC=P.isAAC),(v=P.id3)>0&&(y.pid=v),g&&!p&&(o.logger.log("reparse from beginning"),g=!1,l=O-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:g=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});A&&(f=w(A))?(C(f,!0),m.pesData=null):m.pesData=A,R&&(f=w(R))?(E.isAAC?N(f):L(f),E.pesData=null):(R&&R.size&&o.logger.log("last AAC PES packet truncated,might overlap between fragments"),E.pesData=R),b&&(f=w(b))?(M(f),y.pesData=null):y.pesData=b,null==this.sampleAes?this.remuxer.remux(E,m,y,this._txtTrack,n,a,s):this.decryptAndRemux(E,m,y,this._txtTrack,n,a,s)},t.decryptAndRemux=function(e,t,n,r,i,a,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,(function(){o.decryptAndRemuxAvc(e,t,n,r,i,a,s)}))}else this.decryptAndRemuxAvc(e,t,n,r,i,a,s)},t.decryptAndRemuxAvc=function(e,t,n,r,i,a,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,(function(){o.remuxer.remux(e,t,n,r,i,a,s)}))}else this.remuxer.remux(e,t,n,r,i,a,s)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._trackUnknownPmt=function(e,t,n){var r=this.pmtUnknownTypes[e]||0;return 0===r&&(this.pmtUnknownTypes[e]=0,t.call(o.logger,n)),this.pmtUnknownTypes[e]++,r},t._parsePMT=function(e,t,n,r){var i,a,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(a=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){this._trackUnknownPmt(e[t],o.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=a);break;case 21:-1===s.id3&&(s.id3=a);break;case 219:if(!r){this._trackUnknownPmt(e[t],o.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=a);break;case 3:case 4:n?-1===s.audio&&(s.audio=a,s.isAAC=!1):this._trackUnknownPmt(e[t],o.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],o.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],o.logger.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s},t._parsePES=function(e){var t,n,r,i,a,s,l,u,c=0,d=e.data;if(!e||0===e.size)return null;for(;d[0].length<19&&d.length>1;){var f=new Uint8Array(d[0].length+d[1].length);f.set(d[0]),f.set(d[1],d[0].length),d[0]=f,d.splice(1,1)}if(1===((t=d[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;if(192&(n=t[7])&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&n?s-(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(o.logger.warn(Math.round((s-l)/9e4)+"s delta between PTS and DTS, align them"),s=l):l=s),u=(i=t[8])+9,e.size<=u)return null;e.size-=u,a=new Uint8Array(e.size);for(var h=0,g=d.length;h<g;h++){var p=(t=d[h]).byteLength;if(u){if(u>p){u-=p;continue}t=t.subarray(u),p-=u,u=0}a.set(t,c),c+=p}return r&&(r-=i+3),{data:a,pts:s,dts:l,len:r}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;if(isNaN(e.pts)){if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&o.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var n,r,i,a=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),l=this.avcSample,u=!1,c=this.pushAccesUnit.bind(this),d=function(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}};e.data=null,l&&o.length&&!s.audFound&&(c(l,s),l=this.avcSample=d(!1,e.pts,e.dts,"")),o.forEach((function(t){switch(t.type){case 1:r=!0,l||(l=a.avcSample=d(!0,e.pts,e.dts,"")),l.frame=!0;var o=t.data;if(u&&o.length>4){var f=new A(o).readSliceType();2!==f&&4!==f&&7!==f&&9!==f||(l.key=!0)}break;case 5:r=!0,l||(l=a.avcSample=d(!0,e.pts,e.dts,"")),l.key=!0,l.frame=!0;break;case 6:r=!0,(n=new A(a.discardEPB(t.data))).readUByte();for(var h=0,g=0,p=!1,m=0;!p&&n.bytesAvailable>1;){h=0;do{h+=m=n.readUByte()}while(255===m);g=0;do{g+=m=n.readUByte()}while(255===m);if(4===h&&0!==n.bytesAvailable){if(p=!0,181===n.readUByte()&&49===n.readUShort()&&1195456820===n.readUInt()&&3===n.readUByte()){var y=n.readUByte(),_=31&y,T=[y,n.readUByte()];for(i=0;i<_;i++)T.push(n.readUByte()),T.push(n.readUByte()),T.push(n.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:e.pts,bytes:T})}}else if(5===h&&0!==n.bytesAvailable){if(p=!0,g>16){var v=[];for(i=0;i<16;i++)v.push(n.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||v.push("-");var S=g-16,R=new Uint8Array(S);for(i=0;i<S;i++)R[i]=n.readUByte();a._insertSampleInOrder(a._txtTrack.samples,{pts:e.pts,payloadType:h,uuid:v.join(""),userDataBytes:R,userData:Object(E.utf8ArrayToStr)(R.buffer)})}}else if(g<n.bytesAvailable)for(i=0;i<g;i++)n.readUByte()}break;case 7:if(r=!0,u=!0,!s.sps){var b=(n=new A(t.data)).readSPS();s.width=b.width,s.height=b.height,s.pixelRatio=b.pixelRatio,s.sps=[t.data],s.duration=a._duration;var I=t.data.subarray(1,4),D="avc1.";for(i=0;i<3;i++){var w=I[i].toString(16);w.length<2&&(w="0"+w),D+=w}s.codec=D}break;case 8:r=!0,s.pps||(s.pps=[t.data]);break;case 9:r=!1,s.audFound=!0,l&&c(l,s),l=a.avcSample=d(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,l&&(l.debug+="unknown NAL "+t.type+" ")}l&&r&&l.units.push(t)})),t&&l&&(c(l,s),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var n=this._avcTrack.samples;t=n[n.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},t._parseAVCNALu=function(e){var t,n,r,i,a=0,s=e.byteLength,o=this._avcTrack,l=o.naluState||0,u=l,c=[],d=-1;for(-1===l&&(d=0,i=31&e[0],l=0,a=1);a<s;)if(t=e[a++],l)if(1!==l)if(t)if(1===t){if(d>=0)r={data:e.subarray(d,a-l-1),type:i},c.push(r);else{var f=this._getLastNalUnit();if(f&&(u&&a<=4-u&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-u)),(n=a-l-1)>0)){var h=new Uint8Array(f.data.byteLength+n);h.set(f.data,0),h.set(e.subarray(0,n),f.data.byteLength),f.data=h}}a<s?(d=a,i=31&e[a],l=0):l=-1}else l=0;else l=3;else l=t?0:2;else l=t?0:1;if(d>=0&&l>=0&&(r={data:e.subarray(d,s),type:i,state:l},c.push(r)),0===c.length){var g=this._getLastNalUnit();if(g){var p=new Uint8Array(g.data.byteLength+e.byteLength);p.set(g.data,0),p.set(e,g.data.byteLength),g.data=p}}return o.naluState=l,c},t.discardEPB=function(e){for(var t,n,r=e.byteLength,i=[],a=1;a<r-2;)0===e[a]&&0===e[a+1]&&3===e[a+2]?(i.push(a+2),a+=2):a++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var s=0;for(a=0;a<t;s++,a++)s===i[0]&&(s++,i.shift()),n[a]=e[s];return n},t._parseAACPES=function(e){var t,n,a,s,l,u,c,d=this._audioTrack,h=e.data,E=e.pts,y=this.aacOverFlow,_=this.aacLastPTS;if(y){var T=new Uint8Array(y.byteLength+h.byteLength);T.set(y,0),T.set(h,y.byteLength),h=T}for(a=0,l=h.length;a<l-1&&!f(h,a);a++);if(!a||(a<l-1?(u="AAC PES did not start with ADTS header,offset:"+a,c=!1):(u="no ADTS header found in AAC PES",c=!0),o.logger.warn("parsing error:"+u),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:c,reason:u}),!c)){if(g(d,this.observer,h,a,this.audioCodec),n=0,t=p(d.samplerate),y&&_){var v=_+t;Math.abs(v-E)>1&&(o.logger.log("AAC: align PTS for overlapping frames by "+Math.round((v-E)/90)),E=v)}for(;a<l;){if(f(h,a)){if(a+5<l){var S=m(d,h,a,E,n);if(S){a+=S.length,s=S.sample.pts,n++;continue}}break}a++}y=a<l?h.subarray(a,l):null,this.aacOverFlow=y,this.aacLastPTS=s}},t._parseMPEGPES=function(e){for(var t=e.data,n=t.length,r=0,i=0,a=e.pts;i<n;)if(v.isHeader(t,i)){var s=v.appendFrame(this._audioTrack,t,i,a,r);if(!s)break;i+=s.length,r++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),D=I,w=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,n,r=E.default.getID3Data(e,0);if(r&&void 0!==E.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(v.probe(e,t))return o.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=E.default.getID3Data(e,0)||[],a=E.default.getTimeStamp(i),s=void 0!==a?90*a:9e4*t,o=i.length,l=e.length,u=0,c=0,d=this._audioTrack,f=[{pts:s,dts:s,data:i}];o<l;)if(v.isHeader(e,o)){var h=v.appendFrame(d,e,o,s,u);if(!h)break;o+=h.length,c=h.sample.pts,u++}else E.default.isHeader(e,o)?(i=E.default.getID3Data(e,o),f.push({pts:c,dts:c,data:i}),o+=i.length):o++;this.remuxer.remux(d,{samples:[]},{samples:f,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),C=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),N=Math.pow(2,32)-1,L=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,a=i;i--;)r+=n[i].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<a;i++)t.set(n[i],r),r+=n[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var r=Math.floor(n/(N+1)),i=Math.floor(n%(N+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var r=Math.floor(n/(N+1)),i=Math.floor(n%(N+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var n,r,i=t.samples||[],a=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,a[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,a=[],s=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,a.push(i>>>8&255),a.push(255&i),a=a.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,c=t.pixelRatio[0],d=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,a=t.height,s=Math.floor(r/(N+1)),o=Math.floor(r%(N+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),i=t.id,a=Math.floor(n/(N+1)),s=Math.floor(n%(N+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,a,s,o,l,u=t.samples||[],c=u.length,d=12+16*c,f=new Uint8Array(d);for(n+=8+d,f.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<c;r++)a=(i=u[r]).duration,s=i.size,o=i.flags,l=i.cts,f.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*r);return e.box(e.types.trun,f)},e.initSegment=function(t){e.types||e.init();var n,r=e.moov(t);return(n=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}(),M=L;function O(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function P(e,t){return void 0===t&&(t=!1),O(e,1e3,1/9e4,t)}function x(e,t){return void 0===t&&(t=1),O(e,9e4,1/t)}var F=x(10),k=x(.2),U=null,B=function(){function e(e,t,n,r){if(this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===U){var i=navigator.userAgent.match(/Chrome\/(\d+)/i);U=i?parseInt(i[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,n=e.reduce((function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,G(e,n.pts)):r>0?e:n.pts}),e[0].pts);return t&&o.logger.debug("PTS rollover detected"),n},t.remux=function(e,t,n,i,a,s,l){if(this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated){var u=e.samples.length,c=t.samples.length,d=a,f=a;if(u&&c){var h=this.getVideoStartPts(t.samples),g=(G(e.samples[0].pts,h)-h)/t.inputTimeScale;d+=Math.max(0,g),f+=Math.max(0,-g)}if(u){e.timescale||(o.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,a));var p,m=this.remuxAudio(e,d,s,l);c&&(m&&(p=m.endPTS-m.startPTS),t.timescale||(o.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,a)),this.remuxVideo(t,f,s,p))}else if(c){var E=this.remuxVideo(t,f,s,0,l);E&&e.codec&&this.remuxEmptyAudio(e,d,s,E)}}n.samples.length&&this.remuxID3(n,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(r.default.FRAG_PARSED)},t.generateIS=function(e,t,n){var a,s,l=this.observer,u=e.samples,c=t.samples,d=this.typeSupported,f="audio/mp4",h={},g={tracks:h},p=void 0===this._initPTS;if(p&&(a=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,o.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(d.mpeg?(f="audio/mpeg",e.codec=""):d.mp3&&(e.codec="mp3")),h.audio={container:f,codec:e.codec,initSegment:!e.isAAC&&d.mpeg?new Uint8Array:M.initSegment([e]),metadata:{channelCount:e.channelCount}},p&&(a=s=u[0].pts-Math.round(e.inputTimeScale*n))),t.sps&&t.pps&&c.length){var m=t.inputTimeScale;if(t.timescale=m,h.video={container:"video/mp4",codec:t.codec,initSegment:M.initSegment([t]),metadata:{width:t.width,height:t.height}},p){var E=this.getVideoStartPts(c),y=Math.round(m*n);s=Math.min(s,G(c[0].dts,E)-y),a=Math.min(a,E-y),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:a})}}else p&&h.audio&&this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:a});Object.keys(h).length?(l.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,g),this.ISGenerated=!0,p&&(this._initPTS=a,this._initDTS=s)):l.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,n,a){var s,l,u,c,d,f=e.timescale,h=e.samples,g=[],p=h.length,m=this._initPTS,E=8,y=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,T=0,v=!1,S=this.nextAvcDts;if(0!==p){n||(S=t*f-(h[0].pts-G(h[0].dts,h[0].pts)));for(var A=0;A<p;A++){var R=h[A];R.pts=G(R.pts-m,S),R.dts=G(R.dts-m,S),R.dts>R.pts&&(T=Math.max(Math.min(T,R.pts-R.dts),-1*k)),R.dts<h[A>0?A-1:A].dts&&(v=!0)}v&&h.sort((function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id})),c=h[0].dts,d=h[p-1].dts;var b=Math.round((d-c)/(p-1));if(T<0){if(T<-2*b){o.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+P(-b,!0)+" ms");for(var I=T,D=0;D<p;D++)h[D].dts=I=Math.max(I,h[D].pts-b),h[D].pts=Math.max(I,h[D].pts)}else{o.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+P(T,!0)+" ms to overcome this issue");for(var w=0;w<p;w++)h[w].dts=h[w].dts+T}c=h[0].dts,d=h[p-1].dts}if(n){var C=c-S,N=C>b;if(N||C<-1){N?o.logger.warn("AVC: "+P(C,!0)+" ms ("+C+"dts) hole between fragments detected, filling it"):o.logger.warn("AVC: "+P(-C,!0)+" ms ("+C+"dts) overlapping between fragments detected"),c=S;var L=h[0].pts-C;h[0].dts=c,h[0].pts=L,o.logger.log("Video: First PTS/DTS adjusted: "+P(L,!0)+"/"+P(c,!0)+", delta: "+P(C,!0)+" ms")}}U&&U<75&&(c=Math.max(0,c));for(var O=0,x=0,F=0;F<p;F++){for(var B=h[F],q=B.units,K=q.length,H=0,Y=0;Y<K;Y++)H+=q[Y].data.length;x+=H,O+=K,B.length=H,B.dts=Math.max(B.dts,c),B.pts=Math.max(B.pts,B.dts,0),y=Math.min(B.pts,y),_=Math.max(B.pts,_)}d=h[p-1].dts;var V=x+4*O+8;try{l=new Uint8Array(V)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:V,reason:"fail allocating video mdat "+V})}var j=new DataView(l.buffer);j.setUint32(0,V),l.set(M.types.mdat,4);for(var z=0;z<p;z++){for(var W,$=h[z],X=$.units,Q=0,J=0,Z=X.length;J<Z;J++){var ee=X[J],te=ee.data,ne=ee.data.byteLength;j.setUint32(E,ne),E+=4,l.set(te,E),E+=ne,Q+=4+ne}if(z<p-1)s=h[z+1].dts-$.dts;else{var re=this.config,ie=$.dts-h[z>0?z-1:z].dts;if(re.stretchShortVideoTrack){var ae=re.maxBufferHole,se=Math.floor(ae*f),oe=(a?y+a*f:this.nextAudioPts)-$.pts;oe>se?((s=oe-ie)<0&&(s=ie),o.logger.log("It is approximately "+P(oe,!1)+" ms to the next segment; using duration "+P(s,!1)+" ms for the last video frame.")):s=ie}else s=ie}W=Math.round($.pts-$.dts),g.push({size:Q,duration:s,cts:W,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:$.key?2:1,isNonSync:$.key?0:1}})}this.nextAvcDts=d+s;var le=e.dropped;if(e.nbNalu=0,e.dropped=0,g.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ue=g[0].flags;ue.dependsOn=2,ue.isNonSync=0}e.samples=g,u=M.moof(e.sequenceNumber++,c,e),e.samples=[];var ce={data1:u,data2:l,startPTS:y/f,endPTS:(_+s)/f,startDTS:c/f,endDTS:this.nextAvcDts/f,type:"video",hasAudio:!1,hasVideo:!0,nb:g.length,dropped:le};return this.observer.trigger(r.default.FRAG_PARSING_DATA,ce),ce}},t.remuxAudio=function(e,t,n,a){var s,l,u,c,d,f,h=e.inputTimeScale,g=e.timescale,p=h/g,m=(e.isAAC?1024:1152)*p,E=this._initPTS,y=!e.isAAC&&this.typeSupported.mpeg,_=y?0:8,T=e.samples,v=[],S=this.nextAudioPts;if(n|=T.length&&S&&(a&&Math.abs(t-S/h)<.1||Math.abs(T[0].pts-S-E)<20*m),T.forEach((function(e){e.pts=e.dts=G(e.pts-E,t*h)})),T=T.filter((function(e){return e.pts>=0})),0!==T.length){if(n||(S=a?Math.max(0,t*h):T[0].pts),e.isAAC)for(var A=this.config.maxAudioFramesDrift,R=0,b=S;R<T.length;){var I=T[R],D=I.pts,w=D-b;if(w<=-A*m)n||R>0?(o.logger.warn("Dropping 1 audio frame @ "+P(b,!0)/1e3+"s due to "+P(w,!0)+" ms overlap."),T.splice(R,1)):(o.logger.warn("Audio frame @ "+P(D,!0)/1e3+"s overlaps nextAudioPts by "+P(w,!0)+" ms."),b=D+m,R++);else if(w>=A*m&&w<F&&b){var N=Math.round(w/m);o.logger.warn("Injecting "+N+" audio frames @ "+P(b,!0)/1e3+"s due to "+P(w,!0)+" ms gap.");for(var L=0;L<N;L++){var O=Math.max(b,0);(l=C.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),l=I.unit.subarray()),T.splice(R,0,{unit:l,pts:O,dts:O}),b+=m,R++}I.pts=I.dts=b,b+=m,R++}else Math.abs(w),I.pts=I.dts=b,b+=m,R++}for(var x=T.length,k=0;x--;)k+=T[x].unit.byteLength;for(var U=0,B=T.length;U<B;U++){var q=T[U],K=q.unit,H=q.pts;if(void 0!==f&&s)s.duration=Math.round((H-f)/p);else{var Y=H-S,V=0;if(n&&e.isAAC&&Y){if(Y>0&&Y<F)V=Math.round((H-S)/m),o.logger.log(P(Y,!0)+" ms hole between AAC samples detected,filling it"),V>0&&((l=C.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(l=K.subarray()),k+=V*l.length);else if(Y<-12){o.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+P(S,!0)+" ms / "+P(H,!0)+" ms / "+P(-Y,!0)+" ms"),k-=K.byteLength;continue}H=S}if(d=H,!(k>0))return;k+=_;try{u=new Uint8Array(k)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:k,reason:"fail allocating audio mdat "+k})}y||(new DataView(u.buffer).setUint32(0,k),u.set(M.types.mdat,4));for(var j=0;j<V;j++)(l=C.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(o.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),l=K.subarray()),u.set(l,_),_+=l.byteLength,s={size:l.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},v.push(s)}u.set(K,_);var z=K.byteLength;_+=z,s={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},v.push(s),f=H}var W=0;if((x=v.length)>=2&&(W=v[x-2].duration,s.duration=W),x){this.nextAudioPts=S=f+p*W,e.samples=v,c=y?new Uint8Array:M.moof(e.sequenceNumber++,d/p,e),e.samples=[];var $=d/h,X=S/h,Q={data1:c,data2:u,startPTS:$,endPTS:X,startDTS:$,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:x};return this.observer.trigger(r.default.FRAG_PARSING_DATA,Q),Q}return null}},t.remuxEmptyAudio=function(e,t,n,r){var i=e.inputTimeScale,a=i/(e.samplerate?e.samplerate:i),s=this.nextAudioPts,l=(void 0!==s?s:r.startDTS*i)+this._initDTS,u=r.endDTS*i+this._initDTS,c=1024*a,d=Math.ceil((u-l)/c),f=C.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(o.logger.warn("remux empty Audio"),f){for(var h=[],g=0;g<d;g++){var p=l+g*c;h.push({unit:f,pts:p,dts:p})}e.samples=h,this.remuxAudio(e,t,n)}else o.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e,t){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,a=this._initPTS,s=this._initDTS,o=0;o<n;o++){var l=e.samples[o];l.pts=G(l.pts-a,t*i)/i,l.dts=G(l.dts-s,t*i)/i}this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples}),e.samples=[]}},t.remuxText=function(e,t){var n=e.samples.length,i=e.inputTimeScale,a=this._initPTS;if(n){for(var s=0;s<n;s++){var o=e.samples[s];o.pts=G(o.pts-a,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts})),this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e}();function G(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}var q,K=B,H=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,n,i,a,s,o,l){var u=this.observer,c="";e&&(c+="audio"),t&&(c+="video"),u.trigger(r.default.FRAG_PARSING_DATA,{data1:l,startPTS:a,startDTS:a,type:c,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(r.default.FRAG_PARSED)},e}(),Y=Object(l.getSelfScope)();try{q=Y.performance.now.bind(Y.performance)}catch(e){o.logger.debug("Unable to use Performance API on this environment"),q=Y.Date.now}var V=function(){function e(e,t,n,r){this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,n,i,s,o,l,u,c,d,f,h){var g=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var p=this.decrypter;null==p&&(p=this.decrypter=new a.default(this.observer,this.config));var m=q();p.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var a=q();g.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:a}}),g.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,s,o,l,u,c,d,f,h)}))}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,s,o,l,u,c,d,f,h)},t.pushDecrypted=function(e,t,n,a,s,o,l,u,c,d,f,h){var g=this.demuxer,p=this.remuxer;if(!g||l||u){for(var m,E=this.observer,T=this.typeSupported,v=this.config,S=[{demux:D,remux:K},{demux:_.default,remux:H},{demux:y,remux:K},{demux:w,remux:K}],A=0,R=S.length;A<R&&!(m=S[A]).demux.probe(e);A++);if(!m)return void E.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});p&&p instanceof m.remux||(p=new m.remux(E,v,T,this.vendor)),g&&g instanceof m.demux||(g=new m.demux(E,p,v,T),this.probe=m.demux.probe),this.demuxer=g,this.remuxer=p}(l||u)&&(g.resetInitSegment(n,a,s,d),p.resetInitSegment()),l&&(g.resetTimeStamp(h),p.resetTimeStamp(h)),"function"==typeof g.setDecryptData&&g.setDecryptData(t),g.append(e,o,c,f)},e}();t.default=V},"./src/demux/demuxer-worker.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/demux/demuxer-inline.js"),i=n("./src/events.js"),a=n("./src/utils/logger.js"),s=n("./node_modules/eventemitter3/index.js");t.default=function(e){var t=new s.EventEmitter;t.trigger=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",(function(i){var s=i.data;switch(s.cmd){case"init":var o=JSON.parse(s.config);e.demuxer=new r.default(t,s.typeSupported,o,s.vendor),Object(a.enableLogs)(o.debug),n("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS)}})),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,(function(t,n){var r=[],i={event:t,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(i,r)}))}},"./src/demux/id3.js":function(e,t,n){"use strict";n.r(t),n.d(t,"utf8ArrayToStr",(function(){return o}));var r,i=n("./src/utils/get-self-scope.js"),a=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var r=n,i=0;e.isHeader(t,n);)i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i;if(i>0)return t.subarray(r,r+i)},e._readSize=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,(n|=(127&e[t+2])<<7)|127&e[t+3]},e.getTimeStamp=function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),a=(n+=10)+i;n+8<a;){var s=e._getFrameData(t.subarray(n)),o=e._decodeFrame(s);o&&r.push(o),n+=s.size+10}e.isFooter(t,n)&&(n+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):e._decodeTextFrame(t)},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var a=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:a}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var a=e._utf8ArrayToStr(t.data);return{key:t.type,data:a}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var n=s();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var a,o,l,u=e.length,c="",d=0;d<u;){if(0===(a=e[d++])&&t)return c;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(a);break;case 12:case 13:o=e[d++],c+=String.fromCharCode((31&a)<<6|63&o);break;case 14:o=e[d++],l=e[d++],c+=String.fromCharCode((15&a)<<12|(63&o)<<6|(63&l)<<0)}}return c},e}();function s(){var e=Object(i.getSelfScope)();return r||void 0===e.TextDecoder||(r=new e.TextDecoder("utf-8")),r}var o=a._utf8ArrayToStr;t.default=a},"./src/demux/mp4demuxer.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/utils/logger.js"),i=n("./src/events.js"),a=Math.pow(2,32)-1,s=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,n,r,a){if(t&&t.byteLength){var s=this.initData=e.parseInitSegment(t);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var o={};s.audio&&s.video?o.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:a?t:null}:(s.audio&&(o.audio={container:"audio/mp4",codec:n,initSegment:a?t:null}),s.video&&(o.video={container:"video/mp4",codec:r,initSegment:a?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:o})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var r,i,a,s,o,l,u=[];if(t.data?(o=t.start,a=t.end,t=t.data):(o=0,a=t.byteLength),!n.length)return null;for(r=o;r<a;)l=(i=e.readUint32(t,r))>1?r+i:a,e.bin2str(t.subarray(r+4,r+8))===n[0]&&(1===n.length?u.push({data:t,start:r+8,end:l}):(s=e.findBox({data:t,start:r+8,end:l},n.slice(1))).length&&(u=u.concat(s))),r=l;return u},e.parseSegmentIndex=function(t){var n,r=e.findBox(t,["moov"])[0],i=r?r.end:null,a=0,s=e.findBox(t,["sidx"]);if(!s||!s[0])return null;n=[];var o=(s=s[0]).data[0];a=0===o?8:16;var l=e.readUint32(s,a);a+=4,a+=0===o?8:16,a+=2;var u=s.end+0,c=e.readUint16(s,a);a+=2;for(var d=0;d<c;d++){var f=a,h=e.readUint32(s,f);f+=4;var g=2147483647&h;if(1==(2147483648&h)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var p=e.readUint32(s,f);f+=4,n.push({referenceSize:g,subsegmentDuration:p,info:{duration:p/l,start:u,end:u+g-1}}),u+=g,a=f+=4}return{earliestPresentationTime:0,timescale:l,version:o,referencesCount:c,references:n,moovEndOffset:i}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var a=i.data[i.start],s=0===a?12:20,o=e.readUint32(i,s),l=e.findBox(t,["mdia","mdhd"])[0];if(l){s=0===(a=l.data[l.start])?12:20;var u=e.readUint32(l,s),c=e.findBox(t,["mdia","hdlr"])[0];if(c){var d={soun:"audio",vide:"video"}[e.bin2str(c.data.subarray(c.start+8,c.start+12))];if(d){var f=e.findBox(t,["mdia","minf","stbl","stsd"]);if(f.length){f=f[0];var h=e.bin2str(f.data.subarray(f.start+12,f.start+16));r.logger.log("MP4Demuxer:"+d+":"+h+" found")}n[o]={timescale:u,type:d},n[d]={timescale:u,id:o}}}}}})),n},e.getStartDTS=function(t,n){var r,i,a;return r=e.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map((function(n){return e.findBox(n,["tfhd"]).map((function(r){var i,a,s;return i=e.readUint32(r,4),a=t[i].timescale||9e4,s=e.findBox(n,["tfdt"]).map((function(t){var n,r;return n=t.data[t.start],r=e.readUint32(t,4),1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r}))[0],s/a}))}))),a=Math.min.apply(null,i),isFinite(a)?a:0},e.offsetStartDTS=function(t,n,r){e.findBox(n,["moof","traf"]).map((function(n){return e.findBox(n,["tfhd"]).map((function(i){var s=e.readUint32(i,4),o=t[s].timescale||9e4;e.findBox(n,["tfdt"]).map((function(t){var n=t.data[t.start],i=e.readUint32(t,4);if(0===n)e.writeUint32(t,4,i-r*o);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*o,i=Math.max(i,0);var s=Math.floor(i/(a+1)),l=Math.floor(i%(a+1));e.writeUint32(t,4,s),e.writeUint32(t,8,l)}}))}))}))},t.append=function(t,n,r,a){var s=this.initData;s||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),s=this.initData);var o,l=this.initPTS;if(void 0===l){var u=e.getStartDTS(s,t);this.initPTS=l=u-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:l})}e.offsetStartDTS(s,t,l),o=e.getStartDTS(s,t),this.remuxer.remux(s.audio,s.video,null,null,o,r,a,t)},t.destroy=function(){},e}();t.default=s},"./src/errors.ts":function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"ErrorTypes",(function(){return r})),n.d(t,"ErrorDetails",(function(){return i})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(r||(r={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException"}(i||(i={}))},"./src/events.js":function(e,t,n){"use strict";n.r(t),t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return En}));var r={};n.r(r),n.d(r,"newCue",(function(){return Tt}));var i,a,s=n("./node_modules/url-toolkit/src/url-toolkit.js"),o=n("./src/errors.ts"),l=n("./src/polyfills/number.js"),u=n("./src/events.js"),c=n("./src/utils/logger.js"),d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},f=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(d[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){c.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),h=f;!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(a||(a={}));var g=n("./src/demux/mp4demuxer.js");function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m,E=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,n;return t=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(s.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&p(t.prototype,n),e}();function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.AUDIO="audio",e.VIDEO="video"}(m||(m={}));var _=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[m.AUDIO]=!1,e[m.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,n,r=e.prototype;return r.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},r.addElementaryStream=function(e){this._elementaryStreams[e]=!0},r.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},r.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},r.setDecryptDataFromLevelKey=function(e,t){var n=e;return(null==e?void 0:e.method)&&e.uri&&!e.iv&&((n=new E(e.baseuri,e.reluri)).method=e.method,n.iv=this.createInitializationVector(t)),n},t=e,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&c.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(l.isFiniteNumber)(this.programDateTime))return null;var e=Object(l.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&y(t.prototype,n),e}();function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,n;return t=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(l.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&T(t.prototype,n),e}(),S=/^(\d+)x(\d+)$/,A=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,R=function(){function e(t){for(var n in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=S.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(A.lastIndex=0;null!==(t=A.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}(),b=R,I={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function D(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var w=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,C=/#EXT-X-MEDIA:(.*)/g,N=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),L=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,M=/\.(mp4|m4s|m4v|m4a)$/i,O=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return s.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[],a={},s=!1;function o(e,t){["video","audio"].forEach((function(n){var r=e.filter((function(e){return function(e,t){var n=I[t];return!!n&&!0===n[e.slice(0,4)]}(e,n)}));if(r.length){var i=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e}for(w.lastIndex=0;null!=(r=w.exec(t));)if(r[1]){var l={},u=l.attrs=new b(r[1]);l.url=e.resolve(r[2],n);var c=u.decimalResolution("RESOLUTION");c&&(l.width=c.width,l.height=c.height),l.bitrate=u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),l.name=u.NAME,o([].concat((u.CODECS||"").split(/[ ,]+/)),l),l.videoCodec&&-1!==l.videoCodec.indexOf("avc1")&&(l.videoCodec=e.convertAVC1ToAVCOTI(l.videoCodec)),i.push(l)}else if(r[3]){var d=new b(r[3]);d["DATA-ID"]&&(s=!0,a[d["DATA-ID"]]=d)}return{levels:i,sessionData:s?a:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){var a;void 0===i&&(i=[]);var s=[],o=0;for(C.lastIndex=0;null!==(a=C.exec(t));){var l=new b(a[1]);if(l.TYPE===r){var u={attrs:l,id:o++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE,type:r,default:"YES"===l.DEFAULT,autoselect:"YES"===l.AUTOSELECT,forced:"YES"===l.FORCED,lang:l.LANGUAGE};if(l.URI&&(u.url=e.resolve(l.URI,n)),i.length){var c=e.findGroup(i,u.groupId);u.audioCodec=c?c.codec:i[0].codec}s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,n,r,i){var a,s,o,u=0,d=0,f=new v(t),h=0,g=null,p=new _,m=null;for(N.lastIndex=0;null!==(a=N.exec(e));){var y=a[1];if(y){p.duration=parseFloat(y);var T=(" "+a[2]).slice(1);p.title=T||null,p.tagList.push(T?["INF",y,T]:["INF",y])}else if(a[3]){if(Object(l.isFiniteNumber)(p.duration)){var S=u++;p.type=r,p.start=d,o&&(p.levelkey=o),p.sn=S,p.level=n,p.cc=h,p.urlId=i,p.baseurl=t,p.relurl=(" "+a[3]).slice(1),P(p,g),f.fragments.push(p),g=p,d+=p.duration,p=new _}}else if(a[4]){var A=(" "+a[4]).slice(1);g?p.setByteRange(A,g):p.setByteRange(A)}else if(a[5])p.rawProgramDateTime=(" "+a[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),null===m&&(m=f.fragments.length);else{if(!(a=a[0].match(L))){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<a.length&&void 0===a[s];s++);var R=(" "+a[s+1]).slice(1),I=(" "+a[s+2]).slice(1);switch(a[s]){case"#":p.tagList.push(I?[R,I]:[R]);break;case"PLAYLIST-TYPE":f.type=R.toUpperCase();break;case"MEDIA-SEQUENCE":u=f.startSN=parseInt(R);break;case"TARGETDURATION":f.targetduration=parseFloat(R);break;case"VERSION":f.version=parseInt(R);break;case"EXTM3U":break;case"ENDLIST":f.live=!1;break;case"DIS":h++,p.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":h=parseInt(R);break;case"KEY":var D=new b(R),w=D.enumeratedString("METHOD"),C=D.URI,O=D.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(D.KEYFORMAT||"identity")){c.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}w&&(o=new E(t,C),C&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(w)>=0&&(o.method=w,o.key=null,o.iv=O));break;case"START":var x=new b(R).decimalFloatingPoint("TIME-OFFSET");Object(l.isFiniteNumber)(x)&&(f.startTimeOffset=x);break;case"MAP":var F=new b(R);p.relurl=F.URI,F.BYTERANGE&&p.setByteRange(F.BYTERANGE),p.baseurl=t,p.level=n,p.type=r,p.sn="initSegment",f.initSegment=p,(p=new _).rawProgramDateTime=f.initSegment.rawProgramDateTime;break;default:c.logger.warn("line parsed but not handled: "+a)}}}return(p=g)&&!p.relurl&&(f.fragments.pop(),d-=p.duration),f.totalduration=d,f.averagetargetduration=d/f.fragments.length,f.endSN=u-1,f.startCC=f.fragments[0]?f.fragments[0].cc:0,f.endCC=h,!f.initSegment&&f.fragments.length&&f.fragments.every((function(e){return M.test(e.relurl)}))&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(p=new _).relurl=f.fragments[0].relurl,p.baseurl=t,p.level=n,p.type=r,p.sn="initSegment",f.initSegment=p,f.needSidxRanges=!0),m&&function(e,t){for(var n=e[t],r=t-1;r>=0;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(f.fragments,m),f},e}();function P(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):(null==t?void 0:t.programDateTime)&&(e.programDateTime=t.endProgramDateTime),Object(l.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var x=window.performance,F=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADING,u.default.LEVEL_LOADING,u.default.AUDIO_TRACK_LOADING,u.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return a.AUDIO;case i.SUBTITLE_TRACK:return a.SUBTITLE;default:return a.MAIN}},r.getResponseUrl=function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n};var s=r.prototype;return s.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},s.getInternalLoader=function(e){return this.loaders[e.type]},s.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},s.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},s.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},s.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},s.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},s.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},s.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},s.load=function(e){var t=this.hls.config;c.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n,r,a,s,o=this.getInternalLoader(e);if(o){var l=o.context;if(l&&l.url===e.url)return c.logger.trace("playlist request ongoing"),!1;c.logger.warn("aborting previous loader for type: "+e.type),o.abort()}switch(e.type){case i.MANIFEST:n=t.manifestLoadingMaxRetry,r=t.manifestLoadingTimeOut,a=t.manifestLoadingRetryDelay,s=t.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=0,s=0,a=0,r=t.levelLoadingTimeOut;break;default:n=t.levelLoadingMaxRetry,r=t.levelLoadingTimeOut,a=t.levelLoadingRetryDelay,s=t.levelLoadingMaxRetryTimeout}o=this.createInternalLoader(e);var u={timeout:r,maxRetry:n,retryDelay:a,maxRetryDelay:s},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return c.logger.debug("Calling internal loader delegate for URL: "+e.url),o.load(e,u,d),!0},s.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=x.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},s.loaderror=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!1,e)},s.loadtimeout=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!0)},s._handleMasterPlaylist=function(e,t,n,i){var a=this.hls,s=e.data,o=r.getResponseUrl(e,n),l=O.parseMasterPlaylist(s,o),d=l.levels,f=l.sessionData;if(d.length){var h=d.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),g=O.parseMasterPlaylistMedia(s,o,"AUDIO",h),p=O.parseMasterPlaylistMedia(s,o,"SUBTITLES"),m=O.parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS");if(g.length){var E=!1;g.forEach((function(e){e.url||(E=!0)})),!1===E&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(c.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}a.trigger(u.default.MANIFEST_LOADED,{levels:d,audioTracks:g,subtitles:p,captions:m,url:o,stats:t,networkDetails:i,sessionData:f})}else this._handleManifestParsingError(e,n,"no level found in manifest",i)},s._handleTrackOrLevelPlaylist=function(e,t,n,a){var s=this.hls,c=n.id,d=n.level,f=n.type,h=r.getResponseUrl(e,n),g=Object(l.isFiniteNumber)(c)?c:0,p=Object(l.isFiniteNumber)(d)?d:g,m=r.mapContextToLevelType(n),E=O.parseLevelPlaylist(e.data,h,p,m,g);if(E.tload=t.tload,E.fragments.length){if(f===i.MANIFEST){var y={url:h,details:E};s.trigger(u.default.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:h,stats:t,networkDetails:a,sessionData:null})}if(t.tparsed=x.now(),E.needSidxRanges){var _=E.initSegment.url;this.load({url:_,isSidxRequest:!0,type:f,level:d,levelDetails:E,id:c,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=E,this._handlePlaylistLoaded(e,t,n,a)}else s.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},s._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var n=g.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach((function(e,t){var n=e.info;if(i){var r=i.fragments[t];0===r.byteRange.length&&r.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}})),i&&i.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},s._handleManifestParsingError=function(e,t,n,r){this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})},s._handleNetworkError=function(e,t,n,r){var a,s;void 0===n&&(n=!1),void 0===r&&(r=null),c.logger.info("A network error occured while loading a "+e.type+"-type playlist");var l=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:a=n?o.ErrorDetails.MANIFEST_LOAD_TIMEOUT:o.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case i.LEVEL:a=n?o.ErrorDetails.LEVEL_LOAD_TIMEOUT:o.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case i.AUDIO_TRACK:a=n?o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;default:s=!1}l&&(l.abort(),this.resetInternalLoader(e.type));var d={type:o.ErrorTypes.NETWORK_ERROR,details:a,fatal:s,url:e.url,loader:l,context:e,networkDetails:t};r&&(d.response=r),this.hls.trigger(u.default.ERROR,d)},s._handlePlaylistLoaded=function(e,t,n,a){var s=n.type,o=n.level,l=n.id,c=n.levelDetails;if(c&&c.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(u.default.LEVEL_LOADED,{details:c,level:o||0,id:l||0,stats:t,networkDetails:a});else switch(s){case i.AUDIO_TRACK:this.hls.trigger(u.default.AUDIO_TRACK_LOADED,{details:c,id:l,stats:t,networkDetails:a});break;case i.SUBTITLE_TRACK:this.hls.trigger(u.default.SUBTITLE_TRACK_LOADED,{details:c,id:l,stats:t,networkDetails:a})}else this._handleManifestParsingError(e,n,"invalid target duration",a)},r}(h),k=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FRAG_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){var t=this.loaders;for(var n in t){var r=t[n];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,n=t.type,r=this.loaders,i=this.hls.config,a=i.fLoader,s=i.loader;t.loaded=0;var o,u,d,f=r[n];f&&(c.logger.warn("abort previous fragment loader for type: "+n),f.abort()),f=r[n]=t.loader=i.fLoader?new a(i):new s(i),o={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var h=t.byteRangeStartOffset,g=t.byteRangeEndOffset;Object(l.isFiniteNumber)(h)&&Object(l.isFiniteNumber)(g)&&(o.rangeStart=h,o.rangeEnd=g),u={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},f.load(o,u,d)},i.loadsuccess=function(e,t,n,r){void 0===r&&(r=null);var i=e.data,a=n.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:a,stats:t,networkDetails:r})},i.loaderror=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},i.loadtimeout=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},i.loadprogress=function(e,t,n,r){void 0===r&&(r=null);var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:r})},r}(h),U=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){for(var t in this.loaders){var n=this.loaders[t];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,n=t.type,r=this.loaders[n];if(t.decryptdata){var i=t.decryptdata.uri;if(i!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;if(r&&(c.logger.warn("abort previous key loader for type:"+n),r.abort()),!i)return void c.logger.warn("key uri is falsy");t.loader=this.loaders[n]=new a.loader(a),this.decrypturl=i,this.decryptkey=null;var s={url:i,frag:t,responseType:"arraybuffer"},o={timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:a.fragLoadingRetryDelay,maxRetryDelay:a.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(s,o,l)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}else c.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(e,t,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(u.default.KEY_LOADED,{frag:r})):c.logger.error("after key load, decryptdata unset")},i.loaderror=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},i.loadtimeout=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.NETWORK_ERROR,details:o.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},r}(h),B="NOT_LOADED",G="APPENDING",q="PARTIAL",K="OK",H=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.BUFFER_APPENDED,u.default.FRAG_BUFFERED,u.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,h.prototype.destroy.call(this),e.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var n=this.fragments,r=Object.keys(n).filter((function(r){var i=n[r];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var a=i.body;return a.startPTS<=e&&e<=a.endPTS}));if(0===r.length)return null;var i=r.pop();return n[i].body},i.detectEvictedFragments=function(e,t){var n=this;Object.keys(this.fragments).forEach((function(r){var i=n.fragments[r];if(i&&i.buffered){var a=i.range[e];if(a)for(var s=a.time,o=0;o<s.length;o++){var l=s[o];if(!n.isTimeBuffered(l.startPTS,l.endPTS,t)){n.removeFragment(i.body);break}}}}))},i.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){if(e.hasElementaryStream(n)){var i=t.timeRanges[n];r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}})))},i.getBufferedTimes=function(e,t,n){for(var r,i,a=[],s=!1,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i){a.push({startPTS:Math.max(e,n.start(o)),endPTS:Math.min(t,n.end(o))});break}if(e<i&&t>r)a.push({startPTS:Math.max(e,n.start(o)),endPTS:Math.min(t,n.end(o))}),s=!0;else if(t<=r)break}return{time:a,partial:s}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t,n,r,i=this,a=null,s=0;return Object.keys(this.fragments).forEach((function(o){var l=i.fragments[o];i.isPartial(l)&&(n=l.body.startPTS-i.bufferPadding,r=l.body.endPTS+i.bufferPadding,e>=n&&e<=r&&(t=Math.min(e-n,r-e),s<=t&&(a=l.body,s=t)))})),a},i.getState=function(e){var t=this.getFragmentKey(e),n=this.fragments[t],r=B;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?q:K:G),r},i.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},i.isTimeBuffered=function(e,t,n){for(var r,i,a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,i=n.end(a)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;Object(l.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)}))},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},r}(h),Y=function(e,t){for(var n=0,r=e.length-1,i=null,a=null;n<=r;){var s=t(a=e[i=(n+r)/2|0]);if(s>0)n=i+1;else{if(!(s<0))return a;r=i-1}}return null},V=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,n){try{if(e){var r,i=e.buffered,a=[];for(r=0;r<i.length;r++)a.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(a,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){e.sort((function(e,t){return e.start-t.start||t.end-e.end}));var r=[];if(n)for(var i=0;i<e.length;i++){var a=r.length;if(a){var s=r[a-1].end;e[i].start-s<n?e[i].end>s&&(r[a-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var o,l=0,u=t,c=t,d=0;d<r.length;d++){var f=r[d].start,h=r[d].end;if(t+n>=f&&t<h)u=f,l=(c=h)-t;else if(t+n<f){o=f;break}}return{len:l,start:u,end:c,nextStart:o}},e}(),j=n("./node_modules/eventemitter3/index.js"),z=n("./node_modules/webworkify-webpack/index.js"),W=n("./src/demux/demuxer-inline.js");function $(){return window.MediaSource||window.WebKitMediaSource}var X=n("./src/utils/get-self-scope.js"),Q=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.trigger=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))},r}(j.EventEmitter),J=Object(X.getSelfScope)(),Z=$()||{isTypeSupported:function(){return!1}},ee=function(){function e(e,t){var n=this;this.hls=e,this.id=t;var r=this.observer=new Q,i=e.config,a=function(t,r){(r=r||{}).frag=n.frag,r.id=n.id,e.trigger(t,r)};r.on(u.default.FRAG_DECRYPTED,a),r.on(u.default.FRAG_PARSING_INIT_SEGMENT,a),r.on(u.default.FRAG_PARSING_DATA,a),r.on(u.default.FRAG_PARSED,a),r.on(u.default.ERROR,a),r.on(u.default.FRAG_PARSING_METADATA,a),r.on(u.default.FRAG_PARSING_USERDATA,a),r.on(u.default.INIT_PTS_FOUND,a);var s={mp4:Z.isTypeSupported("video/mp4"),mpeg:Z.isTypeSupported("audio/mpeg"),mp3:Z.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var d;c.logger.log("demuxing in webworker");try{d=this.w=z("./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(t){e.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:s,vendor:l,id:t,config:JSON.stringify(i)})}catch(e){c.logger.warn("Error in worker:",e),c.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&J.URL.revokeObjectURL(d.objectURL),this.demuxer=new W.default(r,s,i,l),this.w=void 0}}else this.demuxer=new W.default(r,s,i,l)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},t.push=function(e,t,n,r,i,a,s,o){var u=this.w,d=Object(l.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,f=i.decryptdata,h=this.frag,g=!(h&&i.cc===h.cc),p=!(h&&i.level===h.level),m=h&&i.sn===h.sn+1,E=!p&&m;if(g&&c.logger.log(this.id+":discontinuity detected"),p&&c.logger.log(this.id+":switch detected"),this.frag=i,u)u.postMessage({cmd:"demux",data:e,decryptdata:f,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:d,discontinuity:g,trackSwitch:p,contiguous:E,duration:a,accurateTimeOffset:s,defaultInitPTS:o},e instanceof ArrayBuffer?[e]:[]);else{var y=this.demuxer;y&&y.push(e,f,t,n,r,d,g,p,E,a,s,o)}},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":J.URL.revokeObjectURL(this.w.objectURL);break;case u.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}();function te(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function ne(e,t,n){var r=e[t],i=e[n],a=i.startPTS;if(Object(l.isFiniteNumber)(a))n>t?(r.duration=a-r.start,r.duration<0&&c.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-a,i.duration<0&&c.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"));else if(n>t){var s=r.cc===i.cc;i.start=r.start+(s&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else i.start=Math.max(r.start-i.duration,0)}function re(e,t,n,r,i,a){var s=n,o=r;if(Object(l.isFiniteNumber)(t.startPTS)){var u=Math.abs(t.startPTS-n);Object(l.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,s=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),o=Math.min(r,t.endPTS),r=Math.max(r,t.endPTS),i=Math.min(i,t.startDTS),a=Math.max(a,t.endDTS)}var c=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=s,t.endPTS=r,t.minEndPTS=o,t.startDTS=i,t.endDTS=a,t.duration=r-n;var d,f,h,g=t.sn;if(!e||g<e.startSN||g>e.endSN)return 0;for(d=g-e.startSN,(f=e.fragments)[d]=t,h=d;h>0;h--)ne(f,h,h-1);for(h=d;h<f.length-1;h++)ne(f,h,h+1);return e.PTSKnown=!0,c}function ie(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n,r=0;if(ae(e,t,(function(e,i){r=e.cc-i.cc,Object(l.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,n=i),t.PTSKnown=!0})),t.PTSKnown){if(r){c.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,a=0;a<i.length;a++)i[a].cc+=r}n?re(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(!(n<0||n>r.length))for(var a=0;a<i.length;a++)i[a].start+=r[n].start}(e,t),t.PTSKnown=e.PTSKnown}}function ae(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=r;s<=i;s++){var o=e.fragments[a+s],l=t.fragments[s];if(!o||!l)break;n(o,l,s)}}function se(e,t,n){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=r/2;return e&&t.endSN===e.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var oe=function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t};function le(e,t){t.fragments.forEach((function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}})),t.PTSKnown=!0}function ue(e,t,n){!function(e,t,n){if(function(e,t,n){var r=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(r=!0),r}(e,n,t)){var r=function(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var i=function(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}(n,r[0].cc);if(i&&(!i||i.startPTS))return i;c.logger.log("No frag in previous level to align on")}else c.logger.log("No fragments to align")}(n.details,t);r&&(c.logger.log("Adjusting PTS using last level due to CC increase within current level"),le(r.start,t))}}(e,n,t),!n.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var n=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-n)/1e3+t.fragments[0].start;Object(l.isFiniteNumber)(r)&&(c.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),le(r,e))}}(n,t.details)}function ce(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(l.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(he(t,n,i))return i}return null}function de(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;return e?i=t[e.sn-t[0].sn+1]:0===n&&0===t[0].start&&(i=t[0]),i&&0===fe(n,r,i)?i:Y(t,fe.bind(null,n,r))||i}function fe(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function he(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}var ge=function(){function e(e,t,n,r){this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,n=this.media,r=this.stalled,i=n.currentTime,a=n.seeking,s=this.seeking&&!a,o=!this.seeking&&a;if(this.seeking=a,i===e){if((o||s)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var l=V.bufferInfo(n,i,0),u=l.len>0,d=l.nextStart||0;if(u||d){if(a){var f=l.len>2,h=!d||d-i>2&&!this.fragmentTracker.getPartialFragment(i);if(f||h)return;this.moved=!1}if(!this.moved&&this.stalled){var g=Math.max(d,l.start||0)-i;if(g>0&&g<=2)return void this._trySkipBufferHole(null)}var p=self.performance.now();if(null!==r){var m=p-r;!a&&m>=250&&this._reportStall(l.len);var E=V.bufferInfo(n,i,t.maxBufferHole);this._tryFixBufferStall(E,m)}else this.stalled=p}}}else if(this.moved=!0,null!==r){if(this.stallReported){var y=self.performance.now()-r;c.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(y)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,a=r.getPartialFragment(i);a&&this._trySkipBufferHole(a)||e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(c.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,c.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,r=this.media,i=r.currentTime,a=0,s=0;s<r.buffered.length;s++){var l=r.buffered.start(s);if(i+t.maxBufferHole>=a&&i<l){var d=Math.max(l+.05,r.currentTime+.1);return c.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+d),this.moved=!0,this.stalled=null,r.currentTime=d,e&&n.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+d,frag:e}),d}a=r.buffered.end(s)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var a=r+i*e.nudgeOffset;c.logger.warn("Nudging 'currentTime' from "+r+" to "+a),n.currentTime=a,t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else c.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var me=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return(n=e.call.apply(e,[this,t].concat(i))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(pe(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},r}(h),Ee="STOPPED",ye="STARTING",_e="IDLE",Te="PAUSED",ve="KEY_LOADING",Se="FRAG_LOADING",Ae="FRAG_LOADING_WAITING_RETRY",Re="WAITING_TRACK",be="PARSING",Ie="PARSED",De="BUFFER_FLUSHING",we="ENDED",Ce="ERROR",Ne="WAITING_INIT_PTS",Le="WAITING_LEVEL",Me=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Ee},i._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var i=r.getState(n);return i===q||i===K}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,n=this.mediaBuffer,r=this.state,i=t?t.currentTime:null,a=V.bufferInfo(n||t,i,this.config.maxBufferHole);if(c.logger.log("media seeking to "+(Object(l.isFiniteNumber)(i)?i.toFixed(3):i)),r===Se){var s=this.fragCurrent;if(0===a.len&&s){var o=e.maxFragLookUpTolerance,u=s.start-o,d=s.start+s.duration+o;i<u||i>d?(s.loader&&(c.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=_e):c.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===we&&(0===a.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=_e);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=Ee,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},r}(me);function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pe,xe=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.LEVELS_UPDATED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=Ee,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r.audioOnly=!1,r.bitrateTest=!1,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,s,d=r.prototype;return d.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(c.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=_e,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=Ee},d.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},d.doTick=function(){switch(this.state){case De:this.fragLoadError=0;break;case _e:this._doTickIdle();break;case Le:var e=this.levels[this.level];e&&e.details&&(this.state=_e);break;case Ae:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(c.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=_e)}this._checkBuffer(),this._checkFragmentChanged()},d._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,a=this.levels[i];if(a){var s,o=a.bitrate;s=o?Math.max(8*t.maxBufferSize/o,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var l=r<t.maxBufferHole?Math.max(2,t.maxBufferHole):t.maxBufferHole,d=V.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,l),f=d.len;if(!(f>=s)){c.logger.trace("buffer length of "+f.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var h=a.details;if(!h||h.live&&this.levelLastLoaded!==i)this.state=Le;else{if(this._streamEnded(d,h)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(u.default.BUFFER_EOS,g),void(this.state=we)}this._fetchPayloadOrEos(r,d,h)}}}}},d._fetchPayloadOrEos=function(e,t,n){var r=this.fragPrevious,i=(this.level,n.fragments),a=i.length;if(0!==a){var s,o=i[0].start,l=i[a-1].start+i[a-1].duration,u=t.end;if(n.initSegment&&!n.initSegment.data)s=n.initSegment;else if(n.live){var d=this.config.initialLiveManifestSize;if(a<d)return void c.logger.warn("Can not start playback of a level, reason: not enough fragments "+a+" < "+d);if(null===(s=this._ensureFragmentAtLivePoint(n,u,o,l,r,i)))return}else u<o&&(s=i[0]);s||(s=this._findFragment(o,r,a,i,u,l,n)),s&&(s.encrypted?this._loadKey(s,n):this._loadFragment(s,n,e,u))}},d._ensureFragmentAtLivePoint=function(e,t,n,r,i,a){var s,o=this.hls.config,u=this.media,d=1/0;if(void 0!==o.liveMaxLatencyDuration?d=o.liveMaxLatencyDuration:Object(l.isFiniteNumber)(o.liveMaxLatencyDurationCount)&&(d=o.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(n-o.maxFragLookUpTolerance,r-d)){var f=this.liveSyncPosition=this.computeLivePosition(n,e);t=f,u&&!u.paused&&u.readyState&&u.duration>f&&f>u.currentTime&&(c.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+f.toFixed(3)),u.currentTime=f),this.nextLoadPosition=f}if(e.PTSKnown&&t>r&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&i)if(e.hasProgramDateTime)c.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=ce(a,i.endProgramDateTime,o.maxFragLookUpTolerance);else{var h=i.sn+1;if(h>=e.startSN&&h<=e.endSN){var g=a[h-e.startSN];i.cc===g.cc&&(s=g,c.logger.log("live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=Y(a,(function(e){return i.cc-e.cc})))&&c.logger.log("live playlist, switching playlist, load frag with same CC: "+s.sn)}return s},d._findFragment=function(e,t,n,r,i,a,s){var o,l=this.hls.config;if(o=i<a?de(t,r,i,i>a-l.maxFragLookUpTolerance?0:l.maxFragLookUpTolerance):r[n-1]){var u=o.sn-s.startSN,d=t&&o.level===t.level,f=r[u-1],h=r[u+1];if(t&&o.sn===t.sn)if(d&&!o.backtracked)if(o.sn<s.endSN){var g=t.deltaPTS;g&&g>l.maxBufferHole&&t.dropped&&u?(o=f,c.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(o=h,this.fragmentTracker.getState(o)!==K&&c.logger.log("Re-loading fragment with SN: "+o.sn))}else o=null;else o.backtracked&&(h&&h.backtracked?(c.logger.warn("Already backtracked from fragment "+h.sn+", will not backtrack to fragment "+o.sn+". Loading fragment "+h.sn),o=h):(c.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),o.dropped=0,f?(o=f).backtracked=!0:u&&(o=null)))}return o},d._loadKey=function(e,t){c.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=ve,this.hls.trigger(u.default.KEY_LOADING,{frag:e})},d._loadFragment=function(e,t,n,r){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,"initSegment"!==e.sn&&(this.startFragRequested=!0),Object(l.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===B||i===q?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,c.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(r.toFixed(3))),this.hls.trigger(u.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new ee(this.hls,"main")),this.state=Se):i===G&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},d.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,a.MAIN)},d.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},d._checkFragmentChanged=function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),V.isBuffered(n,t)?e=this.getBufferedFrag(t):V.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(u.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},d.immediateLevelSwitch=function(){if(c.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused)||t.pause():e=!0,this.previouslyPaused=e}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},d.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&V.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},d.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,n=this.getBufferedFrag(e.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),e.paused)t=0;else{var r=this.hls.nextLoadLevel,i=this.levels[r],a=this.fragLastKbps;t=a&&this.fragCurrent?this.fragCurrent.duration*i.bitrate/(1e3*a)+1:0}var s=this.getBufferedFrag(e.currentTime+t);if(s){var o=this.followingBufferedFrag(s);if(o){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null;var u=Math.max(s.endPTS,o.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,o.duration));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},d.flushMainBuffer=function(e,t){this.state=De;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,n)},d.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new ge(n,t,this.fragmentTracker,this.hls)},d.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},d.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(l.isFiniteNumber)(t)&&c.logger.log("media seeked to "+t.toFixed(3)),this.tick()},d.onManifestLoading=function(){c.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},d.onManifestParsed=function(e){var t,n=!1,r=!1;e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&c.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},d.onLevelLoaded=function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],a=t.totalduration,s=0;if(c.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live||i.details&&i.details.live){var o=i.details;o&&t.fragments.length>0?(ie(o,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,o),t.PTSKnown&&Object(l.isFiniteNumber)(s)?c.logger.log("live playlist sliding:"+s.toFixed(3)):(c.logger.log("live playlist - outdated PTS, unknown sliding"),ue(this.fragPrevious,r,t))):(c.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,ue(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=n,this.hls.trigger(u.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=t.startTimeOffset;Object(l.isFiniteNumber)(d)?(d<0&&(c.logger.log("negative start time offset "+d+", count from end of last fragment"),d=s+a+d),c.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):t.live?(this.startPosition=this.computeLivePosition(s,t),c.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Le&&(this.state=_e),this.tick()},d.onKeyLoaded=function(){this.state===ve&&(this.state=_e,this.tick())},d.onFragLoaded=function(e){var t=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,a=e.frag;if(this.state===Se&&t&&"main"===a.type&&a.level===t.level&&a.sn===t.sn){var s=e.stats,o=r[t.level],l=o.details;if(this.bitrateTest=!1,this.stats=s,c.logger.log("Loaded "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level),a.bitrateTest&&n.nextLoadLevel)this.state=_e,this.startFragRequested=!1,s.tparsed=s.tbuffered=window.performance.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=_e,s.tparsed=s.tbuffered=window.performance.now(),l.initSegment.data=e.payload,n.trigger(u.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else{c.logger.log("Parsing "+t.sn+" of ["+l.startSN+" ,"+l.endSN+"],level "+t.level+", cc "+t.cc),this.state=be,this.pendingBuffering=!0,this.appended=!1,a.bitrateTest&&(a.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:a}));var d=!(i&&i.seeking)&&(l.PTSKnown||!l.live),f=l.initSegment?l.initSegment.data:[],h=this._getAudioCodec(o);(this.demuxer=this.demuxer||new ee(this.hls,"main")).push(e.payload,f,h,o.videoCodec,t,l.totalduration,d)}}this.fragLoadError=0},d.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===be){var r,i,a=e.tracks;if(this.audioOnly=a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio,i=a.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===o.indexOf("firefox")&&(s="mp4a.40.5"),-1!==o.indexOf("android")&&"audio/mpeg"!==i.container&&(s="mp4a.40.2",c.logger.log("Android: force audio codec to "+s)),i.levelCodec=s,i.id=e.id}for(r in(i=a.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(u.default.BUFFER_CODECS,a),a){i=a[r],c.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var l=i.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:r,data:l,parent:"main",content:"initSegment"}))}this.tick()}},d.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===be){var i=this.levels[this.level],a=n;if(Object(l.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&a.addElementaryStream(m.AUDIO),!0===e.hasVideo&&a.addElementaryStream(m.VIDEO),c.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(a.dropped=e.dropped,a.dropped)if(a.backtracked)c.logger.warn("Already backtracked on this fragment, appending with the gap",a.sn);else{var s=i.details;if(!s||a.sn!==s.startSN)return c.logger.warn("missing video frame(s), backtracking fragment",a.sn),this.fragmentTracker.removeFragment(a),a.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=_e,this.fragPrevious=a,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();c.logger.warn("missing video frame(s) on first frag, appending with gap",a.sn)}else a.backtracked=!1;var o=re(i.details,a,e.startPTS,e.endPTS,e.startDTS,e.endDTS),d=this.hls;d.trigger(u.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:o,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(n){n&&n.length&&t.state===be&&(t.appended=!0,t.pendingBuffering=!0,d.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))})),this.tick()}},d.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===be&&(this.stats.tparsed=window.performance.now(),this.state=Ie,this._checkAppendedParsed())},d.onAudioTrackSwitching=function(e){var t=this.altAudio,n=!!e.url,r=e.id;if(!n){if(this.mediaBuffer!==this.media){c.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(c.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=_e}var a=this.hls;t&&a.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:r})}},d.onAudioTrackSwitched=function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(c.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},d.onBufferCreated=function(e){var t,n,r=e.tracks,i=!1;for(var a in r){var s=r[a];"main"===s.id?(n=a,t=s,"video"===a&&(this.videoBuffer=r[a].buffer)):i=!0}i&&t?(c.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},d.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==be&&t!==Ie||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},d._checkAppendedParsed=function(){if(!(this.state!==Ie||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;c.logger.log("main buffered : "+oe(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=_e}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},d.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=!!this.media&&V.isBuffered(this.media,this.media.currentTime)&&V.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);c.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=Ae}else c.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ce;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Ce&&(e.fatal?(this.state=Ce,c.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==Le||(this.state=_e));break;case o.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==be&&this.state!==Ie||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=_e):(c.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},d._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,c.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},d._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},d.onFragLoadEmergencyAborted=function(){this.state=_e,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},d.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?m.AUDIO:m.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=_e,this.fragPrevious=null},d.onLevelsUpdated=function(e){this.levels=e.levels},d.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},d._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=this.startPosition;if(t!==n&&n>=0){if(e.seeking)return void c.logger.log("could not seek to "+n+", already seeking at "+t);var r=(e.buffered.length?e.buffered.start(0):0)-n;r>0&&r<this.config.maxBufferHole&&(c.logger.log("adjusting start position by "+r+" to match buffer start"),n+=r,this.startPosition=n),c.logger.log("seek to target start position "+n+" from current time "+t+". ready state "+e.readyState),e.currentTime=n}},d._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(c.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},i=r,(s=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}])&&Oe(i.prototype,s),r}(Me);function Fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ke=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,Pe=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s=r.prototype;return s.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},s.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},s.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},s.stopLoad=function(){this.canload=!1},s.onManifestLoaded=function(e){var t,n=[],r=[],i={},a=null,s=!1,l=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,s=s||!!e.videoCodec,l=l||!!e.audioCodec,Pe&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(a=i[e.bitrate])?a.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,n.push(e)),t&&(t.AUDIO&&te(a||e,"audio",t.AUDIO),t.SUBTITLES&&te(a||e,"text",t.SUBTITLES))})),s&&l&&(n=n.filter((function(e){return!!e.videoCodec}))),n=n.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||D(t,"audio"))&&(!n||D(n,"video"))})),e.audioTracks&&(r=e.audioTracks.filter((function(e){return!e.audioCodec||D(e.audioCodec,"audio")}))).forEach((function(e,t){e.id=t})),n.length>0){t=n[0].bitrate,n.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===t){this._firstLevel=d,c.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+t);break}var f=l&&!s;this.hls.trigger(u.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:l,video:s,altAudio:!f&&r.some((function(e){return!!e.url}))})}else this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},s.setLevelInternal=function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){c.logger.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,n.trigger(u.default.LEVEL_SWITCHING,r)}var i=t[e],a=i.details;if(!a||a.live){var s=i.urlId;n.trigger(u.default.LEVEL_LOADING,{url:i.url[s],level:e,id:s})}}else n.trigger(u.default.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},s.onError=function(e){if(e.fatal)e.type===o.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,n=!1,r=!1;switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case o.ErrorDetails.LEVEL_LOAD_ERROR:case o.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case o.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,r)}},s.recoverLevel=function(e,t,n,r){var i,a,s,o=this,l=this.hls.config,u=e.details,d=this._levels[t];if(d.loadError++,d.fragmentError=r,n){if(!(this.levelRetryCount+1<=l.levelLoadingMaxRetry))return c.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);a=Math.min(Math.pow(2,this.levelRetryCount)*l.levelLoadingRetryDelay,l.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return o.loadLevel()}),a),e.levelRetry=!0,this.levelRetryCount++,c.logger.warn("level controller, "+u+", retry in "+a+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((i=d.url.length)>1&&d.loadError<i?(d.urlId=(d.urlId+1)%i,d.details=void 0,c.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+d.urlId)):-1===this.manualLevelIndex?(s=0===t?this._levels.length-1:t-1,c.logger.warn("level controller, "+u+": switch to "+s),this.hls.nextAutoLevel=this.currentLevelIndex=s):r&&(c.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},s.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var n=this._levels[t.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},s.onLevelLoaded=function(e){var t=this,n=e.level,r=e.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var a=se(i.details,r,e.stats.trequest);c.logger.log("live playlist, reload in "+Math.round(a)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),a)}else this.clearTimer()}},s.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},s.loadLevel=function(){if(c.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,r=e.url[n];c.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(u.default.LEVEL_LOADING,{url:r,level:t,id:n})}}},s.removeLevel=function(e,t){var n=this.levels.filter((function(n,r){return r!==e||n.url.length>1&&void 0!==t&&(n.url=n.url.filter((function(e,n){return n!==t})),n.urlId=0,!0)})).map((function(e,t){var n=e.details;return n&&n.fragments&&n.fragments.forEach((function(e){e.level=t})),e}));this._levels=n,this.hls.trigger(u.default.LEVELS_UPDATED,{levels:n})},i=r,(a=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&Fe(i.prototype,a),r}(h),Ue=n("./src/demux/id3.js");function Be(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Ge(e){if(null==e?void 0:e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}var qe=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA,u.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Ge(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Be(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var a=Ue.default.getID3Frames(n[i].data);if(a){var s=Math.max(n[i].pts,0),o=i<n.length-1?n[i+1].pts:t.endPTS;o||(o=t.start+t.duration),o-s<=0&&(o=s+.25);for(var l=0;l<a.length;l++){var u=a[l];if(!Ue.default.isTimeStampFrame(u)){var c=new r(s,o,"");c.value=u,this.id3Track.addCue(c)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var r=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((r+n)/2);if(t<e[i].endTime)r=i-1;else{if(!(t>e[i].endTime))return e[i];n=i+1}}return e[n].endTime-t<t-e[r].endTime?e[n]:e[r]}(n.cues,t);if(r)for(;n.cues[0]!==r;)n.removeCue(n.cues[0])}},r}(h),Ke=qe,He=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Ye=function(){function e(e,t,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new He(t),this.fast_=new He(n)}var t=e.prototype;return t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function Ve(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var je=window.performance,ze=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s=r.prototype;return s.destroy=function(){this.clearTimer(),h.prototype.destroy.call(this)},s.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,r,i=this.hls,a=i.config,s=t.level;i.levels[s].details.live?(n=a.abrEwmaFastLive,r=a.abrEwmaSlowLive):(n=a.abrEwmaFastVoD,r=a.abrEwmaSlowVoD),this._bwEstimator=new Ye(i,r,n,a.abrEwmaDefaultEstimate)}},s._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader;if(!r||r.stats&&r.stats.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=r.stats;if(t&&i&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var a=je.now()-i.trequest,s=Math.abs(t.playbackRate);if(a>500*n.duration/s){var o=e.levels,l=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/a),d=o[n.level];if(!d)return;var f=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,h=i.total?i.total:Math.max(i.loaded,Math.round(n.duration*f/8)),g=t.currentTime,p=(h-i.loaded)/l,m=(V.bufferInfo(t,g,e.config.maxBufferHole).end-g)/s;if(m<2*n.duration/s&&p>m){var E,y,_=e.minAutoLevel;for(y=n.level-1;y>_;y--){var T=o[y].realBitrate?Math.max(o[y].realBitrate,o[y].bitrate):o[y].bitrate;if(n.duration*T/(6.4*l)<m)break}E<p&&(c.logger.warn("loading too slow, abort fragment loading and switch to level "+y+":fragLoadedDelay["+y+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+E.toFixed(1)+"<"+p.toFixed(1)+":"+m.toFixed(1)),e.nextLoadLevel=y,this._bwEstimator.sample(a,i.loaded),r.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:i}))}}}}},s.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(l.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(e.frag.bitrateTest){var a=e.stats;a.tparsed=a.tbuffered=a.tload,this.onFragBuffered(e)}}},s.onFragBuffered=function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&"main"===n.type&&Object(l.isFiniteNumber)(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;c.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},s.onError=function(e){switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},s.clearTimer=function(){clearInterval(this.timer),this.timer=null},s._findBestLevel=function(e,t,n,r,i,a,s,o,l){for(var u=i;u>=r;u--){var d=l[u];if(d){var f,h=d.details,g=h?h.totalduration/h.fragments.length:t,p=!!h&&h.live;f=u<=e?s*n:o*n;var m=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,E=m*g/f;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+m+"/"+g+"/"+a+"/"+E),f>m&&(!E||p&&!this.bitrateTestDelay||E<a))return u}}return-1},i=r,(a=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this._nextABRAutoLevel;return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,a=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,f=(V.bufferInfo(a,l,r.maxBufferHole).end-l)/u,h=this._findBestLevel(s,o,d,i,t,f,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(h>=0)return h;c.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var g=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,p=r.abrBandWidthFactor,m=r.abrBandWidthUpFactor;if(0===f){var E=this.bitrateTestDelay;E&&(g=(o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay)-E,c.logger.trace("bitrate test took "+Math.round(1e3*E)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=m=1)}return h=this._findBestLevel(s,o,d,i,t,f+g,p,m,n),Math.max(h,0)}}])&&Ve(i.prototype,a),r}(h),We=ze,$e=$(),Xe=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){c.logger.log("media source opened"),n.hls.trigger(u.default.MEDIA_ATTACHED,{media:n.media});var e=n.mediaSource;e&&e.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){c.logger.log("media source closed")},n._onMediaSourceEnded=function(){c.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var e=n.sourceBuffer.audio;c.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+n.audioTimestampOffset),e.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var t=n.parent,r=n.segments.reduce((function(e,n){return n.parent===t?e+1:e}),0),i={},a=n.sourceBuffer;for(var s in a){var o=a[s];if(!o)throw Error("handling source buffer update end error: source buffer for "+s+" uninitilized and unable to update buffered TimeRanges.");i[s]=o.buffered}n.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(e){c.logger.error("sourceBuffer error:",e),n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){h.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){c.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(c.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,c.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&$e){var n=this.mediaSource=new $e;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}},i.onMediaDetaching=function(){c.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){c.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):c.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(n){t.pendingTracks[n]=e[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var r in e)if(!t[r]){var i=e[r];if(!i)throw Error("source buffer exists for track "+r+", however track does not");var a=i.levelCodec||i.codec,s=i.container+";codecs="+a;c.logger.log("creating sourceBuffer("+s+")");try{var l=t[r]=n.addSourceBuffer(s);l.addEventListener("updateend",this._onSBUpdateEnd),l.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:l,codec:a,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){c.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var n=this.sourceBuffer[t];n&&!n.ended&&(n.ended=!0,c.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){var r=e[n];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}c.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){c.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),a=r.length-1;a>=0;a--){var s=r[a],o=n[s];if(o){var l=o.buffered;l.length>0&&i>l.start(0)&&this.removeBufferRange(s,o,0,i)&&this.hls.trigger(u.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}}else c.logger.error("flushLiveBackBuffer called without attaching media")}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var r=this.sourceBuffer[n];if(r&&!0===r.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(c.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(l.isFiniteNumber)(e))&&(c.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(t+=i.buffered.length)}}catch(e){c.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void c.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var a=r[i.type];if(!a)return void this._onSBUpdateEnd();if(a.updating)return void n.unshift(i);a.ended=!1,this.parent=i.parent,a.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){c.logger.error("error while trying to append buffer:"+r.message),n.unshift(i);var s={type:o.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1};22===r.code?(this.segments=[],s.details=o.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,s.details=o.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(c.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],s.fatal=!0)),t.trigger(u.default.ERROR,s)}}}},i.flushBuffer=function(e,t,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),c.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return c.logger.warn("abort flushing too many retries"),!0;var a=r[n];if(a){if(a.ended=!1,a.updating)return c.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,a,e,t))return this.flushBufferCounter++,!1}return c.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var a=t.buffered.start(i),s=t.buffered.end(i),o=Math.max(a,n),l=Math.min(s,r);if(Math.min(l,s)-o>.5){var u="null";return this.media&&(u=this.media.currentTime.toString()),c.logger.log("sb remove "+e+" ["+o+","+l+"], of ["+a+","+s+"], pos:"+u),t.remove(o,l),!0}}}catch(e){c.logger.warn("removeBufferRange failed",e)}return!1},r}(h),Qe=Xe;function Je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ze=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED,u.default.LEVELS_UPDATED,u.default.BUFFER_CODECS,u.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n.clientRect=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s,o=r.prototype;return o.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},o.onFpsDropLevelCapping=function(e){r.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},o.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},o.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onLevelsUpdated=function(e){this.levels=e.levels},o.onMediaDetaching=function(){this.stopCapping()},o.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},o.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,i){return r.isLevelAllowed(i,t.restrictedLevels)&&i<=e}));return this.clientRect=null,r.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},r.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},r.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,a=e.length-1,s=0;s<e.length;s+=1){var o=e[s];if((o.width>=t||o.height>=n)&&(r=o,!(i=e[s+1])||r.width!==i.width||r.height!==i.height)){a=s;break}}return a},i=r,s=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(a=[{key:"mediaWidth",get:function(){return this.getDimensions().width*r.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*r.contentScaleFactor}}])&&Je(i.prototype,a),s&&Je(i,s),r}(h),et=Ze,tt=window.performance,nt=function(e){var t,n;function r(t){return e.call(this,t,u.default.MEDIA_ATTACHING)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},i.checkFPS=function(e,t,n){var r=tt.now();if(t){if(this.lastTime){var i=r-this.lastTime,a=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/i,l=this.hls;if(l.trigger(u.default.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:n}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*s){var d=l.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=d)&&(d-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:l.currentLevel}),l.autoLevelCapping=d,l.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},r}(h),rt=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e,t=this.context;e=this.loader=new window.XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(n){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.readystatechange=function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,a=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){var o,l;r.tload=Math.max(r.tfirst,window.performance.now()),l="arraybuffer"===i.responseType?(o=t.response).byteLength:(o=t.responseText).length,r.loaded=r.total=l;var u={url:t.responseURL,data:o};this.callbacks.onSuccess(u,r,i,t)}else r.retry>=a.maxRetry||s>=400&&s<499?(c.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i,t)):(c.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,a.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),a.timeout)},t.loadtimeout=function(){c.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,t)},e}();function it(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var at=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s=r.prototype;return s.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},s.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},s.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)c.logger.warn("Invalid audio track id:",e.id);else{if(c.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},s.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},s.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},s.onError=function(e){e.type===o.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(c.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},s._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)c.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)c.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];c.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,r=t.type,i=t.id;this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:i,type:r,url:n}),this._loadTrackDetailsIfNeeded(t)}},s.doTick=function(){this._updateTrack(this._trackId)},s._selectAudioGroup=function(e){var t=this.hls.levels[e];if(t&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},s._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var i=t.filter((function(e){return e.default}));i.length?t=i:c.logger.warn("No default audio tracks defined")}var a=!1,s=function(){t.forEach((function(t){a||e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),a=!0)}))};s(),a||(r=null,s()),a||(c.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},s._needsTrackLoading=function(e){var t=e.details,n=e.url;return!(t&&!t.live||!n)},s._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;c.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:t,id:n})}},s._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,c.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},s._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,r=t.language,i=t.groupId;c.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var a=e,s=0;s<this.tracks.length;s++)if(!this.trackIdBlacklist[s]&&this.tracks[s].name===n){a=s;break}a!==e?(c.logger.log("Attempting audio-track fallback id:",a,"group-id:",this.tracks[a].groupId),this._setAudioTrack(a)):c.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')},i=r,(a=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&it(i.prototype,a),r}(me),st=at;function ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var lt=window.performance,ut=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.AUDIO_TRACKS_UPDATED,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.BUFFER_RESET,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED,u.default.INIT_PTS_FOUND)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=Ee,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r.waitingVideoCC=null,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s=r.prototype;return s.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,this.videoTrackCC=n,c.logger.log("InitPTS for cc: "+n+" found from main: "+r),this.state===Ne&&this.tick())},s.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(c.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=_e):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=ye),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=Ee},s.doTick=function(){var e,t,n,r=this.hls,i=r.config;switch(this.state){case Ce:case Te:case De:break;case ye:this.state=Re,this.loadedmetadata=!1;break;case _e:var a=this.tracks;if(!a)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=this.videoBuffer?this.videoBuffer:this.media,d=e<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,f=V.bufferInfo(s,e,d),h=V.bufferInfo(o,e,d),g=f.len,p=f.end,m=this.fragPrevious,E=Math.min(i.maxBufferLength,i.maxMaxBufferLength),y=Math.max(E,h.len),_=this.audioSwitch,T=this.trackId;if((g<y||_)&&T<a.length){if(void 0===(n=a[T].details)){this.state=Re;break}if(!_&&this._streamEnded(f,n))return this.hls.trigger(u.default.BUFFER_EOS,{type:"audio"}),void(this.state=we);var v,S=n.fragments,A=S.length,R=S[0].start,b=S[A-1].start+S[A-1].duration;if(_)if(n.live&&!n.PTSKnown)c.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),p=0;else if(p=e,n.PTSKnown&&e<R){if(!(f.end>R||f.nextStart))return;c.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=R+.05}if(n.initSegment&&!n.initSegment.data)v=n.initSegment;else if(p<=R){if(v=S[0],null!==this.videoTrackCC&&v.cc!==this.videoTrackCC&&(v=function(e,t){return Y(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(S,this.videoTrackCC)),n.live&&v.loadIdx&&v.loadIdx===this.fragLoadIdx){var I=f.nextStart?f.nextStart:R;return c.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(I+.05)),void(this.media.currentTime=I+.05)}}else{var D,w=i.maxFragLookUpTolerance,C=m?S[m.sn-S[0].sn+1]:void 0;p<b?(p>b-w&&(w=0),D=C&&!fe(p,w,C)?C:Y(S,(function(e){return fe(p,w,e)}))):D=S[A-1],D&&(v=D,R=D.start,m&&v.level===m.level&&v.sn===m.sn&&(v.sn<n.endSN?(v=S[v.sn+1-n.startSN],this.fragmentTracker.getState(v)!==K&&c.logger.log("SN just loaded, load next one: "+v.sn)):v=null))}v&&(v.encrypted?(c.logger.log("Loading key for "+v.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+T),this.state=ve,r.trigger(u.default.KEY_LOADING,{frag:v})):(this.fragCurrent=v,(_||this.fragmentTracker.getState(v)===B)&&(c.logger.log("Loading "+v.sn+", cc: "+v.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+T+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+p.toFixed(3)),"initSegment"!==v.sn&&(this.startFragRequested=!0),Object(l.isFiniteNumber)(v.sn)&&(this.nextLoadPosition=v.start+v.duration),r.trigger(u.default.FRAG_LOADING,{frag:v}),this.state=Se)))}break;case Re:(t=this.tracks[this.trackId])&&t.details&&(this.state=_e);break;case Ae:var N=lt.now(),L=this.retryDate,M=(s=this.media)&&s.seeking;(!L||N>=L||M)&&(c.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=_e);break;case Ne:var O=this.waitingFragment;if(O){var P=O.frag.cc;if(void 0!==this.initPTS[P])this.waitingFragment=null,this.state=Se,this.onFragLoaded(O);else if(this.videoTrackCC!==this.waitingVideoCC)c.logger.log("Waiting fragment cc ("+P+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var x=V.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole);fe(x.end,i.maxFragLookUpTolerance,O.frag)<0&&(c.logger.log("Waiting fragment cc ("+P+") @ "+O.frag.start+" cancelled because another fragment at "+x.end+" is needed"),this.clearWaitingFragment())}}else this.state=_e}},s.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=_e)},s.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},s.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(c.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},s.onAudioTracksUpdated=function(e){c.logger.log("audio tracks updated"),this.tracks=e.audioTracks},s.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=Te,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=_e),this.tick()},s.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,r=this.tracks[n],i=r.details,a=t.totalduration,s=0;if(c.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+a),t.live||i&&i.live?i&&t.fragments.length>0?(ie(i,t),s=t.fragments[0].start,t.PTSKnown?c.logger.log("live audio playlist sliding:"+s.toFixed(3)):c.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,c.logger.log("live audio playlist - first load, unknown sliding")):t.PTSKnown=!1,r.details=t,!this.startFragRequested){if(-1===this.startPosition){var o=t.startTimeOffset;Object(l.isFiniteNumber)(o)?(c.logger.log("start time offset found in playlist, adjust startPosition to "+o),this.startPosition=o):t.live?(this.startPosition=this.computeLivePosition(s,t),c.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===Re&&(this.state=_e),this.tick()},s.onKeyLoaded=function(){this.state===ve&&(this.state=_e,this.tick())},s.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag;if(this.state===Se&&t&&"audio"===n.type&&n.level===t.level&&n.sn===t.sn){var r=this.tracks[this.trackId],i=r.details,a=i.totalduration,s=t.level,o=t.sn,l=t.cc,d=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",f=this.stats=e.stats;if("initSegment"===o)this.state=_e,f.tparsed=f.tbuffered=lt.now(),i.initSegment.data=e.payload,this.hls.trigger(u.default.FRAG_BUFFERED,{stats:f,frag:t,id:"audio"}),this.tick();else{this.state=be,this.appended=!1,this.demuxer||(this.demuxer=new ee(this.hls,"audio"));var h=this.initPTS[l],g=i.initSegment?i.initSegment.data:[];void 0!==h?(this.pendingBuffering=!0,c.logger.log("Demuxing "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.demuxer.push(e.payload,g,d,null,t,a,!1,h)):(c.logger.log("Unknown video PTS for cc "+l+", waiting for video PTS before demuxing audio frag "+o+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=Ne)}}this.fragLoadError=0},s.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===be){var r,i=e.tracks;if(i.video&&delete i.video,r=i.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(u.default.BUFFER_CODECS,i),c.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var a=r.initSegment;if(a){var s={type:"audio",data:a,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,s))}this.tick()}}},s.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===be){var i=this.trackId,a=this.tracks[i],s=this.hls;Object(l.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(m.AUDIO),c.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),re(a.details,n,e.startPTS,e.endPTS);var d=this.media,f=!1;if(this.audioSwitch)if(d&&d.readyState){var h=d.currentTime;c.logger.log("switching audio track : currentTime:"+h),h>=e.startPTS&&(c.logger.log("switching audio track : flushing all audio"),this.state=De,s.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),f=!0,this.audioSwitch=!1,s.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,s.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i});var g=this.pendingData;if(!g)return c.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(u.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&g.push({type:e.type,data:t,parent:"audio",content:"data"})})),!f&&g.length&&(g.forEach((function(e){t.state===be&&(t.pendingBuffering=!0,t.hls.trigger(u.default.BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},s.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===be&&(this.stats.tparsed=lt.now(),this.state=Ie,this._checkAppendedParsed())},s.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},s.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},s.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==be&&t!==Ie||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},s._checkAppendedParsed=function(){if(!(this.state!==Ie||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=lt.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&c.logger.log("audio buffered : "+oe(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=_e}this.tick()}},s.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case o.ErrorDetails.FRAG_LOAD_ERROR:case o.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&"audio"!==n.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);c.logger.warn("AudioStreamController: frag loading failed, retry in "+a+" ms"),this.retryDate=lt.now()+a,this.state=Ae}else c.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ce}break;case o.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case o.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case o.ErrorDetails.KEY_LOAD_ERROR:case o.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==Ce&&(this.state=e.fatal?Ce:_e,c.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case o.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===be||this.state===Ie)){var s=this.mediaBuffer,l=this.media.currentTime;if(s&&V.isBuffered(s,l)&&V.isBuffered(s,l+.5)){var d=this.config;d.maxMaxBufferLength>=d.maxBufferLength&&(d.maxMaxBufferLength/=2,c.logger.warn("AudioStreamController: reduce max buffer length to "+d.maxMaxBufferLength+"s")),this.state=_e}else c.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=De,this.hls.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},s.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(c.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(u.default.BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=Ie):(this.state=_e,this.fragPrevious=null,this.tick())},i=r,(a=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,c.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}])&&ot(i.prototype,a),r}(Me),ct=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}function r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function i(t,i,a){var s=this,o={enumerable:!0};s.hasBeenReset=!1;var l="",u=!1,c=t,d=i,f=a,h=null,g="",p=!0,m="auto",E="start",y=50,_="middle",T=50,v="middle";Object.defineProperty(s,"id",r({},o,{get:function(){return l},set:function(e){l=""+e}})),Object.defineProperty(s,"pauseOnExit",r({},o,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(s,"startTime",r({},o,{get:function(){return c},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");c=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},o,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},o,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},o,{get:function(){return h},set:function(e){h=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},o,{get:function(){return g},set:function(t){var n=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},o,{get:function(){return p},set:function(e){p=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},o,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},o,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},o,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},o,{get:function(){return _},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},o,{get:function(){return T},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},o,{get:function(){return v},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");v=t,this.hasBeenReset=!0}})),s.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),dt=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function ft(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new dt,this.regionList=[]}function ht(){this.values=Object.create(null)}function gt(e,t,n,r){var i=r?e.split(r):[e];for(var a in i)if("string"==typeof i[a]){var s=i[a].split(n);2===s.length&&t(s[0],s[1])}}ht.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var pt=new ct(0,0,0),mt="middle"===pt.align?"middle":"center";function Et(e,t,n){var r=e;function i(){var t=function(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=i(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),a(),t.endTime=i(),a(),function(e,t){var r=new ht;gt(e,(function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var a=t.split(","),s=a[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===a.length&&r.alt("lineAlign",a[1],["start",mt,"end"]);break;case"position":a=t.split(","),r.percent(e,a[0]),2===a.length&&r.alt("positionAlign",a[1],["start",mt,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",mt,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===pt.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",mt);var a=r.get("position","auto");"auto"===a&&50===pt.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function yt(e){return e.replace(/<br(?: \/)?>/gi,"\n")}ft.prototype={parse:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=yt(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(r=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:r=n(),t.state){case"HEADER":/:/.test(r)?gt(r,(function(e,t){}),/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new ct(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{Et(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return e.onflush&&e.onflush(),this}};var _t=ft;function Tt(e,t,n,r){for(var i,a,s,o,l,u=[],c=window.VTTCue||TextTrackCue,d=0;d<r.rows.length;d++)if(s=!0,o=0,l="",!(i=r.rows[d]).isEmpty()){for(var f=0;f<i.chars.length;f++)i.chars[f].uchar.match(/\s/)&&s?o++:(l+=i.chars[f].uchar,s=!1);i.cueStartTime=t,t===n&&(n+=1e-4),a=new c(t,n,yt(l.trim())),o>=16?o--:o++,navigator.userAgent.match(/Firefox\//)?a.line=d+1:a.line=d>7?d-2:d+1,a.align="left",a.position=Math.max(0,Math.min(100,o/32*100)),u.push(a),e&&e.addCue(a)}return u}var vt,St={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},At=function(e){var t=e;return St.hasOwnProperty(e)&&(t=St[e]),String.fromCharCode(t)},Rt=15,bt=100,It={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Dt={17:2,18:4,21:6,22:8,23:10,19:13,20:15},wt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Ct={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Nt=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(vt||(vt={}));var Lt=function(){function e(){this.time=null,this.verboseLevel=vt.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&c.logger.log(this.time+" ["+e+"] "+t)},e}(),Mt=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},Ot=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),Pt=function(){function e(e,t,n,r,i,a){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Ot(t,n,r,i,a)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),xt=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<bt;t++)this.chars.push(new Pt);this.logger=e,this.pos=0,this.currPenState=new Ot}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<bt;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<bt;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<bt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(vt.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>bt&&(this.logger.log(vt.DEBUG,"Too large cursor position "+this.pos),this.pos=bt)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=At(e);this.pos>=bt?this.logger.log(vt.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<bt;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<bt;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),Ft=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<Rt;t++)this.rows.push(new xt(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<Rt;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,n=0;n<Rt;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<Rt;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<Rt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(vt.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(vt.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<Rt;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var a=i.rows[r].cueStartTime,s=this.logger.time;if(a&&null!==s&&a<s)for(var o=0;o<this.nrRollUpRows;o++)this.rows[t-this.nrRollUpRows+o+1].copy(i.rows[r+o])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,c=Math.max(u-1,0);l.setCursor(e.indent),e.color=l.chars[c].penState.foreground}var d={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(d)},t.setBkgData=function(e){this.logger.log(vt.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(vt.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(vt.INFO,"Rolling up")}else this.logger.log(vt.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<Rt;i++){var a=this.rows[i].getTextString();a&&(r=i+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),kt=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ft(n),this.nonDisplayedMemory=new Ft(n),this.lastOutputScreen=new Ft(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(vt.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(vt.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(vt.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(vt.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(vt.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(vt.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(vt.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(vt.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(vt.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(vt.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(vt.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(vt.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(vt.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(vt.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(vt.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(vt.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(vt.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(vt.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),Ut=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Lt;this.channels=[null,new kt(e,t,r),new kt(e+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,r,i,a=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(r=127&t[s],i=127&t[s+1],0!==r||0!==i){if(this.logger.log(vt.DATA,"["+Mt([t[s],t[s+1]])+"] -> ("+Mt([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(a=this.parseChars(r,i))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(a):this.logger.log(vt.WARNING,"No channel found yet. TEXT-MODE?")}n||a||this.logger.log(vt.WARNING,"Couldn't parse cleaned data "+Mt([r,i])+" orig: "+Mt([t[s],t[s+1]]))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=33&&t<=35))return!1;if(Gt(e,t,n))return Bt(null,null,n),this.logger.log(vt.DEBUG,"Repeated command ("+Mt([e,t])+") is dropped"),!0;var r=20===e||21===e||23===e?1:2,i=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),Bt(e,t,n),this.currentChannel=r,!0},t.parseMidrow=function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(vt.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(vt.DEBUG,"MIDROW ("+Mt([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var n,r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127||(16===e||24===e)&&t>=64&&t<=95))return!1;if(Gt(e,t,r))return Bt(null,null,r),!0;var i=e<=23?1:2;n=t>=64&&t<=95?1===i?It[e]:wt[e]:1===i?Dt[e]:Ct[e];var a=this.channels[i];return!!a&&(a.setPAC(this.interpretPAC(n,t)),Bt(e,t,r),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var n,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){var a;a=17===i?t+80:18===i?t+112:t+144,this.logger.log(vt.INFO,"Special char '"+At(a)+"' in channel "+n),r=[a]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=Mt(r);this.logger.log(vt.DEBUG,"Char codes =  "+s.join(",")),Bt(e,t,this.cmdHistory)}return r},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&t>=32&&t<=47||(23===e||31===e)&&t>=45&&t<=47))return!1;var r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=Nt[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(r),Bt(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}();function Bt(e,t,n){n.a=e,n.b=t}function Gt(e,t,n){return n.a===e&&n.b===t}var qt=Ut,Kt=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[]},e}(),Ht=function(e,t,n){return e.substr(n||0,t.length)===t},Yt=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},Vt=function(e,t,n,r,i,a){var s,o=Object(Ue.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),u="00:00.000",c=0,d=0,f=0,h=[],g=!0,p=!1,m=new _t;m.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==d?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,f)),f&&(i=f-n.presentationOffset),p&&(e.startTime+=i-d,e.endTime+=i-d),e.id=Yt(e.startTime.toString())+Yt(e.endTime.toString())+Yt(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&h.push(e)},m.onparsingerror=function(e){s=e},m.onflush=function(){s&&a?a(s):i(h)},o.forEach((function(e){if(g){if(Ht(e,"X-TIMESTAMP-MAP=")){g=!1,p=!0,e.substr(16).split(",").forEach((function(e){Ht(e,"LOCAL:")?u=e.substr(6):Ht(e,"MPEGTS:")&&(c=parseInt(e.substr(7)))}));try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),c-=t,d=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),i=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(l.isFiniteNumber)(t)&&Object(l.isFiniteNumber)(n)&&Object(l.isFiniteNumber)(r)&&Object(l.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,(t+=6e4*r)+36e5*i}(u)/1e3,f=c/9e4}catch(e){p=!1,s=e}return}""===e&&(g=!1)}m.parse(e+"\n")})),m.flush()};function jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var zt=function(e){var t,n;function r(t){var n;if((n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.FRAG_DECRYPTED,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.FRAG_LOADED,u.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.captionsTracks={},n.nonNativeCaptionsTracks={},n.captionsProperties=void 0,n.cea608Parser1=void 0,n.cea608Parser2=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},n.hls=t,n.config=t.config,n.Cues=t.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode},textTrack3:{label:n.config.captionsTextTrack3Label,languageCode:n.config.captionsTextTrack3LanguageCode},textTrack4:{label:n.config.captionsTextTrack4Label,languageCode:n.config.captionsTextTrack4LanguageCode}},n.config.enableCEA708Captions){var r=new Kt(jt(n),"textTrack1"),i=new Kt(jt(n),"textTrack2"),a=new Kt(jt(n),"textTrack3"),s=new Kt(jt(n),"textTrack4");n.cea608Parser1=new qt(1,r,i),n.cea608Parser2=new qt(3,a,s)}return n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.addCues=function(e,t,n,r,i){for(var a,s,o,l,c=!1,d=i.length;d--;){var f=i[d],h=(a=f[0],s=f[1],o=t,l=n,Math.min(s,l)-Math.max(a,o));if(h>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],n),c=!0,h/(n-t)>.5))return}if(c||i.push([t,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,n,r);else{var g=this.Cues.newCue(null,t,n,r);this.hls.trigger(u.default.CUES_PARSED,{type:"captions",cues:g,track:e})}},i.onInitPtsFound=function(e){var t=this,n=e.frag,r=e.id,i=e.initPTS,a=this.unparsedVttFrags;"main"===r&&(this.initPTS[n.cc]=i),a.length&&(this.unparsedVttFrags=[],a.forEach((function(e){t.onFragLoaded(e)})))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],a=i.label,s=i.languageCode,o=this.getExistingTrack(e);if(o)n[e]=o,Ge(n[e]),Be(n[e],r);else{var l=this.createTextTrack("captions",a,s);l&&(l[e]=!0,n[e]=l)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},i.destroy=function(){e.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Ge(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Ge(t[n])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=e.subtitles||[],r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,n){var r;if(n<i.length){for(var a=null,s=0;s<i.length;s++)if(Wt(i[s],e)){a=i[s];break}a&&(r=a)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)}))}else if(!r&&this.tracks&&this.tracks.length){var a=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(e){var n=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(n){var r="textTrack"+n[1],i=t.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))},i.onFragLoaded=function(e){var t=e.frag,n=e.payload,r=this.cea608Parser1,i=this.cea608Parser2,a=this.initPTS,s=this.lastSn,o=this.unparsedVttFrags;if("main"===t.type){var c=t.sn;t.sn!==s+1&&r&&i&&(r.reset(),i.reset()),this.lastSn=c}else if("subtitle"===t.type)if(n.byteLength){if(!Object(l.isFiniteNumber)(a[t.cc]))return o.push(e),void(a.length&&this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var d=t.decryptdata;null!=d&&null!=d.key&&"AES-128"===d.method||this._parseVTTs(t,n)}else this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var n=this,r=this.hls,i=this.prevCC,a=this.textTracks,s=this.vttCCs;s[e.cc]||(s[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),Vt(t,this.initPTS[e.cc],s,e.cc,(function(t){if(n.config.renderTextTracksNatively){var i=a[e.level];if("disabled"===i.mode)return void r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach((function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){c.logger.debug("Failed occurred on adding cues: "+n);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}))}else{var s=n.tracks[e.level].default?"default":"subtitles"+e.level;r.trigger(u.default.CUES_PARSED,{type:"subtitles",cues:t,track:s})}r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){c.logger.log("Failed to parse VTT cue: "+t),r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},i.onFragDecrypted=function(e){var t=e.frag,n=e.payload;if("subtitle"===t.type){if(!Object(l.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(t,n)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var r=0;r<e.samples.length;r++){var i=e.samples[r].bytes;if(i){var a=this.extractCea608Data(i);t.addData(e.samples[r].pts,a[0]),n.addData(e.samples[r].pts,a[1])}}},i.extractCea608Data=function(e){for(var t=31&e[0],n=2,r=[[],[]],i=0;i<t;i++){var a=e[n++],s=127&e[n++],o=127&e[n++],l=3&a;0===s&&0===o||0!=(4&a)&&(0!==l&&1!==l||(r[l].push(s),r[l].push(o)))}return r},r}(h);function Wt(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var $t=zt;function Xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qt(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}var Jt,Zt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADED,u.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s=r.prototype;return s.destroy=function(){h.prototype.destroy.call(this)},s.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(l.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},s.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(l.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Qt(this.media.textTracks).forEach((function(e){Ge(e)})),this.subtitleTrack=-1,this.media=null)},s.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(u.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},s.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,r=e.details,i=this.trackId,a=this.tracks,s=a[i];if(n>=a.length||n!==i||!s||this.stopped)this._clearReloadTimer();else if(c.logger.log("subtitle track "+n+" loaded"),r.live){var o=se(s.details,r,e.stats.trequest);c.logger.log("Reloading live subtitle playlist in "+o+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),o)}else this._clearReloadTimer()},s.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},s.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},s._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},s._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(c.logger.log("Loading subtitle track "+e),n.trigger(u.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))},s._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;if(t){var i=Qt(t.textTracks);if(-1===e)[].slice.call(i).forEach((function(e){e.mode="disabled"}));else{var a=i[r];a&&(a.mode="disabled")}var s=i[e];s&&(s.mode=n?"showing":"hidden")}},s._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(l.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,c.logger.log("Switching to subtitle track "+e),t.trigger(u.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},s._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=Qt(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}},i=r,(a=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&Xt(i.prototype,a),r}(h),en=n("./src/crypt/decrypter.js"),tn=window.performance,nn=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED,u.default.LEVEL_UPDATED)||this).fragmentTracker=n,r.config=t.config,r.state=Ee,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new en.default(t,t.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.startLoad=function(){this.stopLoad(),this.state=_e;var e=this.tracks[this.currentTrackId];e&&e.details&&(this.setInterval(500),this.tick())},i.onSubtitleFragProcessed=function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=_e,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i,a=t.start,s=0;s<r.length;s++)if(a>=r[s].start&&a<=r[s].end){i=r[s];break}var o=t.start+t.duration;i?i.end=o:(i={start:a,end:o},r.push(i))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=_e},i.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=Ee)},i.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.fragCurrent&&this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.state=_e)},i.onSubtitleTracksUpdated=function(e){var t=this;c.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks,a=i[r];t>=i.length||t!==r||!a||(n.live&&function(e,t,n){void 0===n&&(n=0);var r=-1;ae(e,t,(function(e,t,n){t.start=e.start,r=n}));var i=t.fragments;if(r<0)i.forEach((function(e){e.start+=n}));else for(var a=r+1;a<i.length;a++)i[a].start=i[a-1].start+i[a-1].duration}(a.details,n,this.lastAVStart),a.details=n,this.setInterval(500))},i.onKeyLoaded=function(){this.state===ve&&(this.state=_e)},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag.decryptdata,r=e.frag,i=this.hls;if(this.state===Se&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var a=tn.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,(function(e){var t=tn.now();i.trigger(u.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:a,tdecrypt:t}})}))}},i.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},i.doTick=function(){if(this.media)switch(this.state){case _e:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media,i=this.tracks;if(!i||!i[t]||!i[t].details)break;var a,s=e.maxBufferHole,o=e.maxFragLookUpTolerance,l=Math.min(e.maxBufferLength,e.maxMaxBufferLength),d=V.bufferedInfo(this._getBuffered(),r.currentTime,s),f=d.end,h=d.len,g=i[t].details,p=g.fragments,m=p.length,E=p[m-1].start+p[m-1].duration;if(h>l)return;var y=this.fragPrevious;f<E?(y&&g.hasProgramDateTime&&(a=ce(p,y.endProgramDateTime,o)),a||(a=de(y,p,f,o))):a=p[m-1],a&&a.encrypted?(c.logger.log("Loading key for "+a.sn),this.state=ve,this.hls.trigger(u.default.KEY_LOADING,{frag:a})):a&&n.getState(a)===B&&(this.fragCurrent=a,this.state=Se,this.hls.trigger(u.default.FRAG_LOADING,{frag:a}))}else this.state=_e},i.stopLoad=function(){this.lastAVStart=0,this.fragPrevious=null,e.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){if(this.fragCurrent){var e=this.media?this.media.currentTime:0,t=this.config.maxFragLookUpTolerance,n=this.fragCurrent.start-t,r=this.fragCurrent.start+this.fragCurrent.duration+t;(e<n||e>r)&&(this.fragCurrent.loader&&this.fragCurrent.loader.abort(),this.fragmentTracker.removeFragment(this.fragCurrent),this.fragCurrent=null,this.fragPrevious=null,this.state=_e,this.tick())}},r}(Me);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(Jt||(Jt={}));var rn="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var sn=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHED,u.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(e){if(c.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!n.mediaKeysPromise)return c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var t=function(t){n._media&&(n._attemptSetMediaKeys(t),n._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};n.mediaKeysPromise.then(t).catch(t)},n._config=t.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=t.config.drmSystemOptions,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,a,s=r.prototype;return s.getLicenseServerUrl=function(e){switch(e){case Jt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},s._attemptKeySystemAccess=function(e,t,n){var r=this,i=function(e,t,n,r){if(e===Jt.WIDEVINE)return function(e,t,n){var r={audioCapabilities:[],videoCapabilities:[]};return e.forEach((function(e){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:n.audioRobustness||""})})),t.forEach((function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:n.videoRobustness||""})})),[r]}(t,n,r);throw new Error("Unknown key-system: "+e)}(e,t,n,this._drmSystemOptions);c.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(e,i);this.mediaKeysPromise=a.then((function(t){return r._onMediaKeySystemAccessObtained(e,t)})),a.catch((function(t){c.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},s._onMediaKeySystemAccessObtained=function(e,t){var n=this;c.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r);var i=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return r.mediaKeys=t,c.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),t}));return i.catch((function(e){c.logger.error("Failed to create media-keys:",e)})),i},s._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},s._onNewMediaKeySession=function(e){var t=this;c.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(n){t._onKeySessionMessage(e,n.message)}),!1)},s._onKeySessionMessage=function(e,t){c.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){c.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)}))},s._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return c.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});c.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},s._generateRequestWithPreferredKeySession=function(e,t){var n=this,r=this._mediaKeysList[0];if(!r)return c.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)c.logger.warn("Key-Session already initialized but requested again");else{var i=r.mediaKeysSession;if(!i)return c.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return c.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});c.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,i.generateRequest(e,t).then((function(){c.logger.debug("Key-session generation succeeded")})).catch((function(e){c.logger.error("Error generating key-session request:",e),n.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},s._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r},s._onLicenseRequestReadyStageChange=function(e,t,n,r){if(4===e.readyState)if(200===e.status)this._requestLicenseFailureCount=0,c.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&c.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(c.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var i=3-this._requestLicenseFailureCount+1;c.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(n,r)}},s._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===Jt.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},s._requestLicense=function(e,t){c.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return c.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);c.logger.log("Sending license request to URL: "+r);var a=this._generateLicenseRequestChallenge(n,e);i.send(a)}catch(e){c.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(u.default.ERROR,{type:o.ErrorTypes.KEY_SYSTEM_ERROR,details:o.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},s.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},s.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},s.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map((function(e){return e.audioCodec})),n=e.levels.map((function(e){return e.videoCodec}));this._attemptKeySystemAccess(Jt.WIDEVINE,t,n)}},i=r,(a=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&an(i.prototype,a),r}(h);function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?on(Object(n),!0).forEach((function(t){un(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function un(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var cn=ln(ln({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:rt,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:We,bufferController:Qe,capLevelController:et,fpsController:nt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:rn,testBandwidth:!0},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:nn,subtitleTrackController:Zt,timelineController:$t,audioStreamController:ut,audioTrackController:st,emeController:sn});function dn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dn(Object(n),!0).forEach((function(t){hn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mn(e,t,n){return t&&pn(e.prototype,t),n&&pn(e,n),e}var En=function(e){var t,n;function r(t){var n;void 0===t&&(t={}),(n=e.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=fn(fn({},i),t);var a=gn(n).config;if(void 0!==a.liveMaxLatencyDurationCount&&a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==a.liveMaxLatencyDuration&&(void 0===a.liveSyncDuration||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(c.enableLogs)(a.debug),n._autoLevelCapping=-1;var s=n.abrController=new a.abrController(gn(n)),o=new a.bufferController(gn(n)),l=n.capLevelController=new a.capLevelController(gn(n)),u=new a.fpsController(gn(n)),d=new F(gn(n)),f=new k(gn(n)),h=new U(gn(n)),g=new Ke(gn(n)),p=n.levelController=new ke(gn(n)),m=new H(gn(n)),E=[p,n.streamController=new xe(gn(n),m)],y=a.audioStreamController;y&&E.push(new y(gn(n),m)),n.networkControllers=E;var _=[d,f,h,s,o,l,u,g,m];if(y=a.audioTrackController){var T=new y(gn(n));n.audioTrackController=T,_.push(T)}if(y=a.subtitleTrackController){var v=new y(gn(n));n.subtitleTrackController=v,E.push(v)}if(y=a.emeController){var S=new y(gn(n));n.emeController=S,_.push(S)}return(y=a.subtitleStreamController)&&E.push(new y(gn(n),m)),(y=a.timelineController)&&_.push(new y(gn(n))),n.coreComponents=_,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.isSupported=function(){return function(){var e=$();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!r}()},mn(r,null,[{key:"version",get:function(){return"0.14.17"}},{key:"Events",get:function(){return u.default}},{key:"ErrorTypes",get:function(){return o.ErrorTypes}},{key:"ErrorDetails",get:function(){return o.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:cn},set:function(e){r.defaultConfig=e}}]);var i=r.prototype;return i.destroy=function(){c.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){c.logger.log("attachMedia"),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){c.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=s.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),c.logger.log("loadSource:"+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){void 0===e&&(e=-1),c.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},i.stopLoad=function(){c.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},i.swapAudioCodec=function(){c.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){c.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},mn(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){c.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){c.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){c.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){c.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){c.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){c.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++)if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r;return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),r}(Q);En.defaultConfig=void 0},"./src/polyfills/number.js":function(e,t,n){"use strict";n.r(t),n.d(t,"isFiniteNumber",(function(){return r})),n.d(t,"MAX_SAFE_INTEGER",(function(){return i}));var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":function(e,t,n){"use strict";function r(){return"undefined"==typeof window?self:window}n.r(t),n.d(t,"getSelfScope",(function(){return r}))},"./src/utils/logger.js":function(e,t,n){"use strict";n.r(t),n.d(t,"enableLogs",(function(){return c})),n.d(t,"logger",(function(){return d}));var r=n("./src/utils/get-self-scope.js");function i(){}var a={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=a;function o(e,t){return"["+e+"] > "+t}var l=Object(r.getSelfScope)();function u(e){var t=l.console[e];return t?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=o(e,r[0])),t.apply(l.console,r)}:i}var c=function(e){if(l.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){s[t]=e[t]?e[t].bind(e):u(t)}))}(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=a}}else s=a},d=s}}).default},e.exports=t())},645:(e,t)=>{t.read=function(e,t,n,r,i){var a,s,o=8*i-r-1,l=(1<<o)-1,u=l>>1,c=-7,d=n?i-1:0,f=n?-1:1,h=e[t+d];for(d+=f,a=h&(1<<-c)-1,h>>=-c,c+=o;c>0;a=256*a+e[t+d],d+=f,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=r;c>0;s=256*s+e[t+d],d+=f,c-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),a-=u}return(h?-1:1)*s*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var s,o,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:a-1,g=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=c?(o=0,s=c):s+d>=1?(o=(t*l-1)*Math.pow(2,i),s+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&o,h+=g,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[n+h]=255&s,h+=g,s/=256,u-=8);e[n+h-g]|=128*p}},7006:(e,t,n)=>{!function(e,t,n,r,i){function a(e){if("contents"in e)for(var t=("styleAttrs"in e?e.styleAttrs[r.byName.ruby.qname]:null),n="span"===e.kind&&("container"===t||"textContainer"===t||"baseContainer"===t),i=e.contents.length-1;i>=0;i--)!n||"styleAttrs"in e.contents[i]&&r.byName.ruby.qname in e.contents[i].styleAttrs?a(e.contents[i]):delete e.contents[i]}function s(e,t,n,r){var i=r&&"seq"===r.timeContainer,a=0;r&&(a=i&&n?n.end:r.begin),t.begin=t.explicit_begin?t.explicit_begin+a:a;var o=t.begin,l=null;if("sets"in t)for(var u=0;u<t.sets.length;u++)s(e,t.sets[u],l,t),o="seq"===t.timeContainer?t.sets[u].end:Math.max(o,t.sets[u].end),l=t.sets[u];if("contents"in t){if("contents"in t)for(var c=0;c<t.contents.length;c++)s(e,t.contents[c],l,t),o="seq"===t.timeContainer?t.contents[c].end:Math.max(o,t.contents[c].end),l=t.contents[c]}else o=i?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,a+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=a+t.explicit_end:t.end=o,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function o(e){this.node=e}function l(){this.events=[],this.head=new u,this.body=null}function u(){this.styling=new c,this.layout=new h}function c(){this.styles={},this.initials={}}function d(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function f(){this.styleAttrs=null}function h(){this.regions={}}function g(e,t){p.call(this,"image"),this.src=e,this.type=t}function p(e){this.kind=e}function m(e){this.id=e}function E(e){this.regionID=e}function y(e){this.styleAttrs=e}function _(e){this.sets=e}function T(e){this.contents=e}function v(e,t,n){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=n}function S(){p.call(this,"body")}function A(){p.call(this,"div")}function R(){p.call(this,"p")}function b(){p.call(this,"span")}function I(){p.call(this,"span")}function D(){p.call(this,"br")}function w(){}function C(){}function N(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function L(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function M(e,t){var n={};if(null!==e)for(var i in e.attributes){var a=e.attributes[i].uri+" "+e.attributes[i].local,s=r.byQName[a];if(void 0!==s){var o=s.parse(e.attributes[i].value);null!==o?(n[a]=o,s===r.byName.zIndex&&U(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):B(t,"Cannot parse styling attribute "+a+" --\x3e "+e.attributes[i].value)}}return n}function O(e,t,n){for(var r in e.attributes)if(e.attributes[r].uri===t&&e.attributes[r].local===n)return e.attributes[r].value;return null}function P(e,t,n){var r,i=null;return null!==(r=/^(\d+(?:\.\d+)?)f$/.exec(n))?null!==t&&(i=parseFloat(r[1])/t):null!==(r=/^(\d+(?:\.\d+)?)t$/.exec(n))?null!==e&&(i=parseFloat(r[1])/e):null!==(r=/^(\d+(?:\.\d+)?)ms$/.exec(n))?i=parseFloat(r[1])/1e3:null!==(r=/^(\d+(?:\.\d+)?)s$/.exec(n))?i=parseFloat(r[1]):null!==(r=/^(\d+(?:\.\d+)?)h$/.exec(n))?i=3600*parseFloat(r[1]):null!==(r=/^(\d+(?:\.\d+)?)m$/.exec(n))?i=60*parseFloat(r[1]):null!==(r=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(n))?i=3600*parseInt(r[1])+60*parseInt(r[2])+parseFloat(r[3]):null!==(r=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(n))&&null!==t&&(i=3600*parseInt(r[1])+60*parseInt(r[2])+parseInt(r[3])+(null===r[4]?0:parseInt(r[4])/t)),i}function x(e,t,n){for(;t.styleRefs.length>0;){var r=t.styleRefs.pop();r in e.styles?(x(e,e.styles[r],n),k(e.styles[r].styleAttrs,t.styleAttrs)):B(n,"Non-existant style id referenced")}}function F(e,t,n,r){for(var i=t.length-1;i>=0;i--){var a=t[i];a in e.styles?k(e.styles[a].styleAttrs,n):B(r,"Non-existant style id referenced")}}function k(e,t){for(var n in e)e.hasOwnProperty(n)&&(n in t||(t[n]=e[n]))}function U(e,t){if(e&&e.warn&&e.warn(t))throw t}function B(e,t){if(e&&e.error&&e.error(t))throw t}function G(e,t){throw e&&e.fatal&&e.fatal(t),t}function q(e,t){for(var n,r=0,i=e.length-1;r<=i;){var a=e[n=Math.floor((r+i)/2)];if(a<t)r=n+1;else{if(!(a>t))return{found:!0,index:n};i=n-1}}return{found:!1,index:r}}e.fromXML=function(e,i,p){var m=t.parser(!0,{xmlns:!0}),E=[],y=[],_=[],T=0,v=null;m.onclosetag=function(e){if(E[0]instanceof w)null!==v.head&&null!==v.head.styling&&F(v.head.styling,E[0].styleRefs,E[0].styleAttrs,i),delete E[0].styleRefs;else if(E[0]instanceof c)for(var t in E[0].styles)E[0].styles.hasOwnProperty(t)&&x(E[0],E[0].styles[t],i);else if(E[0]instanceof R||E[0]instanceof b){if(E[0].contents.length>1){var r,a=[E[0].contents[0]];for(r=1;r<E[0].contents.length;r++)E[0].contents[r]instanceof I&&a[a.length-1]instanceof I?a[a.length-1].text+=E[0].contents[r].text:a.push(E[0].contents[r]);E[0].contents=a}E[0]instanceof b&&1===E[0].contents.length&&E[0].contents[0]instanceof I&&(E[0].text=E[0].contents[0].text,delete E[0].contents)}else E[0]instanceof o&&(E[0].node.uri===n.ns_tt&&"metadata"===E[0].node.local?T--:T>0&&p&&"onCloseTag"in p&&p.onCloseTag());_.shift(),y.shift(),E.shift()},m.ontext=function(e){if(void 0===E[0]);else if(E[0]instanceof b||E[0]instanceof R){if(E[0]instanceof b){var t=E[0].styleAttrs[r.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var n=new I;n.initFromText(v,E[0],e,y[0],_[0],i),E[0].contents.push(n)}else E[0]instanceof o&&T>0&&p&&"onText"in p&&p.onText(e)},m.onopentag=function(e){var t=e.attributes["xml:space"];t?_.unshift(t.value):0===_.length?_.unshift("default"):_.unshift(_[0]);var a=e.attributes["xml:lang"];if(a?y.unshift(a.value):0===y.length?y.unshift(""):y.unshift(y[0]),e.uri===n.ns_tt)if("tt"===e.local)null!==v&&G(i,"Two <tt> elements at ("+this.line+","+this.column+")"),(v=new l).initFromNode(e,y[0],i),E.unshift(v);else if("head"===e.local)E[0]instanceof l||G(i,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),E.unshift(v.head);else if("styling"===e.local)E[0]instanceof u||G(i,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),E.unshift(v.head.styling);else if("style"===e.local){var s;E[0]instanceof c?((s=new d).initFromNode(e,i),s.id?v.head.styling.styles[s.id]=s:B(i,"<style> element missing @id attribute"),E.unshift(s)):E[0]instanceof w?((s=new d).initFromNode(e,i),k(s.styleAttrs,E[0].styleAttrs),E.unshift(s)):G(i,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var m;if(E[0]instanceof c){for(var I in(m=new f).initFromNode(e,i),m.styleAttrs)m.styleAttrs.hasOwnProperty(I)&&(v.head.styling.initials[I]=m.styleAttrs[I]);E.unshift(m)}else G(i,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)E[0]instanceof u||G(i,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),E.unshift(v.head.layout);else if("region"===e.local){E[0]instanceof h||G(i,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var N=new w;N.initFromNode(v,e,y[0],i),!N.id||N.id in v.head.layout.regions?B(i,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):v.head.layout.regions[N.id]=N,E.unshift(N)}else if("body"===e.local){E[0]instanceof l||G(i,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==v.body&&G(i,"Second <body> element at "+this.line+","+this.column+")");var L=new S;L.initFromNode(v,e,y[0],i),v.body=L,E.unshift(L)}else if("div"===e.local){E[0]instanceof A||E[0]instanceof S||G(i,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var M=new A;M.initFromNode(v,E[0],e,y[0],i);var O=M.styleAttrs[r.byName.backgroundImage.qname];O&&(M.contents.push(new g(O)),delete M.styleAttrs[r.byName.backgroundImage.qname]),E[0].contents.push(M),E.unshift(M)}else if("image"===e.local){E[0]instanceof A||G(i,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var P=new g;P.initFromNode(v,E[0],e,y[0],i),E[0].contents.push(P),E.unshift(P)}else if("p"===e.local){E[0]instanceof A||G(i,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var x=new R;x.initFromNode(v,E[0],e,y[0],i),E[0].contents.push(x),E.unshift(x)}else if("span"===e.local){E[0]instanceof b||E[0]instanceof R||G(i,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var F=new b;F.initFromNode(v,E[0],e,y[0],_[0],i),E[0].contents.push(F),E.unshift(F)}else if("br"===e.local){E[0]instanceof b||E[0]instanceof R||G(i,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var U=new D;U.initFromNode(v,E[0],e,y[0],i),E[0].contents.push(U),E.unshift(U)}else if("set"===e.local){E[0]instanceof b||E[0]instanceof R||E[0]instanceof A||E[0]instanceof S||E[0]instanceof w||E[0]instanceof D||G(i,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var q=new C;q.initFromNode(v,E[0],e,i),E[0].sets.push(q),E.unshift(q)}else E.unshift(new o(e));else E.unshift(new o(e));if(E[0]instanceof o)if(e.uri===n.ns_tt&&"metadata"===e.local)T++;else if(T>0&&p&&"onOpenTag"in p){var K=[];for(var H in e.attributes)K[e.attributes[H].uri+" "+e.attributes[H].local]={uri:e.attributes[H].uri,local:e.attributes[H].local,value:e.attributes[H].value};p.onOpenTag(e.uri,e.local,K)}},m.write(e).close(),delete v.head.styling.styles;var N=!1;for(var L in v.head.layout.regions)if(v.head.layout.regions.hasOwnProperty(L)){N=!0;break}if(!N){var M=w.prototype.createDefaultRegion(v.lang);v.head.layout.regions[M.id]=M}for(var O in v.head.layout.regions)v.head.layout.regions.hasOwnProperty(O)&&s(v,v.head.layout.regions[O],null,null);return v.body&&s(v,v.body,null,null),v.body&&a(v.body),v},l.prototype.initFromNode=function(e,t,r){var a=function(e,t){var r=O(e,n.ns_ttp,"cellResolution"),i=15,a=32;if(null!==r){var s=/(\d+) (\d+)/.exec(r);null!==s?(a=parseInt(s[1]),i=parseInt(s[2])):U(t,"Malformed cellResolution value (using initial value instead)")}return{w:a,h:i}}(e,r);this.cellLength={h:new i.ComputedLength(0,1/a.h),w:new i.ComputedLength(1/a.w,0)};var s=function(e,t){var r,i=O(e,n.ns_ttp,"frameRate"),a=30;null!==i&&(null!==(r=/(\d+)/.exec(i))?a=parseInt(r[1]):U(t,"Malformed frame rate attribute (using initial value instead)"));var s=O(e,n.ns_ttp,"frameRateMultiplier"),o=1;null!==s&&(null!==(r=/(\d+) (\d+)/.exec(s))?o=parseInt(r[1])/parseInt(r[2]):U(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var l=o*a,u=1,c=O(e,n.ns_ttp,"tickRate");return null===c?null!==i&&(u=l):null!==(r=/(\d+)/.exec(c))?u=parseInt(r[1]):U(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:l,tickRate:u}}(e,r);this.effectiveFrameRate=s.effectiveFrameRate,this.tickRate=s.tickRate,this.aspectRatio=function(e,t){var r=O(e,n.ns_ittp,"aspectRatio");null===r&&(r=O(e,n.ns_ttp,"displayAspectRatio"));var i=null;if(null!==r){var a=/(\d+)\s+(\d+)/.exec(r);if(null!==a){var s=parseInt(a[1]),o=parseInt(a[2]);0!==s&&0!==o?i=s/o:B(t,"Illegal aspectRatio values (ignoring)")}else B(t,"Malformed aspectRatio attribute (ignoring)")}return i}(e,r);var o=O(e,n.ns_ttp,"timeBase");null!==o&&"media"!==o&&G(r,"Unsupported time base");var l=function(e,t){var r=O(e,n.ns_tts,"extent");if(null===r)return null;var a=r.split(" ");if(2!==a.length)return U(t,"Malformed extent (ignoring)"),null;var s=i.parseLength(a[0]),o=i.parseLength(a[1]);return o&&s?{h:o,w:s}:(U(t,"Malformed extent values (ignoring)"),null)}(e,r);null===l?this.pxLength={h:null,w:null}:("px"===l.h.unit&&"px"===l.w.unit||G(r,"Extent on TT must be in px or absent"),this.pxLength={h:new i.ComputedLength(0,1/l.h.value),w:new i.ComputedLength(1/l.w.value,0)}),this.dimensions={h:new i.ComputedLength(0,1),w:new i.ComputedLength(1,0)},this.lang=t},l.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=q(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var n=q(this.events,e.end);n.found||this.events.splice(n.index,0,e.end)}}},l.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},l.prototype.getMediaTimeEvents=function(){return this.events},d.prototype.initFromNode=function(e,t){this.id=N(e),this.styleAttrs=M(e,t),this.styleRefs=L(e)},f.prototype.initFromNode=function(e,t){for(var r in this.styleAttrs={},e.attributes)if(e.attributes[r].uri===n.ns_itts||e.attributes[r].uri===n.ns_ebutts||e.attributes[r].uri===n.ns_tts){var i=e.attributes[r].uri+" "+e.attributes[r].local;this.styleAttrs[i]=e.attributes[r].value}},g.prototype.initFromNode=function(e,t,n,r,i){this.src="src"in n.attributes?n.attributes.src.value:null,this.src||B(i,"Invalid image@src attribute"),this.type="type"in n.attributes?n.attributes.type.value:null,this.type||B(i,"Invalid image@type attribute"),y.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),_.prototype.initFromNode.call(this,e,t,n,i),E.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},m.prototype.initFromNode=function(e,t,n,r){this.id=N(n)},E.prototype.initFromNode=function(e,t,n,r){this.regionID=function(e){return e&&"region"in e.attributes?e.attributes.region.value:""}(n)},y.prototype.initFromNode=function(e,t,n,r){this.styleAttrs=M(n,r),null!==e.head&&null!==e.head.styling&&F(e.head.styling,L(n),this.styleAttrs,r)},_.prototype.initFromNode=function(e,t,n,r){this.sets=[]},T.prototype.initFromNode=function(e,t,n,r){this.contents=[]},v.prototype.initFromNode=function(e,t,n,r){var i=function(e,t,n,r){var i=null;n&&"begin"in n.attributes&&null===(i=P(e.tickRate,e.effectiveFrameRate,n.attributes.begin.value))&&U(r,"Malformed begin value "+n.attributes.begin.value+" (using 0)");var a=null;n&&"dur"in n.attributes&&null===(a=P(e.tickRate,e.effectiveFrameRate,n.attributes.dur.value))&&U(r,"Malformed dur value "+n.attributes.dur.value+" (ignoring)");var s=null;return n&&"end"in n.attributes&&null===(s=P(e.tickRate,e.effectiveFrameRate,n.attributes.end.value))&&U(r,"Malformed end value (ignoring)"),{explicit_begin:i,explicit_end:s,explicit_dur:a}}(e,0,n,r);this.explicit_begin=i.explicit_begin,this.explicit_end=i.explicit_end,this.explicit_dur=i.explicit_dur,this.timeContainer=function(e,t){var n=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return n&&"par"!==n?"seq"===n?"seq":(B(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(n,r)},S.prototype.initFromNode=function(e,t,n,r){y.prototype.initFromNode.call(this,e,null,t,r),v.prototype.initFromNode.call(this,e,null,t,r),_.prototype.initFromNode.call(this,e,null,t,r),E.prototype.initFromNode.call(this,e,null,t,r),T.prototype.initFromNode.call(this,e,null,t,r),this.lang=n},A.prototype.initFromNode=function(e,t,n,r,i){y.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),_.prototype.initFromNode.call(this,e,t,n,i),E.prototype.initFromNode.call(this,e,t,n,i),T.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},R.prototype.initFromNode=function(e,t,n,r,i){y.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),_.prototype.initFromNode.call(this,e,t,n,i),E.prototype.initFromNode.call(this,e,t,n,i),T.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},b.prototype.initFromNode=function(e,t,n,r,i,a){y.prototype.initFromNode.call(this,e,t,n,a),v.prototype.initFromNode.call(this,e,t,n,a),_.prototype.initFromNode.call(this,e,t,n,a),E.prototype.initFromNode.call(this,e,t,n,a),T.prototype.initFromNode.call(this,e,t,n,a),this.space=i,this.lang=r},I.prototype.initFromText=function(e,t,n,r,i,a){v.prototype.initFromNode.call(this,e,t,null,a),this.text=n,this.space=i,this.lang=r},D.prototype.initFromNode=function(e,t,n,r,i){E.prototype.initFromNode.call(this,e,t,n,i),v.prototype.initFromNode.call(this,e,t,n,i),this.lang=r},w.prototype.createDefaultRegion=function(e){var t=new w;return m.call(t,""),y.call(t,{}),_.call(t,[]),v.call(t,0,Number.POSITIVE_INFINITY,null),this.lang=e,t},w.prototype.initFromNode=function(e,t,n,r){m.prototype.initFromNode.call(this,e,null,t,r),v.prototype.initFromNode.call(this,e,null,t,r),_.prototype.initFromNode.call(this,e,null,t,r),this.styleAttrs=M(t,r),this.styleRefs=L(t),this.lang=n},C.prototype.initFromNode=function(e,t,n,r){v.prototype.initFromNode.call(this,e,t,n,r);var i=M(n,r);for(var a in this.qname=null,this.value=null,i)if(i.hasOwnProperty(a)){if(this.qname){B(r,"More than one style specified on set");break}this.qname=a,this.value=i[a]}}}(t,"undefined"==typeof sax?n(6099):sax,"undefined"==typeof imscNames?n(4761):imscNames,"undefined"==typeof imscStyles?n(3060):imscStyles,"undefined"==typeof imscUtils?n(2535):imscUtils)},4795:(e,t,n)=>{!function(e,t,n){function r(e,t,c,f){var h;if("region"===c.kind)(h=document.createElement("div")).style.position="absolute";else if("body"===c.kind)h=document.createElement("div");else if("div"===c.kind)h=document.createElement("div");else if("image"===c.kind){if(h=document.createElement("img"),null!==e.imgResolver&&null!==c.src){var m=e.imgResolver(c.src,h);m&&(h.src=m),h.height=e.regionH,h.width=e.regionW}}else if("p"===c.kind)h=document.createElement("p");else if("span"===c.kind)if("container"===c.styleAttrs[n.byName.ruby.qname])h=document.createElement("ruby"),e.ruby=!0;else if("base"===c.styleAttrs[n.byName.ruby.qname])h=document.createElement("rb");else if("text"===c.styleAttrs[n.byName.ruby.qname])h=document.createElement("rt");else if("baseContainer"===c.styleAttrs[n.byName.ruby.qname])h=document.createElement("rbc");else if("textContainer"===c.styleAttrs[n.byName.ruby.qname])h=document.createElement("rtc");else{if("delimiter"===c.styleAttrs[n.byName.ruby.qname])return;h=document.createElement("span")}else"br"===c.kind&&(h=document.createElement("br"));if(h){if(c.lang&&("region"!==c.kind&&c.lang===f.lang||(h.lang=c.lang)),t.appendChild(h),h.style.margin="0","region"===c.kind){var y=c.styleAttrs[n.byName.writingMode.qname];"lrtb"===y||"lr"===y?(e.ipd="lr",e.bpd="tb"):"rltb"===y||"rl"===y?(e.ipd="rl",e.bpd="tb"):"tblr"===y?(e.ipd="tb",e.bpd="lr"):"tbrl"!==y&&"tb"!==y||(e.ipd="tb",e.bpd="rl")}else if("p"===c.kind&&"tb"===e.bpd){var _=c.styleAttrs[n.byName.direction.qname];e.ipd="ltr"===_?"lr":"rl"}for(var T=0;T<d.length;T++){var v=d[T],S=c.styleAttrs[v.qname];void 0!==S&&null!==v.map&&v.map(e,h,c,S)}var A=h,R=c.styleAttrs[n.byName.linePadding.qname];if(R&&!R.isZero()){var b=R.toUsedLength(e.w,e.h);if(b>0){var I=Math.ceil(b)+"px";"tb"===e.bpd?(A.style.paddingLeft=I,A.style.paddingRight=I):(A.style.paddingTop=I,A.style.paddingBottom=I),e.lp=R}}var D=c.styleAttrs[n.byName.multiRowAlign.qname];if(D&&"auto"!==D){var w=document.createElement("span");w.style.display="inline-block",w.style.textAlign=D,h.appendChild(w),A=w,e.mra=D}var C=c.styleAttrs[n.byName.rubyReserve.qname];if(C&&"none"!==C[0]&&(e.rubyReserve=C),c.styleAttrs[n.byName.fillLineGap.qname]&&(e.flg=!0),"span"===c.kind&&c.text){var N=c.styleAttrs[n.byName.textEmphasis.qname];if(N&&"none"!==N.style&&(e.textEmphasis=!0),n.byName.textCombine.qname in c.styleAttrs&&"all"===c.styleAttrs[n.byName.textCombine.qname])h.textContent=c.text,N&&u(e,h,0,N);else for(var L="",M=0;M<c.text.length;M++){L+=c.text.charAt(M);var O=c.text.charCodeAt(M);if(O<55296||O>56319||M===c.text.length-1){var P=document.createElement("span");P.textContent=L,N&&u(e,P,0,N),h.appendChild(P),L="",P._isd_element=c}}}if("contents"in c)for(var x=0;x<c.contents.length;x++)r(e,A,c.contents[x],c);var F=[];if("p"===c.kind&&(l(e,A,F,null),e.rubyReserve&&(function(e,t){for(var n=0;n<e.length;n++){var r,i,a=document.createElement("ruby"),s=document.createElement("rb");s.textContent="​",a.appendChild(s);var o,l=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";"both"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&1==e.length?((r=document.createElement("rtc")).style[p]=g?"after":"under",r.textContent="​",r.style.fontSize=l,(i=document.createElement("rtc")).style[p]=g?"before":"over",i.textContent="​",i.style.fontSize=l,a.appendChild(r),a.appendChild(i)):((r=document.createElement("rtc")).textContent="​",r.style.fontSize=l,o="after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&n>0?g?"after":"tb"===t.bpd||"rl"===t.bpd?"under":"over":g?"before":"tb"===t.bpd||"rl"===t.bpd?"over":"under",r.style[p]=o,a.appendChild(r));for(var u=null,c=0;c<e[n].rbc.length;c++)if("ruby"===e[n].rbc[c].localName){u=e[n].rbc[c];for(var d=0;d<u.style.length;d++)a.style.setProperty(u.style.item(d),u.style.getPropertyValue(u.style.item(d)));break}(u=u||e[n].elements[0].node).parentElement.insertBefore(a,u)}}(F,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].rbc.length;r++){var i;e[n].rbc[r].style[p]||(i=g?0===n?"before":"after":"tb"===t.bpd||"rl"===t.bpd?0===n?"over":"under":0===n?"under":"over",e[n].rbc[r].style[p]=i)}}(F,e),e.ruby=null),e.textEmphasis&&(function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<e[n].te.length;r++){var i;e[n].te[r].style[E]&&"none"!==e[n].te[r].style[E]||(i="tb"===t.bpd?0===n?"left over":"left under":"rl"===t.bpd?0===n?"right under":"left under":0===n?"left under":"right under",e[n].te[r].style[E]=i)}}(F,e),e.textEmphasis=null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var n=e[t].elements.length;if(0!==n&&!1===e[t].br){var r=document.createElement("br"),i=e[t].elements[n-1].node;i.parentElement.insertBefore(r,i.nextSibling)}}}(F),e.mra=null),e.lp&&(function(e,t,n){if(null!==e)for(var r=0;r<e.length;r++){var i=e[r].elements.length,a=Math.ceil(t)+"px",s="-"+Math.ceil(t)+"px";if(0!==i){var o=e[r].elements[e[r].start_elem],l=e[r].elements[e[r].end_elem];if(o===l&&(elementBoundingRect=o.node.getBoundingClientRect(),0==elementBoundingRect.width||0==elementBoundingRect.height))continue;"lr"===n.ipd?(o.node.style.marginLeft=s,o.node.style.paddingLeft=a):"rl"===n.ipd?(o.node.style.paddingRight=a,o.node.style.marginRight=s):"tb"===n.ipd&&(o.node.style.paddingTop=a,o.node.style.marginTop=s),"lr"===n.ipd?(l.node.style.marginRight=s,l.node.style.paddingRight=a):"rl"===n.ipd?(l.node.style.paddingLeft=a,l.node.style.marginLeft=s):"tb"===n.ipd&&(l.node.style.paddingBottom=a,l.node.style.marginBottom=s)}}}(F,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),function(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=1;r<n.elements.length;){var s=n.elements[r-1],o=n.elements[r];a(s.node,o.node)?n.elements.splice(r,1):r++}for(var l,u,c=[],d=0;d<e.length;d++)for(var f=0;f<e[d].elements.length;f++)(u=i(l=e[d].elements[f].node,c,!1))&&(l.style.backgroundColor=u);for(var h=0;h<c.length;h++)c[h].style.backgroundColor=""}(F),e.flg)){var k=o(A.getBoundingClientRect(),e);!function(e,t,n,r,i){for(var a=Math.sign(n-t),s=0;s<=e.length;s++){var o,l,u,c;if(o=0===s?Math.round(t):s===e.length?Math.round(n):Math.round((e[s-1].after+e[s].before)/2),s>0&&e[s-1])for(u=0;u<e[s-1].elements.length;u++)l=a*(o-(c=e[s-1].elements[u]).after)+"px","lr"===r.bpd?c.node.style.paddingRight=l:"rl"===r.bpd?c.node.style.paddingLeft=l:"tb"===r.bpd&&(c.node.style.paddingBottom=l);if(s<e.length)for(u=0;u<e[s].elements.length;u++)l=a*((c=e[s].elements[u]).before-o)+"px","lr"===r.bpd?c.node.style.paddingLeft=l:"rl"===r.bpd?c.node.style.paddingRight=l:"tb"===r.bpd&&(c.node.style.paddingTop=l)}}(F,k.before,k.after,e),e.flg=null}if("region"===c.kind&&"tb"===e.bpd&&e.enableRollUp&&c.contents.length>0&&"after"===c.styleAttrs[n.byName.displayAlign.qname]){l(e,A,F,null);var U=new s(""===c.id?"_":c.id,F);if(e.currentISDState[U.id]=U,e.previousISDState&&U.id in e.previousISDState&&e.previousISDState[U.id].plist.length>0&&U.plist.length>1&&U.plist[U.plist.length-2].text===e.previousISDState[U.id].plist[e.previousISDState[U.id].plist.length-1].text){var B=h.firstElementChild,G=U.plist[U.plist.length-1].after-U.plist[U.plist.length-1].before;B.style.bottom="-"+G+"px",B.style.transition="transform 0.4s",B.style.position="relative",B.style.transform="translateY(-"+G+"px)"}}}else!function(e,t){if(e&&e.error&&e.error(t))throw t}(e.errorHandler,"Error processing ISD element kind: "+c.kind)}function i(e,t,n){return e.style.backgroundColor?(n&&!t.includes(e)&&t.push(e),e.style.backgroundColor):"SPAN"===e.parentElement.nodeName?i(e.parentElement,t,!0):void 0}function a(e,t){if("SPAN"===e.tagName&&"SPAN"===t.tagName&&e._isd_element===t._isd_element){e.textContent+=t.textContent;for(var n=0;n<t.style.length;n++){var r=t.style[n];(r.indexOf("border")>=0||r.indexOf("padding")>=0||r.indexOf("margin")>=0)&&(e.style[r]=t.style[r])}return t.parentElement.removeChild(t),!0}return!1}function s(e,t){this.id=e,this.plist=t}function o(e,t){var n={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(n.before=e.top,n.after=e.bottom,"lr"===t.ipd?(n.start=e.left,n.end=e.right):(n.start=e.right,n.end=e.left)):"lr"===t.bpd?(n.before=e.left,n.after=e.right,n.start=e.top,n.end=e.bottom):"rl"===t.bpd&&(n.before=e.right,n.after=e.left,n.start=e.top,n.end=e.bottom),n}function l(e,t,n,r){if("rt"!==t.localName&&"rtc"!==t.localName){var i,a,s,u,c=t.style.backgroundColor||r;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var d=o(t.getBoundingClientRect(),e);if(0!==n.length&&(i=d.before,a=d.after,s=n[n.length-1].before,a<(u=n[n.length-1].after)&&i>s||u<=a&&s>=i)){var f=Math.sign(d.after-d.before),h=Math.sign(d.end-d.start);f*(d.before-n[n.length-1].before)<0&&(n[n.length-1].before=d.before),f*(d.after-n[n.length-1].after)>0&&(n[n.length-1].after=d.after),h*(d.start-n[n.length-1].start)<0&&(n[n.length-1].start=d.start,n[n.length-1].start_elem=n[n.length-1].elements.length),h*(d.end-n[n.length-1].end)>0&&(n[n.length-1].end=d.end,n[n.length-1].end_elem=n[n.length-1].elements.length)}else n.push({before:d.before,after:d.after,start:d.start,end:d.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});n[n.length-1].text+=t.textContent,n[n.length-1].elements.push({node:t,bgcolor:c,before:d.before,after:d.after})}else"br"===t.localName&&0!==n.length&&(n[n.length-1].br=!0);else for(var g=t.firstChild;g;)g.nodeType===Node.ELEMENT_NODE&&(l(e,g,n,c),"ruby"===g.localName||"rtc"===g.localName?n.length>0&&n[n.length-1].rbc.push(g):"span"===g.localName&&g.style[m]&&"none"!==g.style[m]&&n.length>0&&n[n.length-1].te.push(g)),g=g.nextSibling}}function u(e,t,n,r){var i;"none"!==r.style&&("auto"===r.style?t.style[m]="filled":t.style[m]=r.style+" "+r.symbol,("before"===r.position||"after"===r.position)&&(i="tb"===e.bpd?"before"===r.position?"left over":"left under":"rl"===e.bpd?"before"===r.position?"right under":"left under":"before"===r.position?"left under":"right under",t.style[E]=i))}function c(e,t){this.qname=e,this.map=t}e.render=function(e,t,n,i,a,s,o,l,u){var c=i||t.clientHeight,d=a||t.clientWidth;if(null!==e.aspectRatio){var f=c*e.aspectRatio;f>d?c=Math.round(d/e.aspectRatio):d=f}var h=document.createElement("div");h.style.position="relative",h.style.width=d+"px",h.style.height=c+"px",h.style.margin="auto",h.style.top=0,h.style.bottom=0,h.style.left=0,h.style.right=0,h.style.zIndex=0;var g={h:c,w:d,regionH:null,regionW:null,imgResolver:n,displayForcedOnlyMode:s||!1,isd:e,errorHandler:o,previousISDState:l,enableRollUp:u||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(t.appendChild(h),"contents"in e)for(var p=0;p<e.contents.length;p++)r(g,h,e.contents[p],e);return g.currentISDState};for(var d=[new c("http://www.w3.org/ns/ttml#styling backgroundColor",(function(e,t,n,r){0!==r[3]&&(t.style.backgroundColor="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")")})),new c("http://www.w3.org/ns/ttml#styling color",(function(e,t,n,r){t.style.color="rgba("+r[0].toString()+","+r[1].toString()+","+r[2].toString()+","+(r[3]/255).toString()+")"})),new c("http://www.w3.org/ns/ttml#styling direction",(function(e,t,n,r){t.style.direction=r})),new c("http://www.w3.org/ns/ttml#styling display",(function(e,t,n,r){})),new c("http://www.w3.org/ns/ttml#styling displayAlign",(function(e,t,n,r){t.style.display="flex",t.style.flexDirection="column","before"===r?t.style.justifyContent="flex-start":"center"===r?t.style.justifyContent="center":"after"===r&&(t.style.justifyContent="flex-end")})),new c("http://www.w3.org/ns/ttml#styling extent",(function(e,t,n,r){e.regionH=r.h.toUsedLength(e.w,e.h),e.regionW=r.w.toUsedLength(e.w,e.h);var i=0,a=0,s=n.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];s&&(i=s[0].toUsedLength(e.w,e.h)+s[2].toUsedLength(e.w,e.h),a=s[1].toUsedLength(e.w,e.h)+s[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-i+"px",t.style.width=e.regionW-a+"px"})),new c("http://www.w3.org/ns/ttml#styling fontFamily",(function(e,t,n,r){for(var i=[],a=0;a<r.length;a++)"monospaceSerif"===r[a]?(i.push("Courier New"),i.push('"Liberation Mono"'),i.push("Courier"),i.push("monospace")):"proportionalSansSerif"===r[a]?(i.push("Arial"),i.push("Helvetica"),i.push('"Liberation Sans"'),i.push("sans-serif")):"monospace"===r[a]?i.push("monospace"):"sansSerif"===r[a]?i.push("sans-serif"):"serif"===r[a]?i.push("serif"):"monospaceSansSerif"===r[a]?(i.push("Consolas"),i.push("monospace")):"proportionalSerif"===r[a]?i.push("serif"):i.push(r[a]);if(i.length>0){for(var s=[i[0]],o=1;o<i.length;o++)-1==s.indexOf(i[o])&&s.push(i[o]);i=s}t.style.fontFamily=i.join(",")})),new c("http://www.w3.org/ns/ttml#styling shear",(function(e,t,n,r){if(0!==r){var i=-.9*r;"tb"===e.bpd?t.style.transform="skewX("+i+"deg)":t.style.transform="skewY("+i+"deg)"}})),new c("http://www.w3.org/ns/ttml#styling fontSize",(function(e,t,n,r){t.style.fontSize=r.toUsedLength(e.w,e.h)+"px"})),new c("http://www.w3.org/ns/ttml#styling fontStyle",(function(e,t,n,r){t.style.fontStyle=r})),new c("http://www.w3.org/ns/ttml#styling fontWeight",(function(e,t,n,r){t.style.fontWeight=r})),new c("http://www.w3.org/ns/ttml#styling lineHeight",(function(e,t,n,r){t.style.lineHeight="normal"===r?"normal":r.toUsedLength(e.w,e.h)+"px"})),new c("http://www.w3.org/ns/ttml#styling opacity",(function(e,t,n,r){t.style.opacity=r})),new c("http://www.w3.org/ns/ttml#styling origin",(function(e,t,n,r){t.style.top=r.h.toUsedLength(e.w,e.h)+"px",t.style.left=r.w.toUsedLength(e.w,e.h)+"px"})),new c("http://www.w3.org/ns/ttml#styling overflow",(function(e,t,n,r){t.style.overflow=r})),new c("http://www.w3.org/ns/ttml#styling padding",(function(e,t,n,r){var i=[];i[0]=r[0].toUsedLength(e.w,e.h)+"px",i[1]=r[3].toUsedLength(e.w,e.h)+"px",i[2]=r[2].toUsedLength(e.w,e.h)+"px",i[3]=r[1].toUsedLength(e.w,e.h)+"px",t.style.padding=i.join(" ")})),new c("http://www.w3.org/ns/ttml#styling position",(function(e,t,n,r){t.style.top=r.h.toUsedLength(e.w,e.h)+"px",t.style.left=r.w.toUsedLength(e.w,e.h)+"px"})),new c("http://www.w3.org/ns/ttml#styling rubyAlign",(function(e,t,n,r){t.style.rubyAlign="spaceAround"===r?"space-around":"center"})),new c("http://www.w3.org/ns/ttml#styling rubyPosition",(function(e,t,n,r){var i;"before"!==r&&"after"!==r||(i=g?r:"tb"===e.bpd||"rl"===e.bpd?"before"===r?"over":"under":"before"===r?"under":"over",t.parentElement.style[p]=i)})),new c("http://www.w3.org/ns/ttml#styling showBackground",null),new c("http://www.w3.org/ns/ttml#styling textAlign",(function(e,t,n,r){var i;i="start"===r?"rl"===e.ipd?"right":"left":"end"===r?"rl"===e.ipd?"left":"right":r,t.style.textAlign=i})),new c("http://www.w3.org/ns/ttml#styling textDecoration",(function(e,t,n,r){t.style.textDecoration=r.join(" ").replace("lineThrough","line-through")})),new c("http://www.w3.org/ns/ttml#styling textOutline",(function(e,t,n,r){})),new c("http://www.w3.org/ns/ttml#styling textShadow",(function(e,t,r,i){var a=r.styleAttrs[n.byName.textOutline.qname];if("none"===i&&"none"===a)t.style.textShadow="";else{var s=[];if("none"!==a){var o="rgba("+a.color[0].toString()+","+a.color[1].toString()+","+a.color[2].toString()+","+(a.color[3]/255).toString()+")";s.push("1px 1px 1px "+o),s.push("-1px 1px 1px "+o),s.push("1px -1px 1px "+o),s.push("-1px -1px 1px "+o)}if("none"!==i)for(var l=0;l<i.length;l++)s.push(i[l].x_off.toUsedLength(e.w,e.h)+"px "+i[l].y_off.toUsedLength(e.w,e.h)+"px "+i[l].b_radius.toUsedLength(e.w,e.h)+"px rgba("+i[l].color[0].toString()+","+i[l].color[1].toString()+","+i[l].color[2].toString()+","+(i[l].color[3]/255).toString()+")");t.style.textShadow=s.join(",")}})),new c("http://www.w3.org/ns/ttml#styling textCombine",(function(e,t,n,r){t.style.textCombineUpright=r})),new c("http://www.w3.org/ns/ttml#styling textEmphasis",(function(e,t,n,r){})),new c("http://www.w3.org/ns/ttml#styling unicodeBidi",(function(e,t,n,r){var i;i="bidiOverride"===r?"bidi-override":r,t.style.unicodeBidi=i})),new c("http://www.w3.org/ns/ttml#styling visibility",(function(e,t,n,r){t.style.visibility=r})),new c("http://www.w3.org/ns/ttml#styling wrapOption",(function(e,t,n,r){"wrap"===r?"preserve"===n.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===n.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"})),new c("http://www.w3.org/ns/ttml#styling writingMode",(function(e,t,n,r){"lrtb"===r||"lr"===r||"rltb"===r||"rl"===r?t.style.writingMode="horizontal-tb":"tblr"===r?t.style.writingMode="vertical-lr":"tbrl"!==r&&"tb"!==r||(t.style.writingMode="vertical-rl")})),new c("http://www.w3.org/ns/ttml#styling zIndex",(function(e,t,n,r){t.style.zIndex=r})),new c("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",(function(e,t,n,r){e.displayForcedOnlyMode&&!1===r&&(t.style.visibility="hidden")}))],f={},h=0;h<d.length;h++)f[d[h].qname]=d[h];var g="webkitRubyPosition"in window.getComputedStyle(document.documentElement),p=g?"webkitRubyPosition":"rubyPosition",m="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",E="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition"}(t,"undefined"==typeof imscNames?n(4761):imscNames,"undefined"==typeof imscStyles?n(3060):imscStyles,"undefined"==typeof imscUtils?n(2535):imscUtils)},3332:(e,t,n)=>{!function(e,t,n,r){e.generateISD=function(e,t,r){var i,s=new l(e),o={},u={},c=e.head.styling.initials[n.byName.showBackground.qname],d=e.head.styling.initials[n.byName.backgroundColor.qname];for(var f in e.head.layout.regions)if(e.head.layout.regions.hasOwnProperty(f)){var h=e.head.layout.regions[f],g=h.styleAttrs[n.byName.showBackground.qname]||c,p=h.styleAttrs[n.byName.backgroundColor.qname]||d;u[h.id]=("always"===g||void 0===g)&&void 0!==p&&!(t<h.begin||t>=h.end)}for(var m in e.body&&e.body.regionID&&(u[e.body.regionID]=!0),i=null!==e.body?function e(t,n){if(n.contents){var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);return r.contents=[],n.contents.filter((function(e){return!(t<e.begin||t>=e.end)})).forEach((function(n){var i=e(t,n);i.regionID&&(u[i.regionID]=!0),null!==i&&r.contents.push(i)})),r}return n}(t,e.body):null,void 0!==u[""]&&(u[""]=!0),u)if(u[m]){var E=a(e,t,e.head.layout.regions[m],i,null,"",e.head.layout.regions[m],r,o);null!==E&&s.contents.push(E.element)}return s};var i=[n.byName.color.qname,n.byName.textCombine.qname,n.byName.textDecoration.qname,n.byName.textEmphasis.qname,n.byName.textOutline.qname,n.byName.textShadow.qname];function a(e,t,l,d,f,h,g,p,m){if(t<g.begin||t>=g.end)return null;var E="regionID"in g&&""!==g.regionID?g.regionID:h;if(null!==f&&E!==l.id&&(!("contents"in g)||"contents"in g&&0===g.contents.length||""!==E))return null;var y=new u(g);if("sets"in g)for(var _=0;_<g.sets.length;_++)t<g.sets[_].begin||t>=g.sets[_].end||(y.styleAttrs[g.sets[_].qname]=g.sets[_].value);var T={};for(var v in y.styleAttrs)if(y.styleAttrs.hasOwnProperty(v)&&(T[v]=!0,"region"===y.kind&&v===n.byName.writingMode.qname&&!(n.byName.direction.qname in y.styleAttrs))){var S=y.styleAttrs[v];"lrtb"===S||"lr"===S?y.styleAttrs[n.byName.direction.qname]="ltr":"rltb"!==S&&"rl"!==S||(y.styleAttrs[n.byName.direction.qname]="rtl")}if(null!==f)for(var A=0;A<n.all.length;A++){var R=n.all[A];if(R.qname===n.byName.textDecoration.qname){var b=f.styleAttrs[R.qname],I=y.styleAttrs[R.qname],D=[];void 0===I?D=b:-1===I.indexOf("none")?((-1===I.indexOf("noUnderline")&&-1!==b.indexOf("underline")||-1!==I.indexOf("underline"))&&D.push("underline"),(-1===I.indexOf("noLineThrough")&&-1!==b.indexOf("lineThrough")||-1!==I.indexOf("lineThrough"))&&D.push("lineThrough"),(-1===I.indexOf("noOverline")&&-1!==b.indexOf("overline")||-1!==I.indexOf("overline"))&&D.push("overline")):D.push("none"),y.styleAttrs[R.qname]=D}else if(R.qname!==n.byName.fontSize.qname||R.qname in y.styleAttrs||"span"!==y.kind||"textContainer"!==y.styleAttrs[n.byName.ruby.qname])if(R.qname!==n.byName.fontSize.qname||R.qname in y.styleAttrs||"span"!==y.kind||"text"!==y.styleAttrs[n.byName.ruby.qname])R.inherit&&R.qname in f.styleAttrs&&!(R.qname in y.styleAttrs)&&(y.styleAttrs[R.qname]=f.styleAttrs[R.qname]);else{var w=f.styleAttrs[n.byName.fontSize.qname];"textContainer"===f.styleAttrs[n.byName.ruby.qname]?y.styleAttrs[R.qname]=w:y.styleAttrs[R.qname]=new r.ComputedLength(.5*w.rw,.5*w.rh)}else{var C=f.styleAttrs[n.byName.fontSize.qname];y.styleAttrs[R.qname]=new r.ComputedLength(.5*C.rw,.5*C.rh)}}for(var N=0;N<n.all.length;N++){var L=n.all[N];if(!(L.qname in y.styleAttrs)&&!(L.qname===n.byName.position.qname&&n.byName.origin.qname in y.styleAttrs||L.qname===n.byName.origin.qname&&n.byName.position.qname in y.styleAttrs)){var M=e.head.styling.initials[L.qname]||L.initial;if(null!==M&&("region"===y.kind||!1===L.inherit&&null!==M)){var O=L.parse(M);null!==O?(y.styleAttrs[L.qname]=O,T[L.qname]=!0):c(p,"Invalid initial value for '"+L.qname+"' on element '"+y.kind)}}}for(var P=0;P<n.all.length;P++){var x=n.all[P];if(x.qname in T&&null!==x.compute){var F=x.compute(e,f,y,y.styleAttrs[x.qname],m);null!==F?y.styleAttrs[x.qname]=F:(y.styleAttrs[x.qname]=x.compute(e,f,y,x.parse(x.initial),m),c(p,"Style '"+x.qname+"' on element '"+y.kind+"' cannot be computed"))}}if("none"===y.styleAttrs[n.byName.display.qname])return null;var k=null;null===f?k=null===d?[]:[d]:"contents"in g&&(k=g.contents);for(var U=0;null!==k&&U<k.length;U++){var B=a(e,t,l,d,y,E,k[U],p,m);null!==B&&y.contents.push(B.element)}for(var G in y.styleAttrs)if(y.styleAttrs.hasOwnProperty(G)){var q=!1;if("span"===y.kind){var K=y.styleAttrs[n.byName.ruby.qname];(q=("container"===K||"textContainer"===K||"baseContainer"===K)&&-1!==i.indexOf(G))||(q="container"!==K&&G===n.byName.rubyAlign.qname),q||(q=!("textContainer"===K||"text"===K)&&G===n.byName.rubyPosition.qname)}if(!q){var H=n.byQName[G];"applies"in H&&(q=-1===H.applies.indexOf(y.kind))}q&&delete y.styleAttrs[G]}var Y=y.styleAttrs[n.byName.ruby.qname];if("p"===y.kind||"span"===y.kind&&("textContainer"===Y||"text"===Y)){var V=[];s(y,V),function(e){for(var t,n=0;n<e.length;)if("br"!==(t=e[n]).kind&&"preserve"!==t.space){var r=t.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(r)&&(0===n||("br"===(i=e[n-1]).kind||/[\r\n\t ]$/.test(i.text)))&&(r=r.substring(1)),t.text=r,0===r.length?e.splice(n,1):n++}else n++;var i,a;for(n=0;n<e.length;n++)"br"!==(t=e[n]).kind&&"preserve"!==t.space?/[ ]$/.test(t.text)&&(n===e.length-1||("br"===(a=e[n+1]).kind||"preserve"===a.space&&/^[\r\n]/.test(a.text)))&&(t.text=t.text.slice(0,-1)):n++}(V),o(y)}return"div"===y.kind&&n.byName.backgroundImage.qname in y.styleAttrs||"br"===y.kind||"image"===y.kind||"contents"in y&&y.contents.length>0||"span"===y.kind&&null!==y.text||"region"===y.kind&&"always"===y.styleAttrs[n.byName.showBackground.qname]?{region_id:E,element:y}:null}function s(e,t){if("contents"in e)for(var r=0;r<e.contents.length;r++){var i=e.contents[r],a=i.styleAttrs[n.byName.ruby.qname];("span"!==i.kind||"textContainer"!==a&&"text"!==a)&&("contents"in i?s(i,t):("span"===i.kind&&0!==i.text.length||"br"===i.kind)&&t.push(i))}}function o(e){if("br"===e.kind)return!1;if("text"in e)return 0===e.text.length;if("contents"in e){for(var t=e.contents.length;t--;)o(e.contents[t])&&e.contents.splice(t,1);return 0===e.contents.length}}function l(e){this.contents=[],this.aspectRatio=e.aspectRatio,this.lang=e.lang}function u(e){for(var t in this.kind=e.kind||"region",this.lang=e.lang,e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)e.styleAttrs.hasOwnProperty(t)&&(this.styleAttrs[t]=e.styleAttrs[t]);"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function c(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?n(4761):imscNames,"undefined"==typeof imscStyles?n(3060):imscStyles,"undefined"==typeof imscUtils?n(2535):imscUtils)},315:(e,t,n)=>{t.generateISD=n(3332).generateISD,t.fromXML=n(7006).fromXML,t.renderHTML=n(4795).render},4761:(e,t)=>{!function(e){e.ns_tt="http://www.w3.org/ns/ttml",e.ns_tts="http://www.w3.org/ns/ttml#styling",e.ns_ttp="http://www.w3.org/ns/ttml#parameter",e.ns_xml="http://www.w3.org/XML/1998/namespace",e.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",e.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",e.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",e.ns_ebutts="urn:ebu:tt:style"}(t)},3060:(e,t,n)=>{!function(e,t,n){function r(e,t,n,r,i,a,s,o){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=i,this.animatable=a,this.initial=n,this.applies=r,this.parse=s,this.compute=o}for(var i in e.all=[new r(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,n.parseColor,null),new r(t.ns_tts,"color","white",["span"],!0,!0,n.parseColor,null),new r(t.ns_tts,"direction","ltr",["p","span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"displayAlign","before",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"extent","auto",["tt","region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),i=n.parseLength(t[1]);return i&&r?{h:i,w:r}:null}),(function(e,t,r,i,a){var s,o;if("auto"===i)s=new n.ComputedLength(0,1);else if(null===(s=n.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)o=new n.ComputedLength(1,0);else if(null===(o=n.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:o}})),new r(t.ns_tts,"fontFamily","default",["span","p"],!0,!0,(function(e){for(var t=e.split(","),n=[],r=0;r<t.length;r++)"'"!==t[r].charAt(0)&&'"'!==t[r].charAt(0)&&"default"===t[r]?n.push("monospaceSerif"):n.push(t[r]);return n}),null),new r(t.ns_tts,"shear","0%",["p"],!0,!0,n.parseLength,(function(e,t,n,r){return"%"!==r.unit?null:Math.abs(r.value)>100?100*Math.sign(r.value):r.value})),new r(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,n.parseLength,(function(t,r,i,a,s){return n.toComputedLength(a.value,a.unit,null!==r?r.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,null!==r?r.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,t.cellLength.h,t.pxLength.h)})),new r(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"lineHeight","normal",["p"],!0,!0,(function(e){return"normal"===e?e:n.parseLength(e)}),(function(t,r,i,a,s){var o;if("normal"===a)o=a;else if(null===(o=n.toComputedLength(a.value,a.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h)))return null;return o})),new r(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new r(t.ns_tts,"origin","auto",["region"],!1,!0,(function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var r=n.parseLength(t[0]),i=n.parseLength(t[1]);return i&&r?{h:i,w:r}:null}),(function(e,t,r,i,a){var s,o;if("auto"===i)s=new n.ComputedLength(0,0);else if(null===(s=n.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)o=new n.ComputedLength(0,0);else if(null===(o=n.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:o}})),new r(t.ns_tts,"overflow","hidden",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"padding","0px",["region"],!1,!0,(function(e){var t=e.split(" ");if(t.length>4)return null;for(var r=[],i=0;i<t.length;i++){var a=n.parseLength(t[i]);if(!a)return null;r.push(a)}return r}),(function(t,r,i,a,s){var o;if(1===a.length)o=[a[0],a[0],a[0],a[0]];else if(2===a.length)o=[a[0],a[1],a[0],a[1]];else if(3===a.length)o=[a[0],a[1],a[2],a[1]];else{if(4!==a.length)return null;o=[a[0],a[1],a[2],a[3]]}var l=i.styleAttrs[e.byName.writingMode.qname];if("lrtb"===l||"lr"===l)o=[o[0],o[3],o[2],o[1]];else if("rltb"===l||"rl"===l)o=[o[0],o[1],o[2],o[3]];else if("tblr"===l)o=[o[3],o[0],o[1],o[2]];else{if("tbrl"!==l&&"tb"!==l)return null;o=[o[3],o[2],o[1],o[0]]}for(var u=[],c=0;c<o.length;c++)if(0===o[c].value)u[c]=new n.ComputedLength(0,0);else if(u[c]=n.toComputedLength(o[c].value,o[c].unit,i.styleAttrs[e.byName.fontSize.qname],0===c||2===c?i.styleAttrs[e.byName.extent.qname].h:i.styleAttrs[e.byName.extent.qname].w,0===c||2===c?t.cellLength.h:t.cellLength.w,0===c||2===c?t.pxLength.h:t.pxLength.w),null===u[c])return null;return u})),new r(t.ns_tts,"position","top left",["region"],!1,!0,(function(e){return n.parsePosition(e)}),(function(t,r,i,a){var s,o;return null===(s=n.toComputedLength(a.v.offset.value,a.v.offset.unit,null,new n.ComputedLength(-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-i.styleAttrs[e.byName.extent.qname].h.rh),null,t.pxLength.h))?null:("bottom"===a.v.edge&&(s=new n.ComputedLength(-s.rw-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-s.rh-i.styleAttrs[e.byName.extent.qname].h.rh)),o=n.toComputedLength(a.h.offset.value,a.h.offset.unit,null,new n.ComputedLength(t.dimensions.w.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-i.styleAttrs[e.byName.extent.qname].w.rh),null,t.pxLength.w),null===s?null:("right"===a.h.edge&&(o=new n.ComputedLength(t.dimensions.w.rw-o.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-o.rh-i.styleAttrs[e.byName.extent.qname].w.rh)),{h:s,w:o}))})),new r(t.ns_tts,"ruby","none",["span"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"rubyAlign","center",["span"],!0,!0,(function(e){return"center"!==e&&"spaceAround"!==e?null:e}),null),new r(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"rubyReserve","none",["p"],!0,!0,(function(e){var t=e.split(" "),r=[null,null];if(0===t.length||t.length>2)return null;if("none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(r[0]=t[0],2===t.length&&"none"!==t[0]){var i=n.parseLength(t[1]);if(!i)return null;r[1]=i}return r}),(function(t,r,i,a,s){if("none"===a[0])return a;var o;return null===(o=null===a[1]?new n.ComputedLength(.5*i.styleAttrs[e.byName.fontSize.qname].rw,.5*i.styleAttrs[e.byName.fontSize.qname].rh):n.toComputedLength(a[1].value,a[1].unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h))?null:[a[0],o]})),new r(t.ns_tts,"showBackground","always",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"textAlign","start",["p"],!0,!0,(function(e){return e}),(function(e,t,n,r,i){return"left"===r?"start":"right"===r?"end":r})),new r(t.ns_tts,"textCombine","none",["span"],!0,!0,(function(e){return"none"===e||"all"===e?e:null}),null),new r(t.ns_tts,"textDecoration","none",["span"],!0,!0,(function(e){return e.split(" ")}),null),new r(t.ns_tts,"textEmphasis","none",["span"],!0,!0,(function(e){for(var t=e.split(" "),r={style:null,symbol:null,color:null,position:null},i=0;i<t.length;i++)if("none"===t[i]||"auto"===t[i])r.style=t[i];else if("filled"===t[i]||"open"===t[i])r.style=t[i];else if("circle"===t[i]||"dot"===t[i]||"sesame"===t[i])r.symbol=t[i];else if("current"===t[i])r.color=t[i];else if("outside"===t[i]||"before"===t[i]||"after"===t[i])r.position=t[i];else if(r.color=n.parseColor(t[i]),null===r.color)return null;return null==r.style&&null==r.symbol?r.style="auto":(r.symbol=r.symbol||"circle",r.style=r.style||"filled"),r.position=r.position||"outside",r.color=r.color||"current",r}),null),new r(t.ns_tts,"textOutline","none",["span"],!0,!0,(function(e){if("none"===e)return e;var t={},r=e.split(" ");if(0===r.length||r.length>2)return null;var i=n.parseColor(r[0]);if(t.color=i,null!==i&&r.shift(),1!==r.length)return null;var a=n.parseLength(r[0]);return a?(t.thickness=a,t):null}),(function(t,r,i,a,s){if("none"===a)return a;var o={};return null===a.color?o.color=i.styleAttrs[e.byName.color.qname]:o.color=a.color,o.thickness=n.toComputedLength(a.thickness.value,a.thickness.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h),null===o.thickness?null:o})),new r(t.ns_tts,"textShadow","none",["span"],!0,!0,n.parseTextShadow,(function(t,r,i,a){if("none"===a)return a;for(var s=[],o=0;o<a.length;o++){var l={};if(l.x_off=n.toComputedLength(a[o][0].value,a[o][0].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.w),null===l.x_off)return null;if(l.y_off=n.toComputedLength(a[o][1].value,a[o][1].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.y_off)return null;if(null===a[o][2])l.b_radius=0;else if(l.b_radius=n.toComputedLength(a[o][2].value,a[o][2].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.b_radius)return null;null===a[o][3]?l.color=i.styleAttrs[e.byName.color.qname]:l.color=a[o][3],s.push(l)}return s})),new r(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,(function(e){return e}),null),new r(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,(function(e){return e}),null),new r(t.ns_tts,"zIndex","auto",["region"],!1,!0,(function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t}),null),new r(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,n.parseLength,(function(e,t,r,i,a){return n.toComputedLength(i.value,i.unit,null,null,e.cellLength.w,null)})),new r(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,(function(e){return e}),null),new r(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,(function(e){return e}),null),new r(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,(function(e){return"true"===e}),null),new r(t.ns_itts,"fillLineGap","false",["p"],!0,!0,(function(e){return"true"===e}),null)],e.byQName={},e.all)e.byQName[e.all[i].qname]=e.all[i];for(var a in e.byName={},e.all)e.byName[e.all[a].name]=e.all[a]}(t,"undefined"==typeof imscNames?n(4761):imscNames,"undefined"==typeof imscUtils?n(2535):imscUtils)},2535:(e,t)=>{!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,n=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,r=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var a,s=null,o=i[e.toLowerCase()];return void 0!==o?s=o:null!==(a=t.exec(e))?s=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),void 0!==a[4]?parseInt(a[4],16):255]:null!==(a=n.exec(e))?s=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),255]:null!==(a=r.exec(e))&&(s=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseInt(a[4])]),s};var a=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;e.parseLength=function(e){var t,n=null;return null!==(t=a.exec(e))&&(n={value:parseFloat(t[1]),unit:t[2]}),n},e.parseTextShadow=function(t){for(var n=t.match(/([^\(,\)]|\([^\)]+\))+/g),r=[],i=0;i<n.length;i++){var a=n[i].split(" ");if(1===a.length&&"none"===a[0])return"none";if(a.length>1&&a.length<5){var s=[null,null,null,null],o=e.parseLength(a.shift());if(null===o)return null;if(s[0]=o,null===(o=e.parseLength(a.shift())))return null;if(s[1]=o,0===a.length){r.push(s);continue}if(null!==(o=e.parseLength(a[0]))&&(s[2]=o,a.shift()),0===a.length){r.push(s);continue}var l=e.parseColor(a[0]);if(null===l)return null;s[3]=l,r.push(s)}}return r},e.parsePosition=function(t){var n=t.split(" "),r=function(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e};if(n.length>4)return null;for(var i=0;i<n.length;i++)if(!r(n[i])){var a=e.parseLength(n[i]);if(null===a)return null;n[i]=a}for(var s={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},o=0;o<n.length;){var l=n[o++];if(r(l)){var u={value:0,unit:"%"};2!==n.length&&o<n.length&&!r(n[o])&&(u=n[o++]),"right"===l?(s.h.edge=l,s.h.offset=u):"bottom"===l?(s.v.edge=l,s.v.offset=u):"left"===l?s.h.offset=u:"top"===l&&(s.v.offset=u)}else{if(1!==n.length&&2!==n.length)return null;1===o?s.h.offset=l:s.v.offset=l}}return s},e.ComputedLength=function(e,t){this.rw=e,this.rh=t},e.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},e.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},e.toComputedLength=function(t,n,r,i,a,s){return"%"===n&&i?new e.ComputedLength(i.rw*t/100,i.rh*t/100):"em"===n&&r?new e.ComputedLength(r.rw*t,r.rh*t):"c"===n&&a?new e.ComputedLength(t*a.rw,t*a.rh):"px"===n&&s?new e.ComputedLength(t*s.rw,t*s.rh):"rh"===n?new e.ComputedLength(0,t/100):"rw"===n?new e.ComputedLength(t/100,0):null}}(t)},2592:(e,t,n)=>{const r=n(7138),i=n(5115),a=n(6907),s=n(3776);function o(e,t,n,a,s){const o=[].slice.call(arguments,1),l=o.length,u="function"==typeof o[l-1];if(!u&&!r())throw new Error("Callback required as last argument");if(!u){if(l<1)throw new Error("Too few arguments provided");return 1===l?(n=t,t=a=void 0):2!==l||t.getContext||(a=n,n=t,t=void 0),new Promise((function(r,s){try{const s=i.create(n,a);r(e(s,t,a))}catch(e){s(e)}}))}if(l<2)throw new Error("Too few arguments provided");2===l?(s=n,n=t,t=a=void 0):3===l&&(t.getContext&&void 0===s?(s=a,a=void 0):(s=a,a=n,n=t,t=void 0));try{const r=i.create(n,a);s(null,e(r,t,a))}catch(e){s(e)}}i.create,t.rT=o.bind(null,a.render),o.bind(null,a.renderToDataURL),o.bind(null,(function(e,t,n){return s.render(e,n)}))},7138:e=>{e.exports=function(){return"function"==typeof Promise&&Promise.prototype&&Promise.prototype.then}},1845:(e,t,n)=>{const r=n(242).getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];const t=Math.floor(e/7)+2,n=r(e),i=145===n?26:2*Math.ceil((n-13)/(2*t-2)),a=[n-7];for(let e=1;e<t-1;e++)a[e]=a[e-1]-i;return a.push(6),a.reverse()},t.getPositions=function(e){const n=[],r=t.getRowColCoords(e),i=r.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)0===e&&0===t||0===e&&t===i-1||e===i-1&&0===t||n.push([r[e],r[t]]);return n}},8260:(e,t,n)=>{const r=n(6910),i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function a(e){this.mode=r.ALPHANUMERIC,this.data=e}a.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=45*i.indexOf(this.data[t]);n+=i.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(i.indexOf(this.data[t]),6)},e.exports=a},7245:e=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){const t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},3280:e=>{function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,n,r){const i=e*this.size+t;this.data[i]=n,r&&(this.reservedBit[i]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},3424:(e,t,n)=>{const r=n(2378),i=n(6910);function a(e){this.mode=i.BYTE,"string"==typeof e&&(e=r(e)),this.data=new Uint8Array(e)}a.getBitsLength=function(e){return 8*e},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},e.exports=a},5393:(e,t,n)=>{const r=n(4908),i=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],a=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case r.L:return i[4*(e-1)+0];case r.M:return i[4*(e-1)+1];case r.Q:return i[4*(e-1)+2];case r.H:return i[4*(e-1)+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case r.L:return a[4*(e-1)+0];case r.M:return a[4*(e-1)+1];case r.Q:return a[4*(e-1)+2];case r.H:return a[4*(e-1)+3];default:return}}},4908:(e,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&void 0!==e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,n){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(e){return n}}},6526:(e,t,n)=>{const r=n(242).getSymbolSize;t.getPositions=function(e){const t=r(e);return[[0,0],[t-7,0],[0,t-7]]}},1642:(e,t,n)=>{const r=n(242),i=r.getBCHDigit(1335);t.getEncodedBits=function(e,t){const n=e.bit<<3|t;let a=n<<10;for(;r.getBCHDigit(a)-i>=0;)a^=1335<<r.getBCHDigit(a)-i;return 21522^(n<<10|a)}},9729:(e,t)=>{const n=new Uint8Array(512),r=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)n[t]=e,r[e]=t,e<<=1,256&e&&(e^=285);for(let e=255;e<512;e++)n[e]=n[e-255]}(),t.log=function(e){if(e<1)throw new Error("log("+e+")");return r[e]},t.exp=function(e){return n[e]},t.mul=function(e,t){return 0===e||0===t?0:n[r[e]+r[t]]}},5442:(e,t,n)=>{const r=n(6910),i=n(242);function a(e){this.mode=r.KANJI,this.data=e}a.getBitsLength=function(e){return 13*e},a.prototype.getLength=function(){return this.data.length},a.prototype.getBitsLength=function(){return a.getBitsLength(this.data.length)},a.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=i.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else{if(!(n>=57408&&n<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");n-=49472}n=192*(n>>>8&255)+(255&n),e.put(n,13)}},e.exports=a},7126:(e,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};function n(e,n,r){switch(e){case t.Patterns.PATTERN000:return(n+r)%2==0;case t.Patterns.PATTERN001:return n%2==0;case t.Patterns.PATTERN010:return r%3==0;case t.Patterns.PATTERN011:return(n+r)%3==0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2==0;case t.Patterns.PATTERN101:return n*r%2+n*r%3==0;case t.Patterns.PATTERN110:return(n*r%2+n*r%3)%2==0;case t.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}}t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){const t=e.size;let n=0,r=0,i=0,a=null,s=null;for(let o=0;o<t;o++){r=i=0,a=s=null;for(let l=0;l<t;l++){let t=e.get(o,l);t===a?r++:(r>=5&&(n+=r-5+3),a=t,r=1),t=e.get(l,o),t===s?i++:(i>=5&&(n+=i-5+3),s=t,i=1)}r>=5&&(n+=r-5+3),i>=5&&(n+=i-5+3)}return n},t.getPenaltyN2=function(e){const t=e.size;let n=0;for(let r=0;r<t-1;r++)for(let i=0;i<t-1;i++){const t=e.get(r,i)+e.get(r,i+1)+e.get(r+1,i)+e.get(r+1,i+1);4!==t&&0!==t||n++}return 3*n},t.getPenaltyN3=function(e){const t=e.size;let n=0,r=0,i=0;for(let a=0;a<t;a++){r=i=0;for(let s=0;s<t;s++)r=r<<1&2047|e.get(a,s),s>=10&&(1488===r||93===r)&&n++,i=i<<1&2047|e.get(s,a),s>=10&&(1488===i||93===i)&&n++}return 40*n},t.getPenaltyN4=function(e){let t=0;const n=e.data.length;for(let r=0;r<n;r++)t+=e.data[r];return 10*Math.abs(Math.ceil(100*t/n/5)-10)},t.applyMask=function(e,t){const r=t.size;for(let i=0;i<r;i++)for(let a=0;a<r;a++)t.isReserved(a,i)||t.xor(a,i,n(e,a,i))},t.getBestMask=function(e,n){const r=Object.keys(t.Patterns).length;let i=0,a=1/0;for(let s=0;s<r;s++){n(s),t.applyMask(s,e);const r=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(s,e),r<a&&(a=r,i=s)}return i}},6910:(e,t,n)=>{const r=n(3114),i=n(7007);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!r.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return i.testNumeric(e)?t.NUMERIC:i.testAlphanumeric(e)?t.ALPHANUMERIC:i.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,n){if(t.isValid(e))return e;try{return function(e){if("string"!=typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+e)}}(e)}catch(e){return n}}},1085:(e,t,n)=>{const r=n(6910);function i(e){this.mode=r.NUMERIC,this.data=e.toString()}i.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,3*i+1))},e.exports=i},6143:(e,t,n)=>{const r=n(9729);t.mul=function(e,t){const n=new Uint8Array(e.length+t.length-1);for(let i=0;i<e.length;i++)for(let a=0;a<t.length;a++)n[i+a]^=r.mul(e[i],t[a]);return n},t.mod=function(e,t){let n=new Uint8Array(e);for(;n.length-t.length>=0;){const e=n[0];for(let i=0;i<t.length;i++)n[i]^=r.mul(t[i],e);let i=0;for(;i<n.length&&0===n[i];)i++;n=n.slice(i)}return n},t.generateECPolynomial=function(e){let n=new Uint8Array([1]);for(let i=0;i<e;i++)n=t.mul(n,new Uint8Array([1,r.exp(i)]));return n}},5115:(e,t,n)=>{const r=n(242),i=n(4908),a=n(7245),s=n(3280),o=n(1845),l=n(6526),u=n(7126),c=n(5393),d=n(2882),f=n(3103),h=n(1642),g=n(6910),p=n(6130);function m(e,t,n){const r=e.size,i=h.getEncodedBits(t,n);let a,s;for(a=0;a<15;a++)s=1==(i>>a&1),a<6?e.set(a,8,s,!0):a<8?e.set(a+1,8,s,!0):e.set(r-15+a,8,s,!0),a<8?e.set(8,r-a-1,s,!0):a<9?e.set(8,15-a-1+1,s,!0):e.set(8,15-a-1,s,!0);e.set(r-8,8,1,!0)}function E(e,t,n,i){let h;if(Array.isArray(e))h=p.fromArray(e);else{if("string"!=typeof e)throw new Error("Invalid data");{let r=t;if(!r){const t=p.rawSplit(e);r=f.getBestVersionForData(t,n)}h=p.fromString(e,r||40)}}const E=f.getBestVersionForData(h,n);if(!E)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<E)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+E+".\n")}else t=E;const y=function(e,t,n){const i=new a;n.forEach((function(t){i.put(t.mode.bit,4),i.put(t.getLength(),g.getCharCountIndicator(t.mode,e)),t.write(i)}));const s=8*(r.getSymbolTotalCodewords(e)-c.getTotalCodewordsCount(e,t));for(i.getLengthInBits()+4<=s&&i.put(0,4);i.getLengthInBits()%8!=0;)i.putBit(0);const o=(s-i.getLengthInBits())/8;for(let e=0;e<o;e++)i.put(e%2?17:236,8);return function(e,t,n){const i=r.getSymbolTotalCodewords(t),a=i-c.getTotalCodewordsCount(t,n),s=c.getBlocksCount(t,n),o=s-i%s,l=Math.floor(i/s),u=Math.floor(a/s),f=u+1,h=l-u,g=new d(h);let p=0;const m=new Array(s),E=new Array(s);let y=0;const _=new Uint8Array(e.buffer);for(let e=0;e<s;e++){const t=e<o?u:f;m[e]=_.slice(p,p+t),E[e]=g.encode(m[e]),p+=t,y=Math.max(y,t)}const T=new Uint8Array(i);let v,S,A=0;for(v=0;v<y;v++)for(S=0;S<s;S++)v<m[S].length&&(T[A++]=m[S][v]);for(v=0;v<h;v++)for(S=0;S<s;S++)T[A++]=E[S][v];return T}(i,e,t)}(t,n,h),_=r.getSymbolSize(t),T=new s(_);return function(e,t){const n=e.size,r=l.getPositions(t);for(let t=0;t<r.length;t++){const i=r[t][0],a=r[t][1];for(let t=-1;t<=7;t++)if(!(i+t<=-1||n<=i+t))for(let r=-1;r<=7;r++)a+r<=-1||n<=a+r||(t>=0&&t<=6&&(0===r||6===r)||r>=0&&r<=6&&(0===t||6===t)||t>=2&&t<=4&&r>=2&&r<=4?e.set(i+t,a+r,!0,!0):e.set(i+t,a+r,!1,!0))}}(T,t),function(e){const t=e.size;for(let n=8;n<t-8;n++){const t=n%2==0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}(T),function(e,t){const n=o.getPositions(t);for(let t=0;t<n.length;t++){const r=n[t][0],i=n[t][1];for(let t=-2;t<=2;t++)for(let n=-2;n<=2;n++)-2===t||2===t||-2===n||2===n||0===t&&0===n?e.set(r+t,i+n,!0,!0):e.set(r+t,i+n,!1,!0)}}(T,t),m(T,n,0),t>=7&&function(e,t){const n=e.size,r=f.getEncodedBits(t);let i,a,s;for(let t=0;t<18;t++)i=Math.floor(t/3),a=t%3+n-8-3,s=1==(r>>t&1),e.set(i,a,s,!0),e.set(a,i,s,!0)}(T,t),function(e,t){const n=e.size;let r=-1,i=n-1,a=7,s=0;for(let o=n-1;o>0;o-=2)for(6===o&&o--;;){for(let n=0;n<2;n++)if(!e.isReserved(i,o-n)){let r=!1;s<t.length&&(r=1==(t[s]>>>a&1)),e.set(i,o-n,r),a--,-1===a&&(s++,a=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}(T,y),isNaN(i)&&(i=u.getBestMask(T,m.bind(null,T,n))),u.applyMask(i,T),m(T,n,i),{modules:T,version:t,errorCorrectionLevel:n,maskPattern:i,segments:h}}t.create=function(e,t){if(void 0===e||""===e)throw new Error("No input text");let n,a,s=i.M;return void 0!==t&&(s=i.from(t.errorCorrectionLevel,i.M),n=f.from(t.version),a=u.from(t.maskPattern),t.toSJISFunc&&r.setToSJISFunction(t.toSJISFunc)),E(e,n,s,a)}},2882:(e,t,n)=>{const r=n(6143);function i(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}i.prototype.initialize=function(e){this.degree=e,this.genPoly=r.generateECPolynomial(this.degree)},i.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const n=r.mod(t,this.genPoly),i=this.degree-n.length;if(i>0){const e=new Uint8Array(this.degree);return e.set(n,i),e}return n},e.exports=i},7007:(e,t)=>{let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+")(?:.|[\r\n]))+";t.KANJI=new RegExp(n,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(r,"g"),t.NUMERIC=new RegExp("[0-9]+","g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const i=new RegExp("^"+n+"$"),a=new RegExp("^[0-9]+$"),s=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return i.test(e)},t.testNumeric=function(e){return a.test(e)},t.testAlphanumeric=function(e){return s.test(e)}},6130:(e,t,n)=>{const r=n(6910),i=n(1085),a=n(8260),s=n(3424),o=n(5442),l=n(7007),u=n(242),c=n(5987);function d(e){return unescape(encodeURIComponent(e)).length}function f(e,t,n){const r=[];let i;for(;null!==(i=e.exec(n));)r.push({data:i[0],index:i.index,mode:t,length:i[0].length});return r}function h(e){const t=f(l.NUMERIC,r.NUMERIC,e),n=f(l.ALPHANUMERIC,r.ALPHANUMERIC,e);let i,a;return u.isKanjiModeEnabled()?(i=f(l.BYTE,r.BYTE,e),a=f(l.KANJI,r.KANJI,e)):(i=f(l.BYTE_KANJI,r.BYTE,e),a=[]),t.concat(n,i,a).sort((function(e,t){return e.index-t.index})).map((function(e){return{data:e.data,mode:e.mode,length:e.length}}))}function g(e,t){switch(t){case r.NUMERIC:return i.getBitsLength(e);case r.ALPHANUMERIC:return a.getBitsLength(e);case r.KANJI:return o.getBitsLength(e);case r.BYTE:return s.getBitsLength(e)}}function p(e,t){let n;const l=r.getBestModeForData(e);if(n=r.from(t,l),n!==r.BYTE&&n.bit<l.bit)throw new Error('"'+e+'" cannot be encoded with mode '+r.toString(n)+".\n Suggested mode is: "+r.toString(l));switch(n!==r.KANJI||u.isKanjiModeEnabled()||(n=r.BYTE),n){case r.NUMERIC:return new i(e);case r.ALPHANUMERIC:return new a(e);case r.KANJI:return new o(e);case r.BYTE:return new s(e)}}t.fromArray=function(e){return e.reduce((function(e,t){return"string"==typeof t?e.push(p(t,null)):t.data&&e.push(p(t.data,t.mode)),e}),[])},t.fromString=function(e,n){const i=function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];switch(i.mode){case r.NUMERIC:t.push([i,{data:i.data,mode:r.ALPHANUMERIC,length:i.length},{data:i.data,mode:r.BYTE,length:i.length}]);break;case r.ALPHANUMERIC:t.push([i,{data:i.data,mode:r.BYTE,length:i.length}]);break;case r.KANJI:t.push([i,{data:i.data,mode:r.BYTE,length:d(i.data)}]);break;case r.BYTE:t.push([{data:i.data,mode:r.BYTE,length:d(i.data)}])}}return t}(h(e,u.isKanjiModeEnabled())),a=function(e,t){const n={},i={start:{}};let a=["start"];for(let s=0;s<e.length;s++){const o=e[s],l=[];for(let e=0;e<o.length;e++){const u=o[e],c=""+s+e;l.push(c),n[c]={node:u,lastCount:0},i[c]={};for(let e=0;e<a.length;e++){const s=a[e];n[s]&&n[s].node.mode===u.mode?(i[s][c]=g(n[s].lastCount+u.length,u.mode)-g(n[s].lastCount,u.mode),n[s].lastCount+=u.length):(n[s]&&(n[s].lastCount=u.length),i[s][c]=g(u.length,u.mode)+4+r.getCharCountIndicator(u.mode,t))}}a=l}for(let e=0;e<a.length;e++)i[a[e]].end=0;return{map:i,table:n}}(i,n),s=c.find_path(a.map,"start","end"),o=[];for(let e=1;e<s.length-1;e++)o.push(a.table[s[e]].node);return t.fromArray(o.reduce((function(e,t){const n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)}),[]))},t.rawSplit=function(e){return t.fromArray(h(e,u.isKanjiModeEnabled()))}},242:(e,t)=>{let n;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return r[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!=typeof e)throw new Error('"toSJISFunc" is not a valid function.');n=e},t.isKanjiModeEnabled=function(){return void 0!==n},t.toSJIS=function(e){return n(e)}},3114:(e,t)=>{t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},3103:(e,t,n)=>{const r=n(242),i=n(5393),a=n(4908),s=n(6910),o=n(3114),l=r.getBCHDigit(7973);function u(e,t){return s.getCharCountIndicator(e,t)+4}function c(e,t){let n=0;return e.forEach((function(e){const r=u(e.mode,t);n+=r+e.getBitsLength()})),n}t.from=function(e,t){return o.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,n){if(!o.isValid(e))throw new Error("Invalid QR Code version");void 0===n&&(n=s.BYTE);const a=8*(r.getSymbolTotalCodewords(e)-i.getTotalCodewordsCount(e,t));if(n===s.MIXED)return a;const l=a-u(n,e);switch(n){case s.NUMERIC:return Math.floor(l/10*3);case s.ALPHANUMERIC:return Math.floor(l/11*2);case s.KANJI:return Math.floor(l/13);case s.BYTE:default:return Math.floor(l/8)}},t.getBestVersionForData=function(e,n){let r;const i=a.from(n,a.M);if(Array.isArray(e)){if(e.length>1)return function(e,n){for(let r=1;r<=40;r++)if(c(e,r)<=t.getCapacity(r,n,s.MIXED))return r}(e,i);if(0===e.length)return 1;r=e[0]}else r=e;return function(e,n,r){for(let i=1;i<=40;i++)if(n<=t.getCapacity(i,r,e))return i}(r.mode,r.getLength(),i)},t.getEncodedBits=function(e){if(!o.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;r.getBCHDigit(t)-l>=0;)t^=7973<<r.getBCHDigit(t)-l;return e<<12|t}},6907:(e,t,n)=>{const r=n(9653);t.render=function(e,t,n){let i=n,a=t;void 0!==i||t&&t.getContext||(i=t,t=void 0),t||(a=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),i=r.getOptions(i);const s=r.getImageWidth(e.modules.size,i),o=a.getContext("2d"),l=o.createImageData(s,s);return r.qrToImageData(l.data,e,i),function(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=n,t.width=n,t.style.height=n+"px",t.style.width=n+"px"}(o,a,s),o.putImageData(l,0,0),a},t.renderToDataURL=function(e,n,r){let i=r;void 0!==i||n&&n.getContext||(i=n,n=void 0),i||(i={});const a=t.render(e,n,i),s=i.type||"image/png",o=i.rendererOpts||{};return a.toDataURL(s,o.quality)}},3776:(e,t,n)=>{const r=n(9653);function i(e,t){const n=e.a/255,r=t+'="'+e.hex+'"';return n<1?r+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function a(e,t,n){let r=e+t;return void 0!==n&&(r+=" "+n),r}t.render=function(e,t,n){const s=r.getOptions(t),o=e.modules.size,l=e.modules.data,u=o+2*s.margin,c=s.color.light.a?"<path "+i(s.color.light,"fill")+' d="M0 0h'+u+"v"+u+'H0z"/>':"",d="<path "+i(s.color.dark,"stroke")+' d="'+function(e,t,n){let r="",i=0,s=!1,o=0;for(let l=0;l<e.length;l++){const u=Math.floor(l%t),c=Math.floor(l/t);u||s||(s=!0),e[l]?(o++,l>0&&u>0&&e[l-1]||(r+=s?a("M",u+n,.5+c+n):a("m",i,0),i=0,s=!1),u+1<t&&e[l+1]||(r+=a("h",o),o=0)):i++}return r}(l,o,s.margin)+'"/>',f='viewBox="0 0 '+u+" "+u+'"',h='<svg xmlns="http://www.w3.org/2000/svg" '+(s.width?'width="'+s.width+'" height="'+s.width+'" ':"")+f+' shape-rendering="crispEdges">'+c+d+"</svg>\n";return"function"==typeof n&&n(null,h),h}},9653:(e,t)=>{function n(e){if("number"==typeof e&&(e=e.toString()),"string"!=typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map((function(e){return[e,e]})))),6===t.length&&t.push("F","F");const n=parseInt(t.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});const t=void 0===e.margin||null===e.margin||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:r,scale:r?4:i,margin:t,color:{dark:n(e.color.dark||"#000000ff"),light:n(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,n){const r=t.getScale(e,n);return Math.floor((e+2*n.margin)*r)},t.qrToImageData=function(e,n,r){const i=n.modules.size,a=n.modules.data,s=t.getScale(i,r),o=Math.floor((i+2*r.margin)*s),l=r.margin*s,u=[r.color.light,r.color.dark];for(let t=0;t<o;t++)for(let n=0;n<o;n++){let c=4*(t*o+n),d=r.color.light;t>=l&&n>=l&&t<o-l&&n<o-l&&(d=u[a[Math.floor((t-l)/s)*i+Math.floor((n-l)/s)]?1:0]),e[c++]=d.r,e[c++]=d.g,e[c++]=d.b,e[c]=d.a}}},9509:(e,t,n)=>{var r=n(8764),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),a(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},6099:(e,t,n)=>{!function(e){e.parser=function(e,t){return new i(e,t)},e.SAXParser=i,e.SAXStream=s,e.createStream=function(e,t){return new s(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(t,n){if(!(this instanceof i))return new i(t,n);var a=this;!function(e){for(var t=0,n=r.length;t<n;t++)e[r[t]]=""}(a),a.q=a.c="",a.bufferCheckPosition=e.MAX_BUFFER_LENGTH,a.opt=n||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!t,a.noscript=!(!t&&!a.opt.noscript),a.state=b.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(g)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),D(a,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),i.prototype={end:function(){M(this)},write:function(t){var n=this;if(this.error)throw this.error;if(n.closed)return L(n,"Cannot write after close. Assign an onready handler.");if(null===t)return M(n);"object"==typeof t&&(t=t.toString());for(var i=0,a="";a=q(t,i++),n.c=a,a;)switch(n.trackPosition&&(n.position++,"\n"===a?(n.line++,n.column=0):n.column++),n.state){case b.BEGIN:if(n.state=b.BEGIN_WHITESPACE,"\ufeff"===a)continue;G(n,a);continue;case b.BEGIN_WHITESPACE:G(n,a);continue;case b.TEXT:if(n.sawRoot&&!n.closedRoot){for(var s=i-1;a&&"<"!==a&&"&"!==a;)(a=q(t,i++))&&n.trackPosition&&(n.position++,"\n"===a?(n.line++,n.column=0):n.column++);n.textNode+=t.substring(s,i-1)}"<"!==a||n.sawRoot&&n.closedRoot&&!n.strict?(!v(o,a)||n.sawRoot&&!n.closedRoot||O(n,"Text data outside of root node."),"&"===a?n.state=b.TEXT_ENTITY:n.textNode+=a):(n.state=b.OPEN_WAKA,n.startTagPosition=n.position);continue;case b.SCRIPT:"<"===a?n.state=b.SCRIPT_ENDING:n.script+=a;continue;case b.SCRIPT_ENDING:"/"===a?n.state=b.CLOSE_TAG:(n.script+="<"+a,n.state=b.SCRIPT);continue;case b.OPEN_WAKA:if("!"===a)n.state=b.SGML_DECL,n.sgmlDecl="";else if(T(o,a));else if(T(p,a))n.state=b.OPEN_TAG,n.tagName=a;else if("/"===a)n.state=b.CLOSE_TAG,n.tagName="";else if("?"===a)n.state=b.PROC_INST,n.procInstName=n.procInstBody="";else{if(O(n,"Unencoded <"),n.startTagPosition+1<n.position){var l=n.position-n.startTagPosition;a=new Array(l).join(" ")+a}n.textNode+="<"+a,n.state=b.TEXT}continue;case b.SGML_DECL:"[CDATA["===(n.sgmlDecl+a).toUpperCase()?(w(n,"onopencdata"),n.state=b.CDATA,n.sgmlDecl="",n.cdata=""):n.sgmlDecl+a==="--"?(n.state=b.COMMENT,n.comment="",n.sgmlDecl=""):"DOCTYPE"===(n.sgmlDecl+a).toUpperCase()?(n.state=b.DOCTYPE,(n.doctype||n.sawRoot)&&O(n,"Inappropriately located doctype declaration"),n.doctype="",n.sgmlDecl=""):">"===a?(w(n,"onsgmldeclaration",n.sgmlDecl),n.sgmlDecl="",n.state=b.TEXT):T(c,a)?(n.state=b.SGML_DECL_QUOTED,n.sgmlDecl+=a):n.sgmlDecl+=a;continue;case b.SGML_DECL_QUOTED:a===n.q&&(n.state=b.SGML_DECL,n.q=""),n.sgmlDecl+=a;continue;case b.DOCTYPE:">"===a?(n.state=b.TEXT,w(n,"ondoctype",n.doctype),n.doctype=!0):(n.doctype+=a,"["===a?n.state=b.DOCTYPE_DTD:T(c,a)&&(n.state=b.DOCTYPE_QUOTED,n.q=a));continue;case b.DOCTYPE_QUOTED:n.doctype+=a,a===n.q&&(n.q="",n.state=b.DOCTYPE);continue;case b.DOCTYPE_DTD:n.doctype+=a,"]"===a?n.state=b.DOCTYPE:T(c,a)&&(n.state=b.DOCTYPE_DTD_QUOTED,n.q=a);continue;case b.DOCTYPE_DTD_QUOTED:n.doctype+=a,a===n.q&&(n.state=b.DOCTYPE_DTD,n.q="");continue;case b.COMMENT:"-"===a?n.state=b.COMMENT_ENDING:n.comment+=a;continue;case b.COMMENT_ENDING:"-"===a?(n.state=b.COMMENT_ENDED,n.comment=N(n.opt,n.comment),n.comment&&w(n,"oncomment",n.comment),n.comment=""):(n.comment+="-"+a,n.state=b.COMMENT);continue;case b.COMMENT_ENDED:">"!==a?(O(n,"Malformed comment"),n.comment+="--"+a,n.state=b.COMMENT):n.state=b.TEXT;continue;case b.CDATA:"]"===a?n.state=b.CDATA_ENDING:n.cdata+=a;continue;case b.CDATA_ENDING:"]"===a?n.state=b.CDATA_ENDING_2:(n.cdata+="]"+a,n.state=b.CDATA);continue;case b.CDATA_ENDING_2:">"===a?(n.cdata&&w(n,"oncdata",n.cdata),w(n,"onclosecdata"),n.cdata="",n.state=b.TEXT):"]"===a?n.cdata+="]":(n.cdata+="]]"+a,n.state=b.CDATA);continue;case b.PROC_INST:"?"===a?n.state=b.PROC_INST_ENDING:T(o,a)?n.state=b.PROC_INST_BODY:n.procInstName+=a;continue;case b.PROC_INST_BODY:if(!n.procInstBody&&T(o,a))continue;"?"===a?n.state=b.PROC_INST_ENDING:n.procInstBody+=a;continue;case b.PROC_INST_ENDING:">"===a?(w(n,"onprocessinginstruction",{name:n.procInstName,body:n.procInstBody}),n.procInstName=n.procInstBody="",n.state=b.TEXT):(n.procInstBody+="?"+a,n.state=b.PROC_INST_BODY);continue;case b.OPEN_TAG:T(m,a)?n.tagName+=a:(P(n),">"===a?k(n):"/"===a?n.state=b.OPEN_TAG_SLASH:(v(o,a)&&O(n,"Invalid character in tag name"),n.state=b.ATTRIB));continue;case b.OPEN_TAG_SLASH:">"===a?(k(n,!0),U(n)):(O(n,"Forward-slash in opening tag not followed by >"),n.state=b.ATTRIB);continue;case b.ATTRIB:if(T(o,a))continue;">"===a?k(n):"/"===a?n.state=b.OPEN_TAG_SLASH:T(p,a)?(n.attribName=a,n.attribValue="",n.state=b.ATTRIB_NAME):O(n,"Invalid attribute name");continue;case b.ATTRIB_NAME:"="===a?n.state=b.ATTRIB_VALUE:">"===a?(O(n,"Attribute without value"),n.attribValue=n.attribName,F(n),k(n)):T(o,a)?n.state=b.ATTRIB_NAME_SAW_WHITE:T(m,a)?n.attribName+=a:O(n,"Invalid attribute name");continue;case b.ATTRIB_NAME_SAW_WHITE:if("="===a)n.state=b.ATTRIB_VALUE;else{if(T(o,a))continue;O(n,"Attribute without value"),n.tag.attributes[n.attribName]="",n.attribValue="",w(n,"onattribute",{name:n.attribName,value:""}),n.attribName="",">"===a?k(n):T(p,a)?(n.attribName=a,n.state=b.ATTRIB_NAME):(O(n,"Invalid attribute name"),n.state=b.ATTRIB)}continue;case b.ATTRIB_VALUE:if(T(o,a))continue;T(c,a)?(n.q=a,n.state=b.ATTRIB_VALUE_QUOTED):(O(n,"Unquoted attribute value"),n.state=b.ATTRIB_VALUE_UNQUOTED,n.attribValue=a);continue;case b.ATTRIB_VALUE_QUOTED:if(a!==n.q){"&"===a?n.state=b.ATTRIB_VALUE_ENTITY_Q:n.attribValue+=a;continue}F(n),n.q="",n.state=b.ATTRIB_VALUE_CLOSED;continue;case b.ATTRIB_VALUE_CLOSED:T(o,a)?n.state=b.ATTRIB:">"===a?k(n):"/"===a?n.state=b.OPEN_TAG_SLASH:T(p,a)?(O(n,"No whitespace between attributes"),n.attribName=a,n.attribValue="",n.state=b.ATTRIB_NAME):O(n,"Invalid attribute name");continue;case b.ATTRIB_VALUE_UNQUOTED:if(v(d,a)){"&"===a?n.state=b.ATTRIB_VALUE_ENTITY_U:n.attribValue+=a;continue}F(n),">"===a?k(n):n.state=b.ATTRIB;continue;case b.CLOSE_TAG:if(n.tagName)">"===a?U(n):T(m,a)?n.tagName+=a:n.script?(n.script+="</"+n.tagName,n.tagName="",n.state=b.SCRIPT):(v(o,a)&&O(n,"Invalid tagname in closing tag"),n.state=b.CLOSE_TAG_SAW_WHITE);else{if(T(o,a))continue;v(p,a)?n.script?(n.script+="</"+a,n.state=b.SCRIPT):O(n,"Invalid tagname in closing tag."):n.tagName=a}continue;case b.CLOSE_TAG_SAW_WHITE:if(T(o,a))continue;">"===a?U(n):O(n,"Invalid characters in closing tag");continue;case b.TEXT_ENTITY:case b.ATTRIB_VALUE_ENTITY_Q:case b.ATTRIB_VALUE_ENTITY_U:var u,f;switch(n.state){case b.TEXT_ENTITY:u=b.TEXT,f="textNode";break;case b.ATTRIB_VALUE_ENTITY_Q:u=b.ATTRIB_VALUE_QUOTED,f="attribValue";break;case b.ATTRIB_VALUE_ENTITY_U:u=b.ATTRIB_VALUE_UNQUOTED,f="attribValue"}";"===a?(n[f]+=B(n),n.entity="",n.state=u):T(n.entity.length?y:E,a)?n.entity+=a:(O(n,"Invalid character in entity name"),n[f]+="&"+n.entity+a,n.entity="",n.state=u);continue;default:throw new Error(n,"Unknown state: "+n.state)}return n.position>=n.bufferCheckPosition&&function(t){for(var n=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,a=0,s=r.length;a<s;a++){var o=t[r[a]].length;if(o>n)switch(r[a]){case"textNode":C(t);break;case"cdata":w(t,"oncdata",t.cdata),t.cdata="";break;case"script":w(t,"onscript",t.script),t.script="";break;default:L(t,"Max buffer length exceeded: "+r[a])}i=Math.max(i,o)}var l=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=l+t.position}(n),n},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;C(e=this),""!==e.cdata&&(w(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(w(e,"onscript",e.script),e.script="")}};try{t=n(3086).Stream}catch(e){t=function(){}}var a=e.EVENTS.filter((function(e){return"error"!==e&&"end"!==e}));function s(e,n){if(!(this instanceof s))return new s(e,n);t.apply(this),this._parser=new i(e,n),this.writable=!0,this.readable=!0;var r=this;this._parser.onend=function(){r.emit("end")},this._parser.onerror=function(e){r.emit("error",e),r._parser.error=null},this._decoder=null,a.forEach((function(e){Object.defineProperty(r,"on"+e,{get:function(){return r._parser["on"+e]},set:function(t){if(!t)return r.removeAllListeners(e),r._parser["on"+e]=t,t;r.on(e,t)},enumerable:!0,configurable:!1})}))}s.prototype=Object.create(t.prototype,{constructor:{value:s}}),s.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=n(2553).s;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},s.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},s.prototype.on=function(e,n){var r=this;return r._parser["on"+e]||-1===a.indexOf(e)||(r._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),r.emit.apply(r,t)}),t.prototype.on.call(r,e,n)};var o="\r\n\t ",l="0124356789",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c="'\"",d=o+">",f="http://www.w3.org/XML/1998/namespace",h="http://www.w3.org/2000/xmlns/",g={xml:f,xmlns:h};o=_(o),l=_(l),u=_(u);var p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function _(e){return e.split("").reduce((function(e,t){return e[t]=!0,e}),{})}function T(e,t){return function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)?!!t.match(e):e[t]}function v(e,t){return!T(e,t)}c=_(c),d=_(d);var S,A,R,b=0;for(var I in e.STATE={BEGIN:b++,BEGIN_WHITESPACE:b++,TEXT:b++,TEXT_ENTITY:b++,OPEN_WAKA:b++,SGML_DECL:b++,SGML_DECL_QUOTED:b++,DOCTYPE:b++,DOCTYPE_QUOTED:b++,DOCTYPE_DTD:b++,DOCTYPE_DTD_QUOTED:b++,COMMENT_STARTING:b++,COMMENT:b++,COMMENT_ENDING:b++,COMMENT_ENDED:b++,CDATA:b++,CDATA_ENDING:b++,CDATA_ENDING_2:b++,PROC_INST:b++,PROC_INST_BODY:b++,PROC_INST_ENDING:b++,OPEN_TAG:b++,OPEN_TAG_SLASH:b++,ATTRIB:b++,ATTRIB_NAME:b++,ATTRIB_NAME_SAW_WHITE:b++,ATTRIB_VALUE:b++,ATTRIB_VALUE_QUOTED:b++,ATTRIB_VALUE_CLOSED:b++,ATTRIB_VALUE_UNQUOTED:b++,ATTRIB_VALUE_ENTITY_Q:b++,ATTRIB_VALUE_ENTITY_U:b++,CLOSE_TAG:b++,CLOSE_TAG_SAW_WHITE:b++,SCRIPT:b++,SCRIPT_ENDING:b++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach((function(t){var n=e.ENTITIES[t],r="number"==typeof n?String.fromCharCode(n):n;e.ENTITIES[t]=r})),e.STATE)e.STATE[e.STATE[I]]=I;function D(e,t,n){e[t]&&e[t](n)}function w(e,t,n){e.textNode&&C(e),D(e,t,n)}function C(e){e.textNode=N(e.opt,e.textNode),e.textNode&&D(e,"ontext",e.textNode),e.textNode=""}function N(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function L(e,t){return C(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,D(e,"onerror",t),e}function M(e){return e.sawRoot&&!e.closedRoot&&O(e,"Unclosed root tag"),e.state!==b.BEGIN&&e.state!==b.BEGIN_WHITESPACE&&e.state!==b.TEXT&&L(e,"Unexpected end"),C(e),e.c="",e.closed=!0,D(e,"onend"),i.call(e,e.strict,e.opt),e}function O(e,t){if("object"!=typeof e||!(e instanceof i))throw new Error("bad call to strictFail");e.strict&&L(e,t)}function P(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,n=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(n.ns=t.ns),e.attribList.length=0,w(e,"onopentagstart",n)}function x(e,t){var n=e.indexOf(":")<0?["",e]:e.split(":"),r=n[0],i=n[1];return t&&"xmlns"===e&&(r="xmlns",i=""),{prefix:r,local:i}}function F(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=x(e.attribName,!0),n=t.prefix,r=t.local;if("xmlns"===n)if("xml"===r&&e.attribValue!==f)O(e,"xml: prefix must be bound to "+f+"\nActual: "+e.attribValue);else if("xmlns"===r&&e.attribValue!==h)O(e,"xmlns: prefix must be bound to "+h+"\nActual: "+e.attribValue);else{var i=e.tag,a=e.tags[e.tags.length-1]||e;i.ns===a.ns&&(i.ns=Object.create(a.ns)),i.ns[r]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,w(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function k(e,t){if(e.opt.xmlns){var n=e.tag,r=x(e.tagName);n.prefix=r.prefix,n.local=r.local,n.uri=n.ns[r.prefix]||"",n.prefix&&!n.uri&&(O(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),n.uri=r.prefix);var i=e.tags[e.tags.length-1]||e;n.ns&&i.ns!==n.ns&&Object.keys(n.ns).forEach((function(t){w(e,"onopennamespace",{prefix:t,uri:n.ns[t]})}));for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],u=o[1],c=x(l,!0),d=c.prefix,f=c.local,h=""===d?"":n.ns[d]||"",g={name:l,value:u,prefix:d,local:f,uri:h};d&&"xmlns"!==d&&!h&&(O(e,"Unbound namespace prefix: "+JSON.stringify(d)),g.uri=d),e.tag.attributes[l]=g,w(e,"onattribute",g)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),w(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=b.TEXT:e.state=b.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function U(e){if(!e.tagName)return O(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=b.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=b.SCRIPT);w(e,"onscript",e.script),e.script=""}var t=e.tags.length,n=e.tagName;e.strict||(n=n[e.looseCase]());for(var r=n;t--&&e.tags[t].name!==r;)O(e,"Unexpected close tag");if(t<0)return O(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=b.TEXT);e.tagName=n;for(var i=e.tags.length;i-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,w(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach((function(t){var n=a.ns[t];w(e,"onclosenamespace",{prefix:t,uri:n})}))}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=b.TEXT}function B(e){var t,n=e.entity,r=n.toLowerCase(),i="";return e.ENTITIES[n]?e.ENTITIES[n]:e.ENTITIES[r]?e.ENTITIES[r]:("#"===(n=r).charAt(0)&&("x"===n.charAt(1)?(n=n.slice(2),i=(t=parseInt(n,16)).toString(16)):(n=n.slice(1),i=(t=parseInt(n,10)).toString(10))),n=n.replace(/^0+/,""),i.toLowerCase()!==n?(O(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function G(e,t){"<"===t?(e.state=b.OPEN_WAKA,e.startTagPosition=e.position):v(o,t)&&(O(e,"Non-whitespace before first tag."),e.textNode=t,e.state=b.TEXT)}function q(e,t){var n="";return t<e.length&&(n=e.charAt(t)),n}b=e.STATE,String.fromCodePoint||(S=String.fromCharCode,A=Math.floor,R=function(){var e,t,n=16384,r=[],i=-1,a=arguments.length;if(!a)return"";for(var s="";++i<a;){var o=Number(arguments[i]);if(!isFinite(o)||o<0||o>1114111||A(o)!==o)throw RangeError("Invalid code point: "+o);o<=65535?r.push(o):(e=55296+((o-=65536)>>10),t=o%1024+56320,r.push(e,t)),(i+1===a||r.length>n)&&(s+=S.apply(null,r),r.length=0)}return s},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:R,configurable:!0,writable:!0}):String.fromCodePoint=R)}(t)},3086:(e,t,n)=>{var r=n(624);function i(){r.call(this)}i.prototype=new r,e.exports=i,i.Stream=i,i.prototype.pipe=function(e,t){var n=this;function r(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function i(){n.readable&&n.resume&&n.resume()}n.on("data",r),e.on("drain",i),e._isStdio||t&&!1===t.end||(n.on("end",s),n.on("close",o));var a=!1;function s(){a||(a=!0,e.end())}function o(){a||(a=!0,"function"==typeof e.destroy&&e.destroy())}function l(e){if(u(),!this.hasListeners("error"))throw e}function u(){n.off("data",r),e.off("drain",i),n.off("end",s),n.off("close",o),n.off("error",l),e.off("error",l),n.off("end",u),n.off("close",u),e.off("end",u),e.off("close",u)}return n.on("error",l),e.on("error",l),n.on("end",u),n.on("close",u),e.on("end",u),e.on("close",u),e.emit("pipe",n),e}},2553:(e,t,n)=>{"use strict";var r=n(9509).Buffer,i=r.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(r.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:return this.write=f,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var n=e.toString("utf16le",t);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var n=function(e,t,n){var r=t.length-1;if(r<n)return 0;var i=s(t[r]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(e.lastNeed=i-2),i):--r<n||-2===i?0:(i=s(t[r]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var r=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,r),e.toString("utf8",t,r)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},9707:(e,t,n)=>{"use strict";function r(e){return encodeURI(function(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}(e))}n.d(t,{cX:()=>S});const i={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},a={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},s={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let o="undefined"!=typeof self&&self.location?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function l(e,t=Object.create(null),n=o,u=""){if(e&&"object"==typeof e&&!Array.isArray(e)){const r=e.$id||e.id;if(r){const i=new URL(r,n.href);i.hash.length>1?t[i.href]=e:(i.hash="",""===u?n=i:l(e,t,n))}}else if(!0!==e&&!1!==e)return t;const c=n.href+(u?"#"+u:"");if(void 0!==t[c])throw new Error(`Duplicate schema URI "${c}".`);if(t[c]=e,!0===e||!1===e)return t;if(void 0===e.__absolute_uri__&&Object.defineProperty(e,"__absolute_uri__",{enumerable:!1,value:c}),e.$ref&&void 0===e.__absolute_ref__){const t=new URL(e.$ref,n.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_ref__",{enumerable:!1,value:t.href})}if(e.$recursiveRef&&void 0===e.__absolute_recursive_ref__){const t=new URL(e.$recursiveRef,n.href);t.hash=t.hash,Object.defineProperty(e,"__absolute_recursive_ref__",{enumerable:!1,value:t.href})}e.$anchor&&(t[new URL("#"+e.$anchor,n.href).href]=e);for(let o in e){if(s[o])continue;const c=`${u}/${r(o)}`,d=e[o];if(Array.isArray(d)){if(i[o]){const e=d.length;for(let r=0;r<e;r++)l(d[r],t,n,`${c}/${r}`)}}else if(a[o])for(let e in d)l(d[e],t,n,`${c}/${r(e)}`);else l(d,t,n,c)}return t}function u(e,t){const n=typeof e;if(n!==typeof t)return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(!u(e[r],t[r]))return!1;return!0}if("object"===n){if(!e||!t)return e===t;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const r of n)if(!u(e[r],t[r]))return!1;return!0}return e===t}const c=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,d=[0,31,28,31,30,31,30,31,31,30,31,30,31],f=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function h(e){return e.test.bind(e)}const g={date:p,time:m.bind(void 0,!1),"date-time":function(e){const t=e.split(E);return 2==t.length&&p(t[0])&&m(!0,t[1])},duration:e=>e.length>1&&e.length<80&&(/^P\d+([.,]\d+)?W$/.test(e)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(e)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(e)),uri:function(e){return y.test(e)&&_.test(e)},"uri-reference":h(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":h(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:h(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:e=>{if('"'===e[0])return!1;const[t,n,...r]=e.split("@");return!(!t||!n||0!==r.length||t.length>64||n.length>253)&&"."!==t[0]&&!t.endsWith(".")&&!t.includes("..")&&!(!/^[a-z0-9.-]+$/i.test(n)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(t))&&n.split(".").every((e=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(e)))},hostname:h(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:h(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:h(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:function(e){if(T.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}},uuid:h(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":h(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":h(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":h(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/),date:h(/^\d\d\d\d-[0-1]\d-[0-3]\d$/),time:h(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i),"date-time":h(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i),"uri-reference":h(/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i)};function p(e){const t=e.match(c);if(!t)return!1;const n=+t[1],r=+t[2],i=+t[3];return r>=1&&r<=12&&i>=1&&i<=(2==r&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(n)?29:d[r])}function m(e,t){const n=t.match(f);if(!n)return!1;const r=+n[1],i=+n[2],a=+n[3],s=!!n[5];return(r<=23&&i<=59&&a<=59||23==r&&59==i&&60==a)&&(!e||s)}const E=/t|\s/i,y=/\/|:/,_=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,T=/[^\\]\\Z/;function v(e,t,n="2019-09",i=l(t),a=!0,s=null,o="#",c="#",d=Object.create(null)){if(!0===t)return{valid:!0,errors:[]};if(!1===t)return{valid:!1,errors:[{instanceLocation:o,keyword:"false",keywordLocation:o,error:"False boolean schema."}]};const f=typeof e;let h;switch(f){case"boolean":case"number":case"string":h=f;break;case"object":h=null===e?"null":Array.isArray(e)?"array":"object";break;default:throw new Error(`Instances of "${f}" type are not supported.`)}const{$ref:p,$recursiveRef:m,$recursiveAnchor:E,type:y,const:_,enum:T,required:S,not:A,anyOf:R,allOf:b,oneOf:I,if:D,then:w,else:C,format:N,properties:L,patternProperties:M,additionalProperties:O,unevaluatedProperties:P,minProperties:x,maxProperties:F,propertyNames:k,dependentRequired:U,dependentSchemas:B,dependencies:G,prefixItems:q,items:K,additionalItems:H,unevaluatedItems:Y,contains:V,minContains:j,maxContains:z,minItems:W,maxItems:$,uniqueItems:X,minimum:Q,maximum:J,exclusiveMinimum:Z,exclusiveMaximum:ee,multipleOf:te,minLength:ne,maxLength:re,pattern:ie,__absolute_ref__:ae,__absolute_recursive_ref__:se}=t,oe=[];if(!0===E&&null===s&&(s=t),"#"===m){const r=null===s?i[se]:s,l=`${c}/$recursiveRef`,u=v(e,null===s?t:s,n,i,a,r,o,l,d);u.valid||oe.push({instanceLocation:o,keyword:"$recursiveRef",keywordLocation:l,error:"A subschema had errors."},...u.errors)}if(void 0!==p){const t=i[ae||p];if(void 0===t){let e=`Unresolved $ref "${p}".`;throw ae&&ae!==p&&(e+=`  Absolute URI "${ae}".`),e+=`\nKnown schemas:\n- ${Object.keys(i).join("\n- ")}`,new Error(e)}const r=`${c}/$ref`,l=v(e,t,n,i,a,s,o,r,d);if(l.valid||oe.push({instanceLocation:o,keyword:"$ref",keywordLocation:r,error:"A subschema had errors."},...l.errors),"4"===n||"7"===n)return{valid:0===oe.length,errors:oe}}if(Array.isArray(y)){let t=y.length,n=!1;for(let r=0;r<t;r++)if(h===y[r]||"integer"===y[r]&&"number"===h&&e%1==0&&e==e){n=!0;break}n||oe.push({instanceLocation:o,keyword:"type",keywordLocation:`${c}/type`,error:`Instance type "${h}" is invalid. Expected "${y.join('", "')}".`})}else"integer"===y?("number"!==h||e%1||e!=e)&&oe.push({instanceLocation:o,keyword:"type",keywordLocation:`${c}/type`,error:`Instance type "${h}" is invalid. Expected "${y}".`}):void 0!==y&&h!==y&&oe.push({instanceLocation:o,keyword:"type",keywordLocation:`${c}/type`,error:`Instance type "${h}" is invalid. Expected "${y}".`});if(void 0!==_&&("object"===h||"array"===h?u(e,_)||oe.push({instanceLocation:o,keyword:"const",keywordLocation:`${c}/const`,error:`Instance does not match ${JSON.stringify(_)}.`}):e!==_&&oe.push({instanceLocation:o,keyword:"const",keywordLocation:`${c}/const`,error:`Instance does not match ${JSON.stringify(_)}.`})),void 0!==T&&("object"===h||"array"===h?T.some((t=>u(e,t)))||oe.push({instanceLocation:o,keyword:"enum",keywordLocation:`${c}/enum`,error:`Instance does not match any of ${JSON.stringify(T)}.`}):T.some((t=>e===t))||oe.push({instanceLocation:o,keyword:"enum",keywordLocation:`${c}/enum`,error:`Instance does not match any of ${JSON.stringify(T)}.`})),void 0!==A){const t=`${c}/not`;v(e,A,n,i,a,s,o,t).valid&&oe.push({instanceLocation:o,keyword:"not",keywordLocation:t,error:'Instance matched "not" schema.'})}let le=[];if(void 0!==R){const t=`${c}/anyOf`,r=oe.length;let l=!1;for(let r=0;r<R.length;r++){const u=R[r],c=Object.create(d),f=v(e,u,n,i,a,!0===E?s:null,o,`${t}/${r}`,c);oe.push(...f.errors),l=l||f.valid,f.valid&&le.push(c)}l?oe.length=r:oe.splice(r,0,{instanceLocation:o,keyword:"anyOf",keywordLocation:t,error:"Instance does not match any subschemas."})}if(void 0!==b){const t=`${c}/allOf`,r=oe.length;let l=!0;for(let r=0;r<b.length;r++){const u=b[r],c=Object.create(d),f=v(e,u,n,i,a,!0===E?s:null,o,`${t}/${r}`,c);oe.push(...f.errors),l=l&&f.valid,f.valid&&le.push(c)}l?oe.length=r:oe.splice(r,0,{instanceLocation:o,keyword:"allOf",keywordLocation:t,error:"Instance does not match every subschema."})}if(void 0!==I){const t=`${c}/oneOf`,r=oe.length,l=I.filter(((r,l)=>{const u=Object.create(d),c=v(e,r,n,i,a,!0===E?s:null,o,`${t}/${l}`,u);return oe.push(...c.errors),c.valid&&le.push(u),c.valid})).length;1===l?oe.length=r:oe.splice(r,0,{instanceLocation:o,keyword:"oneOf",keywordLocation:t,error:`Instance does not match exactly one subschema (${l} matches).`})}if("object"!==h&&"array"!==h||Object.assign(d,...le),void 0!==D){const t=`${c}/if`;if(v(e,D,n,i,a,s,o,t,d).valid){if(void 0!==w){const r=v(e,w,n,i,a,s,o,`${c}/then`,d);r.valid||oe.push({instanceLocation:o,keyword:"if",keywordLocation:t,error:'Instance does not match "then" schema.'},...r.errors)}}else if(void 0!==C){const r=v(e,C,n,i,a,s,o,`${c}/else`,d);r.valid||oe.push({instanceLocation:o,keyword:"if",keywordLocation:t,error:'Instance does not match "else" schema.'},...r.errors)}}if("object"===h){if(void 0!==S)for(const t of S)t in e||oe.push({instanceLocation:o,keyword:"required",keywordLocation:`${c}/required`,error:`Instance does not have required property "${t}".`});const t=Object.keys(e);if(void 0!==x&&t.length<x&&oe.push({instanceLocation:o,keyword:"minProperties",keywordLocation:`${c}/minProperties`,error:`Instance does not have at least ${x} properties.`}),void 0!==F&&t.length>F&&oe.push({instanceLocation:o,keyword:"maxProperties",keywordLocation:`${c}/maxProperties`,error:`Instance does not have at least ${F} properties.`}),void 0!==k){const t=`${c}/propertyNames`;for(const l in e){const e=`${o}/${r(l)}`,u=v(l,k,n,i,a,s,e,t);u.valid||oe.push({instanceLocation:o,keyword:"propertyNames",keywordLocation:t,error:`Property name "${l}" does not match schema.`},...u.errors)}}if(void 0!==U){const t=`${c}/dependantRequired`;for(const n in U)if(n in e){const r=U[n];for(const i of r)i in e||oe.push({instanceLocation:o,keyword:"dependentRequired",keywordLocation:t,error:`Instance has "${n}" but does not have "${i}".`})}}if(void 0!==B)for(const t in B){const l=`${c}/dependentSchemas`;if(t in e){const u=v(e,B[t],n,i,a,s,o,`${l}/${r(t)}`,d);u.valid||oe.push({instanceLocation:o,keyword:"dependentSchemas",keywordLocation:l,error:`Instance has "${t}" but does not match dependant schema.`},...u.errors)}}if(void 0!==G){const t=`${c}/dependencies`;for(const l in G)if(l in e){const u=G[l];if(Array.isArray(u))for(const n of u)n in e||oe.push({instanceLocation:o,keyword:"dependencies",keywordLocation:t,error:`Instance has "${l}" but does not have "${n}".`});else{const c=v(e,u,n,i,a,s,o,`${t}/${r(l)}`);c.valid||oe.push({instanceLocation:o,keyword:"dependencies",keywordLocation:t,error:`Instance has "${l}" but does not match dependant schema.`},...c.errors)}}}const l=Object.create(null);let u=!1;if(void 0!==L){const t=`${c}/properties`;for(const c in L){if(!(c in e))continue;const f=`${o}/${r(c)}`,h=v(e[c],L[c],n,i,a,s,f,`${t}/${r(c)}`);if(h.valid)d[c]=l[c]=!0;else if(u=a,oe.push({instanceLocation:o,keyword:"properties",keywordLocation:t,error:`Property "${c}" does not match schema.`},...h.errors),u)break}}if(!u&&void 0!==M){const t=`${c}/patternProperties`;for(const c in M){const f=new RegExp(c),h=M[c];for(const g in e){if(!f.test(g))continue;const p=`${o}/${r(g)}`,m=v(e[g],h,n,i,a,s,p,`${t}/${r(c)}`);m.valid?d[g]=l[g]=!0:(u=a,oe.push({instanceLocation:o,keyword:"patternProperties",keywordLocation:t,error:`Property "${g}" matches pattern "${c}" but does not match associated schema.`},...m.errors))}}}if(u||void 0===O){if(!u&&void 0!==P){const t=`${c}/unevaluatedProperties`;for(const l in e)if(!d[l]){const u=`${o}/${r(l)}`,c=v(e[l],P,n,i,a,s,u,t);c.valid?d[l]=!0:oe.push({instanceLocation:o,keyword:"unevaluatedProperties",keywordLocation:t,error:`Property "${l}" does not match unevaluated properties schema.`},...c.errors)}}}else{const t=`${c}/additionalProperties`;for(const c in e){if(l[c])continue;const f=`${o}/${r(c)}`,h=v(e[c],O,n,i,a,s,f,t);h.valid?d[c]=!0:(u=a,oe.push({instanceLocation:o,keyword:"additionalProperties",keywordLocation:t,error:`Property "${c}" does not match additional properties schema.`},...h.errors))}}}else if("array"===h){void 0!==$&&e.length>$&&oe.push({instanceLocation:o,keyword:"maxItems",keywordLocation:`${c}/maxItems`,error:`Array has too many items (${e.length} > ${$}).`}),void 0!==W&&e.length<W&&oe.push({instanceLocation:o,keyword:"minItems",keywordLocation:`${c}/minItems`,error:`Array has too few items (${e.length} < ${W}).`});const t=e.length;let r=0,l=!1;if(void 0!==q){const u=`${c}/prefixItems`,f=Math.min(q.length,t);for(;r<f;r++){const t=v(e[r],q[r],n,i,a,s,`${o}/${r}`,`${u}/${r}`);if(d[r]=!0,!t.valid&&(l=a,oe.push({instanceLocation:o,keyword:"prefixItems",keywordLocation:u,error:"Items did not match schema."},...t.errors),l))break}}if(void 0!==K){const u=`${c}/items`;if(Array.isArray(K)){const c=Math.min(K.length,t);for(;r<c;r++){const t=v(e[r],K[r],n,i,a,s,`${o}/${r}`,`${u}/${r}`);if(d[r]=!0,!t.valid&&(l=a,oe.push({instanceLocation:o,keyword:"items",keywordLocation:u,error:"Items did not match schema."},...t.errors),l))break}}else for(;r<t;r++){const t=v(e[r],K,n,i,a,s,`${o}/${r}`,u);if(d[r]=!0,!t.valid&&(l=a,oe.push({instanceLocation:o,keyword:"items",keywordLocation:u,error:"Items did not match schema."},...t.errors),l))break}if(!l&&void 0!==H){const u=`${c}/additionalItems`;for(;r<t;r++){const t=v(e[r],H,n,i,a,s,`${o}/${r}`,u);d[r]=!0,t.valid||(l=a,oe.push({instanceLocation:o,keyword:"additionalItems",keywordLocation:u,error:"Items did not match additional items schema."},...t.errors))}}}if(void 0!==V)if(0===t&&void 0===j)oe.push({instanceLocation:o,keyword:"contains",keywordLocation:`${c}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(void 0!==j&&t<j)oe.push({instanceLocation:o,keyword:"minContains",keywordLocation:`${c}/minContains`,error:`Array has less items (${t}) than minContains (${j}).`});else{const r=`${c}/contains`,l=oe.length;let u=0;for(let l=0;l<t;l++){const t=v(e[l],V,n,i,a,s,`${o}/${l}`,r);t.valid?(d[l]=!0,u++):oe.push(...t.errors)}u>=(j||0)&&(oe.length=l),void 0===j&&void 0===z&&0===u?oe.splice(l,0,{instanceLocation:o,keyword:"contains",keywordLocation:r,error:"Array does not contain item matching schema."}):void 0!==j&&u<j?oe.push({instanceLocation:o,keyword:"minContains",keywordLocation:`${c}/minContains`,error:`Array must contain at least ${j} items matching schema. Only ${u} items were found.`}):void 0!==z&&u>z&&oe.push({instanceLocation:o,keyword:"maxContains",keywordLocation:`${c}/maxContains`,error:`Array may contain at most ${z} items matching schema. ${u} items were found.`})}if(!l&&void 0!==Y){const l=`${c}/unevaluatedItems`;for(;r<t;r++){if(d[r])continue;const t=v(e[r],Y,n,i,a,s,`${o}/${r}`,l);d[r]=!0,t.valid||oe.push({instanceLocation:o,keyword:"unevaluatedItems",keywordLocation:l,error:"Items did not match unevaluated items schema."},...t.errors)}}if(X)for(let n=0;n<t;n++){const r=e[n],i="object"==typeof r&&null!==r;for(let a=0;a<t;a++){if(n===a)continue;const t=e[a],s="object"==typeof t&&null!==t;(r===t||i&&s&&u(r,t))&&(oe.push({instanceLocation:o,keyword:"uniqueItems",keywordLocation:`${c}/uniqueItems`,error:`Duplicate items at indexes ${n} and ${a}.`}),n=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER)}}}else if("number"===h){if("4"===n?(void 0!==Q&&(!0===Z&&e<=Q||e<Q)&&oe.push({instanceLocation:o,keyword:"minimum",keywordLocation:`${c}/minimum`,error:`${e} is less than ${Z?"or equal to ":""} ${Q}.`}),void 0!==J&&(!0===ee&&e>=J||e>J)&&oe.push({instanceLocation:o,keyword:"maximum",keywordLocation:`${c}/maximum`,error:`${e} is greater than ${ee?"or equal to ":""} ${J}.`})):(void 0!==Q&&e<Q&&oe.push({instanceLocation:o,keyword:"minimum",keywordLocation:`${c}/minimum`,error:`${e} is less than ${Q}.`}),void 0!==J&&e>J&&oe.push({instanceLocation:o,keyword:"maximum",keywordLocation:`${c}/maximum`,error:`${e} is greater than ${J}.`}),void 0!==Z&&e<=Z&&oe.push({instanceLocation:o,keyword:"exclusiveMinimum",keywordLocation:`${c}/exclusiveMinimum`,error:`${e} is less than ${Z}.`}),void 0!==ee&&e>=ee&&oe.push({instanceLocation:o,keyword:"exclusiveMaximum",keywordLocation:`${c}/exclusiveMaximum`,error:`${e} is greater than or equal to ${ee}.`})),void 0!==te){const t=e%te;Math.abs(0-t)>=1.1920929e-7&&Math.abs(te-t)>=1.1920929e-7&&oe.push({instanceLocation:o,keyword:"multipleOf",keywordLocation:`${c}/multipleOf`,error:`${e} is not a multiple of ${te}.`})}}else if("string"===h){const t=void 0===ne&&void 0===re?0:function(e){let t,n=0,r=e.length,i=0;for(;i<r;)n++,t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<r&&(t=e.charCodeAt(i),56320==(64512&t)&&i++);return n}(e);void 0!==ne&&t<ne&&oe.push({instanceLocation:o,keyword:"minLength",keywordLocation:`${c}/minLength`,error:`String is too short (${t} < ${ne}).`}),void 0!==re&&t>re&&oe.push({instanceLocation:o,keyword:"maxLength",keywordLocation:`${c}/maxLength`,error:`String is too long (${t} > ${re}).`}),void 0===ie||new RegExp(ie).test(e)||oe.push({instanceLocation:o,keyword:"pattern",keywordLocation:`${c}/pattern`,error:"String does not match pattern."}),void 0!==N&&g[N]&&!g[N](e)&&oe.push({instanceLocation:o,keyword:"format",keywordLocation:`${c}/format`,error:`String does not match format "${N}".`})}return{valid:0===oe.length,errors:oe}}class S{constructor(e,t="2019-09",n=!0){this.schema=e,this.draft=t,this.shortCircuit=n,this.lookup=l(e)}validate(e){return v(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),l(e,this.lookup)}}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(6010),i=window;for(var o in r)i[o]=r[o];r.__esModule&&Object.defineProperty(i,"__esModule",{value:!0})})();
